<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>لوحة تحكم التاجر - VIRA MALL</title>
<style>
body{font-family:'Cairo',sans-serif;background:#f5f5f7;padding:15px}
h1{text-align:center;color:#0f1111}
.upload-section{background:white;padding:15px;border-radius:15px;box-shadow:0 5px 15px rgba(0,0,0,0.1);margin-bottom:20px;display:flex;flex-direction:column;gap:10px}
input,button{padding:10px;border-radius:10px;border:1px solid #ccc;font-size:14px}
button{background:#D4AF37;color:#000;border:none;cursor:pointer;font-weight:bold}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #ccc;padding:8px;text-align:center;font-size:12px}
th{background:#0f1111;color:#D4AF37}
a{color:#D4AF37;text-decoration:none;word-break:break-all}
button:hover{opacity:.8}
</style>
</head>
<body>

<h1>لوحة تحكم التاجر - VIRA MALL</h1>

<div class="upload-section">
  <input type="file" id="imageInput" accept="image/*">
  <input type="text" id="productName" placeholder="اسم المنتج">
  <input type="text" id="productColor" placeholder="لون المنتج">
  <input type="text" id="productDesc" placeholder="وصف المنتج">
  <input type="text" id="productPrice" placeholder="السعر">
  <input type="text" id="productSize" placeholder="المقاس">
  <input type="text" id="productEmbroidery" placeholder="التطريز">
  <button id="uploadBtn">رفع المنتج</button>
</div>

<h2>المنتجات المرفوعة</h2>
<table id="productsTable">
<thead>
<tr>
<th>اسم المنتج</th>
<th>اللون</th>
<th>الوصف</th>
<th>السعر</th>
<th>المقاس</th>
<th>التطريز</th>
<th>رابط الصورة</th>
</tr>
</thead>
<tbody></tbody>
</table>

<button id="copyLinksBtn">نسخ جميع الروابط</button>
<button id="downloadCSVBtn">تحميل CSV</button>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBOcv6Feaq63nE3P1YH72-q--xZ1GF3xEA",
  authDomain: "vira-mall.firebaseapp.com",
  projectId: "vira-mall",
  storageBucket: "vira-mall.appspot.com",
  messagingSenderId: "504385201131",
  appId: "1:504385201131:web:af56a81e75630b76b12fae",
  measurementId: "G-71TTJFB4KN"
};

firebase.initializeApp(firebaseConfig);
const storage = firebase.storage();

const imageInput = document.getElementById('imageInput');
const uploadButton = document.getElementById('uploadBtn');
const productNameInput = document.getElementById('productName');
const productColorInput = document.getElementById('productColor');
const productDescInput = document.getElementById('productDesc');
const productPriceInput = document.getElementById('productPrice');
const productSizeInput = document.getElementById('productSize');
const productEmbroideryInput = document.getElementById('productEmbroidery');
const tableBody = document.getElementById('productsTable').querySelector('tbody');
const copyLinksBtn = document.getElementById('copyLinksBtn');
const downloadCSVBtn = document.getElementById('downloadCSVBtn');

const uploadedProducts = [];

uploadButton.addEventListener('click', async () => {
  const file = imageInput.files[0];
  if(!file){ alert('اختاري صورة للمنتج'); return; }

  const name = productNameInput.value || "بدون اسم";
  const color = productColorInput.value || "-";
  const desc = productDescInput.value || "-";
  const price = productPriceInput.value || "-";
  const size = productSizeInput.value || "-";
  const embroidery = productEmbroideryInput.value || "-";

  try {
    const storageRef = storage.ref('products/' + file.name);
    const snapshot = await storageRef.put(file);
    const url = await snapshot.ref.getDownloadURL();

    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${name}</td>
      <td>${color}</td>
      <td>${desc}</td>
      <td>${price}</td>
      <td>${size}</td>
      <td>${embroidery}</td>
      <td><a href="${url}" target="_blank">${url}</a></td>
    `;
    tableBody.appendChild(row);

    uploadedProducts.push({name,color,desc,price,size,embroidery,url});

    imageInput.value = '';
    productNameInput.value = '';
    productColorInput.value = '';
    productDescInput.value = '';
    productPriceInput.value = '';
    productSizeInput.value = '';
    productEmbroideryInput.value = '';
  } catch(err){ console.error(err); alert('خطأ في الرفع'); }
});

// نسخ الروابط
copyLinksBtn.addEventListener('click', () => {
  if(uploadedProducts.length===0){ alert('لا توجد روابط للنسخ'); return; }
  const text = uploadedProducts.map(p=>p.url).join('\n');
  navigator.clipboard.writeText(text).then(()=>alert('تم نسخ جميع الروابط'));
});

// تنزيل CSV
downloadCSVBtn.addEventListener('click', () => {
  if(uploadedProducts.length===0){ alert('لا توجد منتجات لتحويلها CSV'); return; }
  const headers = ["اسم المنتج","اللون","الوصف","السعر","المقاس","التطريز","رابط الصورة"];
  let csv = headers.join(",") + "\n";
  uploadedProducts.forEach(p=>{
    csv += [p.name,p.color,p.desc,p.price,p.size,p.embroidery,p.url].map(f=>`"${f}"`).join(",") + "\n";
  });
  const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download='products.csv';
  document.body.appendChild(a); a.click(); document.body.removeChild(a);
});
</script>

</body>
</html>
