<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ููุญุฉ ุชุญูู ุงูุชุงุฌุฑ - Vira Mall</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>ููุญุฉ ุชุญูู ุงูุชุงุฌุฑ</h1>

  <!-- ูุณู ุฑูุน ุงูููุชุฌุงุช -->
  <div class="upload-section">
    <input type="file" id="imageInput" accept="image/*">
    <input type="text" id="productName" placeholder="ุงุณู ุงูููุชุฌ">
    <input type="text" id="productColor" placeholder="ููู ุงูููุชุฌ">
    <input type="text" id="productDesc" placeholder="ูุตู ุงูููุชุฌ">
    <input type="text" id="productPrice" placeholder="ุงูุณุนุฑ">
    <input type="text" id="productSize" placeholder="ุงูููุงุณ">
    <input type="text" id="productEmbroidery" placeholder="ุงูุชุทุฑูุฒ">
    <button id="uploadBtn">ุฑูุน ุงูููุชุฌ</button>
  </div>

  <!-- ุฌุฏูู ุงูููุชุฌุงุช ุงููุฑููุนุฉ -->
  <h2>ุงูููุชุฌุงุช ุงููุฑููุนุฉ</h2>
  <table border="1" id="productsTable">
    <thead>
      <tr>
        <th>ุงุณู ุงูููุชุฌ</th>
        <th>ุงูููู</th>
        <th>ุงููุตู</th>
        <th>ุงูุณุนุฑ</th>
        <th>ุงูููุงุณ</th>
        <th>ุงูุชุทุฑูุฒ</th>
        <th>ุฑุงุจุท ุงูุตูุฑุฉ</th>
      </tr>
    </thead>
    <tbody>
      <!-- ุณูุชู ููุก ุงูุฌุฏูู ุชููุงุฆูุงู -->
    </tbody>
  </table>

  <!-- ุฃุฒุฑุงุฑ ูุณุฎ ูุชุญููู CSV -->
  <button id="copyLinksBtn">ูุณุฎ ุฌููุน ุงูุฑูุงุจุท</button>
  <button id="downloadCSVBtn">ุชุญููู CSV</button>

  <script type="module">
    // ๐น ุงุณุชุฏุนุงุก Firebase ูู ุงูููู ุงููุฑูุฒู
    import { storage, ref, uploadBytes, getDownloadURL } from './firebase-config.js';

    const imageInput = document.getElementById('imageInput');
    const uploadButton = document.getElementById('uploadBtn');
    const productNameInput = document.getElementById('productName');
    const productColorInput = document.getElementById('productColor');
    const productDescInput = document.getElementById('productDesc');
    const productPriceInput = document.getElementById('productPrice');
    const productSizeInput = document.getElementById('productSize');
    const productEmbroideryInput = document.getElementById('productEmbroidery');
    const tableBody = document.getElementById('productsTable').querySelector('tbody');
    const copyLinksBtn = document.getElementById('copyLinksBtn');
    const downloadCSVBtn = document.getElementById('downloadCSVBtn');

    const uploadedProducts = []; // ูุชุฎุฒูู ูู ุจูุงูุงุช ุงูููุชุฌุงุช

    // ุฑูุน ุงูููุชุฌ
    uploadButton.addEventListener('click', () => {
      const file = imageInput.files[0];
      const productName = productNameInput.value || "ุจุฏูู ุงุณู";
      const productColor = productColorInput.value || "ุบูุฑ ูุญุฏุฏ";
      const productDesc = productDescInput.value || "-";
      const productPrice = productPriceInput.value || "-";
      const productSize = productSizeInput.value || "-";
      const productEmbroidery = productEmbroideryInput.value || "-";

      if (!file) {
        alert("ุงุฎุชุงุฑู ุตูุฑุฉ ููููุชุฌ ุฃููุงู!");
        return;
      }

      const storageRef = ref(storage, `products/${file.name}`);

      uploadBytes(storageRef, file).then(snapshot => {
        getDownloadURL(snapshot.ref).then(url => {
          // ุฅุถุงูุฉ ุงูููุชุฌ ููุฌุฏูู
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${productName}</td>
            <td>${productColor}</td>
            <td>${productDesc}</td>
            <td>${productPrice}</td>
            <td>${productSize}</td>
            <td>${productEmbroidery}</td>
            <td><a href="${url}" target="_blank">${url}</a></td>
          `;
          tableBody.appendChild(row);

          // ุญูุธ ุงูููุชุฌ ูุงูููุง
          uploadedProducts.push({
            name: productName,
            color: productColor,
            desc: productDesc,
            price: productPrice,
            size: productSize,
            embroidery: productEmbroidery,
            imageUrl: url
          });

          // ูุณุญ ุงูุฅุฏุฎุงูุงุช ุจุนุฏ ุงูุฑูุน
          imageInput.value = '';
          productNameInput.value = '';
          productColorInput.value = '';
          productDescInput.value = '';
          productPriceInput.value = '';
          productSizeInput.value = '';
          productEmbroideryInput.value = '';
        });
      }).catch(err => {
        console.error("ุฎุทุฃ ูู ุงูุฑูุน:", err);
        alert("ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุฑูุน ุงูุตูุฑุฉ");
      });
    });

    // ูุณุฎ ุฌููุน ุฑูุงุจุท ุงูุตูุฑ
    copyLinksBtn.addEventListener('click', () => {
      if (uploadedProducts.length === 0) {
        alert("ูุง ุชูุฌุฏ ุฑูุงุจุท ูููุณุฎ!");
        return;
      }
      const textToCopy = uploadedProducts.map(p => p.imageUrl).join('\n');
      navigator.clipboard.writeText(textToCopy).then(() => {
        alert("ุชู ูุณุฎ ุฌููุน ุฑูุงุจุท ุงูุตูุฑ!");
      }).catch(err => {
        console.error("ุฎุทุฃ ูู ุงููุณุฎ:", err);
        alert("ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงููุณุฎ");
      });
    });

    // ุชุญููู CSV
    downloadCSVBtn.addEventListener('click', () => {
      if (uploadedProducts.length === 0) {
        alert("ูุง ุชูุฌุฏ ููุชุฌุงุช ูุชุญููููุง CSV!");
        return;
      }

      const headers = ["ุงุณู ุงูููุชุฌ","ุงูููู","ุงููุตู","ุงูุณุนุฑ","ุงูููุงุณ","ุงูุชุทุฑูุฒ","ุฑุงุจุท ุงูุตูุฑุฉ"];
      const rows = uploadedProducts.map(p => [
        p.name,p.color,p.desc,p.price,p.size,p.embroidery,p.imageUrl
      ]);

      let csvContent = headers.join(",") + "\n";
      rows.forEach(row => {
        csvContent += row.map(field => `"${field}"`).join(",") + "\n";
      });

      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'products.csv';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    });

  </script>
</body>
</html>
