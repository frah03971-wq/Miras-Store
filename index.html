<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MIRAS LUXURY MALL</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Playfair+Display:wght@700&display=swap');
        
        :root { --gold: #e5b9a8; --dark: #050505; --accent: #b38b7d; }
        body { font-family: 'Cairo', sans-serif; background-color: var(--dark); margin: 0; color: #fff; overflow-x: hidden; }

        /* Ø²Ø± Ø§Ù„Ø³Ù„Ø© Ø§Ù„Ø«Ø§Ø¨Øª - Ø£Ù‡Ù… ØªØ¹Ø¯ÙŠÙ„ */
        .cart-toggle { 
            position: fixed; 
            top: 20px; 
            left: 20px; 
            background: var(--gold); 
            color: #000; 
            padding: 12px 20px; 
            border-radius: 30px; 
            cursor: pointer; 
            z-index: 9999; 
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(229,185,168,0.5);
            border: 2px solid #fff;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Ø´Ø§Ø´Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ */
        #welcome-screen { min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; text-align: center; background: radial-gradient(circle, #1a1a1a 0%, #000 100%); }
        .mall-title { color: var(--gold); font-size: clamp(2.5em, 8vw, 4em); font-family: 'Playfair Display', serif; margin: 0; }
        
        .search-box { width: 90%; max-width: 500px; margin: 30px 0; position: relative; }
        .search-box input { width: 100%; padding: 15px 45px; border-radius: 30px; border: 1px solid var(--gold); background: rgba(255,255,255,0.05); color: #fff; outline: none; font-family: 'Cairo'; }

        .store-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 15px; max-width: 900px; width: 100%; }
        .store-item { height: 160px; position: relative; border: 1px solid #222; cursor: pointer; overflow: hidden; border-radius: 12px; }
        .store-item img { width: 100%; height: 100%; object-fit: cover; opacity: 0.4; transition: 0.4s; }
        .store-item:hover img { opacity: 0.7; }
        .store-item h2 { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: var(--gold); width: 100%; background: rgba(0,0,0,0.5); padding: 8px 0; margin: 0; font-size: 1.2em; }

        /* Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª */
        #main-store, #cart-page { display: none; padding-top: 80px; min-height: 100vh; }
        .header-title { text-align: center; color: var(--gold); padding: 20px; font-family: 'Playfair Display'; }
        .back-home { background: transparent; color: var(--gold); border: 1px solid var(--gold); padding: 8px 20px; margin: 20px; cursor: pointer; border-radius: 20px; }
        
        .products-list { display: flex; flex-direction: column; gap: 30px; padding: 20px; max-width: 800px; margin: 0 auto; }
        .p-card { background: #0a0a0a; border: 1px solid #1a1a1a; border-radius: 20px; overflow: hidden; }
        .p-gallery img { width: 100%; height: auto; display: block; border-bottom: 1px solid #1a1a1a; }
        
        .p-info { padding: 25px; text-align: right; }
        .p-price { color: var(--gold); font-size: 2em; font-weight: bold; display: block; margin: 10px 0; }
        
        .p-btns { display: flex; gap: 10px; margin-top: 20px; }
        .add-to-cart { flex: 2; background: var(--gold); color: #000; padding: 15px; border: none; font-weight: bold; border-radius: 10px; cursor: pointer; }
        .quick-wa { flex: 1; background: transparent; border: 1px solid #25d366; color: #25d366; text-align: center; text-decoration: none; padding: 15px; border-radius: 10px; font-weight: bold; }

        /* ØµÙØ­Ø© Ø§Ù„Ø³Ù„Ø© */
        .cart-box { max-width: 600px; margin: 0 auto; padding: 25px; background: #0a0a0a; border: 1px solid var(--gold); border-radius: 20px; }
        .cart-row { display: flex; justify-content: space-between; padding: 15px 0; border-bottom: 1px solid #222; }
        .confirm-btn { width: 100%; background: #25d366; color: #fff; padding: 18px; border: none; font-weight: bold; border-radius: 10px; margin-top: 25px; cursor: pointer; font-size: 1.1em; }

        @media (max-width: 600px) { .mall-title { font-size: 2.5em; } }
    </style>
</head>
<body>

<div class="cart-toggle" onclick="openCartPage()">
    ğŸ›’ Ø§Ù„Ø³Ù„Ø© (<span id="count-display">0</span>)
</div>

<div id="welcome-screen">
    <h1 class="mall-title">MIRAS MALL</h1>
    <p style="color: #888; letter-spacing: 5px; font-size: 0.8em;">THE HOUSE OF LUXURY</p>
    
    <div class="search-box">
        <input type="text" id="search-input" placeholder="Ø§Ø¨Ø­Ø«ÙŠ Ø¹Ù† ÙØ³ØªØ§Ù†ØŒ Ø´Ù†Ø·Ø©ØŒ Ù…Ø§Ø±ÙƒØ©..." onkeyup="searchNow(event)">
    </div>

    <div class="store-grid">
        <div class="store-item" onclick="loadShop('VIRA Boutique')"><h2>VIRA BAGS</h2><img src="https://i.ibb.co/RpzYpBQ1/1000261620.jpg"></div>
        <div class="store-item" onclick="loadShop('Ù…ÙŠØ±Ø§Ø³ Ù„Ù„ÙØ³Ø§ØªÙŠÙ†')"><h2>Ø§Ù„ÙØ³Ø§ØªÙŠÙ†</h2><img src="https://via.placeholder.com/400x600/111/e5b9a8?text=DRESSES"></div>
        <div class="store-item" onclick="loadShop('Ù…ÙŠØ±Ø§Ø³ Ù„Ù„Ø¬Ø²Ù…')"><h2>Ø§Ù„Ø¬Ø²Ù…</h2><img src="https://via.placeholder.com/400x600/111/e5b9a8?text=SHOES"></div>
        <div class="store-item" onclick="loadShop('Ù…ÙŠØ±Ø§Ø³ Ù„Ù„Ø¹Ù†Ø§ÙŠØ©')"><h2>Ø§Ù„Ø¹Ù†Ø§ÙŠØ©</h2><img src="https://via.placeholder.com/400x600/111/e5b9a8?text=SKINCARE"></div>
    </div>
</div>

<div id="main-store">
    <button class="back-home" onclick="goBackHome()">â¬… Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…ÙˆÙ„</button>
    <h1 id="current-shop-name" class="header-title"></h1>
    <div class="products-list" id="products-render"></div>
</div>

<div id="cart-page">
    <button class="back-home" onclick="hideCartPage()">â¬… Ù…ÙˆØ§ØµÙ„Ø© Ø§Ù„ØªØ³ÙˆÙ‚</button>
    <div class="cart-box">
        <h2 style="text-align: center; color: var(--gold);">Ø­Ù‚ÙŠØ¨Ø© Ù…Ø´ØªØ±ÙŠØ§ØªÙƒ ğŸ›ï¸</h2>
        <div id="cart-list"></div>
        <div style="text-align:center; margin-top:25px; font-size:1.6em; color:var(--gold); border-top:1px solid #333; padding-top:15px;">
            Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: <span id="final-price">0</span> SDG
        </div>
        <button class="confirm-btn" onclick="sendOrderWA()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ âœ…</button>
    </div>
</div>

<script>
    const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTWD0ZQAKe2KRwLQnNjh2t7Z2Y_BKXxaKZxZwKSXUaZLQ3eeLB1fwj6vNllpNwXCtd9aY9Q_tuuFXXV/pub?output=csv';
    let productsData = [], myCart = [];

    async function fetchData() {
        const r = await fetch(csvUrl + '&t=' + Date.now());
        const t = await r.text();
        const lines = t.split('\n').filter(l => l.trim() !== '');
        productsData = lines.slice(1).map(l => {
            const c = l.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
            return {
                name: c[0].replace(/"/g,''),
                price: parseFloat(c[1]) || 0,
                shop: c[2].replace(/"/g,''),
                img: c[3].replace(/"/g,''),
                phone: c[4]?.replace(/[^\d]/g,'') || '249967584275',
                desc: c[5]?.replace(/"/g,'') || ''
            };
        });
    }

    function searchNow(e) {
        const val = document.getElementById('search-input').value.toLowerCase();
        if(val.length < 2 && e.key !== 'Enter') return;
        const filtered = productsData.filter(p => p.name.toLowerCase().includes(val) || p.shop.toLowerCase().includes(val));
        showShopUI(`Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø«: ${val}`, filtered);
    }

    function loadShop(name) {
        const filtered = productsData.filter(p => p.shop === name);
        showShopUI(name, filtered);
    }

    function showShopUI(title, list) {
        document.getElementById('welcome-screen').style.display = 'none';
        document.getElementById('cart-page').style.display = 'none';
        document.getElementById('main-store').style.display = 'block';
        document.getElementById('current-shop-name').innerText = title;
        
        const container = document.getElementById('products-render');
        container.innerHTML = list.length ? '' : '<h2>Ù‚Ø±ÙŠØ¨Ø§Ù‹ Ø¬Ø¯Ø§Ù‹... âœ¨</h2>';
        
        list.forEach(p => {
            const imgs = p.img.split(',');
            let galleryHtml = '<div class="p-gallery">';
            imgs.forEach(i => galleryHtml += `<img src="${i.trim()}" onerror="this.src='https://via.placeholder.com/400'">`);
            galleryHtml += '</div>';

            container.innerHTML += `
                <div class="p-card">
                    ${galleryHtml}
                    <div class="p-info">
                        <h3 style="margin:0;">${p.name}</h3>
                        <span class="p-price">${p.price} SDG</span>
                        <p style="color:#888;">${p.desc}</p>
                        <div class="p-btns">
                            <button class="add-to-cart" onclick="addToMyCart('${p.name}', ${p.price}, '${p.phone}')">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø© ğŸ›’</button>
                            <a href="https://wa.me/${p.phone}?text=Ø·Ù„Ø¨:${p.name}" class="quick-wa">Ø·Ù„Ø¨ Ø³Ø±ÙŠØ¹ âš¡</a>
                        </div>
                    </div>
                </div>`;
        });
        window.scrollTo(0,0);
    }

    function addToMyCart(n, p, ph) {
        myCart.push({n, p, ph});
        document.getElementById('count-display').innerText = myCart.length;
        alert('ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø­Ù‚ÙŠØ¨Ø© âœ…');
    }

    function openCartPage() {
        document.getElementById('welcome-screen').style.display = 'none';
        document.getElementById('main-store').style.display = 'none';
        document.getElementById('cart-page').style.display = 'block';
        
        const listDiv = document.getElementById('cart-list');
        listDiv.innerHTML = '';
        let total = 0;
        myCart.forEach((item, i) => {
            listDiv.innerHTML += `
                <div class="cart-row">
                    <span>${item.n}</span>
                    <span>${item.p} SDG <button onclick="removeFromCart(${i})" style="background:none; border:none; color:red; cursor:pointer;">âŒ</button></span>
                </div>`;
            total += item.p;
        });
        document.getElementById('final-price').innerText = total;
    }

    function removeFromCart(i) {
        myCart.splice(i, 1);
        document.getElementById('count-display').innerText = myCart.length;
        openCartPage();
    }

    function sendOrderWA() {
        if(!myCart.length) return alert('Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ© ÙŠØ§ Ø¬Ù…ÙŠÙ„Ø©!');
        let text = "Ù…Ø±Ø­Ø¨Ø§Ù‹ Ù…ÙŠØ±Ø§Ø³ Ù…ÙˆÙ„ØŒ Ø£ÙˆØ¯ Ø·Ù„Ø¨ Ø§Ù„Ø¢ØªÙŠ:\n";
        let total = 0;
        myCart.forEach(item => {
            text += `- ${item.n} (${item.p} SDG)\n`;
            total += item.p;
        });
        text += `\nØ§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: ${total} SDG`;
        window.open(`https://wa.me/${myCart[0].ph}?text=${encodeURIComponent(text)}`);
    }

    function goBackHome() { location.reload(); }
    function hideCartPage() { document.getElementById('cart-page').style.display = 'none'; document.getElementById('main-store').style.display = 'block'; }

    window.onload = fetchData;
</script>
</body>
</html>
