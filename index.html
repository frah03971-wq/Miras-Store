<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VIRA MALL | ÙÙŠØ±Ø§ Ù…ÙˆÙ„</title>
    <style>
        :root { --gold: #D4AF37; --black: #0a0a0a; --bg: #f9f9f9; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--black); overflow-x: hidden; }
        
        /* Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ù…Ù„ÙƒÙŠ */
        header { background: var(--black); padding: 15px 20px; position: sticky; top: 0; z-index: 2000; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        .nav-top { display: flex; justify-content: space-between; align-items: center; }
        .logo { text-align: center; flex-grow: 1; }
        header h1 { color: var(--gold); margin: 0; font-size: 22px; font-weight: 900; letter-spacing: 1px; }
        .slogan { color: #fff; font-size: 10px; display: block; margin-top: 2px; }
        
        /* Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø« */
        .search-container { background: #fff; margin-top: 12px; padding: 8px 15px; border-radius: 25px; display: flex; align-items: center; gap: 10px; }
        .search-container input { border: none; width: 100%; outline: none; font-size: 14px; }

        /* Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© */
        .cats { display: flex; gap: 10px; padding: 15px; overflow-x: auto; background: #fff; border-bottom: 1px solid #eee; white-space: nowrap; }
        .cat-btn { padding: 8px 18px; border-radius: 20px; border: 1px solid #ddd; background: #f9f9f9; font-size: 12px; font-weight: bold; cursor: pointer; }
        .cat-btn.active { background: var(--black); color: var(--gold); border-color: var(--black); }

        /* Ø§Ù„Ø´Ø¨ÙƒØ© Grid (2 ÙÙŠ Ø§Ù„ØµÙ) */
        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; padding: 12px; }
        .card { background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.05); position: relative; display: flex; flex-direction: column; border: 1px solid #eee; }
        
        /* Ø§Ù„Ø³Ù„Ø§ÙŠØ¯Ø± (Ø´ÙŠ Ø¥Ù† Ø³ØªØ§ÙŠÙ„) */
        .slider-container { position: relative; width: 100%; aspect-ratio: 3/4; overflow: hidden; background: #f0f0f0; }
        .track { display: flex; height: 100%; transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94); }
        .track img { min-width: 100%; height: 100%; object-fit: cover; }
        
        .img-counter { position: absolute; bottom: 10px; right: 10px; background: rgba(0,0,0,0.5); color: #fff; padding: 2px 8px; border-radius: 10px; font-size: 10px; z-index: 10; }
        .fav-btn { position: absolute; top: 10px; left: 10px; font-size: 22px; color: rgba(255,255,255,0.9); z-index: 15; cursor: pointer; text-shadow: 0 0 5px rgba(0,0,0,0.3); }
        .fav-btn.active { color: #e91e63; }

        .info { padding: 12px 8px; text-align: center; flex-grow: 1; }
        .title { font-size: 12px; color: #444; height: 32px; overflow: hidden; margin-bottom: 8px; line-height: 1.3; }
        .price { font-size: 16px; font-weight: 900; color: var(--black); }
        
        .btn-add { background: var(--black); color: white; width: 100%; padding: 10px; border: none; border-radius: 8px; font-size: 12px; font-weight: bold; margin-top: 10px; cursor: pointer; }

        /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© */
        .panel { position: fixed; top: 0; right: -100%; width: 300px; height: 100%; background: white; z-index: 3000; transition: 0.4s; padding: 25px; box-shadow: -10px 0 30px rgba(0,0,0,0.1); }
        .panel.active { right: 0; }
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 2500; display: none; backdrop-filter: blur(4px); }
        
        .menu-item { padding: 15px 0; border-bottom: 1px solid #eee; font-weight: bold; display: flex; justify-content: space-between; }
        .sub-box { background: #fff9e6; border: 1px dashed var(--gold); padding: 15px; border-radius: 15px; text-align: center; margin-top: 20px; }
    </style>
</head>
<body>

<div class="overlay" id="overlay" onclick="closeAll()"></div>

<header>
    <div class="nav-top">
        <div onclick="togglePanel('menuPanel')" style="color:var(--gold); font-size:26px;">â˜°</div>
        <div class="logo">
            <h1>VIRA MALL</h1>
            <span class="slogan">Ø®ÙŠÙ€Ø§Ø±Ùƒ Ø§Ù„Ø£ÙˆÙ„ ÙÙŠ Ø§Ù„Ø³Ù€ÙˆØ¯Ø§Ù†</span>
        </div>
        <div onclick="togglePanel('cartPanel')" style="color:var(--gold); font-size:24px; position:relative;">
            ğŸ›’ <span id="cartBadge" style="position:absolute; top:-5px; right:-8px; background:#e91e63; color:white; font-size:10px; padding:2px 5px; border-radius:10px; display:none;">0</span>
        </div>
    </div>
    <div class="search-container">
        <span>ğŸ”</span>
        <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø«ÙŠ Ø¹Ù† Ø§Ù„Ø£Ù†Ø§Ù‚Ø©..." oninput="search()">
    </div>
</header>

<div class="cats">
    <button class="cat-btn active" onclick="filter('Ø§Ù„ÙƒÙ„', this)">Ø§Ù„ÙƒÙ„</button>
    <button class="cat-btn" onclick="filter('Ø£Ø·ÙØ§Ù„', this)">Ù…Ù„Ø§Ø¨Ø³ Ø£Ø·ÙØ§Ù„</button>
    <button class="cat-btn" onclick="filter('Ù†ÙˆÙ…', this)">Ù…Ù„Ø§Ø¨Ø³ Ù†ÙˆÙ…</button>
    <button class="cat-btn" onclick="filter('Ø¹Ø¨Ø§ÙŠØ§Øª', this)">Ø¹Ø¨Ø§ÙŠØ§Øª</button>
    <button class="cat-btn" onclick="filter('Ø´Ù†Ø·', this)">Ø´Ù†Ø·</button>
</div>

<div class="grid" id="mainGrid"></div>

<div class="panel" id="cartPanel">
    <h2>ğŸ›ï¸ Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚</h2>
    <div id="cartList"></div>
    <button class="btn-add" style="background:var(--gold); color:#000; margin-top:20px;" onclick="sendWhatsApp()">Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ âœ…</button>
</div>

<div class="panel" id="menuPanel">
    <h2 style="color:var(--gold)">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</h2>
    <div class="menu-item">
        <span>ğŸ’° Ø§Ù„Ø¹Ù…Ù„Ø©</span>
        <select id="cur" onchange="render()"><option>SDG</option><option>SAR</option></select>
    </div>
    <div class="menu-item" onclick="alert('Ø§Ù„Ù…ÙØ¶Ù„Ø© Ù‚Ø±ÙŠØ¨Ø§Ù‹')">â¤ï¸ Ø§Ù„Ù…ÙØ¶Ù„Ø©</div>
    <div class="sub-box">
        <strong>Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„ØªØ§Ø¬Ø±Ø§Øª</strong>
        <p style="color:var(--gold); font-weight:900; margin:5px 0;">Ø§Ø´ØªØ±Ø§Ùƒ: 30,000 SDG</p>
        <small>Ø¨Ù†ÙƒÙƒ: 2280384</small>
    </div>
</div>

<script>
    const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTWD0ZQAKe2KRwLQnNjh2t7Z2Y_BKXxaKZxZwKSXUaZLQ3eeLB1fwj6vNllpNwXCtd9aY9Q_tuuFXXV/pub?gid=0&single=true&output=csv';
    let products = [], cart = [];

    async function init() {
        const res = await fetch(CSV_URL + '&t=' + Date.now());
        const text = await res.text();
        const rows = text.split('\n').slice(1);
        products = rows.map((r, i) => {
            const c = r.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/).map(v => v.replace(/"/g, '').trim());
            return { id: i, name: c[0], price: c[1], store: c[2], imgs: c[3].split(/\s+/), wa: c[4], cat: c[5] || '' };
        }).filter(p => p.name);
        render(products);
    }

    function render(data = products) {
        const cur = document.getElementById('cur').value;
        const grid = document.getElementById('mainGrid');
        grid.innerHTML = data.map(p => `
            <div class="card" id="p-${p.id}" data-idx="0">
                <div class="slider-container" ontouchstart="sT(event)" ontouchmove="mT(event, ${p.id})">
                    <div class="fav-btn" onclick="this.classList.toggle('active')">â¤</div>
                    <div class="track" style="transform:translateX(0)">${p.imgs.map(img => `<img src="${img}" ondblclick="this.requestFullscreen()">`).join('')}</div>
                    ${p.imgs.length > 1 ? `<div class="img-counter"><span class="idx">1</span>/${p.imgs.length}</div>` : ''}
                </div>
                <div class="info">
                    <div class="title">${p.name}</div>
                    <div class="price">${p.price} ${cur}</div>
                    <button class="btn-add" onclick="addToCart(${p.id})">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø© ğŸ›’</button>
                </div>
            </div>
        `).join('');
    }

    let startX = 0;
    function sT(e) { startX = e.touches[0].clientX; }
    function mT(e, id) {
        if(!startX) return;
        let diff = startX - e.touches[0].clientX;
        if(Math.abs(diff) > 40) {
            let card = document.getElementById(`p-${id}`), track = card.querySelector('.track'), counter = card.querySelector('.idx'), idx = parseInt(card.dataset.idx);
            if(diff > 0 && idx < track.children.length - 1) idx++;
            else if(diff < 0 && idx > 0) idx--;
            card.dataset.idx = idx;
            track.style.transform = `translateX(${idx * 100}%)`;
            if(counter) counter.innerText = idx + 1;
            startX = 0;
        }
    }

    function addToCart(id) {
        cart.push(products.find(p => p.id === id));
        document.getElementById('cartBadge').innerText = cart.length;
        document.getElementById('cartBadge').style.display = 'block';
        let list = document.getElementById('cartList');
        list.innerHTML = cart.map(i => `<div style="padding:10px; border-bottom:1px solid #eee; font-size:12px;">â–«ï¸ ${i.name}</div>`).join('');
    }

    function filter(c, btn) {
        document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        render(c === 'Ø§Ù„ÙƒÙ„' ? products : products.filter(p => p.cat.includes(c) || p.name.includes(c)));
    }

    function search() {
        const q = document.getElementById('searchInput').value.toLowerCase();
        render(products.filter(p => p.name.toLowerCase().includes(q)));
    }

    function togglePanel(id) { document.getElementById(id).classList.add('active'); document.getElementById('overlay').style.display = 'block'; }
    function closeAll() { document.querySelectorAll('.panel').forEach(p => p.classList.remove('active')); document.getElementById('overlay').style.display = 'none'; }

    init();
</script>
</body>
</html>
