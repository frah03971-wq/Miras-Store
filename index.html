<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VIRA MALL | Ø®ÙŠØ§Ø±Ùƒ Ø§Ù„Ø£ÙˆÙ„</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap');
        :root { --primary: #febd69; --dark: #131921; --bg: #f5f6f7; --red: #ff4757; --gold: #d4af37; }
        body { font-family: 'Cairo', sans-serif; background: var(--bg); margin: 0; padding-bottom: 90px; overflow-x: hidden; }

        /* Header & Premium UI */
        .app-header { background: var(--dark); padding: 15px; color: white; position: sticky; top: 0; z-index: 3000; border-bottom: 2px solid var(--primary); box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .logo-area { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .logo { font-size: 26px; font-weight: 900; color: var(--primary); text-decoration: none; letter-spacing: 1px; }
        .merchant-btn { background: linear-gradient(45deg, var(--gold), var(--primary)); color: var(--dark); padding: 7px 15px; border-radius: 20px; font-size: 11px; font-weight: 900; text-decoration: none; box-shadow: 0 4px 8px rgba(0,0,0,0.2); }

        .cart-icon-box { position: relative; cursor: pointer; font-size: 28px; }
        .cart-count { position: absolute; top: -5px; right: -8px; background: var(--red); color: white; font-size: 11px; padding: 2px 7px; border-radius: 50%; font-weight: 700; border: 2px solid var(--dark); }

        .search-box { background: white; border-radius: 12px; display: flex; padding: 5px 15px; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .search-box input { border: none; width: 100%; padding: 10px; outline: none; font-family: 'Cairo'; font-weight: 600; }

        /* Categories */
        .cats-scroll { display: flex; overflow-x: auto; padding: 15px; gap: 15px; background: white; border-bottom: 1px solid #ddd; }
        .cat-item { display: flex; flex-direction: column; align-items: center; min-width: 75px; cursor: pointer; transition: 0.3s; }
        .cat-circle { width: 60px; height: 60px; background: #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 26px; border: 2px solid var(--primary); box-shadow: 0 4px 8px rgba(0,0,0,0.05); }
        .cat-item span { font-size: 12px; font-weight: 700; margin-top: 6px; color: var(--dark); }
        .cat-item:active { transform: scale(0.9); }

        /* Grid & Cards */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 15px; }
        .card { background: white; border-radius: 20px; overflow: hidden; position: relative; box-shadow: 0 6px 15px rgba(0,0,0,0.06); transition: 0.3s; border: 1px solid #eee; }
        .img-box { height: 220px; position: relative; overflow: hidden; }
        .img-box img { width: 100%; height: 100%; object-fit: cover; transition: 0.5s; }
        .wishlist-heart { position: absolute; top: 12px; right: 12px; font-size: 26px; color: white; cursor: pointer; filter: drop-shadow(0 0 4px rgba(0,0,0,0.6)); z-index: 10; }
        .wishlist-heart.active { color: var(--red); }
        .price-badge { position: absolute; bottom: 12px; left: 12px; background: rgba(19, 25, 33, 0.9); color: var(--primary); padding: 5px 12px; border-radius: 10px; font-weight: 900; font-size: 13px; }

        .info { padding: 15px; text-align: center; }
        .merchant-tag { font-size: 10px; color: var(--red); font-weight: 900; text-transform: uppercase; margin-bottom: 5px; display: block; }
        .p-title { font-size: 14px; font-weight: 700; height: 40px; overflow: hidden; margin-bottom: 12px; color: #333; line-height: 1.3; }
        .add-btn { width: 100%; background: var(--primary); border: none; padding: 12px; border-radius: 12px; font-family: 'Cairo'; font-weight: 800; cursor: pointer; font-size: 13px; transition: 0.3s; }
        .add-btn:active { background: var(--dark); color: var(--primary); }

        /* Modal Custom Styling */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 5000; backdrop-filter: blur(8px); }
        .modal-content { background: white; width: 85%; max-width: 450px; margin: 30px auto; border-radius: 30px; padding: 25px; max-height: 85vh; overflow-y: auto; position: relative; animation: slideUp 0.4s ease; }
        @keyframes slideUp { from { transform: translateY(100px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        /* Bottom Nav */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: white; display: flex; justify-content: space-around; padding: 15px 0; border-top: 1px solid #ddd; z-index: 4000; box-shadow: 0 -5px 15px rgba(0,0,0,0.05); }
        .nav-link { text-align: center; text-decoration: none; color: #888; font-size: 12px; font-weight: 700; background: none; border: none; flex: 1; }
        .nav-link.active { color: var(--dark); }
        .nav-link i { display: block; font-size: 22px; margin-bottom: 4px; }

        .cats-scroll::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>

<header class="app-header">
    <div class="logo-area">
        <a href="#" class="logo">VIRA MALL</a>
        <div style="display: flex; align-items: center; gap:12px;">
            <a href="https://forms.gle/vE6W9mXvUj7u7X8P7" target="_blank" class="merchant-btn">Ø§Ù†Ø¶Ù…ÙŠ ÙƒØªØ§Ø¬Ø±Ø© â•</a>
            <div class="cart-icon-box" onclick="toggleModal('cartOverlay')">
                ğŸ›’<span class="cart-count" id="cartCount">0</span>
            </div>
        </div>
    </div>
    <div class="search-box">
        <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø«ÙŠ Ø¹Ù† Ù…Ù†ØªØ¬ØŒ Ù…Ø§Ø±ÙƒØ©ØŒ Ø£Ùˆ Ù…ØªØ¬Ø±..." oninput="search(this.value)">
    </div>
</header>

<div class="cats-scroll" id="catBar"></div>
<div id="gridArea" class="grid"></div>

<div id="cartOverlay" class="modal-overlay" onclick="toggleModal('cartOverlay')">
    <div class="modal-content" onclick="event.stopPropagation()">
        <h3 style="text-align: center; margin-top: 0;">Ø³Ù„Ø© Ø·Ù„Ø¨Ø§ØªÙƒ ğŸ›ï¸</h3>
        <div id="cartItemsList"></div>
        <div style="display:flex; justify-content:space-between; font-weight:900; margin:20px 0; font-size: 18px; color: var(--red); border-top: 2px solid #eee; padding-top: 15px;">
            <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span>
            <span id="cartTotal">0 SDG</span>
        </div>
        <button class="add-btn" style="background:var(--dark); color:var(--primary); padding: 15px; font-size: 16px;" onclick="checkout()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ âœ…</button>
        <button onclick="toggleModal('cartOverlay')" style="width:100%; background:none; border:none; color:#999; margin-top:15px; font-family:'Cairo'; font-weight:bold;">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
</div>

<div id="deliveryModal" class="modal-overlay" onclick="toggleModal('deliveryModal')">
    <div class="modal-content" onclick="event.stopPropagation()">
        <h3 style="text-align: center;">Ø®Ø¯Ù…Ø© Ø§Ù„ØªÙˆØµÙŠÙ„ ğŸšš</h3>
        <p style="text-align: center; line-height: 1.6;">Ù†ÙˆØµÙ„ Ù„Ø¬Ù…ÙŠØ¹ Ù…Ù†Ø§Ø·Ù‚ ÙˆÙ„Ø§ÙŠØ© Ø§Ù„Ø®Ø±Ø·ÙˆÙ… ÙˆØ§Ù„ÙˆÙ„Ø§ÙŠØ§Øª.<br><b>Ø£Ø³Ø¹Ø§Ø± Ø§Ù„ØªÙˆØµÙŠÙ„ ØªØ¨Ø¯Ø£ Ù…Ù† 3,000 SDG.</b></p>
        <button class="add-btn" onclick="sendDirect('ØªÙˆØµÙŠÙ„')">ØªØ­Ø¯Ø« Ù…Ø¹ Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„ØªÙˆØµÙŠÙ„</button>
        <button onclick="toggleModal('deliveryModal')" style="width:100%; background:none; border:none; color:#999; margin-top:15px; font-family:'Cairo'; font-weight:bold;">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
</div>

<nav class="bottom-nav">
    <button class="nav-link active" onclick="loadData()"><i>ğŸ </i>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
    <button class="nav-link" onclick="toggleModal('deliveryModal')"><i>ğŸšš</i>Ø§Ù„ØªÙˆØµÙŠÙ„</button>
    <button class="nav-link" onclick="alert('Ø§Ù„Ù…ÙØ¶Ù„Ø§Øª ØªÙØ­ÙØ¸ ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø­Ø§Ù„ÙŠØ§Ù‹!')"><i>â¤ï¸</i>Ø§Ù„Ù…ÙØ¶Ù„Ø©</button>
    <button class="nav-link" onclick="sendDirect('Ø§Ø³ØªÙØ³Ø§Ø±')"><i>ğŸ’¬</i>ØªÙˆØ§ØµÙ„</button>
</nav>

<script>
    const url = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSsqL_LzG-fE_20L9SjKk9Z5L_F2uM_2pZ3E_4m9uV9W_E/pub?output=csv';
    let products = [];
    let cart = [];

    async function loadData() {
        const res = await fetch(url + '&t=' + Date.now());
        const text = await res.text();
        const rows = text.split('\n').slice(1);
        products = rows.map(r => {
            const c = r.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
            return {
                merchant: c[1]?.replace(/"/g,'').trim(),
                cat: c[2]?.trim(),
                name: c[3]?.replace(/"/g,'').trim(),
                price: c[4]?.trim(),
                img: c[5]?.replace(/"/g,'').trim()
            };
        }).filter(p => p.name && p.img && p.img.startsWith('http'));
        renderCats();
        renderProducts(products);
    }

    function renderCats() {
        const cats = [...new Set(products.map(p => p.cat))];
        const icons = {'Ø§Ù„Ø±Ø¬Ø§Ù„':'ğŸ‘”', 'Ø§Ù„Ø£Ø·ÙØ§Ù„':'ğŸ‘¶', 'Ø§Ù„Ø¹Ø·ÙˆØ±':'ğŸŒ¸', 'Ø§Ù„Ø¨Ø®ÙˆØ±':'ğŸ’¨'};
        let h = `<div class="cat-item" onclick="loadData()"><div class="cat-circle">ğŸŒˆ</div><span>Ø§Ù„ÙƒÙ„</span></div>`;
        cats.forEach(c => { h += `<div class="cat-item" onclick="filterCat('${c}')"><div class="cat-circle">${icons[c] || 'ğŸ“¦'}</div><span>${c}</span></div>`; });
        document.getElementById('catBar').innerHTML = h;
    }

    function renderProducts(list) {
        document.getElementById('gridArea').innerHTML = list.map(p => `
            <div class="card">
                <div class="img-box">
                    <img src="${p.img}" loading="lazy" onerror="this.src='https://via.placeholder.com/250x300?text=VIRA+MALL'">
                    <span class="wishlist-heart" onclick="this.classList.toggle('active')">â¤</span>
                    <div class="price-badge">${p.price} SDG</div>
                </div>
                <div class="info">
                    <span class="merchant-tag">Ù…ØªØ¬Ø±: ${p.merchant}</span>
                    <div class="p-title">${p.name}</div>
                    <button class="add-btn" onclick="addToCart('${p.name}', '${p.price}', '${p.merchant}')">Ø£Ø¶ÙŠÙÙŠ Ù„Ù„Ø³Ù„Ø© ğŸ›’</button>
                </div>
            </div>`).join('');
    }

    function addToCart(name, price, merchant) {
        cart.push({name, price, merchant});
        document.getElementById('cartCount').innerText = cart.length;
        const notification = document.createElement('div');
        notification.style = "position:fixed; bottom:100px; left:50%; transform:translateX(-50%); background:var(--dark); color:var(--primary); padding:10px 20px; border-radius:20px; z-index:6000; font-weight:bold;";
        notification.innerText = "ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø© âœ¨";
        document.body.appendChild(notification);
        setTimeout(() => notification.remove(), 2000);
    }

    function toggleModal(id) {
        const m = document.getElementById(id);
        m.style.display = (m.style.display === 'block') ? 'none' : 'block';
        if(id === 'cartOverlay') renderCart();
    }

    function renderCart() {
        let total = 0;
        const h = cart.map((item, i) => {
            total += parseInt(item.price.replace(/\D/g,'')) || 0;
            return `<div class="cart-item-row">
                        <div style="width:70%"><b>${item.name}</b><br><small style="color:var(--red)">${item.merchant}</small></div>
                        <div style="font-weight:900">${item.price}</div>
                        <button onclick="cart.splice(${i},1); renderCart();" style="border:none; background:none; color:red; font-size:18px;">âœ•</button>
                    </div>`;
        }).join('');
        document.getElementById('cartItemsList').innerHTML = h || '<p style="text-align:center; padding:20px;">Ø³Ù„ØªÙƒ ÙØ§Ø¶ÙŠØ©ØŒ Ø§Ø¨Ø¯Ø£ÙŠ Ø¨Ø§Ù„ØªØ³ÙˆÙ‚ Ø§Ù„Ø¢Ù†! ğŸ›ï¸</p>';
        document.getElementById('cartTotal').innerText = total + ' SDG';
        document.getElementById('cartCount').innerText = cart.length;
    }

    function checkout() {
        if(cart.length === 0) return alert('Ø³Ù„ØªÙƒ ÙØ§Ø¶ÙŠØ© ÙŠØ§ Ø¹Ø³Ù„!');
        let msg = `Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ù† VIRA MALL ğŸ‘‘:\n\n` + cart.map(i => `â€¢ ${i.name} [Ù…ØªØ¬Ø±: ${i.merchant}] - ${i.price}`).join('\n');
        msg += `\n\nğŸ’° *Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ: ${document.getElementById('cartTotal').innerText}*\n\nğŸ“ Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ ğŸšš.`;
        window.open(`https://wa.me/249967584275?text=${encodeURIComponent(msg)}`);
    }

    function filterCat(c) { renderProducts(products.filter(p => p.cat === c)); }
    function search(q) { renderProducts(products.filter(p => p.name.toLowerCase().includes(q.toLowerCase()) || p.merchant.toLowerCase().includes(q.toLowerCase()))); }
    function sendDirect(t) { 
        let m = t === 'ØªÙˆØµÙŠÙ„' ? 'Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† Ø£Ø³Ø¹Ø§Ø± Ø§Ù„ØªÙˆØµÙŠÙ„ Ù„Ù…ÙˆÙ‚Ø¹ÙŠ ğŸšš' : 'Ù…Ø±Ø­Ø¨Ø§Ù‹ ÙÙŠØ±Ø§ Ù…ÙˆÙ„ØŒ Ø£Ø±ÙŠØ¯ Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø± ğŸ’¬';
        window.open(`https://wa.me/249967584275?text=${encodeURIComponent(m)}`); 
    }

    loadData();
</script>
</body>
</html>
