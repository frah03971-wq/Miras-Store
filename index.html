<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VIRA MALL | ÙÙŠØ±Ø§ Ù…ÙˆÙ„</title>
    <style>
        :root { --gold: #D4AF37; --black: #0a0a0a; --bg: #ffffff; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg); overflow-x: hidden; touch-action: manipulation; }
        
        /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
        header { background: var(--black); padding: 12px 15px; position: sticky; top: 0; z-index: 2000; display: flex; justify-content: space-between; align-items: center; }
        header h1 { color: var(--gold); margin: 0; font-size: 18px; font-weight: 900; }
        .logo-box { text-align: center; }
        .slogan { color: #fff; font-size: 9px; display: block; }

        /* Ø§Ù„Ø´Ø¨ÙƒØ© */
        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; padding: 10px; }
        .card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.05); border: 1px solid #eee; position: relative; }
        
        /* Ø³Ù„Ø§ÙŠØ¯Ø± Ø´ÙŠ Ø¥Ù† Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ */
        .slider-container { position: relative; width: 100%; aspect-ratio: 3/4; overflow: hidden; background: #f9f9f9; cursor: zoom-in; }
        .track { display: flex; height: 100%; width: 100%; transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94); }
        .track img { min-width: 100%; width: 100%; height: 100%; object-fit: cover; pointer-events: none; }
        
        /* Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØµÙˆØ± 1/3 */
        .img-counter { position: absolute; bottom: 8px; right: 8px; background: rgba(0,0,0,0.5); color: #fff; padding: 2px 8px; border-radius: 10px; font-size: 10px; z-index: 10; }
        
        /* Ø§Ù„Ù‚Ù„Ø¨ */
        .fav-icon { position: absolute; top: 8px; left: 8px; font-size: 22px; color: rgba(255,255,255,0.8); z-index: 10; cursor: pointer; text-shadow: 0 0 5px rgba(0,0,0,0.3); }
        .fav-icon.active { color: #ff3b30; }

        .info { padding: 10px 5px; text-align: center; }
        .price { font-size: 15px; font-weight: 900; margin-bottom: 5px; }
        .title { font-size: 11px; color: #555; height: 30px; overflow: hidden; margin-bottom: 8px; }
        
        /* Ø²Ø± Ø§Ù„Ø³Ù„Ø© */
        .btn-cart { background: var(--black); color: white; width: 100%; padding: 8px; border: none; border-radius: 5px; font-size: 11px; font-weight: bold; cursor: pointer; }
        .btn-cart.added { background: #28a745; }

        /* Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© */
        .side-panel { position: fixed; top: 0; right: -100%; width: 300px; height: 100%; background: white; z-index: 3000; transition: 0.4s; padding: 20px; box-shadow: -5px 0 20px rgba(0,0,0,0.2); overflow-y: auto; }
        .side-panel.active { right: 0; }
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2500; display: none; }

        /* ØªÙƒØ¨ÙŠØ± Ø§Ù„ØµÙˆØ±Ø© */
        img:fullscreen { object-fit: contain !important; background: black; }
    </style>
</head>
<body>

<div class="overlay" id="overlay" onclick="closeAll()"></div>

<header>
    <div onclick="openPanel('menuPanel')" style="color:var(--gold); font-size:24px;">â˜°</div>
    <div class="logo-box">
        <h1>VIRA MALL</h1>
        <span class="slogan">Ø®ÙŠÙ€Ø§Ø±Ùƒ Ø§Ù„Ø£ÙˆÙ„ ÙÙŠ Ø§Ù„Ø³Ù€ÙˆØ¯Ø§Ù†</span>
    </div>
    <div onclick="openPanel('cartPanel')" style="color:var(--gold); font-size:22px; position:relative;">
        ğŸ›’ <span id="cartCount" style="position:absolute; top:-5px; right:-10px; background:#ff3b30; color:white; font-size:10px; padding:2px 5px; border-radius:50%; display:none;">0</span>
    </div>
</header>

<div class="grid" id="mainGrid"></div>

<div class="side-panel" id="cartPanel">
    <h3>ğŸ›’ Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</h3>
    <div id="cartItemsList"></div>
    <hr>
    <button class="btn-cart" style="background:var(--gold); color:black;" onclick="checkout()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ (ÙˆØ§ØªØ³Ø§Ø¨)</button>
</div>

<div class="side-panel" id="menuPanel">
    <h2 style="color:var(--gold)">VIRA MALL</h2>
    <div style="margin: 20px 0;">
        <p>ğŸ’° <b>Ø§Ù„Ø¹Ù…Ù„Ø©:</b> 
            <select onchange="updateCur(this.value)">
                <option value="SDG">SDG (Ø³ÙˆØ¯Ø§Ù†ÙŠ)</option>
                <option value="SAR">SAR (Ø³Ø¹ÙˆØ¯ÙŠ)</option>
                <option value="USD">USD (Ø¯ÙˆÙ„Ø§Ø±)</option>
            </select>
        </p>
        <p>ğŸŒ <b>Ø§Ù„Ù„ØºØ©:</b> <button onclick="alert('Ù‚Ø±ÙŠØ¨Ø§Ù‹...')">English</button></p>
    </div>
    <hr>
    <p>ğŸš€ <b>Ù„Ù„ØªØ§Ø¬Ø±Ø§Øª:</b> Ø§Ø´ØªØ±Ø§Ùƒ 30,000 SDG</p>
    <p>ğŸ’³ <b>Ø¨Ù†ÙƒÙƒ:</b> 2280384</p>
    <p>ğŸšš <b>Ø§Ù„ØªÙˆØµÙŠÙ„:</b> Ù…ØªØ§Ø­ Ù„ÙƒÙ„ Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª</p>
</div>

<script>
    const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTWD0ZQAKe2KRwLQnNjh2t7Z2Y_BKXxaKZxZwKSXUaZLQ3eeLB1fwj6vNllpNwXCtd9aY9Q_tuuFXXV/pub?gid=0&single=true&output=csv';
    let products = [];
    let cart = [];
    let cur = 'SDG';

    async function fetchData() {
        const res = await fetch(CSV_URL + '?t=' + Date.now());
        const text = await res.text();
        const rows = text.split('\n').slice(1);
        products = rows.map((r, i) => {
            const c = r.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/).map(v => v.replace(/"/g, '').trim());
            return { id: i, name: c[0], price: c[1], store: c[2], imgs: c[3].split(/\s+/), wa: c[4] };
        }).filter(p => p.name);
        render();
    }

    function render() {
        const grid = document.getElementById('mainGrid');
        grid.innerHTML = products.map(p => `
            <div class="card" id="card-${p.id}" data-idx="0">
                <div class="fav-icon" onclick="toggleFav(${p.id}, this)">â¤</div>
                <div class="slider-container" 
                     ontouchstart="sT(event)" 
                     ontouchmove="mT(event, ${p.id})" 
                     ondblclick="zoomImg(event)">
                    <div class="track" style="transform: translateX(0px);">${p.imgs.map(img => `<img src="${img}">`).join('')}</div>
                    ${p.imgs.length > 1 ? `<div class="img-counter"><span class="idx">1</span>/${p.imgs.length}</div>` : ''}
                </div>
                <div class="info">
                    <div class="title">${p.name}</div>
                    <div class="price">${p.price} ${cur}</div>
                    <button class="btn-cart" id="btn-${p.id}" onclick="addToCart(${p.id})">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø© ğŸ›’</button>
                </div>
            </div>
        `).join('');
    }

    // Ø³Ù„Ø§ÙŠØ¯Ø± Ø´ÙŠ Ø¥Ù† (ÙŠÙ…ÙŠÙ† ÙˆÙŠØ³Ø§Ø±)
    let startX = 0;
    function sT(e) { startX = e.touches[0].clientX; }
    function mT(e, id) {
        if (!startX) return;
        let diff = startX - e.touches[0].clientX;
        if (Math.abs(diff) > 40) {
            let card = document.getElementById(`card-${id}`);
            let track = card.querySelector('.track');
            let counter = card.querySelector('.idx');
            let idx = parseInt(card.dataset.idx);
            let total = track.children.length;

            if (diff > 0 && idx < total - 1) idx++; // ÙŠØ³Ø§Ø±
            else if (diff < 0 && idx > 0) idx--; // ÙŠÙ…ÙŠÙ†

            card.dataset.idx = idx;
            track.style.transform = `translateX(${idx * 100}%)`;
            if(counter) counter.innerText = idx + 1;
            startX = 0;
        }
    }

    // ØªÙƒØ¨ÙŠØ± Ø§Ù„ØµÙˆØ±
    function zoomImg(e) {
        if (e.target.tagName === 'IMG') {
            if (e.target.requestFullscreen) e.target.requestFullscreen();
        }
    }

    // Ø§Ù„Ø³Ù„Ø© ÙˆØ§Ù„Ù…ÙØ¶Ù„Ø©
    function addToCart(id) {
        let p = products[id];
        cart.push(p);
        document.getElementById('cartCount').innerText = cart.size = cart.length;
        document.getElementById('cartCount').style.display = 'block';
        document.getElementById(`btn-${id}`).innerText = "ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© âœ…";
        updateCartList();
    }

    function updateCartList() {
        const list = document.getElementById('cartItemsList');
        list.innerHTML = cart.map(item => `<div style="padding:10px; border-bottom:1px solid #eee;">${item.name} - ${item.price}</div>`).join('');
    }

    function toggleFav(id, el) { el.classList.toggle('active'); }
    function openPanel(id) { document.getElementById(id).classList.add('active'); document.getElementById('overlay').style.display = 'block'; }
    function closeAll() { document.querySelectorAll('.side-panel').forEach(p => p.classList.remove('active')); document.getElementById('overlay').style.display = 'none'; }
    function updateCur(v) { cur = v; render(); }

    fetchData();
</script>
</body>
</html>
