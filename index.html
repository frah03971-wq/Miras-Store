<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VIRA MALL | GLOBAL LUXURY</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap');
        :root { --gold: #D4AF37; --black: #0f1111; --white: #ffffff; --bg: #f8f9fa; }
        body { font-family: 'Cairo', sans-serif; background: var(--bg); margin: 0; padding-bottom: 90px; color: var(--black); }
        
        /* Premium Header */
        .header { background: linear-gradient(135deg, #1a1a1a, #000); padding: 20px 15px; position: sticky; top: 0; z-index: 2000; border-bottom: 3px solid var(--gold); text-align: center; }
        .logo { font-size: 32px; font-weight: 900; color: var(--gold); text-decoration: none; display: block; margin-bottom: 15px; letter-spacing: 2px; text-shadow: 0 2px 5px rgba(0,0,0,0.5); }
        .header-tools { display: flex; gap: 10px; align-items: center; }
        .search-box { flex-grow: 1; background: rgba(255,255,255,0.1); border-radius: 25px; padding: 8px 15px; border: 1px solid var(--gold); display: flex; }
        .search-box input { background: none; border: none; color: white; width: 100%; font-family: 'Cairo'; outline: none; font-size: 14px; }
        .join-btn { background: var(--gold); color: black; padding: 10px 18px; border-radius: 25px; font-weight: 900; font-size: 11px; text-decoration: none; white-space: nowrap; box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3); cursor: pointer; }

        /* Product Grid */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 15px; }
        .card { background: white; border-radius: 25px; overflow: hidden; box-shadow: 0 10px 25px rgba(0,0,0,0.07); position: relative; border: 1px solid #eee; transition: 0.3s; }
        .card:active { transform: scale(0.97); }
        .card img { width: 100%; height: 220px; object-fit: cover; background: #f9f9f9; }
        .price { position: absolute; top: 12px; left: 12px; background: rgba(15, 17, 17, 0.85); color: var(--gold); padding: 5px 12px; border-radius: 12px; font-weight: 900; font-size: 13px; backdrop-filter: blur(5px); }
        .info { padding: 15px; text-align: center; }
        .store-label { font-size: 10px; color: var(--gold); font-weight: 900; display: block; text-transform: uppercase; margin-bottom: 5px; }
        .title { font-size: 14px; font-weight: 700; margin-bottom: 12px; height: 40px; overflow: hidden; line-height: 1.4; }
        .btn-add { background: var(--black); color: var(--gold); border: 1px solid var(--gold); width: 100%; padding: 12px; border-radius: 15px; font-family: 'Cairo'; font-weight: 800; cursor: pointer; }

        /* Subscription Modal */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 5000; backdrop-filter: blur(10px); }
        .modal-content { background: white; width: 85%; max-width: 400px; margin: 60px auto; border-radius: 35px; padding: 35px; text-align: center; border: 3px solid var(--gold); animation: slideUp 0.4s ease; }
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        /* Floating Elements */
        .cart-float { position: fixed; bottom: 100px; right: 25px; background: var(--gold); width: 65px; height: 65px; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 10px 25px rgba(212, 175, 55, 0.4); z-index: 1000; font-size: 30px; }
        .footer-nav { position: fixed; bottom: 0; width: 100%; background: white; display: flex; justify-content: space-around; padding: 18px 0; border-top: 1px solid #eee; z-index: 1000; box-shadow: 0 -5px 20px rgba(0,0,0,0.05); }
        .nav-link { text-decoration: none; color: #aaa; font-size: 11px; font-weight: 800; text-align: center; }
        .nav-link.active { color: var(--gold); }
    </style>
</head>
<body>

<header class="header">
    <a href="#" class="logo">VIRA MALL</a>
    <div class="header-tools">
        <div class="search-box">
            <input type="text" placeholder="Ø§Ø¨Ø­Ø«ÙŠ Ø¹Ù† Ø§Ù„ØªÙ…ÙŠØ²..." oninput="search(this.value)">
        </div>
        <div class="join-btn" onclick="showPayment()">Ø§Ù†Ø¶Ù… ÙƒØªØ§Ø¬Ø± ğŸ‘‘</div>
    </div>
</header>

<div id="gridArea" class="grid"></div>

<div id="paymentModal" class="modal" onclick="closePayment()">
    <div class="modal-content" onclick="event.stopPropagation()">
        <h2 style="color:var(--gold); margin-top:0;">Ø¹Ø¶ÙˆÙŠØ© Ø§Ù„ØªØ§Ø¬Ø± Ø§Ù„Ù…Ù„ÙƒÙŠØ© âœ¨</h2>
        <p style="font-size: 15px;">Ø±Ø³ÙˆÙ… Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø´Ù‡Ø±ÙŠ: <b>30,000 SDG</b></p>
        <div style="background:#f9f9f9; padding:20px; border-radius:20px; margin:20px 0; border:2px dashed var(--gold)">
            <p style="margin:0 0 10px 0; color:#666;">Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ (Ø¨Ù†ÙƒÙƒ):</p>
            <h2 style="letter-spacing:3px; margin:0; color:black;">2280384</h2>
        </div>
        <p style="font-size:12px; color:#888; line-height:1.6;">ÙŠØ±Ø¬Ù‰ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø±Ø³ÙˆÙ… ÙˆØ¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø¯ÙØ¹ Ø¹Ø¨Ø± Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ù„ØªÙØ¹ÙŠÙ„ Ù…ØªØ¬Ø±Ùƒ ÙˆØ§Ù„Ø¨Ø¯Ø¡ ÙÙŠ Ø¹Ø±Ø¶ Ù…Ù†ØªØ¬Ø§ØªÙƒ.</p>
        <button class="btn-add" style="background:var(--gold); color:black; padding:15px; font-size:16px;" onclick="handleMerchantAction()">ØªØ£ÙƒÙŠØ¯ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± âœ…</button>
    </div>
</div>

<div class="cart-float" onclick="checkout()">
    ğŸ›’ <span id="cartCount" style="position:absolute; top:-5px; right:-5px; background:black; color:var(--gold); font-size:12px; width:25px; height:25px; border-radius:50%; display:flex; align-items:center; justify-content:center; border:2px solid var(--gold); font-weight:900;">0</span>
</div>

<nav class="footer-nav">
    <a href="#" class="nav-link active" onclick="loadData()">ğŸ <br>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
    <a href="https://wa.me/249967584275" class="nav-link">ğŸšš<br>Ø§Ù„ØªÙˆØµÙŠÙ„</a>
    <a href="https://wa.me/249967584275" class="nav-link">ğŸ’¬<br>ØªÙˆØ§ØµÙ„</a>
</nav>

<script>
    const MY_NUMBER = "249967584275"; // Ø±Ù‚Ù…Ùƒ Ø§Ù„Ø³Ø­Ø±ÙŠ
    const mySheet = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSsqL_LzG-fE_20L9SjKk9Z5L_F2uM_2pZ3E_4m9uV9W_E/pub?output=csv&gid=917392071';
    const merchantSheet = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTWD0ZQAKe2KRwLQnNjh2t7Z2Y_BKXxaKZxZwKSXUaZLQ3eeLB1fwj6vNllpNwXCtd9aY9Q_tuuFXXV/pub?output=csv';

    let allProducts = [];
    let cart = [];

    async function loadData() {
        allProducts = [];
        await fetchSheet(mySheet, "ÙÙŠØ±Ø§ Ù…ÙˆÙ„", false);
        await fetchSheet(merchantSheet, "", true);
        renderProducts(allProducts);
    }

    async function fetchSheet(url, defStore, checkExpiry) {
        try {
            const res = await fetch(url + '&t=' + Date.now());
            const text = await res.text();
            const rows = text.split('\n').slice(1);
            const now = new Date();

            rows.forEach(r => {
                const c = r.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                if (!c[3]) return;

                const timestamp = new Date(c[0]);
                const diffDays = (now - timestamp) / (1000 * 60 * 60 * 24);

                // Ø§Ù„Ù…Ø³Ø­ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¨Ø¹Ø¯ 30 ÙŠÙˆÙ… Ù„Ù„ØªØ§Ø¬Ø±Ø§Øª
                if (checkExpiry && diffDays > 30) return;

                allProducts.push({
                    merchant: defStore || c[1]?.replace(/"/g,'').trim(),
                    name: c[3]?.replace(/"/g,'').trim(),
                    price: c[4]?.trim(),
                    img: c[5]?.replace(/"/g,'').trim()
                });
            });
        } catch(e) { console.log("Fetch Error"); }
    }

    function renderProducts(list) {
        const grid = document.getElementById('gridArea');
        if(list.length === 0) {
            grid.innerHTML = '<p style="grid-column:1/3; text-align:center; padding:100px 20px;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ù…Ø§Ù„... âœ¨</p>';
            return;
        }
        grid.innerHTML = list.map(p => `
            <div class="card">
                <img src="${p.img}" loading="lazy" onerror="this.src='https://via.placeholder.com/300?text=VIRA+MALL'">
                <div class="price">${p.price} SDG</div>
                <div class="info">
                    <span class="store-label">${p.merchant}</span>
                    <div class="title">${p.name}</div>
                    <button class="btn-add" onclick="addToCart('${p.name}', '${p.merchant}')">Ø£Ø¶ÙŠÙÙŠ Ù„Ù„Ø³Ù„Ø© ğŸ›’</button>
                </div>
            </div>`).join('');
    }

    function showPayment() { document.getElementById('paymentModal').style.display = 'block'; }
    function closePayment() { document.getElementById('paymentModal').style.display = 'none'; }
    
    function handleMerchantAction() {
        const msg = "Ù…Ø±Ø­Ø¨Ø§Ù‹ ÙÙŠØ±Ø§ØŒ Ø£ÙˆØ¯ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙƒØªØ§Ø¬Ø±Ø© ÙÙŠ ÙÙŠØ±Ø§ Ù…ÙˆÙ„. Ù‚Ù…Øª Ø¨ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø±Ø³ÙˆÙ… (30 Ø£Ù„Ù). Ø¥Ù„ÙŠÙƒ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø¯ÙØ¹:";
        window.open(`https://wa.me/${MY_NUMBER}?text=${encodeURIComponent(msg)}`, '_blank');
        setTimeout(() => {
            window.location.href = "https://docs.google.com/forms/d/1j9qvaGJip8Il4gZTJtefwmkzclrqGlpLyihhXvd4jA8/viewform";
        }, 3000);
    }

    function addToCart(n, s) {
        cart.push({n, s});
        document.getElementById('cartCount').innerText = cart.length;
        alert('Ø£Ø¶ÙŠÙ Ù„Ø¬Ù…Ø§Ù„Ùƒ âœ¨');
    }

    function checkout() {
        if(cart.length === 0) { alert('Ø­Ù‚ÙŠØ¨ØªÙƒ ÙØ§Ø±ØºØ© ÙŠØ§ Ø¨ÙŠØ¨!'); return; }
        let msg = `Ø·Ù„Ø¨ Ù…Ù„ÙƒÙŠ Ù…Ù† VIRA MALL ğŸ‘‘:\n\n` + cart.map(i => `â€¢ ${i.n} [Ù…Ù†: ${i.s}]`).join('\n');
        window.open(`https://wa.me/${MY_NUMBER}?text=${encodeURIComponent(msg)}`);
    }

    function search(q) {
        const filtered = allProducts.filter(p => p.name.toLowerCase().includes(q.toLowerCase()) || p.merchant.toLowerCase().includes(q.toLowerCase()));
        renderProducts(filtered);
    }

    loadData();
</script>
</body>
</html>
