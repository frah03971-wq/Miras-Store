<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VIRA MALL | ÙÙŠØ±Ø§ Ù…ÙˆÙ„</title>

<style>
:root{--gold:#D4AF37;--dark:#0f1111;--gray:#f5f5f7;--white:#fff;--red:#e41e31}
body{margin:0;font-family:'Segoe UI',Tahoma;background:var(--gray)}

header{
background:var(--dark);
color:white;
padding:20px 10px;
text-align:center;
position:sticky;
top:0;
z-index:1000;
border-bottom:3px solid var(--gold)
}
header h1{margin:0;color:var(--gold)}
.slogan{font-size:13px;color:#ccc}

.container{
padding:15px;
display:grid;
grid-template-columns:repeat(auto-fill,minmax(165px,1fr));
gap:15px;
max-width:1200px;
margin:auto
}

.card{
background:white;
border-radius:15px;
overflow:hidden;
box-shadow:0 4px 12px rgba(0,0,0,.08)
}

/* ===== SLIDER ===== */
.slider{
position:relative;
height:210px;
overflow:hidden;
direction:ltr;
touch-action:pan-y
}
.track{
display:flex;
height:100%;
transition:transform .4s ease
}
.track img{
width:100%;
flex-shrink:0;
object-fit:cover
}
.nav{
position:absolute;
top:50%;
transform:translateY(-50%);
width:32px;
height:32px;
border-radius:50%;
background:rgba(0,0,0,.6);
color:white;
border:none;
cursor:pointer;
z-index:10
}
.prev{left:8px}
.next{right:8px}

.dots{
position:absolute;
bottom:8px;
left:50%;
transform:translateX(-50%);
display:flex;
gap:5px
}
.dot{
width:7px;
height:7px;
border-radius:50%;
background:#bbb
}
.dot.active{background:var(--gold)}

.fav{
position:absolute;
top:10px;
right:10px;
font-size:22px;
color:white;
text-shadow:0 0 5px #000;
cursor:pointer
}
.fav.active{color:var(--red)}

.info{
padding:12px;
text-align:center
}
.store{font-size:10px;color:var(--gold);font-weight:bold}
.title{font-size:14px;font-weight:bold;height:36px;overflow:hidden}
.price{font-weight:900;margin:8px 0}
.btn{
background:var(--gold);
border:none;
padding:10px;
border-radius:10px;
font-weight:bold;
width:100%;
cursor:pointer
}
</style>
</head>

<body>

<header>
<h1>VIRA MALL</h1>
<p class="slogan">Ù…Ù†ØµØ© Ø§Ù„Ø¨Ø±Ø§Ù†Ø¯Ø§Øª Ø§Ù„Ø³ÙˆØ¯Ø§Ù†ÙŠØ© ğŸ‡¸ğŸ‡©</p>
</header>

<div class="container" id="grid"></div>

<script>
const SHEET_URL='https://docs.google.com/spreadsheets/d/e/2PACX-1vTWD0ZQAKe2KRwLQnNjh2t7Z2Y_BKXxaKZxZwKSXUaZLQ3eeLB1fwj6vNllpNwXCtd9aY9Q_tuuFXXV/pub?output=csv';
let favs=JSON.parse(localStorage.getItem('viraFav')||'[]');

async function load(){
 const r=await fetch(SHEET_URL);
 const t=await r.text();
 const rows=t.split(/\r?\n/).slice(1);
 const data=rows.map((r,i)=>{
  const c=r.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/).map(x=>x.replace(/"/g,''));
  return{ id:i,name:c[0],price:c[1],store:c[2],imgs:c[3]?.split(' ')||[],wa:c[4]};
 }).filter(p=>p.name);

 render(data);
}

function render(list){
 grid.innerHTML=list.map(p=>{
  const dots=p.imgs.map((_,i)=>`<div class="dot ${i==0?'active':''}"></div>`).join('');
  const fav=favs.includes(p.id)?'active':'';
  return`
  <div class="card" data-i="0">
   <div class="slider">
    <div class="fav ${fav}" onclick="toggleFav(${p.id},this)">â¤</div>
    <div class="track">
     ${p.imgs.map(img=>`<img src="${img}">`).join('')}
    </div>
    ${p.imgs.length>1?`
     <button class="nav prev" onclick="slide(this,-1)">â®</button>
     <button class="nav next" onclick="slide(this,1)">â¯</button>
     <div class="dots">${dots}</div>
    `:''}
   </div>
   <div class="info">
    <div class="store">${p.store}</div>
    <div class="title">${p.name}</div>
    <div class="price">${p.price} SDG</div>
    <button class="btn" onclick="window.open('https://wa.me/${p.wa}?text=Ø·Ù„Ø¨: ${p.name}')">Ø·Ù„Ø¨ ÙˆØ§ØªØ³Ø§Ø¨</button>
   </div>
  </div>`;
 }).join('');

 initSliders();
}

/* ===== SLIDER LOGIC ===== */
function slide(btn,dir){
 const card=btn.closest('.card');
 const track=card.querySelector('.track');
 const dots=card.querySelectorAll('.dot');
 let i=+card.dataset.i;
 const total=track.children.length;

 i=(i+dir+total)%total;
 card.dataset.i=i;
 track.style.transform=`translateX(-${i*100}%)`;
 dots.forEach(d=>d.classList.remove('active'));
 dots[i].classList.add('active');
}

/* Swipe + Auto */
function initSliders(){
 document.querySelectorAll('.slider').forEach(slider=>{
  let startX=0;
  slider.addEventListener('touchstart',e=>startX=e.touches[0].clientX);
  slider.addEventListener('touchend',e=>{
   const endX=e.changedTouches[0].clientX;
   if(startX-endX>50) slider.querySelector('.next')?.click();
   if(endX-startX>50) slider.querySelector('.prev')?.click();
  });

  setInterval(()=>{
   slider.querySelector('.next')?.click();
  },4000);
 });
}

function toggleFav(id,el){
 if(favs.includes(id)){
  favs=favs.filter(x=>x!==id);
  el.classList.remove('active');
 }else{
  favs.push(id);
  el.classList.add('active');
 }
 localStorage.setItem('viraFav',JSON.stringify(favs));
}

load();
</script>

</body>
</html>
