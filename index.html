<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†ØµØ© Ù…ÙŠØ±Ø§Ø³ - Miras Mall</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap');
        body { font-family: 'Cairo', sans-serif; background-color: #000; margin: 0; padding: 20px; text-align: center; color: #fff; }
        header { background: linear-gradient(135deg, #1a1a1a 0%, #000 100%); color: #d4af37; padding: 30px; margin-bottom: 20px; border-radius: 20px; border: 1px solid #d4af37; }
        .filter-container { margin-bottom: 30px; display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; }
        .filter-btn { background: #1a1a1a; color: #d4af37; border: 1px solid #d4af37; padding: 10px 20px; border-radius: 15px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .filter-btn.active, .filter-btn:hover { background: #d4af37; color: #000; }
        .products-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 20px; max-width: 1200px; margin: 0 auto; }
        .product-card { background: #111; padding: 15px; border-radius: 25px; border: 1px solid #333; transition: 0.3s; }
        .product-card img { width: 100%; height: 260px; object-fit: cover; border-radius: 20px; background: #222; }
        .shop-tag { font-size: 0.8em; color: #d4af37; background: #222; padding: 5px 10px; border-radius: 10px; display: inline-block; margin-bottom: 10px; border: 0.5px solid #d4af37; }
        .price { color: #d4af37; font-weight: bold; font-size: 1.3em; display: block; margin: 10px 0; }
        .btn-whatsapp { display: block; background: #25d366; color: white; padding: 10px; text-decoration: none; border-radius: 12px; font-weight: bold; }
    </style>
</head>
<body>

<header>
    <h1>âœ¨ Ù…Ù†ØµØ© Ù…ÙŠØ±Ø§Ø³ Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ© âœ¨</h1>
    <p>Ø¨ÙˆØ§Ø¨ØªÙƒ Ù„Ù„ØªØ³ÙˆÙ‚ Ø§Ù„ÙØ®Ù…</p>
</header>

<div class="filter-container" id="filter-buttons">
    <button class="filter-btn active" onclick="filterShop('Ø§Ù„ÙƒÙ„')">Ø§Ù„ÙƒÙ„</button>
</div>

<div class="products-grid" id="products-container">
    <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª...</p>
</div>

<script>
    const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTWD0ZQAKe2KRwLQnNjh2t7Z2Y_BKXxaKZxZwKSXUaZLQ3eeLB1fwj6vNllpNwXCtd9aY9Q_tuuFXXV/pub?output=csv'; 
    let allProducts = [];

    async function loadData() {
        try {
            const response = await fetch(sheetUrl + '&t=' + Date.now());
            const text = await response.text();
            const rows = text.split('\n').filter(r => r.trim() !== '');
            
            allProducts = [];
            const shops = new Set();

            for (let i = 1; i < rows.length; i++) {
                const cols = rows[i].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                if (cols.length >= 4) {
                    const product = {
                        name: cols[0].replace(/"/g, '').trim(), // Ø§Ù„Ø¹Ù…ÙˆØ¯ A
                        price: cols[1].replace(/"/g, '').trim(), // Ø§Ù„Ø¹Ù…ÙˆØ¯ B
                        shop: cols[2] ? cols[2].replace(/"/g, '').trim() : 'Ø¹Ø§Ù…', // Ø§Ù„Ø¹Ù…ÙˆØ¯ C
                        img: cols[3] ? cols[3].replace(/"/g, '').trim() : '', // Ø§Ù„Ø¹Ù…ÙˆØ¯ D
                        phone: cols[4] ? cols[4].replace(/"/g, '').trim() : '249967584275' // Ø§Ù„Ø¹Ù…ÙˆØ¯ E
                    };
                    allProducts.push(product);
                    if(product.shop) shops.add(product.shop);
                }
            }

            const filterBox = document.getElementById('filter-buttons');
            shops.forEach(shop => {
                if(shop && shop !== 'Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø±') {
                    filterBox.innerHTML += `<button class="filter-btn" onclick="filterShop('${shop}')">${shop}</button>`;
                }
            });

            displayProducts(allProducts);
        } catch (e) {
            document.getElementById('products-container').innerHTML = "<h2>ØªØ£ÙƒØ¯ÙŠ Ù…Ù† Ù†Ø´Ø± Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙŠØ§ Ù‚Ù„Ø¨ÙŠ</h2>";
        }
    }

    function displayProducts(products) {
        const container = document.getElementById('products-container');
        container.innerHTML = '';
        products.forEach(p => {
            container.innerHTML += `
                <div class="product-card">
                    <span class="shop-tag">ğŸ¬ ${p.shop}</span>
                    <img src="${p.img}" alt="${p.name}" onerror="this.src='https://via.placeholder.com/300/111/d4af37?text=Miras+Mall'">
                    <h3 style="margin:10px 0">${p.name}</h3>
                    <span class="price">${p.price} SDG</span>
                    <a href="https://wa.me/${p.phone}?text=Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ Ø£Ø±ÙŠØ¯ Ø·Ù„Ø¨: ${p.name}" class="btn-whatsapp">Ø§Ø·Ù„Ø¨ÙŠ Ø§Ù„Ø¢Ù†</a>
                </div>`;
        });
    }

    function filterShop(shopName) {
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.classList.toggle('active', btn.innerText === shopName);
        });
        if (shopName === 'Ø§Ù„ÙƒÙ„') { displayProducts(allProducts); } 
        else { displayProducts(allProducts.filter(p => p.shop === shopName)); }
    }

    window.onload = loadData;
</script>
</body>
</html>
