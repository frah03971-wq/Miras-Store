<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VIRA MALL | Ø®ÙŠØ§Ø±Ùƒ Ø§Ù„Ø£ÙˆÙ„</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap');
        :root { --primary: #febd69; --dark: #131921; --bg: #f5f6f7; --red: #ff4757; }
        body { font-family: 'Cairo', sans-serif; background: var(--bg); margin: 0; padding-bottom: 90px; }
        .app-header { background: var(--dark); padding: 15px; color: white; position: sticky; top: 0; z-index: 3000; border-bottom: 2px solid var(--primary); }
        .logo-area { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .logo { font-size: 26px; font-weight: 900; color: var(--primary); text-decoration: none; }
        .merchant-btn { background: var(--primary); color: var(--dark); padding: 7px 15px; border-radius: 20px; font-size: 12px; font-weight: 900; text-decoration: none; }
        .cart-icon-box { position: relative; cursor: pointer; font-size: 26px; }
        .cart-count { position: absolute; top: -5px; right: -8px; background: var(--red); color: white; font-size: 11px; padding: 2px 6px; border-radius: 50%; font-weight: 700; }
        .search-box { background: white; border-radius: 12px; display: flex; padding: 5px 15px; align-items: center; }
        .search-box input { border: none; width: 100%; padding: 8px; outline: none; font-family: 'Cairo'; font-weight: bold; }
        .cats-scroll { display: flex; overflow-x: auto; padding: 15px; gap: 15px; background: white; border-bottom: 1px solid #ddd; }
        .cat-item { display: flex; flex-direction: column; align-items: center; min-width: 70px; cursor: pointer; }
        .cat-circle { width: 55px; height: 55px; background: #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; border: 2px solid var(--primary); box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .cat-item span { font-size: 11px; font-weight: 700; margin-top: 5px; color: var(--dark); }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding: 12px; }
        .card { background: white; border-radius: 18px; overflow: hidden; position: relative; box-shadow: 0 4px 15px rgba(0,0,0,0.05); border: 1px solid #eee; }
        .img-box { height: 210px; position: relative; }
        .img-box img { width: 100%; height: 100%; object-fit: cover; }
        .price-badge { position: absolute; bottom: 10px; left: 10px; background: var(--dark); color: var(--primary); padding: 4px 10px; border-radius: 8px; font-weight: 800; font-size: 12px; }
        .info { padding: 12px; text-align: center; }
        .merchant-name { font-size: 10px; color: var(--red); font-weight: bold; margin-bottom: 4px; }
        .p-title { font-size: 13px; font-weight: 700; height: 38px; overflow: hidden; margin-bottom: 10px; }
        .add-btn { width: 100%; background: var(--primary); border: none; padding: 10px; border-radius: 12px; font-family: 'Cairo'; font-weight: 800; cursor: pointer; }
        #cartOverlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 5000; backdrop-filter: blur(5px); }
        .cart-modal { background: white; width: 90%; max-width: 400px; margin: 50px auto; border-radius: 25px; padding: 25px; max-height: 80vh; overflow-y: auto; }
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: white; display: flex; justify-content: space-around; padding: 12px 0; border-top: 1px solid #ddd; z-index: 4000; }
        .nav-link { text-align: center; text-decoration: none; color: #888; font-size: 12px; font-weight: 700; background: none; border: none; flex: 1; }
        .nav-link.active { color: var(--dark); }
    </style>
</head>
<body>
<header class="app-header">
    <div class="logo-area">
        <a href="#" class="logo">VIRA MALL</a>
        <div style="display: flex; align-items: center; gap: 10px;">
            <a href="https://docs.google.com/forms/d/1j9qvaGJip8Il4gZTJtefwmkzclrqGlpLyihhXvd4jA8/viewform" target="_blank" class="merchant-btn">Ø§Ù†Ø¶Ù… ÙƒØªØ§Ø¬Ø± â•</a>
            <div class="cart-icon-box" onclick="toggleCart()">
                ğŸ›’<span class="cart-count" id="cartCount">0</span>
            </div>
        </div>
    </div>
    <div class="search-box">
        <input type="text" placeholder="Ø§Ø¨Ø­Ø«ÙŠ Ø¹Ù† Ù…Ù†ØªØ¬ Ø£Ùˆ Ù…ØªØ¬Ø±..." oninput="search(this.value)">
    </div>
</header>
<div class="cats-scroll" id="catBar"></div>
<div id="gridArea" class="grid"></div>
<div id="cartOverlay" onclick="toggleCart()">
    <div class="cart-modal" onclick="event.stopPropagation()">
        <h3 style="text-align: center;">Ø³Ù„ØªÙƒ Ø§Ù„Ø¬Ù…ÙŠÙ„Ø© ğŸ›ï¸</h3>
        <div id="cartItemsList"></div>
        <div style="display:flex; justify-content:space-between; font-weight:900; margin:20px 0; font-size: 18px; color: var(--red);">
            <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span><span id="cartTotal">0 SDG</span>
        </div>
        <button class="add-btn" style="background:var(--dark); color:var(--primary); padding: 15px;" onclick="checkout()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ âœ…</button>
        <button onclick="toggleCart()" style="width:100%; background:none; border:none; color:#999; margin-top:15px; font-family:'Cairo';">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
</div>
<nav class="bottom-nav">
    <button class="nav-link active" onclick="loadData()"><i>ğŸ </i>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
    <button class="nav-link" onclick="sendDirect('ØªÙˆØµÙŠÙ„')"><i>ğŸšš</i>Ø§Ù„ØªÙˆØµÙŠÙ„</button>
    <button class="nav-link" onclick="alert('Ù‚Ø±ÙŠØ¨Ø§Ù‹!')"><i>â¤ï¸</i>Ø§Ù„Ù…ÙØ¶Ù„Ø©</button>
    <button class="nav-link" onclick="sendDirect('Ø§Ø³ØªÙØ³Ø§Ø±')"><i>ğŸ’¬</i>ØªÙˆØ§ØµÙ„</button>
</nav>
<script>
    const url = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSsqL_LzG-fE_20L9SjKk9Z5L_F2uM_2pZ3E_4m9uV9W_E/pub?output=csv';
    let products = []; let cart = [];
    async function loadData() {
        const res = await fetch(url + '&t=' + Date.now());
        const text = await res.text();
        const rows = text.split('\n').slice(1);
        products = rows.map(r => {
            const c = r.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
            return { merchant: c[1]?.trim(), cat: c[2]?.trim(), name: c[3]?.trim(), price: c[4]?.trim(), img: c[5]?.trim() };
        }).filter(p => p.name && p.img && p.img.startsWith('http'));
        renderCats(); renderProducts(products);
    }
    function renderCats() {
        const cats = [...new Set(products.map(p => p.cat))];
        const icons = {'Ø§Ù„Ø±Ø¬Ø§Ù„':'ğŸ‘”', 'Ø§Ù„Ø£Ø·ÙØ§Ù„':'ğŸ‘¶', 'Ø§Ù„Ø¹Ø·ÙˆØ±':'ğŸŒ¸', 'Ø§Ù„Ø¨Ø®ÙˆØ±':'ğŸ’¨'};
        let h = `<div class="cat-item" onclick="renderProducts(products)"><div class="cat-circle">ğŸŒˆ</div><span>Ø§Ù„ÙƒÙ„</span></div>`;
        cats.forEach(c => { h += `<div class="cat-item" onclick="filterCat('${c}')"><div class="cat-circle">${icons[c] || 'ğŸ“¦'}</div><span>${c}</span></div>`; });
        document.getElementById('catBar').innerHTML = h;
    }
    function renderProducts(list) {
        document.getElementById('gridArea').innerHTML = list.map(p => `
            <div class="card">
                <div class="img-box"><img src="${p.img}"><div class="price-badge">${p.price} SDG</div></div>
                <div class="info"><div class="merchant-name">Ù…ØªØ¬Ø±: ${p.merchant}</div><div class="p-title">${p.name}</div><button class="add-btn" onclick="addToCart('${p.name}', '${p.price}', '${p.merchant}')">Ø£Ø¶ÙŠÙÙŠ Ù„Ù„Ø³Ù„Ø© ğŸ›’</button></div>
            </div>`).join('');
    }
    function addToCart(n, pr, m) { cart.push({name:n, price:pr, merchant:m}); document.getElementById('cartCount').innerText = cart.length; alert('ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©! âœ¨'); }
    function toggleCart() { const o = document.getElementById('cartOverlay'); o.style.display = (o.style.display === 'block' ? 'none' : 'block'); if(o.style.display === 'block') renderCart(); }
    function renderCart() {
        let total = 0;
        const h = cart.map((item, i) => {
            total += parseInt(item.price.replace(/\D/g,'')) || 0;
            return `<div style="display:flex; justify-content:space-between; padding:10px 0; border-bottom:1px solid #eee;"><span>${item.name}</span><b>${item.price}</b><button onclick="cart.splice(${i},1); renderCart();" style="border:none; color:red;">âœ•</button></div>`;
        }).join('');
        document.getElementById('cartItemsList').innerHTML = h || '<p>Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©</p>';
        document.getElementById('cartTotal').innerText = total + ' SDG';
    }
    function checkout() {
        if(cart.length === 0) return;
        let msg = `Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ VIRA MALL ğŸ‘‘:\n\n` + cart.map(i => `â€¢ ${i.name} [${i.merchant}] - ${i.price}`).join('\n');
        msg += `\n\nğŸ’° Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${document.getElementById('cartTotal').innerText}\nğŸ“ Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØªÙˆØµÙŠÙ„:`;
        window.open(`https://wa.me/249967584275?text=${encodeURIComponent(msg)}`);
    }
    function filterCat(c) { renderProducts(products.filter(p => p.cat === c)); }
    function search(q) { renderProducts(products.filter(p => p.name.toLowerCase().includes(q.toLowerCase()) || p.merchant.toLowerCase().includes(q.toLowerCase()))); }
    function sendDirect(t) { window.open(`https://wa.me/249967584275?text=${t === 'ØªÙˆØµÙŠÙ„' ? 'Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† Ø§Ù„ØªÙˆØµÙŠÙ„' : 'Ù…Ø±Ø­Ø¨Ø§ ÙÙŠØ±Ø§ Ù…ÙˆÙ„'}`); }
    loadData();
</script>
</body>
</html>
