<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VIRA MALL | OFFICIAL</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap');
        :root { --gold: #D4AF37; --black: #000; --bg: #f8f9fa; }
        body { font-family: 'Cairo', sans-serif; background: var(--bg); margin: 0; padding-bottom: 90px; color: var(--black); }
        .header { background: var(--black); padding: 25px 15px; text-align: center; border-bottom: 3px solid var(--gold); position: sticky; top: 0; z-index: 2000; }
        .logo { font-size: 32px; font-weight: 900; color: var(--gold); text-decoration: none; letter-spacing: 2px; }
        .search-container { background: #fff; padding: 15px; border-bottom: 1px solid #eee; display: flex; gap: 10px; position: sticky; top: 85px; z-index: 1000; }
        .search-input { flex-grow: 1; padding: 12px; border: 1px solid var(--gold); border-radius: 15px; font-family: 'Cairo'; outline: none; }
        .section-title { padding: 15px; font-weight: 900; border-right: 6px solid var(--gold); margin: 25px 15px 10px; background: #fff; font-size: 18px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 0 15px; }
        .card { background: white; border-radius: 25px; overflow: hidden; box-shadow: 0 8px 20px rgba(0,0,0,0.08); position: relative; border: 1px solid #eee; display: flex; flex-direction: column; }
        .card img { width: 100%; height: 180px; object-fit: cover; }
        .price-chip { position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.8); color: var(--gold); padding: 5px 10px; border-radius: 12px; font-weight: 900; font-size: 11px; border: 1px solid var(--gold); }
        .info { padding: 12px; text-align: center; flex-grow: 1; }
        .store-tag { font-size: 10px; color: var(--gold); font-weight: 800; display: block; margin-bottom: 4px; }
        .title { font-size: 13px; font-weight: 700; margin-bottom: 10px; height: 38px; overflow: hidden; }
        .btn-add { background: var(--black); color: var(--gold); border: 1px solid var(--gold); width: 100%; padding: 10px; border-radius: 12px; font-weight: 800; cursor: pointer; }
        .nav { position: fixed; bottom: 0; width: 100%; background: #fff; display: flex; justify-content: space-around; padding: 15px 0; border-top: 1px solid #eee; z-index: 2500; }
        .nav-item { text-align: center; color: #888; font-size: 11px; font-weight: 700; text-decoration: none; position: relative; }
        .badge { background: red; color: white; border-radius: 50%; padding: 2px 6px; font-size: 10px; position: absolute; top: -5px; right: 5px; }
        .modal { display: none; position: fixed; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 5000; backdrop-filter: blur(8px); }
        .modal-content { background: white; width: 85%; max-width: 400px; margin: 60px auto; border-radius: 30px; padding: 25px; text-align: center; border: 3px solid var(--gold); max-height: 80vh; overflow-y: auto; }
    </style>
</head>
<body>

<header class="header"><a href="#" class="logo">VIRA MALL</a></header>

<div class="search-container">
    <input type="text" id="searchInput" class="search-input" placeholder="Ø§Ø¨Ø­Ø«ÙŠ Ø¹Ù† Ù‚Ø·Ø¹Ø© Ù…Ù…ÙŠØ²Ø©..." oninput="search()">
    <button class="btn-add" style="width:auto; padding:0 15px;" onclick="showModal('merchantModal')">Ø§Ù†Ø¶Ù…ÙŠ ğŸ‘‘</button>
</div>

<div class="section-title">âœ¨ Ù…Ø¬Ù…ÙˆØ¹Ø© VIRA Ø§Ù„Ù…Ù„ÙƒÙŠØ©</div>
<div id="myGrid" class="grid"></div>

<div class="section-title">ğŸ›ï¸ Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ØªØ§Ø¬Ø±Ø§Øª</div>
<div id="merchGrid" class="grid"></div>

<div id="cartModal" class="modal">
    <div class="modal-content">
        <h3>Ø³Ù„Ø© Ø§Ù„Ø¬Ù…Ø§Ù„ ğŸ›’</h3>
        <div id="cartItemsList" style="text-align: right; margin: 20px 0;"></div>
        <div style="text-align:right; margin:15px 0;">
            <label>ÙˆÙ„Ø§ÙŠØ© Ø§Ù„ØªÙˆØµÙŠÙ„:</label>
            <select id="citySelect" onchange="updateTotal()" style="width:100%; padding:10px; border-radius:12px; margin-top:5px; border:1px solid var(--gold); font-family:'Cairo';">
                <option value="0">Ø§Ø®ØªØ±...</option>
                <option value="20000">Ø§Ù„Ø®Ø±Ø·ÙˆÙ… (20,000)</option>
                <option value="25000">Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª (25,000)</option>
            </select>
        </div>
        <h4 id="finalPrice" style="background:var(--black); color:var(--gold); padding:15px; border-radius:15px;">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: 0 SDG</h4>
        <button class="btn-add" onclick="sendOrder()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ ğŸ“¤</button>
        <button onclick="closeModal('cartModal')" style="background:none; border:none; color:#666; margin-top:15px;">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
</div>

<div id="merchantModal" class="modal">
    <div class="modal-content">
        <h2 style="color:var(--gold)">Ø¹Ø¶ÙˆÙŠØ© Ø§Ù„ØªØ§Ø¬Ø±</h2>
        <p>Ø§Ù„Ø±Ø³ÙˆÙ…: <b>30,000 SDG</b></p>
        <button class="btn-add" style="background:var(--gold); color:#000;" onclick="window.open('https://wa.me/249967584275?text=Ø­ÙˆÙ„Øª Ø§Ù„Ù€ 30 Ø£Ù„Ù.. Ø¹Ø§ÙˆØ²Ø© Ø±Ø§Ø¨Ø· Ù…ØªØ¬Ø±ÙŠ âœ¨')">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± ÙˆØ§ØªØ³Ø§Ø¨ âœ…</button>
        <button onclick="closeModal('merchantModal')" style="background:none; border:none; color:red; margin-top:15px;">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
</div>

<nav class="nav">
    <div class="nav-item" onclick="location.reload()">ğŸ <br>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
    <div class="nav-item" onclick="showModal('cartModal')">ğŸ›’<br>Ø§Ù„Ø³Ù„Ø© <span id="cartCount" class="badge">0</span></div>
    <a href="https://wa.me/249967584275" class="nav-item">ğŸ’¬<br>ØªÙˆØ§ØµÙ„</a>
</nav>

<script>
    // Ø§Ù„Ø³Ø± Ù‡Ù†Ø§: Ø¨Ù†Ù‚Ø±Ø§ ÙƒÙ„ ÙˆØ±Ù‚Ø© Ø¨Ø±Ø§Ø¨Ø·Ù‡Ø§ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±
    const SHEET_ID = '1UZnlp45dVMRJxNibcg3fm52H6S4DB4YbGLr4KK3jPqs';
    const URL_VIRA = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=%D8%A7%D9%84%D9%88%D8%B1%D9%82%D8%A91`;
    const URL_MERCH = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=%D8%B1%D8%AF%D9%88%D8%AF%20%D8%A7%D9%84%D9%86%D9%85%D9%88%D8%B0%D8%AC%201`;

    let allData = [];
    let cart = [];

    async function loadData() {
        const [res1, res2] = await Promise.all([fetch(URL_VIRA), fetch(URL_MERCH)]);
        const text1 = await res1.text();
        const text2 = await res2.text();
        
        const parse = (text, isVira) => {
            return text.split('\n').slice(1).map(r => {
                const c = r.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                if (isVira) return { name: c[0]?.replace(/"/g,''), price: c[1]?.replace(/"/g,''), store: c[2]?.replace(/"/g,''), img: c[3]?.replace(/"/g,'') };
                return { store: c[1]?.replace(/"/g,''), name: c[3]?.replace(/"/g,''), price: c[4]?.replace(/"/g,''), img: c[5]?.replace(/"/g,'') };
            }).filter(p => p.name && p.img);
        };

        allData = [...parse(text1, true), ...parse(text2, false)];
        render(allData);
    }

    function render(data) {
        let viraHtml = '', merchHtml = '';
        data.forEach(p => {
            const card = `<div class="card"><div class="price-chip">${p.price} SDG</div><img src="${p.img}" onerror="this.src='https://via.placeholder.com/300'"><div class="info"><span class="store-tag">${p.store}</span><div class="title">${p.name}</div><button class="btn-add" onclick="addToCart('${p.name}','${p.price}','${p.store}')">Ø¥Ø¶Ø§ÙØ© ğŸ›’</button></div></div>`;
            if (p.store.toLowerCase().includes('vira') || p.store.includes('Ù…ÙŠØ±Ø§Ø³') || p.store.includes('ÙÙŠØ±Ø§')) viraHtml += card;
            else merchHtml += card;
        });
        document.getElementById('myGrid').innerHTML = viraHtml || '<div class="empty-msg">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨Ø¶Ø§Ø¹ØªÙƒ.. ØªØ£ÙƒØ¯ÙŠ Ù…Ù† ØªØ³Ù…ÙŠØ© Ø§Ù„Ù…ØªØ¬Ø± (VIRA)</div>';
        document.getElementById('merchGrid').innerHTML = merchHtml;
    }

    function search() {
        const q = document.getElementById('searchInput').value.toLowerCase();
        render(allData.filter(p => p.name.toLowerCase().includes(q) || p.store.toLowerCase().includes(q)));
    }

    function addToCart(n,p,s) { cart.push({n,p,s}); document.getElementById('cartCount').innerText = cart.length; updateCartUI(); alert('Ø£Ø¶ÙŠÙ Ù„Ø¬Ù…Ø§Ù„Ùƒ âœ¨'); }
    function updateCartUI() { document.getElementById('cartItemsList').innerHTML = cart.map((i,idx) => `<div class="cart-row"><span>${i.n}</span><b>${i.p} <span onclick="cart.splice(${idx},1);updateCartUI();" style="color:red">âŒ</span></b></div>`).join(''); updateTotal(); }
    function updateTotal() { const d = parseInt(document.getElementById('citySelect').value)||0; const s = cart.reduce((a,i)=>a+parseInt(i.p.replace(/[^0-9]/g,'')||0),0); document.getElementById('finalPrice').innerText = `Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${s+d} SDG`; }
    function sendOrder() { if(cart.length===0) return; const msg = encodeURIComponent(`Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯:\n${cart.map(i=>`â€¢ ${i.n}`).join('\n')}\nØ§Ù„ØªÙˆØµÙŠÙ„: ${document.getElementById('citySelect').selectedOptions[0].text}`); window.open(`https://wa.me/249967584275?text=${msg}`); }
    function showModal(id) { document.getElementById(id).style.display = 'block'; }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }
    loadData();
</script>
</body>
</html>
