<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VIRA MALL | ÙÙŠØ±Ø§ Ù…ÙˆÙ„</title>
    <style>
        :root { --gold: #D4AF37; --black: #0a0a0a; --bg: #fdfdfd; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--black); transition: 0.3s; overflow-x: hidden; }
        
        /* Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ù…Ù„ÙƒÙŠ */
        header { background: var(--black); padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 2000; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        header h1 { color: var(--gold); margin: 0; font-size: 22px; font-weight: 900; letter-spacing: 2px; }
        .nav-icons { display: flex; gap: 12px; align-items: center; }
        .lang-btn { color: white; border: 1px solid var(--gold); padding: 3px 10px; border-radius: 8px; font-size: 12px; cursor: pointer; font-weight: bold; }

        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙˆØµÙŠÙ„ */
        .delivery-bar { background: #fffde7; padding: 10px; text-align: center; font-size: 11px; color: #856404; font-weight: bold; border-bottom: 1px solid #ffe57f; }

        /* Ø´Ø¨ÙƒØ© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª (Ø³ØªØ§ÙŠÙ„ Ø´ÙŠ Ø¥Ù†) */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(170px, 1fr)); gap: 12px; padding: 12px; }
        .card { background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.05); position: relative; border: 1px solid #eee; }
        
        /* Ø§Ù„Ø³Ù„Ø§ÙŠØ¯Ø± Ø§Ù„Ù…ØªØ·ÙˆØ± */
        .slider-container { position: relative; width: 100%; aspect-ratio: 1/1.25; overflow: hidden; touch-action: pan-y; }
        .track { display: flex; width: 100%; height: 100%; transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94); }
        .track img { min-width: 100%; height: 100%; object-fit: cover; cursor: zoom-in; }
        
        /* Ø§Ù„Ù†Ù‚Ø§Ø· (Dots) */
        .dots { position: absolute; bottom: 8px; left: 50%; transform: translateX(-50%); display: flex; gap: 4px; }
        .dot { width: 5px; height: 5px; background: rgba(255,255,255,0.5); border-radius: 50%; transition: 0.3s; }
        .dot.active { background: var(--gold); width: 12px; border-radius: 10px; }

        .fav-btn { position: absolute; top: 12px; right: 12px; z-index: 10; font-size: 22px; color: rgba(255,255,255,0.9); cursor: pointer; text-shadow: 0 0 5px rgba(0,0,0,0.3); }
        .fav-btn.active { color: #e91e63; }

        .info { padding: 12px; text-align: center; }
        .store-name { font-size: 10px; color: var(--gold); font-weight: bold; margin-bottom: 4px; display: block; }
        .price { font-size: 17px; font-weight: 900; margin: 5px 0; color: var(--black); }
        .title { font-size: 13px; color: #444; height: 34px; overflow: hidden; margin-bottom: 10px; line-height: 1.3; }
        
        .actions { display: flex; gap: 5px; }
        .btn-wa { background: var(--black); color: white; flex: 3; padding: 10px; border-radius: 10px; border: none; font-weight: bold; font-size: 12px; cursor: pointer; }
        .btn-plus { background: var(--gold); color: black; flex: 1; padding: 10px; border-radius: 10px; border: none; font-size: 18px; font-weight: bold; cursor: pointer; }

        /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© */
        .side-panel { position: fixed; top: 0; right: -100%; width: 310px; height: 100%; background: white; z-index: 3000; transition: 0.4s; padding: 30px 20px; box-shadow: -10px 0 30px rgba(0,0,0,0.1); overflow-y: auto; }
        .side-panel.active { right: 0; }
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 2500; display: none; backdrop-filter: blur(4px); }
        
        .menu-item { display: flex; align-items: center; gap: 15px; padding: 18px; background: #f9f9f9; border-radius: 15px; margin-bottom: 12px; text-decoration: none; color: black; font-weight: bold; border: 1px solid transparent; }
        .menu-item:hover { border-color: var(--gold); background: #fff; }

        .sub-card { background: #fff9e6; border: 1px dashed var(--gold); padding: 15px; border-radius: 15px; margin-top: 20px; text-align: center; }
        
        img:fullscreen { object-fit: contain !important; background: black; }
    </style>
</head>
<body dir="rtl">

<div class="overlay" id="overlay" onclick="closeAll()"></div>

<header>
    <div onclick="togglePanel('sideMenu')" style="color:var(--gold); font-size:26px; cursor:pointer;">â˜°</div>
    <h1 id="mainTitle">VIRA MALL</h1>
    <div class="nav-icons">
        <div class="lang-btn" onclick="toggleLang()" id="langBtn">EN</div>
        <div class="icon" style="color:var(--gold); font-size:24px; cursor:pointer;" onclick="togglePanel('cartPanel')">ğŸ›’</div>
    </div>
</header>

<div class="delivery-bar" id="deliveryText">ğŸšš Ø§Ù„ØªÙˆØµÙŠÙ„ Ù…ØªØ§Ø­ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª (Ø§Ù„Ø³Ø¹Ø± Ø­Ø³Ø¨ Ø§Ù„Ù…ØªØ¬Ø±)</div>

<div class="grid" id="mainGrid">
    <p style="text-align:center; grid-column:1/-1; padding:50px; color:#999;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ù†Ø§Ù‚Ø©... âœ¨</p>
</div>

<div class="side-panel" id="cartPanel">
    <h2 id="cartHeader">ğŸ›’ Ø³Ù„ØªÙŠ</h2>
    <div id="cartItems"></div>
    <hr>
    <h3 id="favHeader">â¤ï¸ Ø§Ù„Ù…ÙØ¶Ù„Ø©</h3>
    <div id="favList"></div>
    <button class="btn-wa" style="width:100%; margin-top:20px; padding:15px;" onclick="checkout()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ ÙˆØ§ØªØ³Ø§Ø¨ âœ…</button>
</div>

<div class="side-panel" id="sideMenu">
    <h2 id="menuHeader">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</h2>
    
    <a href="https://t.me/+VksKXlPLnnFjYzlk" target="_blank" class="menu-item">ğŸ“¢ Ù‚Ù†Ø§Ø© Ø§Ù„ØªÙ„Ø¬Ø±Ø§Ù… Ø§Ù„Ø±Ø³Ù…ÙŠØ©</a>
    <a href="admin.html" class="menu-item">ğŸš€ Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„ØªØ§Ø¬Ø±Ø§Øª (Ù†Ø´Ø± Ø¨Ø¶Ø§Ø¹Ø©)</a>
    
    <div class="sub-card">
        <strong id="subTitle">Ø±Ø³ÙˆÙ… Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ù„Ù„ØªØ§Ø¬Ø±Ø§Øª</strong>
        <p style="font-size: 18px; color: var(--gold); margin: 10px 0;">30,000 SDG</p>
        <small id="accText">Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ (Ø¨Ù†ÙƒÙƒ):</small>
        <div style="font-size: 20px; font-weight: 900; letter-spacing: 1px;">2280384</div>
    </div>
</div>

<script>
    let currentLang = 'ar';
    let cart = [];
    let favorites = JSON.parse(localStorage.getItem('vira_favs')) || [];
    const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTWD0ZQAKe2KRwLQnNjh2t7Z2Y_BKXxaKZxZwKSXUaZLQ3eeLB1fwj6vNllpNwXCtd9aY9Q_tuuFXXV/pub?gid=0&single=true&output=csv';

    async function loadData() {
        const res = await fetch(CSV_URL + '?v=' + Date.now());
        const text = await res.text();
        const rows = text.split('\n').slice(1);
        const products = rows.map((r, i) => {
            const c = r.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/).map(v => v.replace(/"/g, '').trim());
            if(!c[0] || !c[1]) return null;
            return { id: i, name: c[0], price: c[1], store: c[2], imgs: c[3].split(/\s+/), wa: c[4] };
        }).filter(p => p);
        render(products);
    }

    function render(data) {
        const grid = document.getElementById('mainGrid');
        grid.innerHTML = data.map(p => `
            <div class="card" id="p-${p.id}" data-idx="0">
                <div class="fav-btn ${favorites.includes(p.id)?'active':''}" onclick="toggleFav(${p.id})">â¤</div>
                <div class="slider-container" 
                     ontouchstart="startTouch(event, ${p.id})" 
                     ontouchmove="moveTouch(event, ${p.id})"
                     ondblclick="zoom(${p.id})">
                    <div class="track">${p.imgs.map(img => `<img src="${img}">`).join('')}</div>
                    <div class="dots">${p.imgs.map((_, i) => `<div class="dot ${i==0?'active':''}"></div>`).join('')}</div>
                </div>
                <div class="info">
                    <span class="store-name">âœ¨ ${p.store}</span>
                    <div class="title">${p.name}</div>
                    <div class="price">${p.price}</div>
                    <div class="actions">
                        <button class="btn-wa" onclick="window.open('https://wa.me/${p.wa}?text=Ø£Ø±ÙŠØ¯ Ø·Ù„Ø¨: ${p.name}')">${currentLang=='ar'?'Ø·Ù„Ø¨':'Order'}</button>
                        <button class="btn-plus" onclick="addToCart('${p.name}')">+</button>
                    </div>
                </div>
            </div>
        `).join('');
    }

    // Ù†Ø¸Ø§Ù… Ø³Ù„Ø§ÙŠØ¯Ø± Ø´ÙŠ Ø¥Ù† (Swipe)
    let touchX = 0;
    function startTouch(e) { touchX = e.touches[0].clientX; }
    function moveTouch(e, id) {
        if (!touchX) return;
        let diff = touchX - e.touches[0].clientX;
        if (Math.abs(diff) > 40) {
            changeSlide(id, diff > 0 ? 1 : -1);
            touchX = 0;
        }
    }

    function changeSlide(id, dir) {
        const card = document.getElementById(`p-${id}`);
        const track = card.querySelector('.track');
        const dots = card.querySelectorAll('.dot');
        let idx = parseInt(card.dataset.idx) + dir;
        if (idx >= 0 && idx < track.children.length) {
            card.dataset.idx = idx;
            track.style.transform = `translateX(${currentLang=='ar' ? idx*100 : -idx*100}%)`;
            dots.forEach((d, i) => d.classList.toggle('active', i === idx));
        }
    }

    function zoom(id) {
        const card = document.getElementById(`p-${id}`);
        const img = card.querySelectorAll('img')[card.dataset.idx];
        if (img.requestFullscreen) img.requestFullscreen();
    }

    function toggleFav(id) {
        if(favorites.includes(id)) favorites = favorites.filter(f => f !== id);
        else favorites.push(id);
        localStorage.setItem('vira_favs', JSON.stringify(favorites));
        loadData();
    }

    function toggleLang() {
        currentLang = currentLang === 'ar' ? 'en' : 'ar';
        document.body.dir = currentLang === 'ar' ? 'rtl' : 'ltr';
        document.getElementById('langBtn').innerText = currentLang === 'ar' ? 'EN' : 'AR';
        
        const trans = {
            ar: ['ğŸšš Ø§Ù„ØªÙˆØµÙŠÙ„ Ù„ÙƒÙ„ Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª', 'ğŸ›’ Ø³Ù„ØªÙŠ', 'â¤ï¸ Ø§Ù„Ù…ÙØ¶Ù„Ø©', 'Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©', 'Ø±Ø³ÙˆÙ… Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ', 'Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨'],
            en: ['ğŸšš Shipping to all states', 'ğŸ›’ My Cart', 'â¤ï¸ Favorites', 'Menu', 'Subscription Fee', 'Account Number']
        };
        const t = trans[currentLang];
        document.getElementById('deliveryText').innerText = t[0];
        document.getElementById('cartHeader').innerText = t[1];
        document.getElementById('favHeader').innerText = t[2];
        document.getElementById('menuHeader').innerText = t[3];
        document.getElementById('subTitle').innerText = t[4];
        document.getElementById('accText').innerText = t[5];
        loadData();
    }

    function togglePanel(id) {
        document.getElementById(id).classList.add('active');
        document.getElementById('overlay').style.display = 'block';
    }
    function closeAll() {
        document.querySelectorAll('.side-panel').forEach(p => p.classList.remove('active'));
        document.getElementById('overlay').style.display = 'none';
    }

    loadData();
</script>
</body>
</html>
