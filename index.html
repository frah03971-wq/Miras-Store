<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VIRA MALL | ÙÙŠØ±Ø§ Ù…ÙˆÙ„</title>
<style>
:root{--gold:#D4AF37;--dark:#0f1111;--gray:#f5f5f7;--white:#fff;--red:#e41e31}
body{margin:0;font-family:'Segoe UI',Tahoma;background:var(--gray);overflow-x:hidden}

/* Ø§Ù„Ù‡ÙŠØ¯Ø± */
header{background:var(--dark);color:white;padding:15px;text-align:center;position:sticky;top:0;z-index:1000;border-bottom:3px solid var(--gold);display:flex;justify-content:space-between;align-items:center}
header h1{margin:0;color:var(--gold);font-size:22px;flex-grow:1}
.menu-btn{font-size:28px;cursor:pointer;color:var(--gold);padding:0 10px}

/* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© */
.sidebar{position:fixed;top:0;right:-300px;width:280px;height:100%;background:var(--dark);z-index:2000;transition:0.3s;color:white;padding:20px;box-shadow:-5px 0 15px rgba(0,0,0,0.5)}
.sidebar.open{right:0}
.sidebar h2{color:var(--gold);border-bottom:1px solid #333;padding-bottom:10px}
.side-item{padding:15px 0;border-bottom:1px solid #222;cursor:pointer;display:flex;align-items:center;gap:10px}
.close-sidebar{font-size:30px;cursor:pointer;text-align:left;display:block}

/* Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª */
.container{padding:15px;display:grid;grid-template-columns:repeat(auto-fill,minmax(165px,1fr));gap:15px;max-width:1200px;margin:auto}
.card{background:white;border-radius:15px;overflow:hidden;box-shadow:0 4px 12px rgba(0,0,0,.08);position:relative}

/* Ø§Ù„Ø³Ù„Ø§ÙŠØ¯Ø± (Ø§Ù„Ø­Ø±ÙƒØ©) */
.slider{position:relative;height:220px;overflow:hidden;direction:ltr}
.track{display:flex;height:100%;transition:transform .5s cubic-bezier(0.4, 0, 0.2, 1)}
.track img{width:100%;flex-shrink:0;object-fit:cover}

.nav{position:absolute;top:50%;transform:translateY(-50%);width:30px;height:30px;border-radius:50%;background:rgba(0,0,0,.5);color:white;border:none;z-index:10;cursor:pointer;display:flex;align-items:center;justify-content:center}
.prev{left:8px} .next{right:8px}

.dots{position:absolute;bottom:10px;left:50%;transform:translateX(-50%);display:flex;gap:5px}
.dot{width:7px;height:7px;border-radius:50%;background:rgba(255,255,255,0.5);transition: 0.3s}
.dot.active{background:var(--gold);width:15px;border-radius:10px}

.fav{position:absolute;top:10px;right:10px;font-size:24px;color:white;text-shadow:0 0 5px #000;z-index:15;cursor:pointer}
.fav.active{color:var(--red)}

.info{padding:12px;text-align:center}
.store{font-size:11px;color:var(--gold);font-weight:bold;margin-bottom:5px;display:block}
.title{font-size:14px;font-weight:bold;height:38px;overflow:hidden;margin-bottom:10px;line-height:1.3}
.price{font-size:16px;font-weight:900;color:var(--dark);margin-bottom:10px}
.btn{background:var(--gold);border:none;padding:12px;border-radius:10px;font-weight:bold;width:100%;cursor:pointer}

/* Ù†ÙˆØ§ÙØ° Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ */
.overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);display:none;z-index:3000;align-items:center;justify-content:center}
.modal{background:white;padding:25px;border-radius:15px;width:80%;max-width:400px;text-align:center;color:black}
</style>
</head>
<body>

<header>
    <div style="width:40px"></div>
    <div>
        <h1>VIRA MALL</h1>
        <p style="margin:0;font-size:12px;color:#ccc">Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø£ÙˆÙ„ ÙÙŠ Ø§Ù„Ø³ÙˆØ¯Ø§Ù† ğŸ‡¸ğŸ‡©</p>
    </div>
    <div class="menu-btn" onclick="toggleSide()">â˜°</div>
</header>

<div class="sidebar" id="sidebar">
    <span class="close-sidebar" onclick="toggleSide()">Ã—</span>
    <h2>VIRA MENU</h2>
    <div class="side-item" onclick="showModal('favs')">â¤ï¸ Ø§Ù„Ù…ÙØ¶Ù„Ø©</div>
    <div class="side-item" onclick="showModal('shipping')">ğŸšš Ø§Ù„ØªÙˆØµÙŠÙ„</div>
    <div class="side-item" onclick="showModal('sub')">ğŸ“© Ø¥Ø´ØªØ±Ø§Ùƒ</div>
    <div class="side-item" onclick="window.location.href='admin.html'">ğŸ‘©â€ğŸ’¼ Ø§Ù„ØªØ§Ø¬Ø±Ø§Øª</div>
</div>

<div class="container" id="grid"></div>

<div class="overlay" id="overlay" onclick="closeModal()">
    <div class="modal" onclick="event.stopPropagation()">
        <h3 id="modalTitle"></h3>
        <div id="modalContent"></div>
        <button class="btn" style="margin-top:15px" onclick="closeModal()">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
</div>

<script>
const SHEET_URL='https://docs.google.com/spreadsheets/d/e/2PACX-1vTWD0ZQAKe2KRwLQnNjh2t7Z2Y_BKXxaKZxZwKSXUaZLQ3eeLB1fwj6vNllpNwXCtd9aY9Q_tuuFXXV/pub?output=csv';
let favs=JSON.parse(localStorage.getItem('viraFav')||'[]');
let productsData = [];

async function load(){
 const r=await fetch(SHEET_URL);
 const t=await r.text();
 const rows=t.split(/\r?\n/).slice(1);
 productsData = rows.map((r,i)=>{
  const c=r.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/).map(x=>x.replace(/"/g,'').trim());
  if(!c[0]) return null;
  return{ id:i,name:c[0],price:c[1],store:c[2],imgs:c[3]?.split(' ')||[],wa:c[4]};
 }).filter(p=>p);
 render(productsData);
}

function render(list){
 grid.innerHTML=list.map(p=>{
  const dots=p.imgs.map((_,i)=>`<div class="dot ${i==0?'active':''}"></div>`).join('');
  return`
  <div class="card" data-i="0">
   <div class="slider">
    <div class="fav ${favs.includes(p.id)?'active':''}" onclick="toggleFav(${p.id},this)">â¤</div>
    <div class="track">${p.imgs.map(img=>`<img src="${img}">`).join('')}</div>
    ${p.imgs.length>1?`
     <button class="nav prev" onclick="slide(this,-1)">â®</button>
     <button class="nav next" onclick="slide(this,1)">â¯</button>
     <div class="dots">${dots}</div>
    `:''}
   </div>
   <div class="info">
    <span class="store">âœ¨ ${p.store}</span>
    <div class="title">${p.name}</div>
    <div class="price">${p.price} SDG</div>
    <button class="btn" onclick="window.open('https://wa.me/${p.wa}?text=Ø·Ù„Ø¨: ${p.name}')">Ø·Ù„Ø¨ ÙˆØ§ØªØ³Ø§Ø¨ âœ…</button>
   </div>
  </div>`;
 }).join('');
 initSliders();
}

function slide(btn,dir){
 const card=btn.closest('.card');
 const track=card.querySelector('.track');
 const dots=card.querySelectorAll('.dot');
 let i=+card.dataset.i;
 const total=track.children.length;
 i=(i+dir+total)%total;
 card.dataset.i=i;
 track.style.transform=`translateX(-${i*100}%)`;
 if(dots.length){
  dots.forEach(d=>d.classList.remove('active'));
  dots[i].classList.add('active');
 }
}

function initSliders(){
 document.querySelectorAll('.slider').forEach(slider=>{
  // ØªÙ‚Ù„ÙŠØ¨ ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„ 4 Ø«ÙˆØ§Ù†ÙŠ
  setInterval(() => { slider.querySelector('.next')?.click(); }, 4000);
  
  // Ø¯Ø¹Ù… Ø§Ù„Ø³Ø­Ø¨ Ø¨Ø§Ù„ÙŠØ¯ (Swipe)
  let startX=0;
  slider.addEventListener('touchstart',e=>startX=e.touches[0].clientX);
  slider.addEventListener('touchend',e=>{
   const endX=e.changedTouches[0].clientX;
   if(startX-endX>50) slide(slider.querySelector('.next'), 1);
   if(endX-startX>50) slide(slider.querySelector('.prev'), -1);
  });
 });
}

function toggleSide(){ document.getElementById('sidebar').classList.toggle('open'); }
function closeModal(){ document.getElementById('overlay').style.display='none'; }

function showModal(type){
 toggleSide();
 const overlay=document.getElementById('overlay');
 overlay.style.display='flex';
 const title=document.getElementById('modalTitle');
 const content=document.getElementById('modalContent');
 
 if(type==='shipping'){
  title.innerText="ğŸšš Ø§Ù„ØªÙˆØµÙŠÙ„";
  content.innerHTML="Ø§Ù„ØªÙˆØµÙŠÙ„ Ù…ØªÙˆÙØ± Ù„ÙƒÙ„ ÙˆÙ„Ø§ÙŠØ§Øª Ø§Ù„Ø³ÙˆØ¯Ø§Ù†. Ø§Ù„Ø³Ø¹Ø± ÙŠØ­Ø¯Ø¯ Ø­Ø³Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ù†Ø¯ Ø§Ù„Ø·Ù„Ø¨.";
 } else if(type==='favs'){
  title.innerText="â¤ï¸ Ø§Ù„Ù…ÙØ¶Ù„Ø©";
  const myFavs = productsData.filter(p => favs.includes(p.id));
  content.innerHTML = myFavs.length ? myFavs.map(p => `<p>â€¢ ${p.name}</p>`).join('') : "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª.";
 } else {
  title.innerText="ğŸ“© Ø¥Ø´ØªØ±Ùƒ";
  content.innerHTML="Ø³ÙŠØµÙ„Ùƒ Ø¬Ø¯ÙŠØ¯Ù†Ø§ Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ù‚Ø±ÙŠØ¨Ø§Ù‹!";
 }
}

function toggleFav(id,el){
 if(favs.includes(id)) favs=favs.filter(x=>x!==id); else favs.push(id);
 el.classList.toggle('active');
 localStorage.setItem('viraFav',JSON.stringify(favs));
}

load();
</script>
</body>
</html>
