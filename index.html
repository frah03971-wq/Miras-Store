<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VIRA MALL | Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø³ÙˆØ¯Ø§Ù†ÙŠ</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap');
        
        :root {
            --amazon-dark: #232f3e;
            --amazon-orange: #febd69;
            --amazon-yellow: #ff9900;
            --sale-red: #fa6338;
            --bg: #f5f6f7;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); font-family: 'Cairo', sans-serif; margin: 0; padding-bottom: 120px; }

        .main-header { background: var(--amazon-dark); padding: 15px; position: sticky; top: 0; z-index: 3000; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .brand-info { text-align: center; }
        .brand-info h1 { color: var(--amazon-orange); margin: 0; font-size: 26px; font-weight: 900; }
        .brand-info p { color: #fff; margin: 0; font-size: 13px; font-weight: 600; }
        
        .search-container { display: flex; margin-top: 15px; background: #fff; border-radius: 8px; overflow: hidden; height: 45px; }
        .search-container input { border: none; padding: 0 15px; width: 100%; font-family: 'Cairo'; outline: none; }
        .search-btn { background: var(--amazon-orange); border: none; padding: 0 15px; cursor: pointer; }

        .section-title { padding: 20px 15px 5px; font-weight: 900; font-size: 20px; color: var(--amazon-dark); display: flex; align-items: center; justify-content: space-between; border-bottom: 2px solid var(--amazon-orange); margin-bottom: 10px; }

        .product-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding: 12px; }
        .p-card { background: #fff; border-radius: 15px; overflow: hidden; border: 1px solid #eee; position: relative; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        
        .fav-btn { position: absolute; top: 10px; left: 10px; background: rgba(255,255,255,0.8); width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 50; cursor: pointer; color: #ccc; }
        .fav-btn.active { color: var(--sale-red); }

        .img-box { position: relative; width: 100%; height: 280px; overflow: hidden; display: flex; background: #f9f9f9; }
        .img-box img { width: 100%; height: 100%; object-fit: cover; flex-shrink: 0; transition: 0.5s; cursor: pointer; }
        
        .dots { position: absolute; bottom: 10px; width: 100%; display: flex; justify-content: center; gap: 5px; z-index: 60; }
        .dot { width: 7px; height: 7px; background: rgba(255,255,255,0.4); border-radius: 50%; }
        .dot.active { background: #fff; width: 16px; border-radius: 10px; }

        .info { padding: 12px; text-align: center; }
        .title { font-size: 14px; font-weight: 700; color: #333; margin-bottom: 5px; height: 40px; overflow: hidden; cursor: pointer; }
        .new-p { color: var(--sale-red); font-size: 18px; font-weight: 900; }
        .add-btn { background: linear-gradient(180deg, #ffdb7d, #ffbb00); border: 1px solid #c89411; width: 100%; padding: 10px; border-radius: 8px; font-family: 'Cairo'; font-weight: 800; cursor: pointer; }

        #descModal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 5000; padding: 20px; overflow-y: auto; }
        .modal-body { background: #fff; border-radius: 25px; padding: 25px; max-width: 450px; margin: auto; position: relative; text-align: center; }
        .close-m { position: absolute; top: 15px; left: 15px; font-size: 25px; cursor: pointer; }

        #viewer { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 9000; justify-content: center; align-items: center; }
        #viewer img { max-width: 100%; max-height: 90%; object-fit: contain; }

        .nav-bar { position: fixed; bottom: 15px; left: 5%; width: 90%; background: #1a1a1a; display: flex; justify-content: space-around; padding: 12px; border-radius: 25px; z-index: 4000; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .nav-item { text-align: center; text-decoration: none; color: #888; font-size: 10px; font-weight: 700; flex: 1; position: relative; }
        .nav-item.active { color: var(--amazon-yellow); }
        .nav-item i { display: block; font-size: 22px; font-style: normal; margin-bottom: 4px; }
        .badge { position: absolute; top: -10px; right: 20%; background: var(--amazon-yellow); color: #000; font-size: 10px; font-weight: 900; min-width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 2px solid #1a1a1a; }

        #back { display: none; position: absolute; right: 15px; top: 18px; color: white; background: rgba(255,255,255,0.2); border: none; padding: 5px 12px; border-radius: 20px; cursor: pointer; }
    </style>
</head>
<body>

<header class="main-header">
    <button id="back" onclick="goHome()">â® Ø±Ø¬ÙˆØ¹</button>
    <div class="brand-info">
        <h1>VIRA MALL</h1>
        <p>Ø§Ù„Ø£Ù†Ø§Ù‚Ø© ÙˆØ§Ù„Ù‚Ø³Ù… Ø§Ù„Ø³ÙˆØ¯Ø§Ù†ÙŠ Ù„Ù„Ø¹Ø·ÙˆØ± ğŸŒ¸ğŸ‡¸ğŸ‡©</p>
    </div>
    <div class="search-container">
        <input type="text" id="mainSearch" placeholder="Ø§Ø¨Ø­Ø«ÙŠ Ø¹Ù† Ø·Ù„Ø¨Ùƒ..." oninput="searchApp()">
        <button class="search-btn">ğŸ”</button>
    </div>
</header>

<div id="contentArea"></div>

<div id="descModal" onclick="this.style.display='none'">
    <div class="modal-body" onclick="event.stopPropagation()">
        <span class="close-m" onclick="document.getElementById('descModal').style.display='none'">Ã—</span>
        <div id="modalContent"></div>
    </div>
</div>

<div id="viewer" onclick="this.style.display='none'">
    <img id="vImg" src="">
</div>

<nav class="nav-bar">
    <a href="javascript:void(0)" class="nav-item active" onclick="goHome()"><i>ğŸ </i>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
    <a href="javascript:void(0)" class="nav-item" onclick="alert('ØªÙˆØµÙŠÙ„ Ø³Ø±ÙŠØ¹ Ù„ÙƒÙ„ Ø§Ù„Ø³ÙˆØ¯Ø§Ù† ğŸšš')"><i>ğŸšš</i>Ø§Ù„ØªÙˆØµÙŠÙ„</a>
    <a href="javascript:void(0)" class="nav-item"><i>â¤ï¸</i>Ø§Ù„Ù…ÙØ¶Ù„Ø©<span id="fBadge" class="badge" style="display:none">0</span></a>
    <a href="javascript:void(0)" class="nav-item" onclick="sendOrder()"><i>ğŸ›’</i>Ø§Ù„Ø­Ù‚ÙŠØ¨Ø©<span id="cBadge" class="badge" style="display:none">0</span></a>
</nav>

<script>
    const url = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTWD0ZQAKe2KRwLQnNjh2t7Z2Y_BKXxaKZxZwKSXUaZLQ3eeLB1fwj6vNllpNwXCtd9aY9Q_tuuFXXV/pub?output=csv';
    let database = [], cart = [], favorites = 0;

    async function init() {
        const r = await fetch(url + '&t=' + Date.now());
        const txt = await r.text();
        const rows = txt.split('\n').slice(1);
        database = rows.map(row => {
            const c = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
            return {
                name: c[0]?.replace(/"/g,''),
                price: c[1]?.trim(),
                shop: c[2]?.trim() || "VIRA",
                imgs: c[3]?.replace(/"/g,'').split(',').map(s => s.trim()),
                old: c[4]?.trim(),
                desc: c[5]?.replace(/"/g,'') || "Ø®Ø§Ù…Ø© ÙØ®Ù…Ø© ÙˆØªØµÙ…ÙŠÙ… Ø±Ø§Ù‚ÙŠ Ù…Ù† ÙÙŠØ±Ø§."
            };
        }).filter(p => p.name && p.price);
        goHome();
    }

    function goHome() {
        document.getElementById('back').style.display = 'none';
        let h = '';
        const shops = [...new Set(database.map(p => p.shop))];
        shops.forEach(s => {
            const items = database.filter(p => p.shop === s).slice(0, 4);
            h += `<div class="section-title"><h2>${s}</h2><span style="font-size:12px; color:var(--amazon-yellow); cursor:pointer;" onclick="goShop('${s}')">Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„ â¯</span></div><div class="product-grid">${items.map(p => createCard(p)).join('')}</div>`;
        });
        document.getElementById('contentArea').innerHTML = h;
    }

    function goShop(name) {
        document.getElementById('back').style.display = 'block';
        const items = database.filter(p => p.shop === name);
        document.getElementById('contentArea').innerHTML = `<div class="section-title">ÙƒÙˆÙ„ÙŠÙƒØ´Ù† ${name}</div><div class="product-grid">${items.map(p => createCard(p)).join('')}</div>`;
        window.scrollTo(0,0);
    }

    function createCard(p) {
        const id = 'p' + Math.random().toString(36).substr(2, 5);
        return `
            <div class="p-card" id="${id}">
                <div class="fav-btn" onclick="toggleFav(this)">â¤</div>
                <div class="img-box" onclick="handleImgClick(event, '${id}')">
                    ${p.imgs.map(src => `<img src="${src}">`).join('')}
                    <div class="dots">${p.imgs.map((_,i)=>`<div class="dot ${i===0?'active':''}"></div>`).join('')}</div>
                </div>
                <div class="info">
                    <div class="title" onclick="openDesc('${encodeURIComponent(JSON.stringify(p))}')">${p.name}</div>
                    <div class="new-p">${p.price} SDG</div>
                    <button class="add-btn" onclick="add('${p.name}', '${p.price}')">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©</button>
                </div>
            </div>`;
    }

    function handleImgClick(event, id) {
        const box = document.getElementById(id).querySelector('.img-box');
        const imgs = box.querySelectorAll('img');
        const dots = box.querySelectorAll('.dot');
        let idx = parseInt(box.dataset.idx || 0);
        const rect = box.getBoundingClientRect();
        const x = event.clientX - rect.left;
        
        if (x > rect.width / 2) {
            document.getElementById('vImg').src = imgs[idx].src;
            document.getElementById('viewer').style.display = 'flex';
        } else {
            idx = (idx + 1) % imgs.length;
            imgs.forEach(img => img.style.transform = `translateX(${idx * 100}%)`);
            dots.forEach((d, i) => d.classList.toggle('active', i === idx));
            box.dataset.idx = idx;
        }
    }

    function openDesc(data) {
        const p = JSON.parse(decodeURIComponent(data));
        document.getElementById('modalContent').innerHTML = `
            <img src="${p.imgs[0]}" style="width:100%; border-radius:15px; margin-bottom:15px;">
            <h3>${p.name}</h3>
            <div style="background:#f9f9f9; padding:15px; border-radius:12px; text-align:right; margin:10px 0;">
                <strong style="display:block; margin-bottom:5px; color:var(--amazon-dark);">Ø§Ù„ÙˆØµÙ ÙˆØ§Ù„ØªÙØ§ØµÙŠÙ„:</strong>
                <p style="color:#555; margin:0; line-height:1.6;">${p.desc}</p>
            </div>
            <div style="font-size:24px; font-weight:900; color:var(--sale-red); margin:15px 0;">${p.price} SDG</div>
            <button class="add-btn" onclick="add('${p.name}', '${p.price}'); document.getElementById('descModal').style.display='none'">Ø£Ø¶ÙŠÙÙŠ Ù„Ù„Ø­Ù‚ÙŠØ¨Ø©</button>
        `;
        document.getElementById('descModal').style.display = 'block';
    }

    function toggleFav(el) {
        el.classList.toggle('active');
        favorites += el.classList.contains('active') ? 1 : -1;
        document.getElementById('fBadge').innerText = favorites;
        document.getElementById('fBadge').style.display = favorites > 0 ? 'flex' : 'none';
    }

    function add(n, p) {
        cart.push({n, p});
        document.getElementById('cBadge').innerText = cart.length;
        document.getElementById('cBadge').style.display = 'flex';
    }

    function searchApp() {
        const q = document.getElementById('mainSearch').value.toLowerCase();
        const f = database.filter(p => p.name.toLowerCase().includes(q) || p.shop.toLowerCase().includes(q));
        document.getElementById('contentArea').innerHTML = `<div class="product-grid">${f.map(p => createCard(p)).join('')}</div>`;
    }

    function sendOrder() {
        if(!cart.length) return alert("Ø³Ù„ØªÙƒ ÙØ§Ø±ØºØ©!");
        let m = "Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ù† VIRA MALL ğŸ›’:\n" + cart.map(it => `- ${it.n} (${it.p})`).join('\n');
        window.open(`https://wa.me/249967584275?text=${encodeURIComponent(m)}`);
    }

    init();
</script>
</body>
</html>
