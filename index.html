<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VIRA MALL | Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ù„ÙƒÙŠØ©</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap');
        :root { --primary: #febd69; --dark: #131921; --bg: #f5f6f7; --red: #ff4757; }
        body { font-family: 'Cairo', sans-serif; background: var(--bg); margin: 0; padding-bottom: 80px; overflow-x: hidden; }

        /* Header & Merchant Btn */
        .app-header { background: var(--dark); padding: 15px; color: white; position: sticky; top: 0; z-index: 3000; border-bottom: 2px solid var(--primary); }
        .logo-area { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .logo { font-size: 24px; font-weight: 900; color: var(--primary); text-decoration: none; }
        .merchant-btn { background: var(--primary); color: var(--dark); padding: 6px 12px; border-radius: 20px; font-size: 11px; font-weight: 900; text-decoration: none; }

        .cart-icon-box { position: relative; cursor: pointer; font-size: 24px; margin-right: 10px; }
        .cart-count { position: absolute; top: -5px; right: -8px; background: var(--red); color: white; font-size: 11px; padding: 2px 6px; border-radius: 50%; font-weight: 700; }

        .search-box { background: white; border-radius: 12px; display: flex; padding: 5px 15px; align-items: center; }
        .search-box input { border: none; width: 100%; padding: 8px; outline: none; font-family: 'Cairo'; }

        /* Categories */
        .cats-scroll { display: flex; overflow-x: auto; padding: 15px; gap: 15px; background: white; border-bottom: 1px solid #eee; }
        .cat-item { display: flex; flex-direction: column; align-items: center; min-width: 70px; cursor: pointer; }
        .cat-circle { width: 55px; height: 55px; background: #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; border: 2px solid var(--primary); box-shadow: 0 3px 6px rgba(0,0,0,0.05); }
        .cat-item span { font-size: 11px; font-weight: 700; margin-top: 5px; color: var(--dark); }

        /* Product Grid */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding: 12px; }
        .card { background: white; border-radius: 18px; overflow: hidden; position: relative; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .img-box { height: 210px; position: relative; }
        .img-box img { width: 100%; height: 100%; object-fit: cover; }
        .wishlist-heart { position: absolute; top: 10px; right: 10px; font-size: 24px; color: white; cursor: pointer; filter: drop-shadow(0 0 3px rgba(0,0,0,0.5)); transition: 0.3s; }
        .wishlist-heart.active { color: var(--red); transform: scale(1.1); }
        .price-badge { position: absolute; bottom: 10px; left: 10px; background: var(--dark); color: var(--primary); padding: 4px 10px; border-radius: 8px; font-weight: 800; font-size: 12px; }

        .info { padding: 12px; text-align: center; }
        .p-title { font-size: 13px; font-weight: 700; height: 38px; overflow: hidden; margin-bottom: 10px; }
        .add-btn { width: 100%; background: var(--primary); border: none; padding: 10px; border-radius: 12px; font-family: 'Cairo'; font-weight: 800; cursor: pointer; }

        /* Cart Modal */
        #cartOverlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 5000; backdrop-filter: blur(5px); }
        .cart-modal { background: white; width: 90%; max-width: 400px; margin: 40px auto; border-radius: 25px; padding: 25px; max-height: 80vh; overflow-y: auto; }
        .cart-item-row { display: flex; justify-content: space-between; border-bottom: 1px dotted #ccc; padding: 12px 0; align-items: center; }

        /* Bottom Nav */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: white; display: flex; justify-content: space-around; padding: 12px 0; border-top: 1px solid #ddd; z-index: 4000; }
        .nav-link { text-align: center; text-decoration: none; color: #888; font-size: 12px; font-weight: 700; background: none; border: none; flex: 1; }
        .nav-link.active { color: var(--dark); }

        .cats-scroll::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>

<header class="app-header">
    <div class="logo-area">
        <a href="#" class="logo">VIRA MALL</a>
        <div style="display: flex; align-items: center;">
            <a href="Ø­Ø·ÙŠ_Ø±Ø§Ø¨Ø·_Ø§Ù„ÙÙˆØ±Ù…_Ù‡Ù†Ø§" class="merchant-btn">Ø§Ù†Ø¶Ù…ÙŠ ÙƒØªØ§Ø¬Ø±Ø© â•</a>
            <div class="cart-icon-box" onclick="toggleCart()">
                ğŸ›’<span class="cart-count" id="cartCount">0</span>
            </div>
        </div>
    </div>
    <div class="search-box">
        <input type="text" placeholder="Ø§Ø¨Ø­Ø«ÙŠ ÙÙŠ ÙÙŠØ±Ø§ Ù…ÙˆÙ„..." oninput="search(this.value)">
    </div>
</header>

<div class="cats-scroll" id="catBar"></div>
<div id="gridArea" class="grid"></div>

<div id="cartOverlay" onclick="toggleCart()">
    <div class="cart-modal" onclick="event.stopPropagation()">
        <h3 style="text-align: center;">Ø³Ù„ØªÙƒ Ø§Ù„Ø¬Ù…ÙŠÙ„Ø© ğŸ›ï¸</h3>
        <div id="cartItemsList"></div>
        <div style="display:flex; justify-content:space-between; font-weight:900; margin:20px 0; font-size: 18px; color: var(--red);">
            <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span>
            <span id="cartTotal">0 SDG</span>
        </div>
        <button class="add-btn" style="background:var(--dark); color:var(--primary); padding: 15px;" onclick="checkout()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ (ÙˆØ§ØªØ³Ø§Ø¨) âœ…</button>
        <button onclick="toggleCart()" style="width:100%; background:none; border:none; color:#999; margin-top:15px; font-family:'Cairo';">Ø±Ø¬ÙˆØ¹</button>
    </div>
</div>

<nav class="bottom-nav">
    <button class="nav-link active" onclick="loadData()"><i>ğŸ </i>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
    <button class="nav-link" onclick="sendDirect('ØªÙˆØµÙŠÙ„')"><i>ğŸšš</i>Ø§Ù„ØªÙˆØµÙŠÙ„</button>
    <button class="nav-link" onclick="alert('Ø§Ù„Ù…ÙØ¶Ù„Ø§Øª Ù‚Ø±ÙŠØ¨Ø§Ù‹')"><i>â¤ï¸</i>Ø§Ù„Ù…ÙØ¶Ù„Ø©</button>
    <button class="nav-link" onclick="sendDirect('Ø§Ø³ØªÙØ³Ø§Ø±')"><i>ğŸ’¬</i>ØªÙˆØ§ØµÙ„</button>
</nav>

<script>
    const url = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTWD0ZQAKe2KRwLQnNjh2t7Z2Y_BKXxaKZxZwKSXUaZLQ3eeLB1fwj6vNllpNwXCtd9aY9Q_tuuFXXV/pub?output=csv';
    let products = [];
    let cart = [];

    async function loadData() {
        const res = await fetch(url + '&t=' + Date.now());
        const text = await res.text();
        const rows = text.split('\n').slice(1);
        products = rows.map(r => {
            const c = r.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
            return { name: c[0]?.replace(/"/g,''), price: c[1]?.trim(), cat: c[2]?.trim() || "Ø¹Ø§Ù…", img: c[3]?.replace(/"/g,'').trim() };
        }).filter(p => p.name && p.img.startsWith('http'));
        renderCats();
        renderProducts(products);
    }

    function renderCats() {
        const cats = [...new Set(products.map(p => p.cat))];
        const icons = {'Ø§Ù„Ø±Ø¬Ø§Ù„':'ğŸ‘”', 'Ø§Ù„Ø£Ø·ÙØ§Ù„':'ğŸ‘¶', 'Ø§Ù„Ø¹Ø·ÙˆØ±':'ğŸŒ¸', 'Ø§Ù„Ø¨Ø®ÙˆØ±':'ğŸ’¨'};
        let h = `<div class="cat-item" onclick="renderProducts(products)"><div class="cat-circle">ğŸŒˆ</div><span>Ø§Ù„ÙƒÙ„</span></div>`;
        cats.forEach(c => { h += `<div class="cat-item" onclick="filterCat('${c}')"><div class="cat-circle">${icons[c] || 'ğŸ“¦'}</div><span>${c}</span></div>`; });
        document.getElementById('catBar').innerHTML = h;
    }

    function renderProducts(list) {
        document.getElementById('gridArea').innerHTML = list.map(p => `
            <div class="card">
                <div class="img-box"><img src="${p.img}"><span class="wishlist-heart" onclick="this.classList.toggle('active')">â¤</span><div class="price-badge">${p.price} SDG</div></div>
                <div class="info"><div class="p-title">${p.name}</div><button class="add-btn" onclick="addToCart('${p.name}', '${p.price}')">Ø£Ø¶ÙŠÙÙŠ Ù„Ù„Ø³Ù„Ø© ğŸ›’</button></div>
            </div>`).join('');
    }

    function addToCart(name, price) {
        cart.push({name, price});
        document.getElementById('cartCount').innerText = cart.length;
        alert('ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©! âœ¨');
    }

    function toggleCart() {
        const o = document.getElementById('cartOverlay');
        o.style.display = o.style.display === 'block' ? 'none' : 'block';
        if(o.style.display === 'block') renderCart();
    }

    function renderCart() {
        let total = 0;
        const h = cart.map((item, i) => {
            total += parseInt(item.price.replace(/\D/g,'')) || 0;
            return `<div class="cart-item-row"><span>${item.name}</span><b>${item.price}</b><button onclick="cart.splice(${i},1); renderCart();" style="border:none; background:none; color:red;">âœ•</button></div>`;
        }).join('');
        document.getElementById('cartItemsList').innerHTML = h || '<p style="text-align:center;">Ø§Ù„Ø³Ù„Ø© ÙØ§Ø¶ÙŠØ©</p>';
        document.getElementById('cartTotal').innerText = total + ' SDG';
        document.getElementById('cartCount').innerText = cart.length;
    }

    function checkout() {
        if(cart.length === 0) return;
        let msg = `Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ VIRA MALL ğŸ›’:\n\n` + cart.map(i => `â€¢ ${i.name} (${i.price})`).join('\n');
        msg += `\n\nğŸ’° Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${document.getElementById('cartTotal').innerText}\nğŸ“ Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØªÙˆØµÙŠÙ„:`;
        window.open(`https://wa.me/249967584275?text=${encodeURIComponent(msg)}`);
    }

    function filterCat(c) { renderProducts(products.filter(p => p.cat === c)); }
    function search(q) { renderProducts(products.filter(p => p.name.toLowerCase().includes(q.toLowerCase()))); }
    function sendDirect(t) { window.open(`https://wa.me/249967584275?text=${t === 'ØªÙˆØµÙŠÙ„' ? 'Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† Ø§Ù„ØªÙˆØµÙŠÙ„ Ù„Ù…ÙˆÙ‚Ø¹ÙŠ' : 'Ù…Ø±Ø­Ø¨Ø§ ÙÙŠØ±Ø§ Ù…ÙˆÙ„'}`); }
    loadData();
</script>
</body>
</html>
