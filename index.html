<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VIRA MALL | THE ULTIMATE SYSTEM</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap');
        
        :root {
            --gold: #D4AF37;
            --black: #050505;
            --white: #ffffff;
            --soft-bg: #fdfdfd;
            --glass: rgba(255, 255, 255, 0.9);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { font-family: 'Cairo', sans-serif; background: var(--soft-bg); margin: 0; color: var(--black); overflow-x: hidden; }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ø£Ø³Ø·ÙˆØ±ÙŠ */
        .ultra-header {
            background: var(--black);
            padding: 25px 15px;
            text-align: center;
            border-bottom: 4px solid var(--gold);
            position: sticky; top: 0; z-index: 5000;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .ultra-header .logo {
            font-size: 32px; font-weight: 900; color: var(--gold);
            text-decoration: none; letter-spacing: 6px;
            text-shadow: 0 0 15px rgba(212,175,55,0.4);
        }

        /* Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø°ÙƒÙŠ */
        .smart-bar {
            background: var(--white);
            padding: 15px;
            display: flex; gap: 10px;
            position: sticky; top: 88px; z-index: 4000;
            border-bottom: 1px solid #f0f0f0;
            backdrop-filter: blur(10px);
        }
        .search-container { flex: 1; position: relative; }
        .search-container input {
            width: 100%; padding: 14px 45px 14px 20px;
            border-radius: 50px; border: 1.5px solid #eee;
            font-family: 'Cairo'; font-size: 14px; transition: 0.3s;
        }
        .search-container input:focus { border-color: var(--gold); box-shadow: 0 0 15px rgba(212,175,55,0.1); }
        .btn-premium {
            background: var(--gold); color: var(--black); border: none;
            padding: 0 20px; border-radius: 50px; font-weight: 800;
            font-size: 11px; cursor: pointer; text-transform: uppercase;
        }

        /* Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª ÙˆØ§Ù„Ø´Ø¨ÙƒØ© */
        .section-header {
            padding: 25px 20px 10px; font-weight: 900; font-size: 20px;
            display: flex; align-items: center; gap: 12px;
        }
        .section-header::after { content: ''; flex: 1; height: 1px; background: #eee; }

        .ultra-grid {
            display: grid; grid-template-columns: repeat(2, 1fr);
            gap: 18px; padding: 18px;
        }
        .luxury-card {
            background: var(--white); border-radius: 30px; overflow: hidden;
            border: 1px solid #f2f2f2; position: relative;
            display: flex; flex-direction: column; transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            animation: cardEntrance 0.6s ease forwards;
        }
        @keyframes cardEntrance { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        .luxury-card:hover { transform: translateY(-10px); box-shadow: 0 15px 35px rgba(0,0,0,0.06); }
        
        .image-box { position: relative; width: 100%; height: 210px; overflow: hidden; }
        .image-box img { width: 100%; height: 100%; object-fit: cover; cursor: pointer; transition: 0.5s; }
        .image-box:hover img { transform: scale(1.1); }
        
        .price-chip {
            position: absolute; bottom: 12px; left: 12px;
            background: rgba(0,0,0,0.75); color: var(--gold);
            padding: 5px 15px; border-radius: 15px;
            font-weight: 800; font-size: 12px; backdrop-filter: blur(8px);
            border: 1px solid var(--gold); z-index: 10;
        }
        .heart-action {
            position: absolute; top: 12px; right: 12px;
            background: white; width: 38px; height: 38px;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            color: #ddd; cursor: pointer; z-index: 10; transition: 0.3s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .heart-action.active { color: #e74c3c; transform: scale(1.2); }

        .luxury-card-content { padding: 15px; text-align: center; flex: 1; display: flex; flex-direction: column; }
        .merchant-tag { font-size: 10px; font-weight: 800; color: var(--gold); margin-bottom: 6px; }
        .product-name { font-size: 14px; font-weight: 700; color: #222; height: 40px; overflow: hidden; margin-bottom: 8px; }
        .product-snippet { font-size: 11px; color: #888; margin-bottom: 15px; display: block; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        
        .btn-luxury-cart {
            background: var(--black); color: var(--gold); border: 1px solid var(--gold);
            padding: 12px; border-radius: 18px; font-weight: 800;
            font-size: 12px; cursor: pointer; transition: 0.3s; margin-top: auto;
        }
        .btn-luxury-cart:active { transform: scale(0.9); background: var(--gold); color: var(--black); }

        /* ÙÙŠØ±Ø§ Ø§ÙƒØ³Ø¨Ù„ÙˆØ±Ø± */
        .vira-royal-banner {
            background: var(--black); margin: 40px 18px; border-radius: 35px;
            padding: 50px 20px; text-align: center; border: 2px solid var(--gold);
            position: relative; overflow: hidden;
        }
        .vira-royal-banner h2 { color: var(--gold); font-size: 40px; font-weight: 900; margin: 0; letter-spacing: 10px; }
        .btn-royal-view {
            background: var(--gold); color: var(--black); border: none;
            padding: 16px 50px; border-radius: 50px; font-weight: 900;
            margin-top: 25px; cursor: pointer; box-shadow: 0 10px 25px rgba(212,175,55,0.3);
        }

        /* Ø§Ù„Ù…Ø³Ø±Ø­ Ø§Ù„Ø³ÙŠÙ†Ù…Ø§Ø¦ÙŠ (VIRA-Vision) */
        .vira-vision {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--glass); z-index: 9999; flex-direction: column;
            justify-content: center; align-items: center; backdrop-filter: blur(25px);
        }
        .vision-container {
            position: relative; width: 95%; height: 65vh;
            background: #fff; border-radius: 30px; overflow: hidden;
            box-shadow: 0 30px 70px rgba(0,0,0,0.15);
        }
        .vision-img {
            width: 100%; height: 100%; object-fit: contain;
            transition: transform 0.1s ease; cursor: zoom-in;
        }
        .vision-nav {
            position: absolute; top: 50%; transform: translateY(-50%);
            background: white; border: none; width: 55px; height: 55px;
            border-radius: 50%; font-size: 24px; box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            cursor: pointer; z-index: 100;
        }
        .vision-prev { right: 15px; } .vision-next { left: 15px; }
        .vision-close {
            margin-top: 35px; background: var(--black); color: var(--gold);
            border: none; padding: 15px 70px; border-radius: 50px;
            font-weight: 900; cursor: pointer; font-family: 'Cairo';
        }

        /* Ø§Ù„Ø³Ù„Ø© Ø§Ù„Ù…Ù„ÙƒÙŠØ© */
        .cart-modal { display: none; position: fixed; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 6000; backdrop-filter: blur(8px); }
        .cart-inner { background: white; width: 92%; max-width: 450px; margin: 40px auto; border-radius: 40px; padding: 30px; border-top: 8px solid var(--gold); position: relative; }
        .cart-scroll { max-height: 350px; overflow-y: auto; padding-right: 5px; }
        .cart-row {
            padding: 15px 0; border-bottom: 1px solid #f5f5f5;
            display: flex; flex-direction: column; gap: 5px;
        }
        .row-top { display: flex; justify-content: space-between; font-weight: 800; font-size: 15px; }
        .delivery-by { font-size: 11px; color: #999; }
        .total-summary {
            background: #fafafa; padding: 25px; border-radius: 25px;
            margin: 25px 0; border: 1px dashed var(--gold); text-align: center;
        }

        /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙÙ„ÙŠØ© */
        .bottom-nav {
            position: fixed; bottom: 0; width: 100%;
            background: var(--white); display: flex; justify-content: space-around;
            padding: 15px 0; border-top: 1px solid #f0f0f0; z-index: 4500;
        }
        .nav-btn { text-align: center; color: #bbb; font-size: 11px; font-weight: 700; flex: 1; position: relative; }
        .nav-btn.active { color: var(--gold); }
        .count-badge {
            background: #ff4757; color: white; border-radius: 50%;
            padding: 3px 8px; font-size: 10px; position: absolute;
            top: -10px; right: 25%; border: 2.5px solid white;
        }
    </style>
</head>
<body>

<div id="visionStage" class="vira-vision">
    <div class="vision-container" id="zoomBase" onmousemove="viraZoom(event)" onmouseleave="viraZoomOut()">
        <button class="vision-nav vision-prev" onclick="navGallery(-1)">â¯</button>
        <img id="stageImg" src="" class="vision-img">
        <button class="vision-nav vision-next" onclick="navGallery(1)">â®</button>
    </div>
    <div style="margin-top:15px; font-size:12px; color:#777;">ğŸ” Ù…Ø±Ø±ÙŠ Ø¥ØµØ¨Ø¹Ùƒ Ù„Ù„ØªÙƒØ¨ÙŠØ± ÙˆØ§Ù„ØªØ¯Ù‚ÙŠÙ‚ ÙÙŠ Ø§Ù„ØªÙØ§ØµÙŠÙ„</div>
    <button class="vision-close" onclick="closeVision()">Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…Ø¹Ø±Ø¶</button>
</div>

<header class="ultra-header"><a href="#" class="logo">VIRA MALL</a></header>

<div id="p-home">
    <div class="smart-bar">
        <div class="search-container">
            <input type="text" id="vSearch" placeholder="Ø§Ø¨Ø­Ø«ÙŠ Ø¹Ù† Ù‚Ø·Ø¹Ø©ØŒ Ù…Ø§Ø±ÙƒØ©ØŒ Ø£Ùˆ Ù…ØªØ¬Ø±..." oninput="ultraSearch()">
        </div>
        <button class="btn-premium" onclick="openM('merchantM')">Ø§Ù†Ø¶Ù…ÙŠ ğŸ‘‘</button>
    </div>

    <div class="section-header">ğŸŒ Ø¹Ø§Ù„Ù… Ø§Ù„ØªØ§Ø¬Ø±Ø§Øª</div>
    <div id="merchGrid" class="ultra-grid"></div>

    <div class="vira-royal-banner">
        <h2>VIRA</h2>
        <p style="color: #666;">Ù„Ù…Ø³Ø© Ù…Ù† Ø§Ù„ÙØ®Ø§Ù…Ø© Ù„ÙƒÙ„ Ø§Ù…Ø±Ø£Ø© Ø³ÙˆØ¯Ø§Ù†ÙŠØ©</p>
        <button class="btn-royal-view" onclick="toggleVira(true)">ØªØµÙØ­ Ù…ØªØ§Ø¬Ø±ÙŠ Ø§Ù„Ø®Ø§ØµØ© ğŸ”¥</button>
    </div>
</div>

<div id="p-vira" style="display:none">
    <div style="padding:15px; background:#fff; display:flex; justify-content:space-between; align-items:center; border-bottom:2px solid var(--gold); position:sticky; top:88px; z-index:4001;">
        <h3 style="margin:0; font-weight:900; letter-spacing:2px;">ğŸ‘‘ VIRA COLLECTION</h3>
        <button onclick="toggleVira(false)" style="background:var(--gold); border:none; padding:8px 20px; border-radius:15px; font-weight:800; font-size:12px;">Ø±Ø¬ÙˆØ¹</button>
    </div>
    <div id="viraGrid" class="ultra-grid" style="margin-top:15px;"></div>
</div>

<div id="cartM" class="cart-modal"><div class="cart-inner">
    <h2 style="text-align:center; margin-top:0;">ğŸ›’ Ø­Ù‚ÙŠØ¨Ø© Ø§Ù„ØªØ³ÙˆÙ‚</h2>
    <div id="cartList" class="cart-scroll"></div>
    <div class="total-summary">
        <small style="color:#888;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</small>
        <h1 id="totalPrice" style="margin:5px 0; color:var(--black);">0 SDG</h1>
        <div style="background:#fff9e6; color:#856404; padding:10px; border-radius:12px; font-size:11px; margin-top:10px;">
            â„¹ï¸ Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„ ÙŠØ­Ø¯Ø¯Ù‡Ø§ ÙƒÙ„ ØªØ§Ø¬Ø± Ø¨Ø´ÙƒÙ„ Ù…Ø³ØªÙ‚Ù„ Ø­Ø³Ø¨ Ù…ÙˆÙ‚Ø¹Ù‡.
        </div>
    </div>
    <button class="btn-luxury-cart" style="width:100%; padding:16px; font-size:15px;" onclick="checkoutWA()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</button>
    <button onclick="closeM('cartM')" style="width:100%; background:none; border:none; color:red; margin-top:15px; font-weight:700;">Ø¥ØºÙ„Ø§Ù‚</button>
</div></div>

<div id="merchantM" class="cart-modal"><div class="cart-inner" style="text-align:center;">
    <h2 style="color:var(--gold)">Ø§Ø¨Ø¯Ø£ÙŠ ØªØ¬Ø§Ø±ØªÙƒ Ù…Ø¹Ù†Ø§</h2>
    <p>Ø§Ù†Ø¶Ù…ÙŠ Ù„Ø£ÙƒØ¨Ø± Ù…Ù†ØµØ© ØªØ³ÙˆÙ‚ Ø³ÙˆØ¯Ø§Ù†ÙŠØ© Ø§Ø­ØªØ±Ø§ÙÙŠØ©</p>
    <div style="background:#f9f9f9; padding:20px; border-radius:20px; margin:20px 0;">
        Ø±Ø³ÙˆÙ… ÙØªØ­ Ø§Ù„Ù…ØªØ¬Ø±<br><b style="font-size:24px;">30,000 SDG</b>
    </div>
    <button class="btn-luxury-cart" style="width:100%" onclick="window.open('https://wa.me/249967584275')">ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© âœ…</button>
    <button onclick="closeM('merchantM')" style="background:none; border:none; color:red; margin-top:15px;">Ø¥ØºÙ„Ø§Ù‚</button>
</div></div>

<nav class="bottom-nav">
    <div class="nav-btn active" onclick="location.reload()">ğŸ <br>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
    <div class="nav-btn" onclick="toggleVira(true)">ğŸ‘‘<br>ÙÙŠØ±Ø§</div>
    <div class="nav-btn" style="position:relative;" onclick="openM('cartM')">
        ğŸ›’<br>Ø§Ù„Ø³Ù„Ø© <span id="cartCount" class="count-badge">0</span>
    </div>
    <div class="nav-btn" onclick="alert('Ù‚Ø³Ù… Ø§Ù„Ù…ÙØ¶Ù„Ø© Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ± âœ¨')">â¤ï¸<br>Ø§Ù„Ù…ÙØ¶Ù„Ø©</div>
</nav>

<script>
    const SHEET_ID = '1UZnlp45dVMRJxNibcg3fm52H6S4DB4YbGLr4KK3jPqs';
    let fullDB = []; let cart = []; let gallery = []; let gIdx = 0;

    async function initSystem() {
        try {
            const [r1, r2] = await Promise.all([
                fetch(`https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv&gid=0`),
                fetch(`https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv&gid=1152504859`)
            ]);
            const d1 = await r1.text(); const d2 = await r2.text();
            
            const parse = (csv, isV) => {
                const rows = csv.split('\n').map(l => l.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/));
                const h = rows[0].map(x => x.replace(/"/g,'').trim());
                return rows.slice(1).map(c => {
                    const f = (k) => { const i = h.findIndex(x => x.includes(k)); return i!==-1?c[i]?.replace(/"/g,'').trim():''; };
                    return isV ? 
                    { name: c[0], price: c[1], store: c[2]||'VIRA', img: c[3], desc: c[5] } :
                    { store: f('Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø±')||'Ù…ØªØ¬Ø± Ø´Ø±ÙŠÙƒ', name: f('Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬'), price: f('Ø§Ù„Ø³Ø¹Ø±'), img: f('Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©'), desc: f('ÙˆØµÙ')||f('Ù…Ù…ÙŠØ²Ø§Øª') };
                }).filter(p => p.name && p.img);
            };

            fullDB = [...parse(d1, true), ...parse(d2, false)];
            render(fullDB);
        } catch(e) { console.error("System Error"); }
    }

    function render(data) {
        let vH = '', mH = '';
        data.forEach(p => {
            const ui = `
            <div class="luxury-card">
                <div class="image-box">
                    <div class="price-chip">${p.price}</div>
                    <div class="heart-action" onclick="this.classList.toggle('active')">â¤</div>
                    <img src="${p.img.split(';')[0]}" onclick="openVision('${p.img}')" loading="lazy">
                </div>
                <div class="luxury-card-content">
                    <span class="merchant-tag">${p.store}</span>
                    <div class="product-name">${p.name}</div>
                    <span class="product-snippet">${p.desc || 'Ù„Ù…Ø³Ø© Ø¬Ù…Ø§Ù„ÙŠØ© ÙØ±ÙŠØ¯Ø©'}</span>
                    <button class="btn-luxury-cart" onclick="addToCart('${p.name}','${p.price}','${p.store}')">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø© ğŸ›’</button>
                </div>
            </div>`;
            if(p.store.toUpperCase().includes('VIRA')) vH += ui; else mH += ui;
        });
        document.getElementById('viraGrid').innerHTML = vH;
        document.getElementById('merchGrid').innerHTML = mH;
    }

    // Ø²ÙˆÙˆÙ… ÙÙŠØ±Ø§ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ
    function viraZoom(e) {
        const img = document.getElementById('stageImg');
        const box = document.getElementById('zoomBase').getBoundingClientRect();
        const x = ((e.clientX - box.left) / box.width) * 100;
        const y = ((e.clientY - box.top) / box.height) * 100;
        img.style.transformOrigin = `${x}% ${y}%`;
        img.style.transform = "scale(2.5)";
    }
    function viraZoomOut() { document.getElementById('stageImg').style.transform = "scale(1)"; }

    function openVision(imgs) {
        gallery = imgs.split(';').map(s => s.trim()); gIdx = 0;
        document.getElementById('stageImg').src = gallery[0];
        document.getElementById('visionStage').style.display = 'flex';
        document.body.style.overflow = 'hidden';
        document.querySelectorAll('.vision-nav').forEach(n => n.style.display = gallery.length > 1 ? 'block' : 'none');
    }
    function navGallery(d) {
        gIdx = (gIdx + d + gallery.length) % gallery.length;
        document.getElementById('stageImg').src = gallery[gIdx];
        viraZoomOut();
    }
    function closeVision() { document.getElementById('visionStage').style.display = 'none'; document.body.style.overflow = 'auto'; }

    function addToCart(n, p, s) {
        cart.push({n,p,s});
        updateCartUI();
        // ØªØ£Ø«ÙŠØ± ØªÙˆØ³Øª Ø®ÙÙŠÙ
        const t = document.createElement('div');
        t.innerText = 'Ø£Ø¶ÙŠÙ Ù„Ù„Ø¬Ù…Ø§Ù„ âœ¨';
        t.style = 'position:fixed; bottom:110px; left:50%; transform:translateX(-50%); background:var(--black); color:var(--gold); padding:10px 25px; border-radius:50px; z-index:9999; font-size:12px; font-weight:700;';
        document.body.appendChild(t);
        setTimeout(()=>t.remove(), 2000);
    }

    function updateCartUI() {
        document.getElementById('cartCount').innerText = cart.length;
        document.getElementById('cartList').innerHTML = cart.map((i,x) => `
            <div class="cart-row">
                <div class="row-top">
                    <span>${i.n}</span>
                    <span>${i.p} <small onclick="cart.splice(${x},1);updateCartUI();" style="color:red; cursor:pointer; margin-right:8px;">Ã—</small></span>
                </div>
                <div class="delivery-by">Ø¨ÙˆØ§Ø³Ø·Ø©: ${i.s} â€¢ Ø§Ù„ØªÙˆØµÙŠÙ„ ÙŠØ­Ø¯Ø¯ Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ù„ØªØ§Ø¬Ø±</div>
            </div>`).join('');
        const total = cart.reduce((a,i) => a + parseInt(i.p.replace(/[^0-9]/g,'')||0), 0);
        document.getElementById('totalPrice').innerText = `${total.toLocaleString()} SDG`;
    }

    function checkoutWA() {
        if(!cart.length) return alert('Ø³Ù„ØªÙƒ Ø®Ø§Ù„ÙŠØ© ÙŠØ§ Ø¬Ù…ÙŠÙ„Ø©!');
        const m = encodeURIComponent(`Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ù† VIRA MALL ğŸ‘‘\n\n${cart.map(i=>`â€¢ ${i.n} (${i.p})\n  Ø§Ù„Ù…ØªØ¬Ø±: ${i.s}`).join('\n\n')}\n\nğŸ’° Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª: ${document.getElementById('totalPrice').innerText}\nğŸšš Ù…Ù„Ø§Ø­Ø¸Ø©: Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„ ÙŠØªÙ… Ø§Ù„Ø§ØªÙØ§Ù‚ Ø¹Ù„ÙŠÙ‡Ø§ Ù…Ø¹ Ø§Ù„ØªØ§Ø¬Ø±.`);
        window.open(`https://wa.me/249967584275?text=${m}`);
    }

    function ultraSearch() {
        const q = document.getElementById('vSearch').value.toLowerCase();
        render(fullDB.filter(p => p.name.toLowerCase().includes(q) || p.store.toLowerCase().includes(q) || (p.desc && p.desc.toLowerCase().includes(q))));
    }

    function toggleVira(s) {
        document.getElementById('p-home').style.display = s ? 'none' : 'block';
        document.getElementById('p-vira').style.display = s ? 'block' : 'none';
        window.scrollTo(0,0);
    }

    function openM(id) { document.getElementById(id).style.display = 'block'; }
    function closeM(id) { document.getElementById(id).style.display = 'none'; }

    initSystem();
</script>
</body>
</html>
