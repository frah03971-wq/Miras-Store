<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VIRA MALL | The Ultimate Luxury</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap');
        
        :root {
            --vira-gold: linear-gradient(135deg, #D4AF37 0%, #F1D592 50%, #D4AF37 100%);
            --royal-black: #0c0c0c;
            --soft-gray: #f8f9fa;
            --shadow-lux: 0 20px 40px rgba(0,0,0,0.1);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { background: var(--soft-gray); color: var(--royal-black); font-family: 'Cairo', sans-serif; margin: 0; overflow-x: hidden; }

        /* Ù‡ÙŠØ¯Ø± Ø³ÙŠÙ†Ù…Ø§Ø¦ÙŠ */
        .header {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            padding: 15px 25px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 2000;
            border-bottom: 1px solid rgba(212, 175, 55, 0.1);
        }
        .logo { font-size: 1.8em; font-weight: 900; color: var(--royal-black); text-decoration: none; letter-spacing: -1px; }
        .logo span { background: var(--vira-gold); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

        /* Ø´Ø¨ÙƒØ© Ø§Ù„Ù…ØªØ§Ø¬Ø± Ø§Ù„Ø®Ø±Ø§ÙÙŠØ© */
        .main-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 20px; }
        .shop-card { 
            position: relative; height: 260px; border-radius: 30px; overflow: hidden; 
            box-shadow: var(--shadow-lux); transition: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            background: #fff;
        }
        .shop-card:active { transform: scale(0.94) rotate(1deg); }
        .shop-img { width: 100%; height: 100%; object-fit: cover; transition: 0.5s; }
        .shop-card:hover .shop-img { transform: scale(1.1); }
        .shop-overlay {
            position: absolute; inset: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.8) 0%, transparent 60%);
            display: flex; flex-direction: column; justify-content: flex-end; padding: 20px;
        }
        .shop-title { color: #fff; font-weight: 900; font-size: 16px; margin: 0; text-shadow: 0 2px 4px rgba(0,0,0,0.3); }

        /* Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ */
        .modal { 
            display: none; position: fixed; inset: 0; background: #fff; z-index: 5000; 
            overflow-y: auto; animation: premiumSlide 0.6s cubic-bezier(0.23, 1, 0.32, 1);
        }
        @keyframes premiumSlide { from { transform: translateY(100%) scale(0.9); opacity: 0; } to { transform: translateY(0) scale(1); opacity: 1; } }
        
        .close-btn { 
            position: fixed; top: 20px; left: 20px; background: var(--royal-black); 
            color: var(--gold); width: 45px; height: 45px; border-radius: 50%; 
            display: flex; align-items: center; justify-content: center; z-index: 6000;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2); font-size: 20px;
        }

        /* ÙƒØ±Øª Ø§Ù„Ù…Ù†ØªØ¬ - Ultra Premium */
        .p-card { padding: 25px; border-bottom: 12px solid var(--soft-gray); position: relative; }
        .slider-box { 
            width: 100%; height: 420px; border-radius: 35px; overflow: hidden; 
            position: relative; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.15);
        }
        .slider-wrap { display: flex; transition: 0.7s cubic-bezier(0.7, 0, 0.3, 1); height: 100%; }
        .slider-wrap img { width: 100%; flex-shrink: 0; object-fit: cover; }
        
        .fav-pulse {
            position: absolute; top: 20px; right: 20px; width: 45px; height: 45px;
            background: rgba(255,255,255,0.9); border-radius: 50%; 
            display: flex; align-items: center; justify-content: center; z-index: 10;
            font-size: 24px; transition: 0.3s;
        }
        .fav-pulse.active { color: #e74c3c; transform: scale(1.2); box-shadow: 0 0 20px rgba(231, 76, 60, 0.3); }

        .price-box { 
            text-align: center; padding: 20px 0; background: white; border-radius: 0 0 35px 35px;
        }
        .current-price { font-size: 28px; font-weight: 900; background: var(--vira-gold); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .old-price { font-size: 16px; text-decoration: line-through; color: #bbb; margin-right: 10px; }

        .buy-now {
            background: var(--royal-black); color: #fff; border: none; width: 100%;
            padding: 20px; border-radius: 20px; font-weight: 900; font-size: 18px;
            margin-top: 15px; transition: 0.3s; box-shadow: 0 10px 20px rgba(0,0,0,0.15);
        }
        .buy-now:active { transform: scale(0.96); background: #222; }

        /* Ø¨Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø¹Ø§Ø¦Ù… */
        .nav-float {
            position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%);
            width: 92%; max-width: 450px; background: rgba(12,12,12,0.95);
            backdrop-filter: blur(15px); border-radius: 30px; padding: 12px;
            display: flex; justify-content: space-around; align-items: center;
            z-index: 4000; box-shadow: 0 20px 40px rgba(0,0,0,0.4);
        }
        .nav-link { color: #777; text-decoration: none; font-size: 11px; text-align: center; flex: 1; }
        .nav-link.active { color: #D4AF37; }
        .nav-link b { font-size: 24px; display: block; margin-bottom: 2px; }
        .badge { background: #D4AF37; color: #000; font-size: 10px; padding: 2px 6px; border-radius: 10px; font-weight: 900; position: absolute; top: -5px; }
    </style>
</head>
<body>

<div class="header">
    <a href="#" class="logo">VIRA<span> MALL</span></a>
    <div style="font-size: 20px;">âœ¨</div>
</div>

<div class="main-grid" id="shopsContainer">
    </div>

<div id="shop-modal" class="modal">
    <div class="close-btn" onclick="closeAll()">âœ•</div>
    <div id="productsArea" style="padding-top: 70px;"></div>
</div>

<div id="fav-modal" class="modal">
    <div class="close-btn" onclick="closeAll()">âœ•</div>
    <h2 style="text-align:center; margin-top:80px;">Ù…ÙØ¶Ù„ØªÙŠ Ø§Ù„Ù…Ù„ÙƒÙŠØ© â¤ï¸</h2>
    <div id="favArea"></div>
</div>

<nav class="nav-float">
    <div class="nav-link active" onclick="closeAll()"><b>ğŸ </b>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
    <div class="nav-link" onclick="openFav()" style="position:relative"><b>â¤ï¸</b>Ø§Ù„Ù…ÙØ¶Ù„Ø©<span id="wCount" class="badge" style="display:none">0</span></div>
    <div class="nav-link" onclick="sendOrder()" style="position:relative"><b>ğŸ›’</b>Ø§Ù„Ø­Ù‚ÙŠØ¨Ø©<span id="cCount" class="badge" style="display:none">0</span></div>
    <a href="https://wa.me/249967584275" class="nav-link" style="color:inherit; text-decoration:none;"><b>ğŸ’¬</b>ØªÙˆØ§ØµÙ„</a>
</nav>

<script>
    const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTWD0ZQAKe2KRwLQnNjh2t7Z2Y_BKXxaKZxZwKSXUaZLQ3eeLB1fwj6vNllpNwXCtd9aY9Q_tuuFXXV/pub?output=csv';
    let dataStore = [], cart = [], favorites = JSON.parse(localStorage.getItem('vira_favs')) || [];

    async function loadMall() {
        const r = await fetch(sheetUrl + '&t=' + Date.now());
        const text = await r.text();
        const rows = text.split('\n').slice(1);
        dataStore = rows.map(row => {
            const c = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
            return { name: c[0]?.replace(/"/g,''), price: c[1], shop: c[2], img: c[3], old: c[4] };
        }).filter(p => p.shop);
        
        const shops = [...new Set(dataStore.map(p => p.shop))];
        document.getElementById('shopsContainer').innerHTML = shops.map(s => {
            const p = dataStore.find(i => i.shop === s);
            return `<div class="shop-card" onclick="openShop('${s}')">
                <img src="${p.img.split(',')[0]}" class="shop-img">
                <div class="shop-overlay"><h3 class="shop-title">${s} ğŸ‡¸ğŸ‡©</h3></div>
            </div>`;
        }).join('');
        updateBadges();
    }

    function openShop(name) {
        const products = dataStore.filter(p => p.shop === name);
        renderProducts(products, 'productsArea');
        document.getElementById('shop-modal').style.display = 'block';
    }

    function renderProducts(list, target) {
        document.getElementById(target).innerHTML = list.map((p, i) => {
            const imgs = p.img.split(',');
            const isF = favorites.some(f => f.name === p.name);
            return `<div class="p-card">
                <div class="slider-box">
                    <div class="fav-pulse ${isF?'active':''}" onclick="toggleF('${p.name}','${p.price}','${p.img}',event)">â¤ï¸</div>
                    <div class="slider-wrap" id="sw-${target}-${i}">
                        ${imgs.map(u => `<img src="${u.trim()}">`).join('')}
                    </div>
                    ${imgs.length > 1 ? `<button onclick="slide('${target}',${i},-1)" style="position:absolute;left:15px;top:50%;border:none;background:rgba(255,255,255,0.7);width:40px;height:40px;border-radius:50%">â®</button>
                    <button onclick="slide('${target}',${i},1)" style="position:absolute;right:15px;top:50%;border:none;background:rgba(255,255,255,0.7);width:40px;height:40px;border-radius:50%">â¯</button>` : ''}
                </div>
                <div class="price-box">
                    <div style="font-weight:900; font-size:18px;">${p.name}</div>
                    <div class="current-price">${p.price} SDG ${p.old ? `<span class="old-price">${p.old}</span>` : ''}</div>
                    <button class="buy-now" onclick="addToCart('${p.name}','${p.price}')">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø­Ù‚ÙŠØ¨Ø© ğŸ›ï¸</button>
                </div>
            </div>`;
        }).join('');
    }

    function slide(target, idx, dir) {
        const el = document.getElementById(`sw-${target}-${idx}`);
        let cur = parseInt(el.dataset.cur || 0);
        cur = (cur + dir + el.children.length) % el.children.length;
        el.style.transform = `translateX(${cur * 100}%)`;
        el.dataset.cur = cur;
    }

    function toggleF(n, p, im, e) {
        const idx = favorites.findIndex(f => f.name === n);
        if(idx > -1) favorites.splice(idx,1); else favorites.push({name:n, price:p, img:im});
        localStorage.setItem('vira_favs', JSON.stringify(favorites));
        e.target.classList.toggle('active');
        updateBadges();
    }

    function addToCart(n, p) {
        cart.push({n, p});
        updateBadges();
        alert("ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø­Ù‚ÙŠØ¨Ø© âœ…");
    }

    function updateBadges() {
        document.getElementById('cCount').innerText = cart.length;
        document.getElementById('cCount').style.display = cart.length ? 'block' : 'none';
        document.getElementById('wCount').innerText = favorites.length;
        document.getElementById('wCount').style.display = favorites.length ? 'block' : 'none';
    }

    function sendOrder() {
        if(!cart.length) return alert("Ø§Ù„Ø­Ù‚ÙŠØ¨Ø© ÙØ§Ø±ØºØ©!");
        let msg = "Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ù† ÙÙŠØ±Ø§ Ù…ÙˆÙ„ ğŸ‡¸ğŸ‡©:\n";
        cart.forEach((x, i) => msg += `${i+1}. ${x.n} (${x.p} SDG)\n`);
        window.open(`https://wa.me/249967584275?text=${encodeURIComponent(msg)}`);
        cart = []; updateBadges();
    }

    function openFav() {
        if(!favorites.length) return alert("Ø§Ù„Ù…ÙØ¶Ù„Ø© ÙØ§Ø±ØºØ© â¤ï¸");
        renderProducts(favorites.map(f => ({...f, shop:'fav'})), 'favArea');
        document.getElementById('fav-modal').style.display = 'block';
    }

    function closeAll() { document.querySelectorAll('.modal').forEach(m => m.style.display = 'none'); }
    loadMall();
</script>
</body>
</html>
