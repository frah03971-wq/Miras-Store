<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VIRA MALL | ÙÙŠØ±Ø§ Ù…ÙˆÙ„</title>
<style>
:root{--gold:#D4AF37;--dark:#0f1111;--gray:#f5f5f7;--white:#fff;--red:#e41e31;}
body{margin:0;font-family:'Segoe UI',Tahoma,sans-serif;background:var(--gray);direction:rtl;overflow-x:hidden;}

/* Ø§Ù„Ù‡ÙŠØ¯Ø± */
header{background:var(--dark);color:white;padding:20px 10px;text-align:center;position:sticky;top:0;z-index:1000;border-bottom:3px solid var(--gold);}
header h1{margin:0;font-size:28px;color:var(--gold);letter-spacing:1px;}
.slogan{margin:5px 0 0;font-size:13px;color:#ddd;}

.menu-btn{cursor:pointer;font-size:26px;color:var(--gold);position:absolute;top:22px;right:20px;z-index:1001;}
.header-tools{position:absolute;top:22px;left:15px;display:flex;gap:8px;}
.currency-switch{cursor:pointer;padding:4px 8px;background:#222;border-radius:8px;color:white;font-size:11px;border:1px solid #444;}
.currency-switch.active{background:var(--gold);color:#000;}

/* Ø§Ù„Ø­Ø§ÙˆÙŠØ© */
.container{padding:15px;display:grid;grid-template-columns:repeat(auto-fill,minmax(165px,1fr));gap:15px;max-width:1200px;margin:0 auto;}

/* ÙƒØ±Øª Ø§Ù„Ù…Ù†ØªØ¬ ÙˆØ§Ù„Ø³Ù„Ø§ÙŠØ¯Ø± */
.card{background:var(--white);border-radius:15px;overflow:hidden;box-shadow:0 4px 12px rgba(0,0,0,.08);position:relative;display:flex;flex-direction:column;}

.slider-container{position:relative;width:100%;height:210px;background:#eee;overflow:hidden;direction:ltr!important;}
.slider-track{display:flex;width:100%;height:100%;transition:transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);will-change: transform;}
.slider-track img{min-width:100%;width:100%;height:100%;object-fit:cover;cursor:pointer;flex-shrink: 0;}

.nav-btn{position:absolute;top:50%;transform:translateY(-50%);background:rgba(212,175,55,0.9);color:black;border:none;width:30px;height:30px;cursor:pointer;border-radius:50%;z-index:10;font-weight:bold;display:flex;align-items:center;justify-content:center;}
.next{right:8px;} .prev{left:8px;}

.dots{position:absolute;bottom:8px;left:0;right:0;display:flex;justify-content:center;gap:4px;z-index:11;}
.dot{width:6px;height:6px;background:rgba(255,255,255,0.5);border-radius:50%;transition:0.3s;}
.dot.active{background:var(--gold);width:12px;border-radius:4px;}

.fav-icon{position:absolute;top:10px;left:10px;z-index:15;color:rgba(255,255,255,0.9);font-size:22px;cursor:pointer;text-shadow:0 0 5px rgba(0,0,0,0.5);transition: 0.3s;}
.fav-icon.active{color:var(--red);transform: scale(1.2);}

.info{padding:12px;text-align:center;direction:rtl;flex-grow:1;}
.store{font-size:10px;color:var(--gold);font-weight:bold;margin-bottom:5px;}
.title{font-size:14px;font-weight:bold;color:var(--dark);height:38px;overflow:hidden;margin-bottom:8px;}
.price{font-size:16px;font-weight:800;color:#222;margin-bottom:10px;}
.btn-order{background:var(--gold);color:var(--dark);border:none;width:100%;padding:10px;border-radius:10px;font-weight:bold;cursor:pointer;}

/* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© Ø§Ù„Ù…Ø­Ø¯Ø«Ø© */
.sidebar{height:100%;width:0;position:fixed;z-index:10001;top:0;right:0;background:var(--dark);overflow-x:hidden;transition:0.4s;color:white;}
.sidebar-content{padding:25px;}
.sidebar h3{color:var(--gold);font-size:18px;border-bottom:1px solid #333;padding-bottom:10px;margin-top:20px;}
.side-link{display:block;color:#ccc;text-decoration:none;padding:10px 0;font-size:14px;border-bottom:1px solid #222;}
.fav-list-item{display:flex;align-items:center;gap:10px;margin-top:10px;font-size:12px;background:#1a1a1a;padding:5px;border-radius:5px;}
.input-sub{width:100%;padding:10px;margin-top:10px;border-radius:5px;border:none;font-size:13px;}
</style>
</head>
<body>

<header>
  <div class="menu-btn" onclick="openNav()">â˜°</div>
  <h1>VIRA MALL</h1>
  <p class="slogan">Ù…Ù†ØµØ© Ø§Ù„Ø¨Ø±Ø§Ù†Ø¯Ø§Øª Ø§Ù„Ø³ÙˆØ¯Ø§Ù†ÙŠØ© ğŸ‡¸ğŸ‡©</p>
  <div class="header-tools">
    <div class="currency-switch active" id="btnSDG" onclick="setCurrency('SDG')">SDG</div>
    <div class="currency-switch" id="btnSAR" onclick="setCurrency('SAR')">SAR</div>
  </div>
</header>

<div class="container" id="grid"></div>

<div id="mySidebar" class="sidebar">
  <div style="padding:15px;font-size:30px;cursor:pointer;color:var(--gold)" onclick="closeNav()">Ã—</div>
  <div class="sidebar-content">
      <h3>ğŸšš Ø§Ù„ØªÙˆØµÙŠÙ„</h3>
      <p style="font-size:13px;color:#ccc;">ØªÙˆØµÙŠÙ„ Ø³Ø±ÙŠØ¹ Ù„ÙƒÙ„ Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª. Ø§Ù„Ø³Ø¹Ø± ÙŠØ­Ø¯Ø¯ Ø¹Ù†Ø¯ Ø§Ù„Ø·Ù„Ø¨.</p>
      
      <h3>â¤ï¸ Ø§Ù„Ù…ÙØ¶Ù„Ø©</h3>
      <div id="fav-items-container">
        <p style="font-size:12px;color:#666;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù…Ø¶Ø§ÙØ©.</p>
      </div>

      <h3>ğŸ“© Ø¥Ø´ØªØ±Ø§Ùƒ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</h3>
      <p style="font-size:12px;color:#ccc;">ØµÙ„Ùƒ Ø¬Ø¯ÙŠØ¯Ù†Ø§ Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨:</p>
      <input type="tel" class="input-sub" placeholder="Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨...">
      <button onclick="alert('ØªÙ… Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø¨Ù†Ø¬Ø§Ø­ âœ¨')" style="background:var(--gold); border:none; padding:5px 10px; margin-top:5px; border-radius:5px; cursor:pointer; font-weight:bold; width:100%">Ø¥Ø±Ø³Ø§Ù„</button>

      <h3>ğŸ’³ Ø§Ù„Ø¯ÙØ¹</h3>
      <p style="font-size:14px;">Ø­Ø³Ø§Ø¨ Ø¨Ù†ÙƒÙƒ: <strong style="color:var(--gold)">2280384</strong></p>
      
      <hr style="border:0;border-top:1px solid #333;margin:25px 0;">
      <button onclick="window.location.href='admin.html'" style="background:var(--gold);width:100%;padding:12px;border-radius:8px;font-weight:bold;cursor:pointer;">ğŸ‘©â€ğŸ’¼ Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„ØªØ§Ø¬Ø±Ø§Øª</button>
  </div>
</div>

<script>
const SHEET_URL='https://docs.google.com/spreadsheets/d/e/2PACX-1vTWD0ZQAKe2KRwLQnNjh2t7Z2Y_BKXxaKZxZwKSXUaZLQ3eeLB1fwj6vNllpNwXCtd9aY9Q_tuuFXXV/pub?gid=0&single=true&output=csv';
let currentCurr='SDG', allProducts=[], favorites=JSON.parse(localStorage.getItem('vira_favs') || '[]');

function openNav(){document.getElementById("mySidebar").style.width="280px"; renderFavs();}
function closeNav(){document.getElementById("mySidebar").style.width="0";}

async function loadProducts(){
  try{
    const res=await fetch(SHEET_URL + '&cache=' + Date.now());
    const text=await res.text();
    const rows=text.split(/\r?\n/).slice(1);
    allProducts=rows.map((r,idx)=>{
      const c=r.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/).map(x=>x.replace(/"/g,'').trim());
      if(!c[0] || c[0].startsWith('=')) return null; 
      const imgs = c[3] ? c[3].split(/\s+/).filter(i => i.startsWith('http')) : [];
      return {id:idx, name:c[0], price:parseFloat(c[1])||0, store:c[2], imgs:imgs, wa:c[4]};
    }).filter(p=>p);
    renderGrid();
  }catch(e){console.error("Error loading products");}
}

function renderGrid(){
  document.getElementById('grid').innerHTML = allProducts.map(p=>{
    const price = currentCurr==='SDG' ? p.price : (p.price * 0.0031).toFixed(2);
    const imgsHtml = p.imgs.map(img => `<img src="${img}">`).join('');
    const dotsHtml = p.imgs.map((_, i) => `<div class="dot ${i===0?'active':''}"></div>`).join('');
    const isFav = favorites.some(fav => fav.name === p.name) ? 'active' : '';
    
    const navs = p.imgs.length > 1 ? `
      <div class="dots">${dotsHtml}</div>
      <button class="nav-btn next" onclick="moveSlide(this, 1)">â¯</button>
      <button class="nav-btn prev" onclick="moveSlide(this, -1)">â®</button>
    ` : '';
    
    return `<div class="card" data-idx="0">
      <div class="slider-container">
        <div class="fav-icon ${isFav}" onclick="toggleFav('${p.name}', '${p.imgs[0]}', this)">â¤</div>
        <div class="slider-track">${imgsHtml}</div>
        ${navs}
      </div>
      <div class="info">
        <div class="store">âœ¨ ${p.store}</div>
        <div class="title">${p.name}</div>
        <div class="price">${price} ${currentCurr}</div>
        <button class="btn-order" onclick="window.open('https://wa.me/${p.wa.replace(/\s/g,'')}?text=Ø·Ù„Ø¨: ${p.name}')">Ø·Ù„Ø¨ ÙˆØ§ØªØ³Ø§Ø¨ âœ…</button>
      </div>
    </div>`;
  }).join('');
}

// Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø³Ù„Ø§ÙŠØ¯Ø± - Ø§Ù„Ø²ÙŠØª Ø§Ù„Ø£ØµÙ„ÙŠ
function moveSlide(btn, dir){
  const card = btn.closest('.card');
  const track = card.querySelector('.slider-track');
  const dots = card.querySelectorAll('.dot');
  const imgsCount = track.querySelectorAll('img').length;
  let current = parseInt(card.getAttribute('data-idx')) || 0;
  
  current = (current + dir + imgsCount) % imgsCount;
  card.setAttribute('data-idx', current);
  
  // Ø§Ù„ØªØ­Ø±ÙŠÙƒ Ø¨Ù†Ø¸Ø§Ù… Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ© Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø¯Ù‚Ø©
  track.style.transform = `translateX(-${current * 100}%)`;
  
  if(dots.length) {
    dots.forEach((d, i) => d.classList.toggle('active', i === current));
  }
}

// Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙØ¶Ù„Ø©
function toggleFav(name, img, el) {
  const index = favorites.findIndex(f => f.name === name);
  if (index > -1) {
    favorites.splice(index, 1);
    el.classList.remove('active');
  } else {
    favorites.push({name, img});
    el.classList.add('active');
  }
  localStorage.setItem('vira_favs', JSON.stringify(favorites));
}

function renderFavs() {
  const container = document.getElementById('fav-items-container');
  if (favorites.length === 0) {
    container.innerHTML = '<p style="font-size:12px;color:#666;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù…Ø¶Ø§ÙØ©.</p>';
    return;
  }
  container.innerHTML = favorites.map(f => `
    <div class="fav-list-item">
      <img src="${f.img}" width="30" height="30" style="border-radius:3px; object-fit:cover;">
      <span>${f.name}</span>
    </div>
  `).join('');
}

function setCurrency(c){
  currentCurr=c;
  document.querySelectorAll('.currency-switch').forEach(e=>e.classList.remove('active'));
  document.getElementById('btn'+c).classList.add('active');
  renderGrid();
}

loadProducts();
</script>
</body>
</html>
