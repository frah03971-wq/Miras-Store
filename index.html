<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VIRA MALL | ÙÙŠØ±Ø§ Ù…ÙˆÙ„</title>
<style>
:root{
  --gold:#D4AF37; --dark:#0f1111; --gray:#f5f5f7; --white:#fff; --red:#e41e31;
}
body{margin:0; font-family:'Segoe UI', Tahoma, sans-serif; background:var(--gray); direction:rtl; overflow-x:hidden;}

/* Ù‡ÙŠØ¯Ø± Ø§Ø­ØªØ±Ø§ÙÙŠ */
header{background:var(--dark); color:white; padding:15px; text-align:center; position:sticky; top:0; z-index:1000; border-bottom:3px solid var(--gold);}
header h1{margin:5px 0; font-size:24px; color:var(--gold);}
.header-tools { position: absolute; top: 15px; left: 15px; display: flex; align-items: center; gap: 8px; }
.currency-switch { cursor:pointer; padding:5px 10px; background:#222; border-radius:10px; color:white; font-size:12px; font-weight:bold; transition:0.3s; border:1px solid #333; }
.currency-switch.active { background:var(--gold); color:#000; border-color:var(--gold); }
.menu-btn { cursor:pointer; font-size:24px; color:var(--gold); margin-right:10px; }

.container{padding:15px; display:grid; grid-template-columns:repeat(auto-fill,minmax(165px,1fr)); gap:15px; max-width:1200px; margin:0 auto;}

/* ØªØµÙ…ÙŠÙ… Ø§Ù„ÙƒØ±Øª */
.card{background:var(--white); border-radius:15px; overflow:hidden; box-shadow:0 4px 10px rgba(0,0,0,.05); position:relative; transition:.3s;}
.card:hover{transform:translateY(-5px);}
.slider-container { position:relative; width:100%; height:190px; overflow:hidden; background:#f9f9f9; }
.slider-track { display:flex; transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1); height:100%; }
.slider-track img { min-width:100%; height:100%; object-fit:cover; cursor:zoom-in; }

.sale-badge{position:absolute; top:10px; right:10px; background:var(--red); color:white; font-size:11px; padding:3px 8px; border-radius:5px; font-weight:bold; z-index:4;}
.favorite { position:absolute; top:10px; left:10px; font-size:22px; cursor:pointer; color:rgba(255,255,255,0.7); z-index:4; text-shadow: 0 0 5px rgba(0,0,0,0.5); }
.favorite.active{color:var(--red);}

.nav-btn { position:absolute; top:50%; transform:translateY(-50%); background:rgba(0,0,0,0.3); color:white; border:none; width:28px; height:28px; cursor:pointer; border-radius:50%; font-weight:bold; z-index:5; display:flex; align-items:center; justify-content:center; }
.next { right:5px; } .prev { left:5px; }

.info{padding:12px; text-align:center;}
.store{font-size:10px; font-weight:bold; color:var(--gold); margin-bottom:4px;}
.title{font-size:13px; font-weight:bold; height:36px; overflow:hidden; color:var(--dark); line-height:1.4;}
.price{font-size:16px; font-weight:800; margin:8px 0; color:#222;}
.btn-order { background:var(--gold); color:var(--dark); border:none; width:100%; padding:10px; border-radius:8px; cursor:pointer; font-weight:bold; transition:0.3s; }
.btn-order:hover { background:var(--dark); color:var(--gold); }

/* Ø§Ù„Ù…Ù†ÙŠÙˆ Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ */
.sidebar { height:100%; width:0; position:fixed; z-index:10000; top:0; right:0; background:var(--dark); overflow-x:hidden; transition:0.4s; box-shadow:-5px 0 15px rgba(0,0,0,0.5); color:white; }
.sidebar-content { padding: 25px; }
.sidebar a.closebtn { position:absolute; top:10px; left:20px; font-size:36px; text-decoration:none; color:var(--gold); }
.sidebar h3{ margin-top:20px; font-size:18px; color:var(--gold); border-bottom:1px solid #333; padding-bottom:10px;}
.fav-item { display:flex; align-items:center; gap:10px; margin-bottom:12px; font-size:13px; background:#1a1a1a; padding:8px; border-radius:8px; }
.admin-section { margin-top:30px; background:#1a1a1a; padding:15px; border-radius:12px; border:1px dashed var(--gold); text-align:center; }

#viewer{display:none; position:fixed; inset:0; background:rgba(0,0,0,0.95); z-index:99999; align-items:center; justify-content:center;}
#viewer img{max-width:95%; max-height:85%; border-radius:10px; border:2px solid var(--gold);}
</style>
</head>
<body>

<header>
  <div style="position:absolute; top:15px; right:15px;" class="menu-btn" onclick="openSidebar()">â˜°</div>
  <h1>VIRA MALL</h1>
  <div class="header-tools">
    <div class="currency-switch active" id="btnSDG" onclick="setCurrency('SDG')">SDG</div>
    <div class="currency-switch" id="btnSAR" onclick="setCurrency('SAR')">SAR</div>
  </div>
</header>

<div class="container" id="grid"></div>

<div class="sidebar" id="sidebar">
  <a href="javascript:void(0)" class="closebtn" onclick="closeSidebar()">Ã—</a>
  <div class="sidebar-content">
      <h3>ğŸ’³ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙˆØ§Ù„Ø¯ÙØ¹</h3>
      <p style="font-size:14px;">Ø±Ù‚Ù… Ø­Ø³Ø§Ø¨ Ø§Ù„ØªØ§Ø¬Ø±Ø§Øª: <br><strong style="font-size:20px; color:var(--gold)">2280384</strong></p>
      
      <h3>ğŸšš Ø§Ù„ØªÙˆØµÙŠÙ„</h3>
      <p style="font-size:14px;">Ø§Ù„Ø³Ø¹Ø± ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…ØªØ¬Ø± ÙˆÙˆØ¬Ù‡Ø© Ø§Ù„Ø·Ù„Ø¨.</p>

      <h3>â¤ï¸ Ø§Ù„Ù…ÙØ¶Ù„Ø© (<span id="favCount">0</span>)</h3>
      <div class="fav-list" id="favList"></div>

      <div class="admin-section">
          <p style="font-size:12px; color:#aaa; margin-bottom:10px;">Ø®Ø§Øµ Ø¨Ù…Ø§Ù„ÙƒØ§Øª Ø§Ù„Ù…ØªØ§Ø¬Ø± ÙÙ‚Ø·</p>
          <button onclick="window.location.href='admin.html'" style="background:var(--gold); border:none; padding:10px; width:100%; border-radius:8px; font-weight:bold; cursor:pointer;">Ø¯Ø®ÙˆÙ„ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… âœ¨</button>
      </div>
  </div>
</div>

<div id="viewer" onclick="this.style.display='none'">
  <img id="viewerImg">
</div>

<script>
const SHEET_URL='https://docs.google.com/spreadsheets/d/e/2PACX-1vTWD0ZQAKe2KRwLQnNjh2t7Z2Y_BKXxaKZxZwKSXUaZLQ3eeLB1fwj6vNllpNwXCtd9aY9Q_tuuFXXV/pub?gid=0&single=true&output=csv';
let currentCurr='SDG', favProducts=[];

function openSidebar(){ document.getElementById('sidebar').style.width='280px'; }
function closeSidebar(){ document.getElementById('sidebar').style.width='0'; }

function setCurrency(c){
  currentCurr=c;
  document.querySelectorAll('.currency-switch').forEach(el=>el.classList.remove('active'));
  document.getElementById('btn'+c).classList.add('active');
  loadProducts();
}

function openImg(src){ document.getElementById('viewerImg').src=src; document.getElementById('viewer').style.display='flex'; }

async function loadProducts(){
  const res = await fetch(SHEET_URL);
  const text = await res.text();
  const rows = text.split(/\r?\n/).slice(1);
  const products = rows.map((r,idx)=>{
    const c = r.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/).map(x=>x.replace(/"/g,'').trim());
    const imgs = c[3] ? c[3].split(' ') : ['https://via.placeholder.com/200'];
    // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø³Ø¹Ø± Ù„Ùˆ Ø±ÙŠØ§Ù„
    let rawPrice = parseFloat(c[1]) || 0;
    const price = currentCurr==='SDG' ? rawPrice : (rawPrice * 0.0031).toFixed(2);
    const sale = c[5] || ''; 
    return {id:idx, name:c[0], price, store:c[2], imgs, whatsapp:c[4], sale};
  }).filter(p=>p.name && !p.name.includes('!'));

  document.getElementById('grid').innerHTML = products.map(p=>{
    let imagesHtml = p.imgs.map(img=>`<img src="${img.trim()}" onclick="openImg('${img.trim()}')" onerror="this.src='https://via.placeholder.com/200'">`).join('');
    let navButtons = p.imgs.length>1 ? `<button class="nav-btn next" onclick="move(this,1)">â¯</button><button class="nav-btn prev" onclick="move(this,-1)">â®</button>`:'';
    let saleBadge = p.sale ? `<div class="sale-badge">Ø®ØµÙ… ${p.sale}</div>` : '';
    let isFav = favProducts.find(f=>f.id===p.id) ? 'active' : '';

    return `<div class="card" data-idx="0" data-id="${p.id}">
      <div class="slider-container">
        <div class="slider-track">${imagesHtml}</div>
        ${navButtons}${saleBadge}
        <div class="favorite ${isFav}" onclick="toggleFav(${p.id},'${p.name}','${p.imgs[0]}', this)">â¤</div>
      </div>
      <div class="info">
        <div class="store">âœ¨ ${p.store}</div>
        <div class="title">${p.name}</div>
        <div class="price">${p.price} <small>${currentCurr}</small></div>
        <button class="btn-order" onclick="order('${p.whatsapp}','${p.name}')">Ø§Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ âœ…</button>
      </div>
    </div>`;
  }).join('');
}

function move(btn,dir){
  const card = btn.closest('.card');
  const track = card.querySelector('.slider-track');
  const total = track.querySelectorAll('img').length;
  let idx = parseInt(card.getAttribute('data-idx'));
  idx = (idx+dir+total)%total;
  card.setAttribute('data-idx',idx);
  track.style.transform=`translateX(${idx*100}%)`;
}

function order(num,name){ 
  const cleanNum = num.replace(/\s/g,'');
  window.open(`https://wa.me/${cleanNum}?text=${encodeURIComponent('Ø³Ù„Ø§Ù…Ø§Øª ÙÙŠØ±Ø§ Ù…ÙˆÙ„ØŒ Ø£Ø±ÙŠØ¯ Ø·Ù„Ø¨: '+name)}`,'_blank'); 
}

function toggleFav(id,name,img, el){
  const idx = favProducts.findIndex(p=>p.id===id);
  if(idx > -1){
    favProducts.splice(idx, 1);
    el.classList.remove('active');
  }else{
    favProducts.push({id,name,img});
    el.classList.add('active');
  }
  renderFav();
}

function renderFav(){
  const list = document.getElementById('favList');
  document.getElementById('favCount').innerText = favProducts.length;
  list.innerHTML = favProducts.map(p=>`
    <div class="fav-item">
        <img src="${p.img}" width="45" height="45" style="object-fit:cover; border-radius:5px;">
        <div style="flex:1; overflow:hidden; white-space:nowrap; text-overflow:ellipsis;">${p.name}</div>
        <span style="color:red; cursor:pointer;" onclick="toggleFav(${p.id})">âœ•</span>
    </div>`).join('');
}

loadProducts();
</script>
</body>
</html>
