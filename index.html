<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VIRA MALL | Ø®ÙŠØ§Ø±Ùƒ Ø§Ù„Ø£ÙˆÙ„ ÙÙŠ Ø§Ù„Ø³ÙˆØ¯Ø§Ù†</title>
    
    <style>
        /* --- Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ§Øª ÙˆØ§Ù„Ø³Ù…Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© --- */
        :root {
            --gold: #D4AF37;
            --black: #0a0a0a;
            --white: #ffffff;
            --soft-gray: #f4f4f4;
            --accent: #e91e63;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--soft-gray);
            color: var(--black);
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„ÙØ®Ù… --- */
        header {
            background: var(--black);
            padding: 15px 20px;
            position: sticky;
            top: 0;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-container {
            text-align: center;
        }

        header h1 {
            color: var(--gold);
            margin: 0;
            font-size: 24px;
            font-weight: 900;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .slogan {
            color: var(--white);
            font-size: 10px;
            font-weight: 300;
            letter-spacing: 1px;
        }

        .nav-icons {
            display: flex;
            gap: 18px;
            color: var(--gold);
            font-size: 22px;
        }

        .cart-icon-wrapper {
            position: relative;
            cursor: pointer;
        }

        .badge {
            position: absolute;
            top: -8px;
            right: -10px;
            background: var(--accent);
            color: white;
            font-size: 10px;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            display: none;
        }

        /* --- Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„Ø£Ù‚Ø³Ø§Ù… --- */
        .search-wrapper {
            background: var(--white);
            border-radius: 25px;
            padding: 8px 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.05);
        }

        .search-wrapper input {
            border: none;
            outline: none;
            width: 100%;
            font-size: 14px;
            background: transparent;
        }

        .category-bar {
            display: flex;
            gap: 12px;
            padding: 15px;
            overflow-x: auto;
            background: var(--white);
            scrollbar-width: none;
            border-bottom: 1px solid #eee;
        }

        .category-bar::-webkit-scrollbar { display: none; }

        .cat-chip {
            padding: 8px 20px;
            background: #f0f0f0;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            white-space: nowrap;
            transition: var(--transition);
            border: 1px solid transparent;
        }

        .cat-chip.active {
            background: var(--black);
            color: var(--gold);
            border-color: var(--black);
        }

        /* --- Ø´Ø¨ÙƒØ© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª (Shein Style) --- */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            padding: 12px;
        }

        .product-card {
            background: var(--white);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            display: flex;
            flex-direction: column;
            box-shadow: 0 4px 10px rgba(0,0,0,0.03);
            border: 1px solid #f0f0f0;
        }

        .image-viewport {
            position: relative;
            width: 100%;
            aspect-ratio: 3/4;
            overflow: hidden;
            background: #eee;
        }

        .image-track {
            display: flex;
            width: 100%;
            height: 100%;
            transition: transform 0.45s cubic-bezier(0.23, 1, 0.32, 1);
        }

        .image-track img {
            min-width: 100%;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .img-indicator {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: rgba(0,0,0,0.5);
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-family: 'Courier New', Courier, monospace;
            z-index: 5;
        }

        .heart-btn {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 22px;
            color: rgba(255,255,255,0.9);
            z-index: 10;
            cursor: pointer;
            text-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: var(--transition);
        }

        .heart-btn.active {
            color: var(--accent);
            transform: scale(1.2);
        }

        .product-info {
            padding: 12px 10px;
            text-align: center;
        }

        .product-title {
            font-size: 12px;
            color: #555;
            height: 32px;
            overflow: hidden;
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .product-price {
            font-size: 16px;
            font-weight: 800;
            color: var(--black);
            margin-bottom: 10px;
        }

        .add-to-cart-btn {
            background: var(--black);
            color: white;
            border: none;
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            font-size: 11px;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
        }

        .add-to-cart-btn:active {
            background: var(--gold);
            color: var(--black);
        }

        /* --- Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© (Panels) --- */
        .panel-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
            z-index: 2500;
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .side-panel {
            position: fixed;
            top: 0;
            right: -100%;
            width: 85%;
            max-width: 350px;
            height: 100%;
            background: var(--white);
            z-index: 3000;
            transition: right 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            padding: 30px 20px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
        }

        .side-panel.open { right: 0; }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--gold);
            padding-bottom: 15px;
            margin-bottom: 20px;
        }

        .menu-link {
            padding: 15px 0;
            border-bottom: 1px solid #eee;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
            text-decoration: none;
            color: var(--black);
        }

        .merchant-box {
            margin-top: auto;
            background: #fff9e6;
            border: 1px dashed var(--gold);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
        }

        /* --- Ù†Ø®Ø¨ Ø§Ù„ØªÙˆØµÙŠÙ„ ÙˆØ§Ù„Ø¹Ù…Ù„Ø© --- */
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--black);
            color: var(--gold);
            padding: 12px 25px;
            border-radius: 30px;
            font-size: 13px;
            font-weight: bold;
            z-index: 5000;
            display: none;
        }

    </style>
</head>
<body>

    <div id="toast" class="toast">ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø© âœ¨</div>

    <div class="panel-overlay" id="overlay" onclick="closeAllPanels()"></div>

    <header>
        <div class="header-top">
            <div onclick="openPanel('menuPanel')" style="cursor:pointer">â˜°</div>
            <div class="logo-container">
                <h1>VIRA MALL</h1>
                <span class="slogan">Ø®ÙŠØ§Ø±Ùƒ Ø§Ù„Ø£ÙˆÙ„ ÙÙŠ Ø§Ù„Ø³ÙˆØ¯Ø§Ù†</span>
            </div>
            <div class="nav-icons">
                <div class="cart-icon-wrapper" onclick="openPanel('cartPanel')">
                    ğŸ›’ <span id="cartBadge" class="badge">0</span>
                </div>
            </div>
        </div>
        <div class="search-wrapper">
            <span>ğŸ”</span>
            <input type="text" id="mainSearch" placeholder="Ø§Ø¨Ø­Ø«ÙŠ Ø¹Ù† Ø§Ù„Ø£Ù†Ø§Ù‚Ø© (Ø£Ø·ÙØ§Ù„ØŒ Ø¹Ø¨Ø§ÙŠØ§ØªØŒ Ù†ÙˆÙ…)..." oninput="handleSearch()">
        </div>
    </header>

    <div class="category-bar">
        <div class="cat-chip active" onclick="filterCat('Ø§Ù„ÙƒÙ„', this)">Ø§Ù„ÙƒÙ„</div>
        <div class="cat-chip" onclick="filterCat('Ø£Ø·ÙØ§Ù„', this)">Ù…Ù„Ø§Ø¨Ø³ Ø£Ø·ÙØ§Ù„</div>
        <div class="cat-chip" onclick="filterCat('Ù†ÙˆÙ…', this)">Ù…Ù„Ø§Ø¨Ø³ Ù†ÙˆÙ…</div>
        <div class="cat-chip" onclick="filterCat('Ø¹Ø¨Ø§ÙŠØ§Øª', this)">Ø¹Ø¨Ø§ÙŠØ§Øª</div>
        <div class="cat-chip" onclick="filterCat('Ø´Ù†Ø·', this)">Ø´Ù†Ø· ÙˆØ¬Ø²Ù…</div>
    </div>

    <div class="products-grid" id="productGrid">
        </div>

    <div class="side-panel" id="menuPanel">
        <div class="panel-header">
            <h2 style="margin:0">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</h2>
            <span onclick="closeAllPanels()" style="font-size:24px; cursor:pointer">âœ•</span>
        </div>
        <div class="menu-link">
            <span>ğŸ’° Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©</span>
            <select id="currencySelector" onchange="changeCurrency(this.value)" style="padding:5px; border-radius:5px;">
                <option value="SDG">SDG (Ø³ÙˆØ¯Ø§Ù†ÙŠ)</option>
                <option value="SAR">SAR (Ø³Ø¹ÙˆØ¯ÙŠ)</option>
                <option value="USD">USD (Ø¯ÙˆÙ„Ø§Ø±)</option>
            </select>
        </div>
        <div class="menu-link"><span>â¤ï¸ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…ÙØ¶Ù„Ø©</span> <span>0</span></div>
        <div class="menu-link"><span>ğŸšš Ø£Ø³Ø¹Ø§Ø± Ø§Ù„ØªÙˆØµÙŠÙ„</span> <span>></span></div>
        
        <div class="merchant-box">
            <strong style="color:var(--gold); font-size:18px;">Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„ØªØ§Ø¬Ø±Ø§Øª ğŸš€</strong>
            <p style="font-size: 13px; margin: 10px 0;">Ø§Ø¹Ø±Ø¶ÙŠ Ø¨Ø¶Ø§Ø¹ØªÙƒ ÙÙŠ Ø£ÙƒØ¨Ø± Ù…ÙˆÙ„ Ø³ÙˆØ¯Ø§Ù†ÙŠ</p>
            <p style="font-weight: 800;">Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ: 30,000 SDG</p>
            <small>Ø±Ù‚Ù… Ø­Ø³Ø§Ø¨ Ø¨Ù†ÙƒÙƒ: <b>2280384</b></small>
        </div>
    </div>

    <div class="side-panel" id="cartPanel">
        <div class="panel-header">
            <h2 style="margin:0">Ø³Ù„ØªÙŠ ğŸ›ï¸</h2>
            <span onclick="closeAllPanels()" style="font-size:24px; cursor:pointer">âœ•</span>
        </div>
        <div id="cartItemsList" style="flex-grow:1; overflow-y:auto;">
            </div>
        <div style="border-top:1px solid #eee; padding-top:20px;">
            <div style="display:flex; justify-content:space-between; font-weight:900; margin-bottom:20px;">
                <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span>
                <span id="cartTotal">0 SDG</span>
            </div>
            <button class="add-to-cart-btn" style="background:var(--gold); color:black; padding:15px;" onclick="checkoutWhatsApp()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ø¨Ø± Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨</button>
        </div>
    </div>

    <script>
        // --- ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ---
        const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTWD0ZQAKe2KRwLQnNjh2t7Z2Y_BKXxaKZxZwKSXUaZLQ3eeLB1fwj6vNllpNwXCtd9aY9Q_tuuFXXV/pub?gid=0&single=true&output=csv';
        let allProducts = [];
        let cart = JSON.parse(localStorage.getItem('vira_cart')) || [];
        let favorites = JSON.parse(localStorage.getItem('vira_favs')) || [];
        let currentCurrency = 'SDG';

        // --- Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ---
        async function fetchProducts() {
            try {
                const response = await fetch(CSV_URL + '?t=' + Date.now());
                const data = await response.text();
                const rows = data.split('\n').slice(1);
                
                allProducts = rows.map((row, index) => {
                    const cols = row.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/).map(v => v.replace(/"/g, '').trim());
                    if (!cols[0]) return null;
                    return {
                        id: index,
                        name: cols[0],
                        price: parseFloat(cols[1].replace(/,/g, '')),
                        store: cols[2],
                        images: cols[3].split(/\s+/),
                        whatsapp: cols[4],
                        category: cols[5] || 'Ø§Ù„ÙƒÙ„'
                    };
                }).filter(p => p !== null);

                renderProducts(allProducts);
                updateUI();
            } catch (error) {
                console.error("Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:", error);
                document.getElementById('productGrid').innerHTML = "<p style='grid-column:1/-1; text-align:center;'>Ø¹ÙÙˆØ§Ù‹ØŒ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª.</p>";
            }
        }

        // --- Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ---
        function renderProducts(productsToRender) {
            const grid = document.getElementById('productGrid');
            grid.innerHTML = productsToRender.map(product => {
                const isFav = favorites.includes(product.id);
                return `
                <div class="product-card" id="prod-${product.id}" data-current-img="0">
                    <div class="image-viewport" ontouchstart="handleTouchStart(event)" ontouchmove="handleTouchMove(event, ${product.id})">
                        <div class="heart-btn ${isFav ? 'active' : ''}" onclick="toggleFavorite(${product.id}, this)">â¤</div>
                        <div class="image-track" style="transform: translateX(0px);">
                            ${product.images.map(img => `<img src="${img}" loading="lazy" ondblclick="zoomImage(this)">`).join('')}
                        </div>
                        ${product.images.length > 1 ? `<div class="img-indicator"><span class="idx">1</span>/${product.images.length}</div>` : ''}
                    </div>
                    <div class="product-info">
                        <div class="product-title">${product.name}</div>
                        <div class="product-price">${product.price.toLocaleString()} ${currentCurrency}</div>
                        <button class="add-to-cart-btn" onclick="addToCart(${product.id})">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø© ğŸ›’</button>
                    </div>
                </div>
                `;
            }).join('');
        }

        // --- Ù†Ø¸Ø§Ù… Ø§Ù„Ø³Ø­Ø¨ (Slide) ---
        let startX = 0;
        function handleTouchStart(e) { startX = e.touches[0].clientX; }
        function handleTouchMove(e, id) {
            if (!startX) return;
            let diff = startX - e.touches[0].clientX;
            if (Math.abs(diff) > 40) {
                const card = document.getElementById(`prod-${id}`);
                const track = card.querySelector('.image-track');
                const indicator = card.querySelector('.idx');
                let idx = parseInt(card.dataset.currentImg);
                const total = track.children.length;

                if (diff > 0 && idx < total - 1) idx++;
                else if (diff < 0 && idx > 0) idx--;

                card.dataset.currentImg = idx;
                track.style.transform = `translateX(${idx * 100}%)`;
                if (indicator) indicator.innerText = idx + 1;
                startX = 0;
            }
        }

        // --- Ø§Ù„Ø³Ù„Ø© ÙˆØ§Ù„Ù…ÙØ¶Ù„Ø© ---
        function addToCart(id) {
            const product = allProducts.find(p => p.id === id);
            cart.push(product);
            localStorage.setItem('vira_cart', JSON.stringify(cart));
            updateUI();
            showToast(`ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© ${product.name} âœ…`);
        }

        function toggleFavorite(id, el) {
            if (favorites.includes(id)) {
                favorites = favorites.filter(f => f !== id);
                el.classList.remove('active');
            } else {
                favorites.push(id);
                el.classList.add('active');
            }
            localStorage.setItem('vira_favs', JSON.stringify(favorites));
        }

        // --- Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ---
        function updateUI() {
            const badge = document.getElementById('cartBadge');
            badge.innerText = cart.length;
            badge.style.display = cart.length > 0 ? 'flex' : 'none';

            const cartList = document.getElementById('cartItemsList');
            let total = 0;
            cartList.innerHTML = cart.map((item, index) => {
                total += item.price;
                return `
                <div style="display:flex; gap:10px; margin-bottom:15px; background:#f9f9f9; padding:10px; border-radius:10px;">
                    <img src="${item.images[0]}" style="width:50px; height:50px; border-radius:5px; object-fit:cover;">
                    <div style="flex-grow:1;">
                        <div style="font-size:11px; font-weight:bold;">${item.name}</div>
                        <div style="font-size:12px; color:var(--gold);">${item.price.toLocaleString()} ${currentCurrency}</div>
                    </div>
                    <div onclick="removeFromCart(${index})" style="color:red; cursor:pointer;">âœ•</div>
                </div>
                `;
            }).join('');
            document.getElementById('cartTotal').innerText = `${total.toLocaleString()} ${currentCurrency}`;
        }

        function removeFromCart(index) {
            cart.splice(index, 1);
            localStorage.setItem('vira_cart', JSON.stringify(cart));
            updateUI();
        }

        // --- Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ÙÙ„ØªØ±Ø© ---
        function handleSearch() {
            const query = document.getElementById('mainSearch').value.toLowerCase();
            const filtered = allProducts.filter(p => p.name.toLowerCase().includes(query) || p.category.toLowerCase().includes(query));
            renderProducts(filtered);
        }

        function filterCat(cat, el) {
            document.querySelectorAll('.cat-chip').forEach(c => c.classList.remove('active'));
            el.classList.add('active');
            const filtered = cat === 'Ø§Ù„ÙƒÙ„' ? allProducts : allProducts.filter(p => p.category.includes(cat) || p.name.includes(cat));
            renderProducts(filtered);
        }

        // --- ÙˆØ¸Ø§Ø¦Ù Ø¹Ø§Ù…Ø© ---
        function openPanel(id) {
            document.getElementById(id).classList.add('open');
            document.getElementById('overlay').style.display = 'block';
            setTimeout(() => document.getElementById('overlay').style.opacity = '1', 10);
        }

        function closeAllPanels() {
            document.querySelectorAll('.side-panel').forEach(p => p.classList.remove('open'));
            document.getElementById('overlay').style.opacity = '0';
            setTimeout(() => document.getElementById('overlay').style.display = 'none', 300);
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.innerText = msg;
            t.style.display = 'block';
            setTimeout(() => t.style.display = 'none', 2500);
        }

        function changeCurrency(val) {
            currentCurrency = val;
            renderProducts(allProducts);
            updateUI();
        }

        function zoomImage(img) { if (img.requestFullscreen) img.requestFullscreen(); }

        function checkoutWhatsApp() {
            if (cart.length === 0) return alert("Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©!");
            let message = "Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ù† ÙÙŠØ±Ø§ Ù…ÙˆÙ„:\n\n";
            cart.forEach(item => message += `- ${item.name} (${item.price} ${currentCurrency})\n`);
            message += `\nØ§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${document.getElementById('cartTotal').innerText}`;
            window.open(`https://wa.me/${cart[0].whatsapp}?text=${encodeURIComponent(message)}`);
        }

        // ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        fetchProducts();
    </script>
</body>
</html>
