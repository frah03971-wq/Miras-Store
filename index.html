<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VIRA MALL | OFFICIAL</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap');
        :root { --gold: #D4AF37; --black: #000; --bg: #f8f9fa; }
        body { font-family: 'Cairo', sans-serif; background: var(--bg); margin: 0; padding-bottom: 90px; color: var(--black); overflow-x: hidden; }
        
        /* Ø§Ù„Ù‡ÙŠØ¯Ø± ÙˆØ§Ù„ÙØ®Ø§Ù…Ø© */
        .header { background: var(--black); padding: 20px; text-align: center; border-bottom: 3px solid var(--gold); position: sticky; top: 0; z-index: 2000; }
        .logo { font-size: 28px; font-weight: 900; color: var(--gold); text-decoration: none; letter-spacing: 2px; }
        
        /* Ù‚Ø³Ù… VIRA Ø§Ù„Ù…ÙˆØ­Ø¯ */
        .vira-special-section { background: white; margin: 15px; border-radius: 20px; padding: 20px; border: 1px solid #ddd; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .vira-title-gold { color: var(--gold); font-weight: 900; font-size: 18px; margin-bottom: 10px; display: block; }
        .btn-view-all { background: var(--black); color: var(--gold); border: 1px solid var(--gold); padding: 10px 25px; border-radius: 50px; font-weight: 700; cursor: pointer; transition: 0.3s; font-size: 14px; }

        /* Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„Ù…ÙØ¶Ù„Ø© */
        .tools-bar { display: flex; gap: 10px; padding: 10px 15px; background: white; position: sticky; top: 75px; z-index: 1000; border-bottom: 1px solid #eee; }
        .search-input { flex-grow: 1; padding: 12px; border: 1px solid #ddd; border-radius: 12px; font-family: 'Cairo'; outline: none; }
        .fav-btn-top { background: #fff; border: 1px solid #eee; border-radius: 12px; padding: 0 15px; color: #e74c3c; font-size: 20px; cursor: pointer; }

        .section-title { padding: 15px; font-weight: 900; border-right: 5px solid var(--gold); margin: 15px; background: #fff; font-size: 16px; border-radius: 0 10px 10px 0; }
        
        /* Ø§Ù„Ø¬Ø±ÙŠØ¯ ÙˆØ§Ù„ÙƒØ±ÙˆØª */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding: 0 15px; }
        .card { background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.05); position: relative; border: 1px solid #eee; display: flex; flex-direction: column; }
        .card img { width: 100%; height: 160px; object-fit: cover; cursor: pointer; }
        
        .fav-heart { position: absolute; top: 10px; right: 10px; background: rgba(255,255,255,0.8); width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #ccc; cursor: pointer; z-index: 10; transition: 0.3s; }
        .fav-heart.active { color: #e74c3c; }

        .price-chip { position: absolute; top: 10px; left: 10px; background: var(--black); color: var(--gold); padding: 4px 10px; border-radius: 8px; font-weight: 800; font-size: 10px; border: 1px solid var(--gold); }
        .info { padding: 10px; text-align: center; }
        .store-tag { font-size: 9px; color: var(--gold); font-weight: 800; margin-bottom: 5px; display: block; }
        .title { font-size: 12px; font-weight: 700; height: 34px; overflow: hidden; margin-bottom: 8px; }
        .desc-text { font-size: 10px; color: #777; margin-bottom: 10px; display: block; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .btn-add { background: var(--black); color: var(--gold); border: 1px solid var(--gold); width: 100%; padding: 8px; border-radius: 10px; font-weight: 700; cursor: pointer; font-size: 12px; }

        /* Ù…Ø³Ø±Ø­ Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø·ÙˆØ± (Collection) */
        .lightbox { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 9999; flex-direction: column; justify-content: center; align-items: center; }
        .lightbox-img-container { position: relative; width: 90%; max-height: 70%; display: flex; justify-content: center; }
        .lightbox img { max-width: 100%; max-height: 100%; border-radius: 10px; border: 2px solid var(--gold); }
        .nav-arrow { position: absolute; top: 50%; transform: translateY(-50%); background: rgba(212, 175, 55, 0.3); color: white; border: none; padding: 15px; cursor: pointer; font-size: 20px; border-radius: 50%; }
        .arrow-left { left: -10px; } .arrow-right { right: -10px; }
        .close-btn { color: var(--gold); border: 1px solid var(--gold); background: none; padding: 8px 30px; border-radius: 50px; margin-top: 20px; cursor: pointer; font-family: 'Cairo'; }

        /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ­ØªÙŠØ© */
        .nav { position: fixed; bottom: 0; width: 100%; background: #fff; display: flex; justify-content: space-around; padding: 12px 0; border-top: 1px solid #eee; z-index: 2500; box-shadow: 0 -5px 15px rgba(0,0,0,0.05); }
        .nav-item { text-align: center; color: #999; font-size: 10px; font-weight: 700; cursor: pointer; text-decoration: none; }
        .nav-item.active { color: var(--gold); }
        .badge { background: #e74c3c; color: white; border-radius: 50%; padding: 2px 6px; font-size: 9px; position: absolute; top: -5px; right: 5px; }
    </style>
</head>
<body>

<div id="lightbox" class="lightbox">
    <div class="lightbox-img-container">
        <button class="nav-arrow arrow-left" onclick="changeLightboxImg(-1)">â®</button>
        <img id="lightboxImg" src="">
        <button class="nav-arrow arrow-right" onclick="changeLightboxImg(1)">â¯</button>
    </div>
    <button class="close-btn" onclick="document.getElementById('lightbox').style.display='none'">Ø¥ØºÙ„Ø§Ù‚</button>
</div>

<header class="header"><a href="#" onclick="location.reload()" class="logo">VIRA MALL</a></header>

<div id="mainView">
    <div class="vira-special-section">
        <span class="vira-title-gold">âœ¨ Ù…Ø¬Ù…ÙˆØ¹Ø© VIRA Ø§Ù„Ø­ØµØ±ÙŠØ©</span>
        <p style="font-size: 11px; color: #666;">Ø§ÙƒØªØ´ÙÙŠ Ø¹Ø§Ù„Ù…ÙƒÙ Ø§Ù„Ø®Ø§Øµ Ø¨ØªØ´ÙƒÙŠÙ„Ø© Ù…Ù„ÙƒÙŠØ© ÙØ±ÙŠØ¯Ø©</p>
        <button class="btn-view-all" onclick="showViraOnly()">ØªØµÙØ­ Ù…Ù†ØªØ¬Ø§ØªÙŠ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</button>
    </div>

    <div class="tools-bar">
        <input type="text" id="searchInput" class="search-input" placeholder="Ø§Ø¨Ø­Ø«ÙŠ Ø¹Ù† Ø§Ù„Ø¬Ù…Ø§Ù„..." oninput="search()">
        <button class="fav-btn-top" onclick="showFavorites()">â¤ï¸</button>
    </div>

    <div class="section-title">ğŸ›ï¸ Ø¹Ø§Ù„Ù… Ø§Ù„ØªØ§Ø¬Ø±Ø§Øª</div>
    <div id="merchGrid" class="grid"></div>
</div>

<div id="viraView" style="display:none">
    <div class="section-title" style="display:flex; justify-content:space-between; align-items:center;">
        <span>ğŸ‘‘ VIRA COLLECTION</span>
        <button onclick="hideViraOnly()" style="background:var(--gold); border:none; padding:5px 15px; border-radius:8px; font-size:11px; font-weight:700;">Ø§Ù„Ø±Ø¬ÙˆØ¹</button>
    </div>
    <div id="myGrid" class="grid"></div>
</div>

<nav class="nav">
    <a onclick="location.reload()" class="nav-item active">ğŸ <br>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
    <a onclick="showViraOnly()" class="nav-item">ğŸ‘‘<br>Ù…ØªØ¬Ø±ÙŠ</a>
    <a onclick="showModal('cartModal')" class="nav-item" style="position:relative;">ğŸ›’<br>Ø§Ù„Ø³Ù„Ø© <span id="cartCount" class="badge">0</span></a>
    <a href="https://wa.me/249967584275" class="nav-item">ğŸ’¬<br>ØªÙˆØ§ØµÙ„</a>
</nav>

<script>
    // Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù„Ø¶Ù…Ø§Ù† Ø¹Ù…Ù„ Ø§Ù„ØµÙˆØ±
    const SHEET_ID = '1UZnlp45dVMRJxNibcg3fm52H6S4DB4YbGLr4KK3jPqs';
    const URL_VIRA = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=%D8%A7%D9%84%D9%8ÙˆØ±Ù‚Ø©1`;
    const URL_MERCH = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=%D8%B1%D8%AF%D9%88%D8%AF%20%D8%A7%D9%84%D9%86%D9%85%D9%88%D8%B0%D8%AC%201`;

    let allData = []; let cart = []; let favorites = JSON.parse(localStorage.getItem('vira_favs')) || [];
    let currentCollection = []; let currentImgIdx = 0;

    async function loadData() {
        try {
            const [r1, r2] = await Promise.all([
                fetch(`https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv&gid=0`), // ÙˆØ±Ù‚Ø© 1
                fetch(`https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv&gid=1152504859`) // Ø±Ø¯ÙˆØ¯ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            ]);
            const t1 = await r1.text(); const t2 = await r2.text();
            
            const parse = (text, isVira) => {
                const rows = text.split('\n').slice(1);
                return rows.map(r => {
                    const c = r.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                    if (isVira) return { name: c[0]?.replace(/"/g,''), price: c[1]?.replace(/"/g,''), store: c[2]?.replace(/"/g,''), img: c[3]?.replace(/"/g,''), desc: c[5]?.replace(/"/g,'') || '' };
                    return { store: c[1]?.replace(/"/g,''), name: c[3]?.replace(/"/g,''), price: c[4]?.replace(/"/g,''), img: c[5]?.replace(/"/g,''), desc: c[6]?.replace(/"/g,'') || '' };
                }).filter(p => p.name && p.img);
            };

            allData = [...parse(t1, true), ...parse(t2, false)];
            render(allData);
        } catch (e) { console.error("Error loading data"); }
    }

    function render(data) {
        let viraHtml = '', merchHtml = '';
        data.forEach((p, idx) => {
            const isFav = favorites.includes(p.name);
            const card = `
                <div class="card">
                    <div class="fav-heart ${isFav?'active':''}" onclick="toggleFav('${p.name}', this)">â¤</div>
                    <div class="price-chip">${p.price} SDG</div>
                    <img src="${p.img}" onclick="openLightbox('${p.img}')" onerror="this.src='https://via.placeholder.com/400?text=VIRA+MALL'">
                    <div class="info">
                        <span class="store-tag">${p.store}</span>
                        <div class="title">${p.name}</div>
                        <span class="desc-text">${p.desc}</span>
                        <button class="btn-add" onclick="addToCart('${p.name}','${p.price}')">Ø¥Ø¶Ø§ÙØ© Ø¨Ø§Ù„Ø³Ù„Ø© ğŸ›’</button>
                    </div>
                </div>`;
            if (p.store.toLowerCase().includes('vira') || p.store.includes('ÙÙŠØ±Ø§')) viraHtml += card;
            else merchHtml += card;
        });
        document.getElementById('myGrid').innerHTML = viraHtml;
        document.getElementById('merchGrid').innerHTML = merchHtml;
    }

    // ÙˆØ¸ÙŠÙØ© Ø§Ù„Ù…Ø³Ø±Ø­ Ø§Ù„Ø³ÙŠÙ†Ù…Ø§Ø¦ÙŠ Ø§Ù„Ù…ØªØ·ÙˆØ±
    function openLightbox(imgStr) {
        currentCollection = imgStr.split(';').map(s => s.trim());
        currentImgIdx = 0;
        updateLightbox();
        document.getElementById('lightbox').style.display = 'flex';
    }

    function updateLightbox() {
        document.getElementById('lightboxImg').src = currentCollection[currentImgIdx];
        const arrows = document.querySelectorAll('.nav-arrow');
        arrows.forEach(a => a.style.display = currentCollection.length > 1 ? 'block' : 'none');
    }

    function changeLightboxImg(dir) {
        currentImgIdx = (currentImgIdx + dir + currentCollection.length) % currentCollection.length;
        updateLightbox();
    }

    function toggleFav(name, el) {
        if (favorites.includes(name)) favorites = favorites.filter(f => f !== name);
        else favorites.push(name);
        el.classList.toggle('active');
        localStorage.setItem('vira_favs', JSON.stringify(favorites));
    }

    function showViraOnly() { document.getElementById('mainView').style.display='none'; document.getElementById('viraView').style.display='block'; window.scrollTo(0,0); }
    function hideViraOnly() { document.getElementById('mainView').style.display='block'; document.getElementById('viraView').style.display='none'; }
    function addToCart(n, p) { cart.push({n,p}); document.getElementById('cartCount').innerText = cart.length; alert('ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¬Ø§Ø­ âœ¨'); }
    function search() { const q = document.getElementById('searchInput').value.toLowerCase(); render(allData.filter(p => p.name.toLowerCase().includes(q) || p.store.toLowerCase().includes(q))); }

    loadData();
</script>
</body>
</html>
