<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VIRA MALL | ููุฑุง ููู</title>
<link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">
</head>
<body>

<div id="loader">VIRA MALL โจ</div>

<header>
  <div class="menu-btn" onclick="toggleM()">โฐ</div>
  <div class="brand">V<span>IRA</span> MALL</div>
  <div class="curr-switcher">
    <div id="btnSDG" class="curr-opt active" onclick="setCurrency('SDG')">SDG</div>
    <div id="btnSAR" class="curr-opt" onclick="setCurrency('SAR')">SAR</div>
  </div>
</header>

<div id="sideMenu" class="side-menu">
  <div class="close-x" style="color:var(--gold)" onclick="toggleM()">โ</div>
  <div style="margin-top:60px">
    <a class="menu-item" onclick="location.reload()">โจ ุงูุฑุฆูุณูุฉ</a>
    <a class="menu-item" onclick="openO('cartPage')">๐ ุงูุณูุฉ</a>
  </div>
</div>

<div id="grid" class="container"></div>

<div id="cartPage" class="overlay">
  <span class="close-x" onclick="closeO()">โ</span>
  <h2 style="margin-top:50px">ุณูุฉ ุงููุดุชุฑูุงุช</h2>
  <div id="cartContent"></div>
  <h3 id="totalVal"></h3>
  <button class="add-btn" onclick="checkout()">ุชุฃููุฏ ุงูุทูุจ ูุงุชุณุงุจ</button>
</div>

<nav>
  <div class="nav-link active" onclick="location.reload()">๐<br>ุงูุฑุฆูุณูุฉ</div>
  <div class="nav-link" onclick="openO('cartPage')">๐<br>ุงูุณูุฉ <span id="cBadge" class="badge">0</span></div>
  <div class="nav-link" onclick="toggleM()">โฐ<br>ุงููุฒูุฏ</div>
</nav>

<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
<script>
const SHEET_URL='https://docs.google.com/spreadsheets/d/e/2PACX-1vTWD0ZQAKe2KRwLQnNjh2t7Z2Y_BKXxaKZxZwKSXUaZLQ3eeLB1fwj6vNllpNwXCtd9aY9Q_tuuFXXV/pub?output=csv';
let db=[],cart=JSON.parse(localStorage.getItem('cart')||'[]'),currentCurr='SDG';
const RATE=0.0031; // ุชุญููู SDG -> SAR

async function init(){
  const r=await fetch(SHEET_URL);
  const t=await r.text();
  const rows=t.split(/\n/).slice(1);
  db=rows.map((row,i)=>{
    const c=row.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/).map(x=>x.replace(/"/g,''));
    return{id:i,name:c[0],price:+c[1]||0,imgs:c[2]?.split(' ')||[]}
  }).filter(p=>p.name);
  render();
  document.getElementById('loader').style.display='none';
}

function render(){
  grid.innerHTML=db.map((p,i)=>{
    let price=currentCurr==='SDG'?p.price+' SDG':(p.price*RATE).toFixed(2)+' SAR';
    return `<div class="card">
      <div class="swiper s${i}"><div class="swiper-wrapper">
        ${p.imgs.map(img=>`<div class="swiper-slide"><img src="${img}"></div>`).join('')}
      </div></div>
      <div class="details">
        <div class="p-title">${p.name}</div>
        <div class="p-price">${price}</div>
        <button class="add-btn" onclick="addC(${p.id})">ุฅุถุงูุฉ ููุณูุฉ</button>
      </div>
    </div>`;
  }).join('');
  db.forEach((_,i)=>new Swiper('.s'+i));
}

function addC(id){
  cart.push(db.find(p=>p.id===id));
  localStorage.setItem('cart',JSON.stringify(cart));
  updateCart();
  alert('ุชูุช ุงูุฅุถุงูุฉ');
}

function updateCart(){
  cartContent.innerHTML=cart.map(i=>`<div>${i.name}</div>`).join('');
  cBadge.innerText=cart.length;
  totalVal.innerText='ุงูุฅุฌูุงูู: '+cart.reduce((s,i)=>s+i.price,0);
}

function checkout(){
  window.open('https://wa.me/249967584275?text='+encodeURIComponent('ุทูุจ ุฌุฏูุฏ'));
}

function toggleM(){sideMenu.classList.toggle('active')}
function openO(id){document.getElementById(id).style.display='block';updateCart()}
function closeO(){document.querySelectorAll('.overlay').forEach(o=>o.style.display='none')}
function setCurrency(c){currentCurr=c;render()}

init();
</script>
</body>
</html>
