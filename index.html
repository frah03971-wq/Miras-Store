<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VIRA MALL | OFFICIAL</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap');
        :root { --gold: #D4AF37; --black: #000; --bg: #f8f9fa; }
        body { font-family: 'Cairo', sans-serif; background: var(--bg); margin: 0; padding-bottom: 90px; color: var(--black); overflow-x: hidden; }
        
        .header { background: var(--black); padding: 25px 15px; text-align: center; border-bottom: 3px solid var(--gold); position: sticky; top: 0; z-index: 2000; }
        .logo { font-size: 32px; font-weight: 900; color: var(--gold); text-decoration: none; letter-spacing: 2px; }
        
        .vira-banner { background: linear-gradient(135deg, #000, #1a1a1a); color: var(--gold); margin: 15px; padding: 30px; border-radius: 30px; border: 1px solid var(--gold); text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.3); position: relative; overflow: hidden; }
        .btn-view-vira { background: var(--gold); color: #000; border: none; padding: 12px 30px; border-radius: 15px; font-weight: 900; margin-top: 15px; cursor: pointer; transition: 0.3s; }
        .btn-view-vira:hover { transform: scale(1.05); box-shadow: 0 0 15px var(--gold); }

        .search-container { background: #fff; padding: 15px; border-bottom: 1px solid #eee; display: flex; gap: 10px; position: sticky; top: 85px; z-index: 1000; }
        .search-input { flex-grow: 1; padding: 12px; border: 1px solid var(--gold); border-radius: 15px; font-family: 'Cairo'; outline: none; }
        
        .section-title { padding: 15px; font-weight: 900; border-right: 6px solid var(--gold); margin: 25px 15px 10px; background: #fff; font-size: 18px; display: flex; justify-content: space-between; align-items: center; }
        
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 0 15px; }
        .card { background: white; border-radius: 25px; overflow: hidden; box-shadow: 0 8px 20px rgba(0,0,0,0.08); position: relative; border: 1px solid #eee; transition: 0.3s; }
        .card img { width: 100%; height: 200px; object-fit: cover; cursor: zoom-in; transition: 0.5s; }
        .card img:hover { transform: scale(1.1); }
        
        .price-chip { position: absolute; top: 12px; left: 12px; background: rgba(0,0,0,0.85); color: var(--gold); padding: 5px 12px; border-radius: 12px; font-weight: 900; font-size: 11px; border: 1px solid var(--gold); z-index: 5; }
        .info { padding: 15px; text-align: center; }
        .store-tag { font-size: 10px; color: var(--gold); font-weight: 800; text-transform: uppercase; }
        .title { font-size: 13px; font-weight: 700; margin: 8px 0 15px; height: 38px; overflow: hidden; color: #222; }
        .btn-add { background: var(--black); color: var(--gold); border: 1px solid var(--gold); width: 100%; padding: 12px; border-radius: 15px; font-weight: 800; cursor: pointer; }

        /* Ù†Ø¸Ø§Ù… ØªÙƒØ¨ÙŠØ± Ø§Ù„ØµÙˆØ± */
        .lightbox { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 9999; justify-content: center; align-items: center; }
        .lightbox img { max-width: 90%; max-height: 80%; border-radius: 15px; border: 2px solid var(--gold); }
        .close-lightbox { position: absolute; top: 30px; right: 30px; color: white; font-size: 40px; cursor: pointer; }

        .nav { position: fixed; bottom: 0; width: 100%; background: #fff; display: flex; justify-content: space-around; padding: 15px 0; border-top: 1px solid #eee; z-index: 2500; box-shadow: 0 -5px 20px rgba(0,0,0,0.1); }
        .nav-item { text-align: center; color: #888; font-size: 11px; font-weight: 700; cursor: pointer; }
        .badge { background: #e74c3c; color: white; border-radius: 50%; padding: 2px 7px; font-size: 10px; position: absolute; top: -8px; right: 10px; }

        .modal { display: none; position: fixed; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 5000; backdrop-filter: blur(8px); }
        .modal-content { background: white; width: 85%; max-width: 400px; margin: 60px auto; border-radius: 35px; padding: 30px; text-align: center; border: 3px solid var(--gold); max-height: 80vh; overflow-y: auto; }
        
        #mainView, #viraView { animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

<div id="lightbox" class="lightbox" onclick="this.style.display='none'">
    <span class="close-lightbox">&times;</span>
    <img id="lightboxImg" src="">
    <p style="color:var(--gold); position:absolute; bottom:50px;">Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…Ø³Ø±Ø­ ğŸ¬</p>
</div>

<header class="header"><a href="#" onclick="location.reload()" class="logo">VIRA MALL</a></header>

<div id="mainView">
    <div class="vira-banner">
        <h2 style="margin:0; letter-spacing:1px;">VIRA ROYAL COLLECTION</h2>
        <p style="font-size:13px; opacity:0.9; margin-top:10px;">Ø¥Ø¨Ø¯Ø§Ø¹ Ø¨Ù„Ø§ Ø­Ø¯ÙˆØ¯.. ØªØµÙØ­ÙŠ Ø£Ù†Ø§Ù‚ØªÙƒ Ø§Ù„Ø®Ø§ØµØ©</p>
        <button class="btn-view-vira" onclick="showViraOnly()">âœ¨ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ù…Ù„ÙƒÙŠ âœ¨</button>
    </div>

    <div class="search-container">
        <input type="text" id="searchInput" class="search-input" placeholder="Ø§Ø¨Ø­Ø«ÙŠ Ø¹Ù† Ù‚Ø·Ø¹Ø© Ø£Ùˆ Ù…ØªØ¬Ø±..." oninput="search()">
        <button class="btn-add" style="width:auto; padding:0 20px;" onclick="showModal('merchantModal')">Ø§Ù†Ø¶Ù…ÙŠ ğŸ‘‘</button>
    </div>

    <div class="section-title">ğŸ›ï¸ Ø§Ø³ØªÙƒØ´ÙÙŠ Ø¹Ø§Ù„Ù… Ø§Ù„ØªØ§Ø¬Ø±Ø§Øª</div>
    <div id="merchGrid" class="grid"></div>
</div>

<div id="viraView" style="display:none">
    <div class="section-title">
        âœ¨ Ø¹Ø§Ù„Ù… VIRA Ø§Ù„Ø®Ø§Øµ
        <button onclick="hideViraOnly()" style="background:var(--black); color:var(--gold); border:1px solid var(--gold); border-radius:12px; padding:8px 15px; font-size:12px">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…ÙˆÙ„ ğŸ </button>
    </div>
    <div id="myGrid" class="grid"></div>
</div>

<div id="cartModal" class="modal"><div class="modal-content"><h3>Ø­Ù‚ÙŠØ¨Ø© Ø§Ù„Ø¬Ù…Ø§Ù„ ğŸ›’</h3><div id="cartItemsList"></div><select id="citySelect" onchange="updateTotal()" style="width:100%; padding:12px; border-radius:15px; margin:15px 0; border:1px solid var(--gold); font-family:'Cairo';"><option value="0">Ø§Ø®ØªØ± Ø§Ù„ÙˆÙ„Ø§ÙŠØ©...</option><option value="20000">Ø§Ù„Ø®Ø±Ø·ÙˆÙ… (20,000)</option><option value="25000">Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª (25,000)</option></select><h4 id="finalPrice" style="background:var(--black); color:var(--gold); padding:18px; border-radius:15px;">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: 0 SDG</h4><button class="btn-add" onclick="sendOrder()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ ÙˆØ§ØªØ³Ø§Ø¨ ğŸ“¤</button><button onclick="closeModal('cartModal')" style="background:none; border:none; margin-top:15px; color:#666;">Ø¥ØºÙ„Ø§Ù‚</button></div></div>

<div id="merchantModal" class="modal"><div class="modal-content"><h2 style="color:var(--gold)">Ø¹Ø¶ÙˆÙŠØ© Ø§Ù„ØªØ§Ø¬Ø±Ø§Øª</h2><p>Ø±Ø³ÙˆÙ… Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ: <b>30,000 SDG</b></p><button class="btn-add" style="background:var(--gold); color:#000;" onclick="window.open('https://wa.me/249967584275?text=Ø­ÙˆÙ„Øª Ø±Ø³ÙˆÙ… Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ 30 Ø£Ù„Ù.. Ø£Ø±ÙŠØ¯ Ø±Ø§Ø¨Ø· Ù…ØªØ¬Ø±ÙŠ âœ¨')">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± âœ…</button><button onclick="closeModal('merchantModal')" style="background:none; border:none; color:red; margin-top:15px;">Ø¥ØºÙ„Ø§Ù‚</button></div></div>

<nav class="nav">
    <div class="nav-item" onclick="location.reload()">ğŸ <br>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
    <div class="nav-item" onclick="showViraOnly()" style="color:var(--gold)">ğŸ‘‘<br>Ù…ØªØ¬Ø±ÙŠ</div>
    <div class="nav-item" onclick="showModal('cartModal')" style="position:relative;">ğŸ›’<br>Ø§Ù„Ø³Ù„Ø© <span id="cartCount" class="badge">0</span></div>
</nav>

<script>
    const SHEET_ID = '1UZnlp45dVMRJxNibcg3fm52H6S4DB4YbGLr4KK3jPqs';
    const URL_VIRA = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=%D8%A7%D9%84%D9%88%D8%B1%D9%82%D8%A91`;
    const URL_MERCH = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=%D8%B1%D8%AF%D9%88%D8%AF%20%D8%A7%D9%84%D9%86%D9%85%D9%88%D8%B0%D8%AC%201`;

    let allData = []; let cart = [];

    async function loadData() {
        try {
            const [res1, res2] = await Promise.all([fetch(URL_VIRA), fetch(URL_MERCH)]);
            const text1 = await res1.text(); const text2 = await res2.text();
            const parse = (text, isVira) => {
                return text.split('\n').slice(1).map(r => {
                    const c = r.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                    if (isVira) return { name: c[0]?.replace(/"/g,''), price: c[1]?.replace(/"/g,''), store: c[2]?.replace(/"/g,''), img: c[3]?.replace(/"/g,'') };
                    return { store: c[1]?.replace(/"/g,''), name: c[3]?.replace(/"/g,''), price: c[4]?.replace(/"/g,''), img: c[5]?.replace(/"/g,'') };
                }).filter(p => p.name && p.img);
            };
            allData = [...parse(text1, true), ...parse(text2, false)];
            render(allData);
        } catch (e) { console.log("Loading..."); }
    }

    function render(data) {
        let viraHtml = '', merchHtml = '';
        data.forEach(p => {
            const card = `<div class="card">
                <div class="price-chip">${p.price} SDG</div>
                <img src="${p.img}" onclick="openLightbox('${p.img}')" onerror="this.src='https://via.placeholder.com/400?text=VIRA+MALL'">
                <div class="info">
                    <span class="store-tag">${p.store}</span>
                    <div class="title">${p.name}</div>
                    <button class="btn-add" onclick="addToCart('${p.name}','${p.price}','${p.store}')">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø© ğŸ›’</button>
                </div>
            </div>`;
            const s = p.store.toLowerCase();
            if (s.includes('vira') || s.includes('ÙÙŠØ±Ø§') || s.includes('Ù…ÙŠØ±Ø§Ø³')) viraHtml += card;
            else merchHtml += card;
        });
        document.getElementById('myGrid').innerHTML = viraHtml;
        document.getElementById('merchGrid').innerHTML = merchHtml;
    }

    function openLightbox(src) {
        document.getElementById('lightboxImg').src = src;
        document.getElementById('lightbox').style.display = 'flex';
    }

    function showViraOnly() { 
        document.getElementById('mainView').style.display = 'none'; 
        document.getElementById('viraView').style.display = 'block';
        window.scrollTo(0,0);
    }
    function hideViraOnly() { 
        document.getElementById('mainView').style.display = 'block'; 
        document.getElementById('viraView').style.display = 'none'; 
    }

    function search() {
        const q = document.getElementById('searchInput').value.toLowerCase();
        render(allData.filter(p => p.name.toLowerCase().includes(q) || p.store.toLowerCase().includes(q)));
    }

    function addToCart(n,p,s) { cart.push({n,p,s}); document.getElementById('cartCount').innerText = cart.length; updateCartUI(); }
    function updateCartUI() { document.getElementById('cartItemsList').innerHTML = cart.map((i,idx) => `<div style="display:flex; justify-content:space-between; padding:12px; border-bottom:1px solid #eee"><span>${i.n}</span><b>${i.p} <span onclick="cart.splice(${idx},1);updateCartUI();" style="color:red; cursor:pointer">âŒ</span></b></div>`).join(''); updateTotal(); }
    function updateTotal() { const d = parseInt(document.getElementById('citySelect').value)||0; const s = cart.reduce((a,i)=>a+parseInt(i.p.replace(/[^0-9]/g,'')||0),0); document.getElementById('finalPrice').innerText = `Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${s+d} SDG`; }
    function sendOrder() { if(cart.length===0) return alert('Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©!'); const msg = encodeURIComponent(`Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ù† VIRA MALL ğŸ‘‘\n\n${cart.map(i=>`â€¢ ${i.n} [${i.s}]`).join('\n')}\n\nğŸ“ Ø§Ù„ØªÙˆØµÙŠÙ„: ${document.getElementById('citySelect').selectedOptions[0].text}`); window.open(`https://wa.me/249967584275?text=${msg}`); }
    function showModal(id) { document.getElementById(id).style.display = 'block'; }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }
    loadData();
</script>
</body>
</html>
