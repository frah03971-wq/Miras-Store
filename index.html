<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VIRA MALL | ÙÙŠØ±Ø§ Ù…ÙˆÙ„ Ø§Ù„Ù…Ø·ÙˆØ±</title>
<style>
:root{ --gold:#D4AF37; --dark:#0f1111; --gray:#f5f5f7; --white:#ffffff; }
body{margin:0; font-family:'Segoe UI', Tahoma, sans-serif; background:var(--gray); direction:rtl; overflow-x:hidden;}

header{background:var(--dark); color:white; padding:20px; text-align:center; position:sticky; top:0; z-index:1000; border-bottom:3px solid var(--gold);}
header h1{margin:0; font-size:26px; color:var(--gold);}

.header-tools { position: absolute; top: 20px; left: 20px; display: flex; gap: 15px; }
.cart-icon { position: relative; cursor: pointer; font-size: 22px; color: var(--gold); }
.cart-count { position: absolute; top: -8px; right: -8px; background: red; color: white; font-size: 12px; padding: 2px 6px; border-radius: 50%; }
.menu-btn { position: absolute; top: 20px; right: 20px; font-size: 26px; color: var(--gold); cursor: pointer; }

/* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø³Ù„Ø§ÙŠØ¯Ø± Ø¯Ø§Ø®Ù„ Ø§Ù„ÙƒØ±Øª */
.img-container { position: relative; width: 100%; height: 200px; background: #eee; overflow: hidden; }
.slider-track { display: flex; transition: transform 0.4s ease-in-out; height: 100%; }
.slider-track img { min-width: 100%; height: 100%; object-fit: cover; cursor: zoom-in; }

/* Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„ */
.nav-btn { position: absolute; top: 50%; transform: translateY(-50%); background: rgba(0,0,0,0.3); color: white; border: none; padding: 5px 8px; cursor: pointer; border-radius: 50%; font-size: 12px; z-index: 10; }
.prev { left: 5px; }
.next { right: 5px; }
.dots { position: absolute; bottom: 8px; width: 100%; text-align: center; z-index: 11; }
.dot { height: 6px; width: 6px; background-color: #bbb; border-radius: 50%; display: inline-block; margin: 0 2px; transition: 0.3s; }
.dot.active { background-color: var(--gold); transform: scale(1.3); }

.container{padding:20px; display:grid; grid-template-columns:repeat(auto-fill,minmax(170px,1fr)); gap:20px; max-width:1200px; margin:0 auto;}
.card{background:var(--white); border-radius:15px; overflow:hidden; box-shadow:0 4px 10px rgba(0,0,0,.05); display:flex; flex-direction:column; transition: 0.3s;}

.info{padding:12px; text-align:center; flex-grow:1;}
.price{font-size:17px; font-weight:bold; color:#222; margin:8px 0;}
.btn-add { background:var(--gold); color:var(--dark); border:none; width:100%; padding:10px; border-radius:8px; cursor:pointer; font-weight:bold; }

/* Ø§Ù„Ø³Ù„Ø© ÙˆØ§Ù„ØªÙˆØµÙŠÙ„ */
.sidebar { height: 100%; width: 0; position: fixed; z-index: 10001; top: 0; right: 0; background: var(--dark); overflow-x: hidden; transition: 0.4s; padding-top: 60px; }
.overlay { display:none; position:fixed; inset:0; background:white; z-index:20000; padding:20px; overflow-y:auto; }
#viewer{display:none; position:fixed; inset:0; background:rgba(0,0,0,0.95); z-index:99999; align-items:center; justify-content:center;}
#viewer img{max-width:95%; max-height:85%; border-radius:10px; border:2px solid var(--gold);}
</style>
</head>
<body>

<header>
  <div class="menu-btn" onclick="openNav()">â˜°</div>
  <h1>VIRA MALL</h1>
  <div class="header-tools">
      <div class="cart-icon" onclick="openCart()">ğŸ›’<span class="cart-count" id="cartCount">0</span></div>
  </div>
</header>

<div id="mySidebar" class="sidebar">
  <a href="javascript:void(0)" class="closebtn" onclick="closeNav()" style="position: absolute; top: 10px; left: 25px; font-size: 36px; color: var(--gold); text-decoration: none;">Ã—</a>
  <div style="padding: 15px 25px; color: var(--gold); font-weight: bold;">ğŸ’³ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¯ÙØ¹ Ù„Ù„ØªØ¬Ø§Ø±</div>
  <div style="padding: 10px 25px; color: white;">Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨: 2280384</div>
</div>

<div class="container" id="grid"></div>

<div id="cartOverlay" class="overlay">
    <div style="text-align: left; font-size: 24px; cursor: pointer;" onclick="closeCart()">âœ•</div>
    <h2>Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª ğŸ›’</h2>
    <div id="cartItems"></div>
    <div style="font-size: 20px; font-weight: bold; margin: 20px 0;">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="totalPrice">0</span> SDG</div>
    <button style="background: #25D366; color: white; width: 100%; padding: 15px; border-radius: 10px; border:none; cursor:pointer;" onclick="sendOrder()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ ÙˆØ§ØªØ³Ø§Ø¨ âœ…</button>
</div>

<div id="viewer" onclick="this.style.display='none'"><img id="viewerImg"></div>

<script>
const SHEET_URL='https://docs.google.com/spreadsheets/d/e/2PACX-1vTWD0ZQAKe2KRwLQnNjh2t7Z2Y_BKXxaKZxZwKSXUaZLQ3eeLB1fwj6vNllpNwXCtd9aY9Q_tuuFXXV/pub?gid=0&single=true&output=csv';

let products = [];
let cart = [];

async function loadProducts(){
  const res = await fetch(SHEET_URL);
  const text = await res.text();
  const rows = text.split(/\r?\n/).slice(1);
  products = rows.map((r, index)=>{
    const c = r.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/).map(x=>x.replace(/"/g,'').trim());
    // Ù‡Ù†Ø§ Ø§Ù„Ø³Ø­Ø±: Ù†Ø­ÙˆÙ„ Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ± Ù„Ù…ØµÙÙˆÙØ© (Array) Ù„Ùˆ ÙÙŠÙ‡ ÙƒØ°Ø§ ØµÙˆØ±Ø© Ù…ÙØµÙˆÙ„ÙŠÙ† Ø¨ÙØ§ØµÙ„Ø©
    const images = c[3] ? c[3].split(',') : ['https://via.placeholder.com/200'];
    return {id: index, name:c[0], price:c[1], store:c[2], imgs:images, whatsapp:c[4]};
  }).filter(p=>p.name);
  render();
}

function render(){
  document.getElementById('grid').innerHTML = products.map(p=> {
    const dots = p.imgs.map((_, i) => `<span class="dot ${i===0?'active':''}" data-idx="${i}"></span>`).join('');
    const nav = p.imgs.length > 1 ? `
        <button class="nav-btn prev" onclick="moveSlide(this, -1)">â®</button>
        <button class="nav-btn next" onclick="moveSlide(this, 1)">â¯</button>
    ` : '';

    return `
    <div class="card" data-current="0">
      <div class="img-container">
          <div class="slider-track">
              ${p.imgs.map(img => `<img src="${img}" onclick="openImg('${img}')" onerror="this.src='https://via.placeholder.com/200'">`).join('')}
          </div>
          ${nav}
          <div class="dots">${dots}</div>
      </div>
      <div class="info">
        <div class="store">âœ¨ ${p.store}</div>
        <div class="title" style="font-size:13px; font-weight:bold;">${p.name}</div>
        <div class="price">${p.price} SDG</div>
        <button class="btn-add" onclick="addToCart(${p.id})">Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø© ğŸ›’</button>
      </div>
    </div>
  `}).join('');
}

function moveSlide(btn, step) {
    const card = btn.closest('.card');
    const track = card.querySelector('.slider-track');
    const dots = card.querySelectorAll('.dot');
    const total = track.querySelectorAll('img').length;
    let current = parseInt(card.getAttribute('data-current'));

    current = (current + step + total) % total;
    card.setAttribute('data-current', current);
    track.style.transform = `translateX(${current * 100}%)`; // Ø§Ù„ØªØ­Ø±ÙŠÙƒ Ù„Ù„ÙŠØ³Ø§Ø±/Ø§Ù„ÙŠÙ…ÙŠÙ†

    dots.forEach((dot, i) => dot.classList.toggle('active', i === current));
}

function addToCart(id) {
    const p = products.find(item => item.id === id);
    cart.push(p);
    updateCart();
    alert("ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù„Ù…Ù„ÙƒØ© ÙÙŠØ±Ø§! âœ¨");
}

function updateCart() {
    document.getElementById('cartCount').innerText = cart.length;
    let total = 0;
    document.getElementById('cartItems').innerHTML = cart.map(item => {
        total += parseInt(item.price) || 0;
        return `<p>${item.name} - ${item.price} SDG</p>`;
    }).join('');
    document.getElementById('totalPrice').innerText = total;
}

function openNav() { document.getElementById("mySidebar").style.width = "280px"; }
function closeNav() { document.getElementById("mySidebar").style.width = "0"; }
function openCart() { document.getElementById('cartOverlay').style.display = 'block'; }
function closeCart() { document.getElementById('cartOverlay').style.display = 'none'; }
function openImg(src){ document.getElementById('viewerImg').src=src; document.getElementById('viewer').style.display='flex'; }

function sendOrder() {
    let msg = `Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ù† VIRA MALL âœ¨%0A`;
    cart.forEach(i => msg += `- ${i.name} (${i.price} SDG)%0A`);
    window.open(`https://wa.me/249967584275?text=${msg}`, '_blank');
}

loadProducts();
</script>
</body>
</html>
