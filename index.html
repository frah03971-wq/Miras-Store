<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VIRA MALL | Ø¹Ø§Ù„Ù… Ø§Ù„ØªØ®ÙÙŠØ¶Ø§Øª</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap');
        
        :root {
            --amazon-orange: #febd69;
            --amazon-dark: #232f3e;
            --amazon-yellow: #ff9900;
            --sale-red: #B12704;
            --light-bg: #f3f3f3;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background: var(--light-bg); color: #111; font-family: 'Cairo', sans-serif; margin: 0; padding-bottom: 100px; }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
        .main-header { background: var(--amazon-dark); padding: 15px; position: sticky; top: 0; z-index: 2000; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .intro-text { text-align: center; color: var(--amazon-orange); margin-bottom: 10px; }
        .intro-text h1 { margin: 0; font-size: 24px; font-weight: 900; }
        .intro-text p { margin: 0; font-size: 13px; color: #fff; opacity: 0.9; }

        /* Ø§Ù„Ø¨Ø­Ø« */
        .search-box { position: relative; width: 100%; display: flex; margin-top: 10px; }
        .search-box input { width: 100%; padding: 12px 15px; border-radius: 8px 0 0 8px; border: none; outline: none; font-family: 'Cairo'; }
        .search-btn { background: var(--amazon-orange); border: none; padding: 0 15px; border-radius: 0 8px 8px 0; cursor: pointer; }

        /* Ø§Ù„Ø£Ù‚Ø³Ø§Ù… */
        .section-title { padding: 15px 15px 5px; font-weight: 900; font-size: 18px; color: var(--amazon-dark); display: flex; align-items: center; gap: 8px; }

        /* ÙƒØ±Øª Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ù…Ø·ÙˆØ± Ø¨Ø§Ù„ØªØ®ÙÙŠØ¶Ø§Øª */
        .product-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 10px; }
        .p-card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 8px rgba(0,0,0,0.05); position: relative; transition: 0.3s; }
        
        .img-container { width: 100%; height: 210px; background: #eee; overflow: hidden; position: relative; }
        .img-container img { width: 100%; height: 100%; object-fit: cover; opacity: 0; transition: opacity 0.5s; }
        .img-container img.loaded { opacity: 1; }

        /* Ù…Ù„ØµÙ‚ SALE */
        .sale-badge { 
            position: absolute; top: 10px; right: 10px; background: var(--sale-red); 
            color: white; padding: 4px 10px; border-radius: 5px; font-size: 10px; 
            font-weight: 900; z-index: 10; animation: pulse 1.5s infinite;
        }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }

        .fav-icon { position: absolute; top: 10px; left: 10px; background: rgba(255,255,255,0.9); border-radius: 50%; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; z-index: 10; cursor: pointer; color: #ddd; }
        .fav-icon.active { color: #ff4757; }

        .p-info { padding: 12px; }
        .p-title { font-size: 13px; font-weight: 700; height: 38px; overflow: hidden; margin-bottom: 5px; }
        
        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙˆØ§Ù„Ù‚Ø¯ÙŠÙ… */
        .price-area { display: flex; flex-direction: column; }
        .old-price { color: #888; text-decoration: line-through; font-size: 11px; }
        .new-price { color: var(--sale-red); font-size: 17px; font-weight: 900; }

        .add-to-cart { 
            background: linear-gradient(to bottom, #f7dfa1, #f0c14b);
            border: 1px solid #a88734; width: 100%; padding: 10px; 
            border-radius: 7px; font-weight: 900; font-family: 'Cairo';
            margin-top: 10px; cursor: pointer; font-size: 12px;
        }

        /* Ø§Ù„Ø¨Ø§Ø± Ø§Ù„Ø³ÙÙ„ÙŠ */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: #fff; display: flex; justify-content: space-around; padding: 12px; border-top: 1px solid #ddd; z-index: 3000; }
        .nav-item { text-align: center; text-decoration: none; color: #555; position: relative; font-size: 11px; font-weight: 700; flex: 1; }
        .nav-item i { display: block; font-size: 20px; font-style: normal; margin-bottom: 4px; }
        .nav-item.active { color: var(--amazon-yellow); }
        .badge { position: absolute; top: -8px; left: 55%; background: var(--amazon-yellow); color: var(--amazon-dark); font-size: 10px; min-width: 18px; padding: 2px; border-radius: 10px; font-weight: 900; }
    </style>
</head>
<body>

<header class="main-header">
    <div class="intro-text">
        <h1>VIRA<span> MALL</span></h1>
        <p>Ø®ÙŠØ§Ø±ÙƒÙ Ø§Ù„Ø£ÙˆÙ„ Ù„Ù„Ø£Ù†Ø§Ù‚Ø© ÙˆØ§Ù„Ø±ÙØ§Ù‡ÙŠØ© âœ¨</p>
    </div>
    <div class="search-box">
        <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø«ÙŠ Ø¹Ù† ÙØ³ØªØ§Ù†ØŒ ØªØ®ÙÙŠØ¶Ø§Øª..." oninput="doSearch()">
        <button class="search-btn">ğŸ”</button>
    </div>
</header>

<div id="offersArea"></div>
<div class="section-title">âœ¨ ÙƒÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</div>
<div id="mainContent" class="product-grid"></div>

<nav class="bottom-nav">
    <a href="#" class="nav-item active"><i>ğŸ </i>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
    <a href="#" class="nav-item" onclick="alert('ØªÙˆØµÙŠÙ„Ù†Ø§ Ø³Ø±ÙŠØ¹ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª ğŸšš')"><i>ğŸšš</i>Ø§Ù„ØªÙˆØµÙŠÙ„</a>
    <a href="#" class="nav-item" onclick="showFavs()"><i>â¤ï¸</i>Ø§Ù„Ù…ÙØ¶Ù„Ø©<span id="favCount" class="badge">0</span></a>
    <a href="#" class="nav-item" onclick="sendOrder()"><i>ğŸ›’</i>Ø§Ù„Ø­Ù‚ÙŠØ¨Ø©<span id="cartCount" class="badge">0</span></a>
    <a href="https://wa.me/249967584275" class="nav-item"><i>ğŸ’¬</i>ØªÙˆØ§ØµÙ„</a>
</nav>

<script>
    const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTWD0ZQAKe2KRwLQnNjh2t7Z2Y_BKXxaKZxZwKSXUaZLQ3eeLB1fwj6vNllpNwXCtd9aY9Q_tuuFXXV/pub?output=csv';
    let products = [], cart = [], favorites = [];

    async function init() {
        try {
            const r = await fetch(sheetUrl + '&t=' + Date.now());
            const text = await r.text();
            const rows = text.split('\n').slice(1);
            products = rows.map(row => {
                const c = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                return { 
                    name: c[0]?.replace(/"/g,''), 
                    price: c[1], 
                    shop: c[2], 
                    img: c[3]?.split(',')[0].trim(),
                    oldPrice: c[4] // Ø§ÙØªØ±Ø¶Ù†Ø§ Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø®Ø§Ù…Ø³ Ù„Ù„Ø³Ø¹Ø± Ø§Ù„Ù‚Ø¯ÙŠÙ…
                };
            }).filter(p => p.name);
            renderAll();
        } catch (e) { console.error("Error"); }
    }

    function renderAll() {
        // Ù‚Ø³Ù… Ø§Ù„Ø¹Ø±ÙˆØ¶ (Ø§Ù„Ù„ÙŠ Ø¹Ù†Ø¯Ù‡Ø§ Ø³Ø¹Ø± Ù‚Ø¯ÙŠÙ…)
        const saleItems = products.filter(p => p.oldPrice && p.oldPrice.trim() !== "");
        if(saleItems.length > 0) {
            let offersHTML = `<div class="section-title">ğŸ”¥ Ø¹Ø±ÙˆØ¶ Ù†Ø§Ø±ÙŠØ©</div><div class="product-grid">`;
            offersHTML += saleItems.map(p => createCard(p)).join('') + `</div>`;
            document.getElementById('offersArea').innerHTML = offersHTML;
        }

        // ÙƒÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
        document.getElementById('mainContent').innerHTML = products.map(p => createCard(p)).join('');
    }

    function createCard(p) {
        const isSale = p.oldPrice && p.oldPrice.trim() !== "";
        return `
            <div class="p-card">
                ${isSale ? '<div class="sale-badge">Ø®ØµÙ… %</div>' : ''}
                <div class="fav-icon" onclick="toggleFav(this, '${p.name}')">â¤</div>
                <div class="img-container">
                    <img src="${p.img}" onload="this.classList.add('loaded')" onerror="this.src='https://via.placeholder.com/300x400?text=VIRA+MALL'">
                </div>
                <div class="p-info">
                    <div class="p-title">${p.name}</div>
                    <div class="price-area">
                        ${isSale ? `<span class="old-price">${p.oldPrice} SDG</span>` : ''}
                        <span class="new-price">${p.price} SDG</span>
                    </div>
                    <button class="add-to-cart" onclick="addToCart('${p.name}', '${p.price}')">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©</button>
                </div>
            </div>`;
    }

    function addToCart(name, price) {
        cart.push({name, price});
        const badge = document.getElementById('cartCount');
        badge.innerText = cart.length; badge.style.display = 'block';
    }

    function toggleFav(el, name) {
        el.classList.toggle('active');
        if(el.classList.contains('active')) favorites.push(name);
        else favorites = favorites.filter(f => f !== name);
        const badge = document.getElementById('favCount');
        badge.innerText = favorites.length; badge.style.display = favorites.length > 0 ? 'block' : 'none';
    }

    function sendOrder() {
        if(!cart.length) return alert("Ø§Ù„Ø­Ù‚ÙŠØ¨Ø© ÙØ§Ø±ØºØ©!");
        let msg = "Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ù† VIRA MALL ğŸ›ï¸:\n" + cart.map((it, i) => `${i+1}. ${it.name} (${it.price} SDG)`).join('\n');
        window.open(`https://wa.me/249967584275?text=${encodeURIComponent(msg)}`);
    }

    function doSearch() {
        const t = document.getElementById('searchInput').value.toLowerCase();
        const f = products.filter(p => p.name.toLowerCase().includes(t));
        document.getElementById('mainContent').innerHTML = f.map(p => createCard(p)).join('');
    }

    init();
</script>
</body>
</html>
