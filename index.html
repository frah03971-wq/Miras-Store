<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VIRA MALL | ÙÙŠØ±Ø§ Ù…ÙˆÙ„ Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap');
        
        :root { 
            --gold: #D4AF37; 
            --black: #000000; 
            --dark-gray: #1a1a1a;
            --amazon-orange: #febd69; 
        }
        
        body { font-family: 'Cairo', sans-serif; background: #f4f4f4; margin: 0; color: #111; padding-bottom: 70px; }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ù…Ù„ÙƒÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯ */
        .top-nav { background: var(--black); padding: 15px 5%; display: flex; align-items: center; justify-content: space-between; position: sticky; top: 0; z-index: 1000; border-bottom: 2px solid var(--gold); }
        .logo { font-size: 1.8em; font-weight: 900; color: #fff; text-decoration: none; letter-spacing: 1px; }
        .logo span { color: var(--gold); }
        .search-container { flex: 1; margin: 0 15px; }
        .search-container input { width: 100%; padding: 10px; border-radius: 25px; border: none; outline: none; }

        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø³ÙÙ„ÙŠ (Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©) */
        .bottom-app-bar { 
            position: fixed; bottom: 0; left: 0; right: 0; 
            background: var(--black); height: 65px; 
            display: flex; justify-content: space-around; align-items: center; 
            border-top: 2px solid var(--gold); z-index: 9999;
        }
        .nav-link { color: #fff; text-decoration: none; text-align: center; font-size: 0.7em; transition: 0.3s; }
        .nav-link i { display: block; font-size: 1.5em; margin-bottom: 2px; color: var(--gold); }
        .nav-link:hover { color: var(--gold); }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø£Ø¹Ù„Ø§Ù… ÙˆØ§Ù„Ø¹Ø±ÙˆØ¶ */
        .badge-sudan { background: #ff0000; color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.8em; margin-right: 5px; }
        .badge-saudi { background: #006C35; color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.8em; margin-right: 5px; }

        /* ÙƒØ±ÙˆØª Ø§Ù„Ø¨Ø±Ø§Ù†Ø¯Ø§Øª */
        .main-content { padding: 20px 5%; }
        .grid-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .brand-card { background: #fff; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.1); border: 1px solid #eee; text-align: center; padding-bottom: 15px; }
        .brand-image { width: 100%; height: 300px; object-fit: cover; }
        .brand-card h2 { margin: 15px 0 5px; color: var(--black); font-weight: 900; }

        /* Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ù…ØªØ¬Ø± */
        #store-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 10000; }
        .modal-body { background: #fff; width: 100%; height: 100%; overflow-y: auto; padding: 20px; position: relative; }
        .close-modal { position: absolute; left: 20px; top: 20px; font-size: 2.5em; color: var(--black); cursor: pointer; }

        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .product-card { border: 1px solid #eee; border-radius: 10px; padding: 15px; text-align: center; }
        .image-container { width: 100%; height: 350px; overflow: hidden; border-radius: 8px; position: relative; }
        .image-container img { width: 100%; height: 100%; object-fit: contain; }
        .p-price { color: #B12704; font-size: 1.4em; font-weight: 900; }
        .add-btn { background: var(--gold); color: #000; border: none; padding: 12px; width: 100%; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 10px; }

    </style>
</head>
<body>

<div class="top-nav">
    <a href="#" class="logo">VIRA<span> MALL</span></a>
    <div class="search-container">
        <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø«ÙŠ Ø¹Ù† Ø£Ù†Ø§Ù‚ØªÙƒ Ù‡Ù†Ø§..." onkeyup="handleSearch()">
    </div>
</div>

<div class="main-content">
    <div class="grid-container" id="brandsGrid"></div>
</div>

<div class="bottom-app-bar">
    <a href="#" class="nav-link" onclick="location.reload()"><i>ğŸ </i>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
    <a href="#brandsGrid" class="nav-link"><i>ğŸ›ï¸</i>Ø§Ù„Ù…ÙˆÙ„</a>
    <a href="#" class="nav-link" onclick="openCart()"><i>ğŸ›’</i>Ø§Ù„Ø³Ù„Ø© <span id="cartCountBadge" style="background:red; color:white; border-radius:50%; padding:2px 6px; font-size:10px;">0</span></a>
    <a href="https://wa.me/YOUR_PHONE" class="nav-link"><i>ğŸ’¬</i>ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</a>
</div>

<div id="store-modal">
    <div class="modal-body">
        <span class="close-modal" onclick="closeStore()">&times;</span>
        <h2 id="modalTitle" style="text-align: center; margin-top: 40px;"></h2>
        <div class="product-grid" id="productsGrid"></div>
    </div>
</div>

<script>
    const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTWD0ZQAKe2KRwLQnNjh2t7Z2Y_BKXxaKZxZwKSXUaZLQ3eeLB1fwj6vNllpNwXCtd9aY9Q_tuuFXXV/pub?output=csv';
    let allProducts = [], cart = [];

    async function loadData() {
        try {
            const resp = await fetch(sheetUrl + '&t=' + Date.now());
            const csv = await resp.text();
            const rows = csv.split('\n').slice(1);
            allProducts = rows.map(r => {
                const c = r.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                return {
                    name: c[0]?.replace(/"/g,'').trim(),
                    price: c[1]?.replace(/"/g,'').trim(),
                    shop: c[2]?.replace(/"/g,'').trim(),
                    img: c[3]?.replace(/"/g,'').trim(),
                    phone: c[4]?.replace(/[^\d]/g,'').trim()
                };
            }).filter(p => p.shop);
            renderMall();
        } catch (e) { console.error("Data Error"); }
    }

    function renderMall() {
        const shops = [...new Set(allProducts.map(p => p.shop))];
        const grid = document.getElementById('brandsGrid');
        grid.innerHTML = shops.map(shop => {
            const firstP = allProducts.find(p => p.shop === shop);
            const firstImg = firstP.img.split(',')[0].trim();
            // Ø¥Ø¶Ø§ÙØ© Ø¹Ù„Ù… Ø§Ù„Ø³ÙˆØ¯Ø§Ù† ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù„Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„ØªÙŠ Ø³Ù†Ø­Ø¯Ø¯Ù‡Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹ Ø£Ùˆ Ù„ÙƒÙ„ Ø§Ù„Ù…ÙˆÙ„
            return `
                <div class="brand-card" onclick="openStore('${shop}')">
                    <img src="${firstImg}" class="brand-image">
                    <h2>${shop} ğŸ‡¸ğŸ‡©</h2>
                    <p style="color:#D4AF37;">Ø¹Ø±Ø¶ ØªØ´ÙƒÙŠÙ„Ø© Ø§Ù„Ù…ÙˆÙ„ ÙƒØ§Ù…Ù„Ø©</p>
                </div>`;
        }).join('');
    }

    function openStore(shopName) {
        document.getElementById('modalTitle').innerText = shopName;
        const products = allProducts.filter(p => p.shop === shopName);
        const grid = document.getElementById('productsGrid');
        
        grid.innerHTML = products.map((p, idx) => {
            const images = p.img.split(',');
            // Ø­Ø³Ø¨Ø© Ø§Ù„Ø®ØµÙ… 15% Ù„Ù„Ø³ÙˆØ¯Ø§Ù†
            const originalPrice = parseFloat(p.price);
            const discountedPrice = (originalPrice * 0.85).toFixed(0);

            return `
                <div class="product-card">
                    <div class="image-container">
                        <img src="${images[0].trim()}">
                        <div style="position:absolute; top:10px; right:10px; background:red; color:white; padding:5px; border-radius:5px; font-weight:bold;">15% OFF ğŸ‡¸ğŸ‡©</div>
                    </div>
                    <div class="p-name" style="margin-top:10px; font-weight:bold;">${p.name}</div>
                    <div class="p-price">${discountedPrice} SDG <span style="font-size:0.6em; text-decoration:line-through; color:gray;">${p.price}</span></div>
                    <button class="add-btn" onclick="addToCart('${p.name}', '${discountedPrice}', '${p.phone}')">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø­Ù‚ÙŠØ¨Ø© ğŸ›ï¸</button>
                </div>`;
        }).join('');
        document.getElementById('store-modal').style.display = 'block';
        document.body.style.overflow = 'hidden';
    }

    function closeStore() { 
        document.getElementById('store-modal').style.display = 'none'; 
        document.body.style.overflow = 'auto';
    }

    function addToCart(name, price, phone) {
        cart.push({name, price, phone});
        document.getElementById('cartCountBadge').innerText = cart.length;
        alert('ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù„Ù€ VIRA MALL âœ…');
    }

    function openCart() {
        if(cart.length === 0) return alert("Ø³Ù„ØªÙƒ ÙØ§Ø±ØºØ© ÙŠØ§ Ø¬Ù…ÙŠÙ„Ø©!");
        let msg = "Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ù† VIRA MALL ğŸ›ï¸:\n\n";
        cart.forEach((item, i) => msg += `${i+1}. ${item.name} (${item.price} SDG)\n`);
        window.open(`https://wa.me/${cart[0].phone}?text=${encodeURIComponent(msg)}`);
    }

    function handleSearch() {
        const term = document.getElementById('searchInput').value.toLowerCase();
        const cards = document.getElementsByClassName('brand-card');
        Array.from(cards).forEach(card => {
            const name = card.getElementsByTagName('h2')[0].innerText.toLowerCase();
            card.style.display = name.includes(term) ? 'block' : 'none';
        });
    }

    window.onload = loadData;
</script>
</body>
</html>
