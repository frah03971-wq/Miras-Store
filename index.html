<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VIRA MALL | ÙÙŠØ±Ø§ Ù…ÙˆÙ„</title>
<style>
:root{--gold:#D4AF37;--dark:#0f1111;--gray:#f5f5f7;--white:#fff;--red:#e41e31}
body{margin:0;font-family:'Segoe UI',Tahoma,sans-serif;background:var(--gray);direction:rtl;overflow-x:hidden}

/* Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ */
header{background:var(--dark);color:white;padding:15px;text-align:center;position:sticky;top:0;z-index:1000;border-bottom:3px solid var(--gold);display:flex;justify-content:space-between;align-items:center}
header h1{margin:0;color:var(--gold);font-size:24px;flex-grow:1;letter-spacing:1px}
.menu-btn{font-size:30px;cursor:pointer;color:var(--gold);padding:0 10px}

/* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© */
.sidebar{position:fixed;top:0;right:-300px;width:280px;height:100%;background:var(--dark);z-index:2000;transition:0.3s;color:white;padding:25px;box-shadow:-5px 0 15px rgba(0,0,0,0.5)}
.sidebar.open{right:0}
.sidebar h2{color:var(--gold);border-bottom:1px solid #333;padding-bottom:10px;margin-bottom:20px}
.side-item{padding:15px 0;border-bottom:1px solid #222;cursor:pointer;display:flex;align-items:center;gap:10px}

/* Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª */
.container{padding:15px;display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:15px;max-width:1200px;margin:auto}
.card{background:white;border-radius:15px;overflow:hidden;box-shadow:0 4px 12px rgba(0,0,0,.08);position:relative;display:flex;flex-direction:column}

/* Ø§Ù„Ø³Ù„Ø§ÙŠØ¯Ø± Ø§Ù„Ù…Ø·ÙˆØ± */
.slider-box{position:relative;height:210px;overflow:hidden;direction:ltr!important;background:#eee}
.track{display:flex;height:100%;transition:transform 0.5s ease-in-out}
.track img{min-width:100%;width:100%;height:100%;object-fit:cover}

.nav-btn{position:absolute;top:50%;transform:translateY(-50%);width:28px;height:28px;border-radius:50%;background:rgba(0,0,0,.5);color:white;border:none;z-index:10;cursor:pointer}
.dots{position:absolute;bottom:8px;left:50%;transform:translateX(-50%);display:flex;gap:4px}
.dot{width:6px;height:6px;border-radius:50%;background:rgba(255,255,255,0.5)}
.dot.active{background:var(--gold);width:12px;border-radius:10px}

/* Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª */
.info{padding:12px;text-align:center;direction:rtl}
.store-tag{font-size:10px;color:var(--gold);font-weight:bold;margin-bottom:5px;display:block}
.title{font-size:14px;font-weight:bold;height:38px;overflow:hidden;margin-bottom:8px;color:var(--dark)}
.price{font-size:17px;font-weight:900;color:#222;margin-bottom:10px}
.btn-wa{background:var(--gold);color:var(--dark);border:none;padding:10px;border-radius:10px;font-weight:bold;width:100%;cursor:pointer;display:block;text-decoration:none}

/* Ø§Ù„Ù†ÙˆØ§ÙØ° */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,0.85);display:none;z-index:3000;align-items:center;justify-content:center;padding:20px}
.modal{background:white;padding:25px;border-radius:20px;width:100%;max-width:350px;text-align:center;color:black}
</style>
</head>
<body>

<header>
    <div style="width:40px"></div>
    <h1>VIRA MALL</h1>
    <div class="menu-btn" onclick="toggleSide()">â˜°</div>
</header>

<div class="sidebar" id="sidebar">
    <div style="text-align:left; font-size:30px; cursor:pointer" onclick="toggleSide()">Ã—</div>
    <h2>Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ğŸŒŸ</h2>
    <div class="side-item" onclick="showPop('bank')">ğŸ’³ Ø¯ÙØ¹ (Ø¨Ù†ÙƒÙƒ)</div>
    <div class="side-item" onclick="showPop('shipping')">ğŸšš Ø§Ù„ØªÙˆØµÙŠÙ„</div>
    <div class="side-item" onclick="window.location.href='admin.html'">ğŸ‘©â€ğŸ’¼ Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„ØªØ§Ø¬Ø±Ø§Øª</div>
</div>

<div class="container" id="grid">
    <p id="loading-msg" style="text-align:center; grid-column:1/-1; padding:50px; color:#888">Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª... âœ¨</p>
</div>

<div class="overlay" id="overlay" onclick="closePop()">
    <div class="modal" onclick="event.stopPropagation()">
        <h3 id="popTitle" style="color:var(--gold)"></h3>
        <div id="popContent" style="margin:15px 0"></div>
        <button class="btn-wa" onclick="closePop()">Ù…ÙˆØ§ÙÙ‚</button>
    </div>
</div>

<script>
// Ø¥Ø¶Ø§ÙØ© timestamp Ù„Ù…Ù†Ø¹ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø¤Ù‚Øª (Cache) ÙˆØ¶Ù…Ø§Ù† Ø¸Ù‡ÙˆØ± Ø£Ø­Ø¯Ø« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTWD0ZQAKe2KRwLQnNjh2t7Z2Y_BKXxaKZxZwKSXUaZLQ3eeLB1fwj6vNllpNwXCtd9aY9Q_tuuFXXV/pub?output=csv&t=' + new Date().getTime();

async function fetchProducts() {
    try {
        const response = await fetch(SHEET_URL);
        const data = await response.text();
        const rows = data.split(/\r?\n/).slice(1);
        
        const products = rows.map((row, index) => {
            const cols = row.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/).map(c => c.replace(/"/g, '').trim());
            if (!cols[0] || cols[0] === "") return null;
            return {
                id: index,
                name: cols[0],
                price: cols[1],
                store: cols[2],
                images: cols[3] ? cols[3].split(' ') : [],
                whatsapp: cols[4]
            };
        }).filter(p => p);

        if (products.length === 0) {
            document.getElementById('grid').innerHTML = "<p style='text-align:center; grid-column:1/-1; padding:50px;'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹.</p>";
        } else {
            renderProducts(products);
        }
    } catch (error) {
        document.getElementById('grid').innerHTML = "<p style='text-align:center; grid-column:1/-1; padding:50px;'>Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.</p>";
    }
}

function renderProducts(list) {
    const grid = document.getElementById('grid');
    grid.innerHTML = list.map(p => {
        const dots = p.images.map((_, i) => `<div class="dot ${i === 0 ? 'active' : ''}"></div>`).join('');
        return `
        <div class="card" data-idx="0">
            <div class="slider-box">
                <div class="track">${p.images.map(img => `<img src="${img}" alt="product">`).join('')}</div>
                ${p.images.length > 1 ? `
                    <button class="nav-btn" style="left:5px" onclick="move(this, -1)">â®</button>
                    <button class="nav-btn" style="right:5px" onclick="move(this, 1)">â¯</button>
                    <div class="dots">${dots}</div>
                ` : ''}
            </div>
            <div class="info">
                <span class="store-tag">âœ¨ ${p.store}</span>
                <div class="title">${p.name}</div>
                <div class="price">${p.price} SDG</div>
                <a class="btn-wa" target="_blank" href="https://wa.me/${p.whatsapp.replace(/\s/g,'')}?text=Ø·Ù„Ø¨: ${p.name}">Ø·Ù„Ø¨ ÙˆØ§ØªØ³Ø§Ø¨ âœ…</a>
            </div>
        </div>`;
    }).join('');
}

function move(btn, dir) {
    const card = btn.closest('.card');
    const track = card.querySelector('.track');
    const dots = card.querySelectorAll('.dot');
    const total = track.children.length;
    let idx = (parseInt(card.dataset.idx) + dir + total) % total;
    card.dataset.idx = idx;
    track.style.transform = `translateX(-${idx * 100}%)`;
    if (dots.length) {
        dots.forEach(d => d.classList.remove('active'));
        dots[idx].classList.add('active');
    }
}

function toggleSide() { document.getElementById('sidebar').classList.toggle('open'); }
function closePop() { document.getElementById('overlay').style.display = 'none'; }

function showPop(type) {
    toggleSide();
    const overlay = document.getElementById('overlay');
    const title = document.getElementById('popTitle');
    const content = document.getElementById('popContent');
    overlay.style.display = 'flex';

    if (type === 'bank') {
        title.innerText = "ğŸ’³ Ø§Ù„Ø¯ÙØ¹ (Ø¨Ù†ÙƒÙƒ)";
        content.innerHTML = "ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù„Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„ØªØ§Ù„ÙŠ:<br><strong style='font-size:22px'>2280384</strong><br>Ø§Ù„Ø§Ø³Ù…: ÙÙŠØ±Ø§ Ù…ÙˆÙ„";
    } else if (type === 'shipping') {
        title.innerText = "ğŸšš Ø§Ù„ØªÙˆØµÙŠÙ„";
        content.innerHTML = "Ø§Ù„ØªÙˆØµÙŠÙ„ Ù…ØªÙˆÙØ± Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª ÙˆÙŠØ­Ø¯Ø¯ Ø§Ù„Ø³Ø¹Ø± Ø¹Ù†Ø¯ Ø§Ù„Ø·Ù„Ø¨.";
    }
}

fetchProducts();
</script>
</body>
</html>
