<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VIRA MALL | ÙÙŠØ±Ø§ Ù…ÙˆÙ„</title>
<style>
:root{--gold:#D4AF37;--dark:#0f1111;--gray:#f5f5f7;--white:#fff;--red:#e41e31}
body{margin:0;font-family:'Segoe UI',Tahoma;background:var(--gray);direction:rtl;overflow-x:hidden}

/* Ø§Ù„Ù‡ÙŠØ¯Ø± */
header{background:var(--dark);color:white;padding:15px;text-align:center;position:sticky;top:0;z-index:1000;border-bottom:3px solid var(--gold);display:flex;justify-content:space-between;align-items:center}
header h1{margin:0;color:var(--gold);font-size:22px;flex-grow:1}
.menu-btn{font-size:30px;cursor:pointer;color:var(--gold);padding:0 10px}

/* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© */
.sidebar{position:fixed;top:0;right:-300px;width:280px;height:100%;background:var(--dark);z-index:2000;transition:0.3s;color:white;padding:25px;box-shadow:-5px 0 15px rgba(0,0,0,0.5)}
.sidebar.open{right:0}
.sidebar h2{color:var(--gold);border-bottom:1px solid #333;padding-bottom:10px}
.side-item{padding:15px 0;border-bottom:1px solid #222;cursor:pointer;display:flex;align-items:center;gap:10px}

/* Ø´Ø¨ÙƒØ© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª */
.container{padding:15px;display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:15px;max-width:1200px;margin:auto}
.card{background:white;border-radius:15px;overflow:hidden;box-shadow:0 4px 12px rgba(0,0,0,.08);position:relative;display:flex;flex-direction:column}

/* Ø§Ù„Ø³Ù„Ø§ÙŠØ¯Ø± Ø§Ù„Ø²ÙŠØª */
.slider{position:relative;height:220px;overflow:hidden;direction:ltr!important;background:#f0f0f0}
.track{display:flex;height:100%;transition:transform 0.5s ease-in-out}
.track img{min-width:100%;width:100%;height:100%;object-fit:cover}
.nav-btn{position:absolute;top:50%;transform:translateY(-50%);width:30px;height:30px;border-radius:50%;background:rgba(0,0,0,.5);color:white;border:none;z-index:10;cursor:pointer;font-weight:bold}
.dots{position:absolute;bottom:10px;left:50%;transform:translateX(-50%);display:flex;gap:5px}
.dot{width:7px;height:7px;border-radius:50%;background:rgba(255,255,255,0.5)}
.dot.active{background:var(--gold);width:15px;border-radius:10px}

.info{padding:12px;text-align:center;direction:rtl}
.store{font-size:11px;color:var(--gold);font-weight:bold}
.title{font-size:14px;font-weight:bold;height:38px;overflow:hidden;margin:5px 0}
.price{font-size:17px;font-weight:900;color:var(--dark)}
.btn-wa{background:var(--gold);color:var(--dark);border:none;padding:12px;border-radius:10px;font-weight:bold;width:100%;cursor:pointer;margin-top:10px;text-decoration:none;display:block}

/* Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,0.85);display:none;z-index:3000;align-items:center;justify-content:center}
.modal{background:white;padding:25px;border-radius:20px;width:80%;max-width:350px;text-align:center;color:black}
</style>
</head>
<body>

<header>
    <div style="width:40px"></div>
    <h1>VIRA MALL</h1>
    <div class="menu-btn" onclick="toggleSide()">â˜°</div>
</header>

<div class="sidebar" id="sidebar">
    <div style="text-align:left; font-size:30px; cursor:pointer" onclick="toggleSide()">Ã—</div>
    <h2>Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ğŸŒ¸</h2>
    <div class="side-item" onclick="showModal('bank')">ğŸ’³ Ø¯ÙØ¹ (Ø¨Ù†ÙƒÙƒ)</div>
    <div class="side-item" onclick="showModal('shipping')">ğŸšš Ø§Ù„ØªÙˆØµÙŠÙ„</div>
    <div class="side-item" onclick="window.location.href='admin.html'">ğŸ‘©â€ğŸ’¼ Ø§Ù„ØªØ§Ø¬Ø±Ø§Øª</div>
</div>

<div class="container" id="grid">
    <p style="text-align:center; grid-column:1/-1; padding:50px;">Ø¬Ø§Ø±ÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ØªØ¬Ø±... âœ¨</p>
</div>

<div class="overlay" id="overlay" onclick="closeModal()">
    <div class="modal" onclick="event.stopPropagation()">
        <h3 id="mTitle" style="color:var(--gold)"></h3>
        <div id="mContent" style="margin:15px 0"></div>
        <button class="btn-wa" onclick="closeModal()">ÙÙ‡Ù…Øª</button>
    </div>
</div>

<script>
const URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTWD0ZQAKe2KRwLQnNjh2t7Z2Y_BKXxaKZxZwKSXUaZLQ3eeLB1fwj6vNllpNwXCtd9aY9Q_tuuFXXV/pub?output=csv';

async function loadProducts() {
    try {
        const res = await fetch(URL + '&t=' + Date.now());
        const text = await res.text();
        const rows = text.split(/\r?\n/).slice(1);
        
        const products = rows.map(row => {
            // ØªÙ‚Ø³ÙŠÙ… Ø°ÙƒÙŠ ÙŠØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„ÙÙˆØ§ØµÙ„ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù†ØµÙˆØµ
            const c = row.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/).map(v => v.replace(/"/g, '').trim());
            if (!c[0]) return null;
            // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØµÙˆØ± (Ù„Ùˆ Ù…ÙØµÙˆÙ„Ø© Ø¨Ù…Ø³Ø§ÙØ© Ø£Ùˆ Ø³Ø·Ø±)
            const imgs = c[3] ? c[3].split(/[\s\n]+/).filter(link => link.includes('http')) : [];
            return { name: c[0], price: c[1], store: c[2], images: imgs, wa: c[4] };
        }).filter(p => p);

        render(products);
    } catch (e) {
        document.getElementById('grid').innerHTML = "Ø­Ø¯Ø« Ø®Ø·Ø£ØŒ ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©.";
    }
}

function render(list) {
    const grid = document.getElementById('grid');
    if(list.length === 0) { grid.innerHTML = "Ø§Ù„Ù…ØªØ¬Ø± ÙØ§Ø±Øº Ø­Ø§Ù„ÙŠØ§Ù‹."; return; }
    
    grid.innerHTML = list.map((p, pIdx) => {
        const dots = p.images.map((_, i) => `<div class="dot ${i === 0 ? 'active' : ''}"></div>`).join('');
        return `
        <div class="card" id="card-${pIdx}" data-i="0">
            <div class="slider">
                <div class="track">${p.images.map(img => `<img src="${img}">`).join('')}</div>
                ${p.images.length > 1 ? `
                    <button class="nav-btn" style="left:5px" onclick="goSlide(${pIdx}, -1)">â®</button>
                    <button class="nav-btn" style="right:5px" onclick="goSlide(${pIdx}, 1)">â¯</button>
                    <div class="dots">${dots}</div>
                ` : ''}
            </div>
            <div class="info">
                <span class="store">âœ¨ ${p.store}</span>
                <div class="title">${p.name}</div>
                <div class="price">${p.price} SDG</div>
                <a class="btn-wa" href="https://wa.me/${p.wa}?text=Ø·Ù„Ø¨: ${p.name}" target="_blank">Ø·Ù„Ø¨ ÙˆØ§ØªØ³Ø§Ø¨ âœ…</a>
            </div>
        </div>`;
    }).join('');
}

function goSlide(pIdx, dir) {
    const card = document.getElementById(`card-${pIdx}`);
    const track = card.querySelector('.track');
    const dots = card.querySelectorAll('.dot');
    const total = track.children.length;
    let i = (parseInt(card.dataset.i) + dir + total) % total;
    card.dataset.i = i;
    track.style.transform = `translateX(-${i * 100}%)`;
    dots.forEach((d, idx) => d.classList.toggle('active', idx === i));
}

function toggleSide() { document.getElementById('sidebar').classList.toggle('open'); }
function closeModal() { document.getElementById('overlay').style.display = 'none'; }

function showModal(type) {
    toggleSide();
    const overlay = document.getElementById('overlay');
    overlay.style.display = 'flex';
    if(type === 'bank') {
        document.getElementById('mTitle').innerText = "ğŸ’³ Ø¨Ù†ÙƒÙƒ";
        document.getElementById('mContent').innerHTML = "Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨: <br><strong>2280384</strong><br>Ø§Ù„Ø§Ø³Ù…: ÙÙŠØ±Ø§ Ù…ÙˆÙ„";
    } else {
        document.getElementById('mTitle').innerText = "ğŸšš Ø§Ù„ØªÙˆØµÙŠÙ„";
        document.getElementById('mContent').innerText = "ØªÙˆØµÙŠÙ„ Ø³Ø±ÙŠØ¹ Ù„ÙƒÙ„ ÙˆÙ„Ø§ÙŠØ§Øª Ø§Ù„Ø³ÙˆØ¯Ø§Ù†.";
    }
}

loadProducts();
</script>
</body>
</html>
