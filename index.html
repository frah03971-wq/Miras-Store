<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VIRA | GHOST PROTOCOL</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@200;400;700;900&family=Cinzel+Decorative:wght@700&display=swap');
        
        :root {
            --gold: #D4AF37; --deep-black: #020202; --glass: rgba(255,255,255,0.03); --glow: 0 0 20px rgba(212,175,55,0.3);
        }

        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        body { background: var(--deep-black); color: #fff; font-family: 'Cairo', sans-serif; margin: 0; overflow-x: hidden; }

        /* Splash Screen - Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ù„ÙˆÙƒ */
        #vira-init {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000;
            z-index: 10000; display: flex; justify-content: center; align-items: center; transition: 1.5s cubic-bezier(1,0,0,1);
        }
        .v-anim { font-family: 'Cinzel Decorative', serif; font-size: 50px; color: var(--gold); letter-spacing: 15px; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; filter: blur(0); } 50% { opacity: 0.3; filter: blur(5px); } }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ø²Ø¬Ø§Ø¬ÙŠ */
        .v-header {
            position: sticky; top: 0; z-index: 9000; background: rgba(0,0,0,0.8);
            backdrop-filter: blur(30px); padding: 25px; text-align: center; border-bottom: 1px solid var(--glass);
        }
        .v-header h1 { font-family: 'Cinzel Decorative', serif; margin: 0; color: var(--gold); letter-spacing: 8px; font-size: 30px; text-shadow: var(--glow); }

        /* Ø´Ø¨ÙƒØ© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø£Ø³Ø·ÙˆØ±ÙŠØ© */
        .v-container { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; padding: 20px; }
        .v-card {
            background: #080808; border-radius: 40px; overflow: hidden; border: 1px solid #111;
            transition: 0.6s cubic-bezier(0.165, 0.84, 0.44, 1); position: relative;
        }
        .v-card:hover { transform: translateY(-15px); border-color: var(--gold); box-shadow: var(--glow); }
        .v-img { width: 100%; height: 260px; object-fit: cover; transition: 0.8s; cursor: crosshair; }
        .v-card:hover .v-img { transform: scale(1.1); filter: brightness(1.1); }

        .v-badge { position: absolute; top: 20px; left: 20px; background: var(--gold); color: #000; padding: 5px 15px; border-radius: 12px; font-weight: 900; font-size: 12px; z-index: 10; }
        .v-info { padding: 20px; text-align: center; }
        .v-store { font-size: 9px; color: var(--gold); letter-spacing: 3px; font-weight: 900; opacity: 0.6; margin-bottom: 10px; display: block; }
        .v-title { font-size: 14px; font-weight: 600; min-height: 40px; margin-bottom: 15px; }

        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ù„ÙƒÙŠØ© */
        .v-btn {
            background: linear-gradient(135deg, #111, #000); border: 1px solid var(--gold); color: var(--gold);
            padding: 12px; width: 100%; border-radius: 18px; font-weight: 900; cursor: pointer; transition: 0.4s;
        }
        .v-btn:hover { background: var(--gold); color: #000; box-shadow: var(--glow); }

        /* Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„ØªØ§Ø¬Ø± - Ø§Ù„Ø³Ø­Ø± Ù‡Ù†Ø§ */
        .v-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 9500; overflow-y: auto; padding: 40px 20px; }
        .v-form-box { background: #080808; padding: 30px; border-radius: 40px; border: 1px solid #1a1a1a; max-width: 500px; margin: 0 auto; }
        input, select { width: 100%; background: #111; border: 1px solid #222; padding: 18px; border-radius: 15px; color: #fff; margin-bottom: 15px; font-family: 'Cairo'; }
        
        /* Ø§Ù„Ø³Ù„Ø© */
        .v-cart-ui { display: none; position: fixed; bottom: 0; left: 0; width: 100%; background: #080808; border-radius: 50px 50px 0 0; z-index: 9100; padding: 40px 25px; border-top: 2px solid var(--gold); box-shadow: 0 -20px 50px rgba(0,0,0,0.5); }
        .cart-item { display: flex; justify-content: space-between; padding: 15px; background: #111; border-radius: 20px; margin-bottom: 10px; border-right: 3px solid var(--gold); }

        /* Ù†Ø§Ù Ø¨Ø§Ø± */
        .v-nav {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); width: 80%;
            background: rgba(255,255,255,0.05); backdrop-filter: blur(25px); border-radius: 100px;
            display: flex; justify-content: space-around; padding: 18px; border: 1px solid var(--glass); z-index: 9200;
        }
        .nav-icon { font-size: 24px; cursor: pointer; transition: 0.3s; opacity: 0.4; }
        .nav-icon.active { opacity: 1; color: var(--gold); transform: scale(1.3); }
    </style>
</head>
<body>

<div id="vira-init"><div class="v-anim">VIRA</div></div>

<div id="merchantGate" class="v-modal">
    <div class="v-form-box">
        <h2 style="color:var(--gold); text-align:center;">Ø¨ÙˆØ§Ø¨Ø© Ø§Ù†Ø¶Ù…Ø§Ù… Ø§Ù„ØªØ§Ø¬Ø± ğŸ‘‘</h2>
        <p style="text-align:center; font-size:12px; color:#777;">Ù„ØªÙØ¹ÙŠÙ„ Ù…ØªØ¬Ø±ÙƒØŒ ÙŠØ±Ø¬Ù‰ ØªØ­ÙˆÙŠÙ„ Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙØ¹ÙŠÙ„ (30,000 SDG) Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†ÙƒÙƒ Ø£Ø¯Ù†Ø§Ù‡:</p>
        <div style="background:var(--gold); color:#000; padding:15px; border-radius:15px; text-align:center; font-weight:900; margin-bottom:20px;">
            Ø­Ø³Ø§Ø¨ Ø¨Ù†ÙƒÙƒ: 1234567 <br> Ø¨Ø§Ø³Ù…: Ø¥Ø¯Ø§Ø±Ø© VIRA MALL
        </div>
        <input type="text" id="mName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø±">
        <input type="text" id="mPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨">
        <p style="font-size:12px; margin-bottom:5px;">Ø§Ø±ÙÙ‚ ØµÙˆØ±Ø© Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„ØªØ­ÙˆÙŠÙ„:</p>
        <input type="file" id="mProof" accept="image/*">
        <button class="v-btn" onclick="submitMerchant()">Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„ØªÙØ¹ÙŠÙ„ Ù„Ù„Ù‡ÙƒØ±</button>
        <button onclick="closeModal('merchantGate')" style="width:100%; background:none; border:none; color:red; margin-top:15px;">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
</div>

<header class="v-header"><h1>VIRA</h1></header>

<div class="v-container" id="grid"></div>

<div id="cartUI" class="v-cart-ui">
    <h2 style="color:var(--gold); text-align:center;">Ø­Ù‚ÙŠØ¨Ø© Ø§Ù„Ù…Ù‚ØªÙ†ÙŠØ§Øª</h2>
    <div id="cartItems"></div>
    <div style="text-align:center; padding:20px;">
        <h1 id="totalPrice">0 SDG</h1>
        <button class="v-btn" style="padding:20px;" onclick="checkout()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ ÙˆØ§ØªØ³Ø§Ø¨</button>
    </div>
    <button onclick="closeModal('cartUI')" style="width:100%; background:none; border:none; color:#555;">Ø±Ø¬ÙˆØ¹</button>
</div>

<nav class="v-nav">
    <div class="nav-icon active" onclick="location.reload()">ğŸ </div>
    <div class="nav-icon" onclick="openModal('cartUI')">ğŸ›’</div>
    <div class="nav-icon" onclick="openModal('merchantGate')">ğŸ‘‘</div>
</nav>

<script>
    const S_ID = '1UZnlp45dVMRJxNibcg3fm52H6S4DB4YbGLr4KK3jPqs';
    let database = []; let cart = [];

    // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù€ Splash
    setTimeout(() => { document.getElementById('vira-init').style.transform = 'translateY(-100%)'; }, 2000);

    async function viraCore() {
        const [r1, r2] = await Promise.all([
            fetch(`https://docs.google.com/spreadsheets/d/${S_ID}/export?format=csv&gid=0`),
            fetch(`https://docs.google.com/spreadsheets/d/${S_ID}/export?format=csv&gid=1152504859`)
        ]);
        const d1 = await r1.text(); const d2 = await r2.text();
        
        const parse = (csv, isV) => {
            const rows = csv.split('\n').map(l => l.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/));
            const h = rows[0].map(x => x.replace(/"/g,'').trim());
            return rows.slice(1).map(c => {
                const f = (k) => { const i = h.findIndex(x => x.includes(k)); return i!==-1?c[i]?.replace(/"/g,'').trim():''; };
                return isV ? { n: c[0], p: c[1], s: c[2]||'VIRA', img: c[3] } :
                { s: f('Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø±')||'Ù…ØªØ¬Ø± Ø´Ø±ÙŠÙƒ', n: f('Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬'), p: f('Ø§Ù„Ø³Ø¹Ø±'), img: f('Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©') };
            }).filter(p => p.n && p.img);
        };
        database = [...parse(d1, true), ...parse(d2, false)];
        render(database);
    }

    function render(data) {
        document.getElementById('grid').innerHTML = data.map((p, i) => `
            <div class="v-card">
                <div class="v-badge">${p.p}</div>
                <img src="${p.img.split(';')[0]}" class="v-img" loading="lazy">
                <div class="v-info">
                    <span class="v-store">${p.s}</span>
                    <div class="v-title">${p.n}</div>
                    <button class="v-btn" onclick="add('${i}')">Ø§Ù‚ØªÙ†Ø§Ø¡</button>
                </div>
            </div>
        `).join('');
    }

    function add(idx) {
        cart.push(database[idx]);
        updateCart();
        alert('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù‚Ø·Ø¹Ø© Ù„Ù…Ø¬Ù…ÙˆØ¹ØªÙƒ âœ¨');
    }

    function updateCart() {
        document.getElementById('cartItems').innerHTML = cart.map((i, x) => `
            <div class="cart-item">
                <span>${i.n}</span>
                <span onclick="cart.splice(${x},1);updateCart();" style="color:red;">Ã—</span>
            </div>
        `).join('');
        const total = cart.reduce((a,i) => a + parseInt(i.p.replace(/[^0-9]/g,'')||0), 0);
        document.getElementById('totalPrice').innerText = `${total.toLocaleString()} SDG`;
    }

    function submitMerchant() {
        const name = document.getElementById('mName').value;
        const phone = document.getElementById('mPhone').value;
        if(!name || !phone) return alert('Ø§Ù…Ù„Ø£ÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙŠØ§ Ù…Ù„ÙƒØ©');
        const msg = encodeURIComponent(`Ø·Ù„Ø¨ Ø§Ù†Ø¶Ù…Ø§Ù… ØªØ§Ø¬Ø± Ø¬Ø¯ÙŠØ¯ ğŸ‘‘\n\nØ§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø±: ${name}\nØ§Ù„ÙˆØ§ØªØ³Ø§Ø¨: ${phone}\n\n*Ù…Ø±ÙÙ‚ ØµÙˆØ±Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± (ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª)*`);
        window.open(`https://wa.me/249967584275?text=${msg}`);
    }

    function checkout() {
        if(!cart.length) return;
        const msg = encodeURIComponent(`Ø·Ù„Ø¨ Ù…Ù‚ØªÙ†ÙŠØ§Øª VIRA ğŸ‘‘\n\n${cart.map(i=>`â€¢ ${i.n} [${i.s}]`).join('\n')}\n\nØ§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${document.getElementById('totalPrice').innerText}`);
        window.open(`https://wa.me/249967584275?text=${msg}`);
    }

    function openModal(id) { document.getElementById(id).style.display = 'block'; }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }

    viraCore();
</script>
</body>
</html>
