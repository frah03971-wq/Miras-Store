<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VIRA MALL | ÙÙŠØ±Ø§ Ù…ÙˆÙ„</title>
    <style>
        :root { --gold: #D4AF37; --black: #0a0a0a; --soft-bg: #fdfdfd; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--soft-bg); color: var(--black); overflow-x: hidden; }
        
        /* Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ù…Ù„ÙƒÙŠ */
        header { background: var(--black); padding: 12px 20px; position: sticky; top: 0; z-index: 2000; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
        .logo-area { text-align: center; }
        header h1 { color: var(--gold); margin: 0; font-size: 20px; font-weight: 900; letter-spacing: 1.5px; }
        .slogan { color: #eee; font-size: 10px; font-weight: 300; }

        /* Ø§Ù„Ø´Ø¨ÙƒØ© Ø§Ù„Ø£Ù†ÙŠÙ‚Ø© */
        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; padding: 12px; }
        .card { background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.04); position: relative; border: 1px solid #f0f0f0; transition: 0.3s; }
        
        /* Ø³Ù„Ø§ÙŠØ¯Ø± Ø´ÙŠ Ø¥Ù† Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ */
        .slider-container { position: relative; width: 100%; aspect-ratio: 3/4; overflow: hidden; background: #f9f9f9; }
        .track { display: flex; height: 100%; transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94); }
        .track img { min-width: 100%; height: 100%; object-fit: cover; }
        
        /* Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØµÙˆØ± (1/3) */
        .img-counter { position: absolute; bottom: 10px; right: 10px; background: rgba(0,0,0,0.4); color: white; padding: 2px 8px; border-radius: 10px; font-size: 10px; z-index: 10; font-family: monospace; }
        
        /* Ø§Ù„Ù…ÙØ¶Ù„Ø© (Ø§Ù„Ù‚Ù„Ø¨) */
        .fav-btn { position: absolute; top: 10px; left: 10px; font-size: 22px; color: rgba(255,255,255,0.9); z-index: 15; cursor: pointer; text-shadow: 0 0 5px rgba(0,0,0,0.3); transition: 0.3s; }
        .fav-btn.active { color: #ff4757; }

        .info { padding: 12px 8px; text-align: center; }
        .title { font-size: 12px; color: #444; height: 32px; overflow: hidden; margin-bottom: 8px; line-height: 1.3; }
        .price { font-size: 16px; font-weight: 900; color: var(--black); margin-bottom: 10px; }
        
        /* Ø²Ø± Ø§Ù„Ø³Ù„Ø© Ø§Ù„Ø¬Ø°Ø§Ø¨ */
        .btn-add { background: var(--black); color: white; width: 100%; padding: 10px; border: none; border-radius: 10px; font-size: 12px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .btn-add:active { transform: scale(0.95); background: var(--gold); }

        /* Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© */
        .side-panel { position: fixed; top: 0; right: -100%; width: 300px; height: 100%; background: white; z-index: 3000; transition: 0.4s; padding: 30px 20px; box-shadow: -10px 0 30px rgba(0,0,0,0.1); }
        .side-panel.active { right: 0; }
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 2500; display: none; backdrop-filter: blur(4px); }
        
        /* ÙƒØ±Øª Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ (Ø²ÙŠ Ù…Ø§ Ø¨ØªØ­Ø¨ÙŠ) */
        .sub-card { background: #fff9e6; border: 1px dashed var(--gold); padding: 15px; border-radius: 15px; text-align: center; margin-top: 20px; }
    </style>
</head>
<body>

<div class="overlay" id="overlay" onclick="closeAll()"></div>

<header>
    <div onclick="togglePanel('menuPanel')" style="color:var(--gold); font-size:26px; cursor:pointer;">â˜°</div>
    <div class="logo-area">
        <h1>VIRA MALL</h1>
        <span class="slogan">Ø®ÙŠÙ€Ø§Ø±Ùƒ Ø§Ù„Ø£ÙˆÙ„ ÙÙŠ Ø§Ù„Ø³Ù€ÙˆØ¯Ø§Ù†</span>
    </div>
    <div onclick="togglePanel('cartPanel')" style="color:var(--gold); font-size:24px; cursor:pointer; position:relative;">
        ğŸ›’ <span id="badge" style="position:absolute; top:-5px; right:-8px; background:#ff4757; color:white; font-size:10px; padding:2px 5px; border-radius:10px; display:none;">0</span>
    </div>
</header>

<div class="grid" id="mainGrid">
    <p style="grid-column: span 2; text-align:center; padding:50px; color:var(--gold);">Ø¨Ù†Ø¬ÙŠØ¨ Ù„ÙŠÙƒ ÙÙŠ Ø§Ù„Ø³Ù…Ø­... âœ¨</p>
</div>

<div class="side-panel" id="cartPanel">
    <h2 style="border-bottom: 2px solid var(--gold); padding-bottom: 10px;">ğŸ›’ Ø³Ù„ØªÙŠ</h2>
    <div id="cartItems" style="margin-top:20px;"></div>
    <button class="btn-add" style="margin-top:30px; background:var(--gold); color:black;" onclick="sendOrder()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ ÙˆØ§ØªØ³Ø§Ø¨ âœ…</button>
</div>

<div class="side-panel" id="menuPanel">
    <h2 style="color:var(--gold)">VIRA MALL</h2>
    <div style="margin:25px 0;">
        <p>ğŸ’° <b>Ø§Ù„Ø¹Ù…Ù„Ø©:</b> 
            <select id="curSelect" onchange="render(allProducts)" style="padding:5px; border-radius:5px;">
                <option value="SDG">SDG (Ø³ÙˆØ¯Ø§Ù†ÙŠ)</option>
                <option value="SAR">SAR (Ø³Ø¹ÙˆØ¯ÙŠ)</option>
            </select>
        </p>
    </div>
    <hr>
    <div class="sub-card">
        <strong>Ø±Ø³ÙˆÙ… Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ù„Ù„ØªØ§Ø¬Ø±Ø§Øª</strong>
        <p style="color:var(--gold); font-size:18px; font-weight:900; margin:10px 0;">30,000 SDG</p>
        <small>Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ (Ø¨Ù†ÙƒÙƒ):</small><br>
        <b style="font-size:18px;">2280384</b>
    </div>
</div>

<script>
    const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTWD0ZQAKe2KRwLQnNjh2t7Z2Y_BKXxaKZxZwKSXUaZLQ3eeLB1fwj6vNllpNwXCtd9aY9Q_tuuFXXV/pub?gid=0&single=true&output=csv';
    let allProducts = [];
    let cart = [];

    async function load() {
        try {
            const res = await fetch(CSV_URL + '&v=' + Date.now());
            const text = await res.text();
            const rows = text.split('\n').slice(1);
            allProducts = rows.map((r, i) => {
                const c = r.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/).map(v => v.replace(/"/g, '').trim());
                if(!c[0]) return null;
                return { id: i, name: c[0], price: c[1], store: c[2], imgs: c[3].split(/\s+/), wa: c[4] };
            }).filter(p => p);
            render(allProducts);
        } catch (e) { alert("ØªØ£ÙƒØ¯ÙŠ Ù…Ù† Ø±Ø§Ø¨Ø· Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙŠØ§ Ù‚Ù„Ø¨ÙŠ"); }
    }

    function render(data) {
        const cur = document.getElementById('curSelect').value;
        const grid = document.getElementById('mainGrid');
        grid.innerHTML = data.map(p => `
            <div class="card" id="card-${p.id}" data-idx="0">
                <div class="fav-btn" onclick="this.classList.toggle('active')">â¤</div>
                <div class="slider-container" ontouchstart="sT(event)" ontouchmove="mT(event, ${p.id})">
                    <div class="track" style="transform:translateX(0px)">${p.imgs.map(img => `<img src="${img}" ondblclick="this.requestFullscreen()">`).join('')}</div>
                    ${p.imgs.length > 1 ? `<div class="img-counter"><span class="idx">1</span>/${p.imgs.length}</div>` : ''}
                </div>
                <div class="info">
                    <div class="title">${p.name}</div>
                    <div class="price">${p.price} ${cur}</div>
                    <button class="btn-add" onclick="addToCart(${p.id})">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø© ğŸ›’</button>
                </div>
            </div>
        `).join('');
    }

    // Ø³Ù„Ø§ÙŠØ¯Ø± Ø­Ù†ÙŠÙ† ÙˆØ³Ù„Ø³ (ÙŠÙ…ÙŠÙ† ÙˆØ´Ù…Ø§Ù„)
    let startX = 0;
    function sT(e) { startX = e.touches[0].clientX; }
    function mT(e, id) {
        if(!startX) return;
        let diff = startX - e.touches[0].clientX;
        if(Math.abs(diff) > 40) {
            let card = document.getElementById(`card-${id}`);
            let track = card.querySelector('.track');
            let counter = card.querySelector('.idx');
            let idx = parseInt(card.dataset.idx);
            if(diff > 0 && idx < track.children.length - 1) idx++;
            else if(diff < 0 && idx > 0) idx--;
            card.dataset.idx = idx;
            track.style.transform = `translateX(${idx * 100}%)`;
            if(counter) counter.innerText = idx + 1;
            startX = 0;
        }
    }

    function addToCart(id) {
        cart.push(allProducts[id]);
        document.getElementById('badge').innerText = cart.length;
        document.getElementById('badge').style.display = 'block';
        updateCartUI();
    }

    function updateCartUI() {
        const list = document.getElementById('cartItems');
        list.innerHTML = cart.map(i => `<div style="padding:10px; border-bottom:1px solid #eee; font-size:12px;">â–«ï¸ ${i.name} (${i.price})</div>`).join('');
    }

    function togglePanel(id) { document.getElementById(id).classList.add('active'); document.getElementById('overlay').style.display = 'block'; }
    function closeAll() { document.querySelectorAll('.side-panel').forEach(p => p.classList.remove('active')); document.getElementById('overlay').style.display = 'none'; }
    
    load();
</script>
</body>
</html>
