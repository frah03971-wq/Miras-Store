<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VIRA OS | GLOBAL LUXURY</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@200;500;900&family=Cinzel:wght@700&display=swap');
        
        :root {
            --vira-gold: #D4AF37;
            --vira-black: #050505;
            --accent: #ffffff;
            --glass: rgba(255, 255, 255, 0.05);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background: var(--vira-black); color: var(--accent); font-family: 'Cairo', sans-serif; margin: 0; overflow-x: hidden; scroll-behavior: smooth; }

        /* Ø§Ù„Ø£Ù†Ù…ÙŠØ´Ù† Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ */
        @keyframes viraGlow { 0% { box-shadow: 0 0 5px var(--vira-gold); } 50% { box-shadow: 0 0 20px var(--vira-gold); } 100% { box-shadow: 0 0 5px var(--vira-gold); } }
        
        /* Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠ */
        header {
            height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center;
            background: radial-gradient(circle, #1a1a1a 0%, #000 100%); position: relative;
        }
        .v-logo { font-family: 'Cinzel', serif; font-size: 80px; color: var(--vira-gold); letter-spacing: 15px; animation: viraGlow 3s infinite; text-shadow: 0 0 30px var(--vira-gold); }
        .v-scroll { position: absolute; bottom: 30px; font-size: 12px; letter-spacing: 5px; opacity: 0.5; animation: bounce 2s infinite; }
        @keyframes bounce { 0%, 20%, 50%, 80%, 100% {transform: translateY(0);} 40% {transform: translateY(-10px);} 60% {transform: translateY(-5px);} }

        /* Ù…Ø­Ø±Ùƒ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù‡ÙƒØ± */
        .search-vault {
            position: sticky; top: 0; z-index: 5000; background: rgba(0,0,0,0.8); backdrop-filter: blur(20px);
            padding: 20px; display: flex; gap: 10px; border-bottom: 1px solid var(--glass);
        }
        .search-vault input {
            flex: 1; background: #111; border: 1px solid #333; padding: 15px 25px; border-radius: 50px;
            color: #fff; font-family: 'Cairo'; transition: 0.4s;
        }
        .search-vault input:focus { border-color: var(--vira-gold); background: #000; }

        /* Ø§Ù„Ø´Ø¨ÙƒØ© Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ© */
        .master-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; padding: 20px; }
        
        .luxury-item {
            background: #0d0d0d; border-radius: 35px; overflow: hidden; position: relative;
            border: 1px solid #1a1a1a; transition: 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .luxury-item:hover { transform: scale(1.03); border-color: var(--vira-gold); z-index: 10; }
        
        .img-engine { width: 100%; height: 250px; position: relative; cursor: zoom-in; }
        .img-engine img { width: 100%; height: 100%; object-fit: cover; }
        
        .floating-price {
            position: absolute; top: 20px; right: 20px; background: rgba(0,0,0,0.8);
            backdrop-filter: blur(10px); color: var(--vira-gold); padding: 5px 15px;
            border-radius: 50px; border: 1px solid var(--vira-gold); font-weight: 900; font-size: 12px;
        }

        .meta-content { padding: 20px; text-align: center; }
        .merchant-id { font-size: 10px; color: var(--vira-gold); letter-spacing: 3px; font-weight: 900; opacity: 0.7; }
        .item-title { font-size: 15px; font-weight: 500; margin: 10px 0; min-height: 45px; }

        .btn-action {
            background: linear-gradient(45deg, #000, #1a1a1a); color: var(--vira-gold);
            border: 1px solid var(--vira-gold); width: 100%; padding: 12px; border-radius: 20px;
            font-weight: 900; cursor: pointer; transition: 0.3s;
        }
        .btn-action:hover { background: var(--vira-gold); color: #000; box-shadow: 0 0 20px var(--vira-gold); }

        /* Ù…Ø³Ø±Ø­ Ø§Ù„Ø¹Ø±Ø¶ V-VISION */
        #v-vision {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 9999; flex-direction: column; align-items: center;
        }
        .vision-display { width: 100%; height: 80vh; position: relative; overflow: hidden; }
        .vision-img { width: 100%; height: 100%; object-fit: contain; transition: 0.1s; }
        .vision-controls { display: flex; gap: 30px; margin-top: 20px; }
        .v-btn { background: var(--vira-gold); border: none; padding: 15px 40px; border-radius: 50px; font-weight: 900; }

        /* Ø§Ù„Ø³Ù„Ø© Ø§Ù„Ù‡ÙƒØ± */
        #v-cart {
            display: none; position: fixed; bottom: 0; left: 0; width: 100%; height: 85vh;
            background: #0a0a0a; border-radius: 50px 50px 0 0; z-index: 6000;
            padding: 30px; border-top: 2px solid var(--vira-gold); overflow-y: auto;
        }
        .cart-group { background: #111; border-radius: 25px; padding: 20px; margin-bottom: 20px; border-right: 4px solid var(--vira-gold); }
        .group-header { font-size: 12px; color: var(--vira-gold); margin-bottom: 15px; display: flex; justify-content: space-between; }

        /* Ø§Ù„Ù†Ø§Ù Ø¨Ø§Ø± */
        .v-nav {
            position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%);
            width: 85%; background: rgba(255,255,255,0.05); backdrop-filter: blur(25px);
            border-radius: 100px; display: flex; justify-content: space-around; padding: 15px;
            border: 1px solid var(--glass); z-index: 5500;
        }
        .v-nav-item { font-size: 24px; color: #444; transition: 0.3s; cursor: pointer; position: relative; }
        .v-nav-item.active { color: var(--vira-gold); text-shadow: 0 0 10px var(--vira-gold); }
        .cart-count { position: absolute; top: -5px; right: -10px; background: red; color: white; font-size: 10px; padding: 2px 6px; border-radius: 50%; }
    </style>
</head>
<body>

<header id="landing">
    <div class="v-logo">VIRA</div>
    <div class="v-scroll">Ø§Ø³Ø­Ø¨ÙŠ Ù„Ù„Ø£Ø¹Ù„Ù‰ Ù„Ø§Ø³ØªÙƒØ´Ø§Ù Ø§Ù„ÙØ®Ø§Ù…Ø©</div>
</header>

<div class="search-vault">
    <input type="text" id="engineSearch" placeholder="Ø§Ø¨Ø­Ø«ÙŠ ÙÙŠ Ù…Ø­Ø±Ùƒ ÙÙŠØ±Ø§ Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ..." oninput="neuralSearch()">
</div>

<div id="v-vision">
    <div class="vision-display" id="zoomBase" onmousemove="microZoom(event)" onmouseleave="microReset()">
        <img id="v-img-stage" src="" class="vision-img">
    </div>
    <div class="vision-controls">
        <button class="v-btn" onclick="closeVision()">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
</div>

<div id="v-cart">
    <h2 style="text-align:center; color:var(--vira-gold);">Ø­Ù‚ÙŠØ¨Ø© Ø§Ù„Ù…Ù‚ØªÙ†ÙŠØ§Øª Ø§Ù„Ù…Ù„ÙƒÙŠØ©</h2>
    <div id="cart-engine-list"></div>
    <div id="total-area" style="text-align:center; padding:30px;">
        <h1 id="total-sdg">0 SDG</h1>
        <p style="color:#666;">* Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„ ØªØ­Ø¯Ø¯ Ø¨Ø´ÙƒÙ„ Ù…Ù†ÙØµÙ„ Ù„ÙƒÙ„ Ù…ØªØ¬Ø± Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø¹Ø¯Ø§Ù„Ø©</p>
        <button class="btn-action" style="padding:20px; font-size:18px;" onclick="deployOrder()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</button>
    </div>
    <button onclick="toggleCart(false)" style="width:100%; background:none; border:none; color:#555; margin-bottom:50px;">Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø³Ù„Ø©</button>
</div>

<div id="grid-host" class="master-grid"></div>

<nav class="v-nav">
    <div class="v-nav-item active" onclick="location.reload()">ğŸ </div>
    <div class="v-nav-item" onclick="toggleCart(true)">ğŸ›’ <span id="v-count" class="cart-count">0</span></div>
    <div class="v-nav-item" onclick="alert('VIRA AI Stylist - Ù‚Ø±ÙŠØ¨Ø§Ù‹')">ğŸ‘—</div>
</nav>

<script>
    const SHEETS_ID = '1UZnlp45dVMRJxNibcg3fm52H6S4DB4YbGLr4KK3jPqs';
    let viraDatabase = []; let viraCart = [];

    // Ø§Ù„Ù…Ø­Ø±Ùƒ Ø§Ù„Ø°ÙƒÙŠ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Data Neural Engine)
    async function viraEngineInit() {
        const [r1, r2] = await Promise.all([
            fetch(`https://docs.google.com/spreadsheets/d/${SHEETS_ID}/export?format=csv&gid=0`),
            fetch(`https://docs.google.com/spreadsheets/d/${SHEETS_ID}/export?format=csv&gid=1152504859`)
        ]);
        const d1 = await r1.text(); const d2 = await r2.text();
        
        const brain = (csv, isRoyal) => {
            const rows = csv.split('\n').map(l => l.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/));
            const head = rows[0].map(h => h.replace(/"/g,'').trim());
            return rows.slice(1).map(c => {
                const get = (key) => { const idx = head.findIndex(h => h.includes(key)); return idx!==-1?c[idx]?.replace(/"/g,'').trim():''; };
                const rawImg = isRoyal ? c[3] : get('Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©');
                return {
                    id: Math.random().toString(36).substr(2, 9),
                    store: isRoyal ? (c[2]||'VIRA') : (get('Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø±')||'Ù…ØªØ¬Ø± Ø´Ø±ÙŠÙƒ'),
                    name: isRoyal ? c[0] : get('Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬'),
                    price: isRoyal ? c[1] : get('Ø§Ù„Ø³Ø¹Ø±'),
                    img: rawImg ? rawImg.split(';')[0] : 'https://via.placeholder.com/300',
                    gallery: rawImg ? rawImg.split(';') : []
                };
            }).filter(p => p.name && p.img.includes('http'));
        };

        viraDatabase = [...brain(d1, true), ...brain(d2, false)];
        renderVira(viraDatabase);
    }

    function renderVira(data) {
        document.getElementById('grid-host').innerHTML = data.map(p => `
            <div class="luxury-item">
                <div class="floating-price">${p.price}</div>
                <div class="img-engine" onclick="openVision('${p.img}')">
                    <img src="${p.img}" loading="lazy">
                </div>
                <div class="meta-content">
                    <div class="merchant-id">${p.store}</div>
                    <div class="item-title">${p.name}</div>
                    <button class="btn-action" onclick="addToViraCart('${p.id}')">Ø§Ù‚ØªÙ†Ø§Ø¡ Ø§Ù„Ø¢Ù† ğŸ›’</button>
                </div>
            </div>
        `).join('');
    }

    // Ø²ÙˆÙˆÙ… Ù…ÙŠÙƒØ±ÙˆØ³ÙƒÙˆØ¨ÙŠ Ù‡ÙƒØ±
    function microZoom(e) {
        const img = document.getElementById('v-img-stage');
        const box = document.getElementById('zoomBase').getBoundingClientRect();
        const x = ((e.clientX - box.left) / box.width) * 100;
        const y = ((e.clientY - box.top) / box.height) * 100;
        img.style.transformOrigin = `${x}% ${y}%`;
        img.style.transform = "scale(3)";
    }
    function microReset() { document.getElementById('v-img-stage').style.transform = "scale(1)"; }

    function openVision(url) {
        document.getElementById('v-img-stage').src = url;
        document.getElementById('v-vision').style.display = 'flex';
        document.body.style.overflow = 'hidden';
    }
    function closeVision() { document.getElementById('v-vision').style.display = 'none'; document.body.style.overflow = 'auto'; }

    function addToViraCart(id) {
        const item = viraDatabase.find(p => p.id === id);
        viraCart.push(item);
        document.getElementById('v-count').innerText = viraCart.length;
        updateViraCartUI();
        // ØªØ£Ø«ÙŠØ± Ø§Ù‡ØªØ²Ø§Ø² Ø®ÙÙŠÙ Ù„Ù„Ø²Ø±
        navigator.vibrate ? navigator.vibrate(10) : null;
    }

    function updateViraCartUI() {
        // ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù…ØªØ¬Ø± (Grouping Engine)
        const groups = viraCart.reduce((acc, obj) => {
            const key = obj.store;
            if (!acc[key]) acc[key] = [];
            acc[key].push(obj);
            return acc;
        }, {});

        document.getElementById('cart-engine-list').innerHTML = Object.keys(groups).map(store => `
            <div class="cart-group">
                <div class="group-header"><span>ğŸ¢ Ù…ØªØ¬Ø±: ${store}</span> <span>${groups[store].length} Ù‚Ø·Ø¹</span></div>
                ${groups[store].map((item, idx) => `
                    <div style="display:flex; justify-content:space-between; margin-bottom:10px; font-size:14px;">
                        <span>${item.name}</span>
                        <span>${item.price}</span>
                    </div>
                `).join('')}
                <div style="font-size:10px; color:#666; border-top:1px solid #222; padding-top:5px;">Ø§Ù„ØªÙˆØµÙŠÙ„ Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØ¬Ø± ÙŠØ­Ø¯Ø¯ Ù„Ø§Ø­Ù‚Ø§Ù‹</div>
            </div>
        `).join('');

        const total = viraCart.reduce((a,i) => a + parseInt(i.price.replace(/[^0-9]/g,'')||0), 0);
        document.getElementById('total-sdg').innerText = `${total.toLocaleString()} SDG`;
    }

    function toggleCart(show) { document.getElementById('v-cart').style.display = show ? 'block' : 'none'; }

    function deployOrder() {
        if(!viraCart.length) return;
        const msg = encodeURIComponent(`Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ù…Ù„ÙŠØ§Ø±ÙŠ Ù…Ù† VIRA MALL ğŸ‘‘\n\n${viraCart.map(i=>`â€¢ ${i.name} [${i.store}]`).join('\n')}\n\nØ§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${document.getElementById('total-sdg').innerText}\n\n*ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø¨Ø®ØµÙˆØµ Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„ Ù„ÙƒÙ„ Ù…ØªØ¬Ø±.*`);
        window.open(`https://wa.me/249967584275?text=${msg}`);
    }

    function neuralSearch() {
        const q = document.getElementById('engineSearch').value.toLowerCase();
        renderVira(viraDatabase.filter(p => p.name.toLowerCase().includes(q) || p.store.toLowerCase().includes(q)));
    }

    viraEngineInit();
</script>
</body>
</html>
