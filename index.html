<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VIRA MALL | FORM EDITION 2026</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&family=Cinzel:wght@700;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --gold: #D4AF37;
            --black: #0a0a0a;
            --white: #ffffff;
            --glass: rgba(255, 255, 255, 0.97);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            margin: 0;
            background-color: #f8f8f8;
            color: var(--black);
            font-family: 'Cairo', sans-serif;
            overflow-x: hidden;
            padding-bottom: 100px;
        }

        /* --- Loader ÿßŸÑŸÖŸÑŸÉŸä --- */
        #v-loader {
            position: fixed;
            inset: 0;
            background: var(--black);
            z-index: 999999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: 1s ease-in-out;
        }
        .shimmer-text {
            font-family: 'Cinzel', serif;
            font-size: 50px;
            color: var(--gold);
            letter-spacing: 15px;
            animation: pulse 2s infinite;
        }
        @keyframes pulse { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.4; transform: scale(1.05); } }

        /* --- Header & Search --- */
        header {
            background: var(--glass);
            backdrop-filter: blur(15px);
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid #eee;
        }
        .logo { font-family: 'Cinzel', serif; font-size: 26px; font-weight: 900; color: var(--black); }
        .logo span { color: var(--gold); }

        .search-container { padding: 15px; background: #fff; }
        .search-bar {
            width: 100%;
            padding: 15px 20px;
            border-radius: 20px;
            border: 1px solid #f0f0f0;
            background: #f9f9f9;
            font-family: 'Cairo';
            outline: none;
            transition: 0.3s;
        }
        .search-bar:focus { border-color: var(--gold); background: #fff; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }

        /* --- Grid System --- */
        .v-tag {
            padding: 30px 20px 10px;
            font-weight: 900;
            font-size: 22px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .v-tag::after { content: ''; flex: 1; height: 1px; background: linear-gradient(to left, var(--gold), transparent); }
        
        .main-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            padding: 15px;
        }
        @media (max-width: 450px) { .main-grid { grid-template-columns: 1fr; } }

        /* --- Product Card --- */
        .product-card {
            background: var(--white);
            border-radius: 30px;
            overflow: hidden;
            position: relative;
            border: 1px solid #eee;
            box-shadow: 0 10px 30px rgba(0,0,0,0.03);
            transition: 0.3s ease;
        }
        .product-card:hover { transform: translateY(-5px); }

        /* Slider Engine */
        .slider-wrapper {
            width: 100%;
            height: 350px;
            position: relative;
            overflow: hidden;
            background: #f0f0f0;
        }
        .slides-inner {
            display: flex;
            width: 100%;
            height: 100%;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            scrollbar-width: none;
        }
        .slides-inner::-webkit-scrollbar { display: none; }
        .slides-inner img {
            min-width: 100%;
            height: 100%;
            object-fit: cover;
            scroll-snap-align: start;
            cursor: zoom-in;
        }
        
        .slider-dots {
            position: absolute;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 5px;
            z-index: 5;
        }
        .dot { width: 6px; height: 6px; background: rgba(255,255,255,0.5); border-radius: 50%; transition: 0.3s; }
        .dot.active { background: var(--gold); width: 15px; border-radius: 10px; }

        .price-tag {
            position: absolute;
            top: 15px;
            left: 15px;
            background: rgba(0,0,0,0.8);
            color: var(--gold);
            padding: 7px 15px;
            border-radius: 12px;
            font-weight: 900;
            font-size: 12px;
            z-index: 10;
            backdrop-filter: blur(5px);
            border: 1px solid var(--gold);
        }

        .card-info { padding: 20px; text-align: center; }
        .store-badge { font-size: 10px; color: var(--gold); font-weight: 900; background: rgba(212,175,55,0.1); padding: 4px 10px; border-radius: 7px; margin-bottom: 10px; display: inline-block; }
        .prod-name { font-size: 17px; font-weight: 700; margin-bottom: 15px; color: #111; line-height: 1.4; height: 48px; overflow: hidden; }
        .shipping-note { font-size: 10px; color: #999; display: block; margin-bottom: 15px; border-top: 1px solid #f9f9f9; padding-top: 10px; }
        
        .buy-button {
            background: var(--black);
            color: var(--gold);
            border: none;
            width: 100%;
            padding: 16px;
            border-radius: 20px;
            font-weight: 900;
            font-size: 14px;
            cursor: pointer;
            transition: 0.3s;
        }
        .buy-button:active { transform: scale(0.95); }

        /* --- Zoom Overlay --- */
        #zoom-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.98);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(10px);
        }
        #zoom-img { max-width: 95%; max-height: 85%; object-fit: contain; }
        .close-zoom { position: absolute; top: 30px; right: 30px; color: #fff; font-size: 40px; }

        /* --- Footer Nav --- */
        nav {
            position: fixed;
            bottom: 25px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 500px;
            background: rgba(255,255,255,0.98);
            backdrop-filter: blur(20px);
            border-radius: 100px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 12px;
            border: 1px solid #eee;
            z-index: 5000;
            box-shadow: 0 15px 40px rgba(0,0,0,0.1);
        }
        .nav-item { font-size: 22px; color: #bbb; cursor: pointer; position: relative; }
        .nav-center {
            background: var(--black);
            width: 75px;
            height: 75px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: -65px;
            border: 6px solid #fff;
            color: var(--gold);
            font-family: 'Cinzel';
            font-size: 35px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        .badge { position: absolute; top: -5px; right: -10px; background: #ff4757; color: #fff; font-size: 10px; width: 18px; height: 18px; border-radius: 50%; display: flex; justify-content: center; align-items: center; border: 2px solid #fff; }

        /* --- Cart Modal --- */
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 6000; }
        .modal-content { background: #fff; width: 92%; max-width: 450px; margin: 60px auto; border-radius: 40px; padding: 30px; max-height: 80vh; overflow-y: auto; }
        .cart-item { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid #f8f8f8; }
    </style>
</head>
<body>

<div id="v-loader">
    <div class="shimmer-text">VIRA</div>
</div>

<header>
    <div style="font-size:22px;">üëë</div>
    <div class="logo">VIRA<span>MALL</span></div>
    <div style="font-size:24px;" onclick="openCart()">üõí</div>
</header>

<div class="search-container">
    <input type="text" class="search-bar" id="searchInput" placeholder="ÿßÿ®ÿ≠ÿ´Ÿä ÿπŸÜ ŸÖŸÜÿ™ÿ¨ ÿ£Ÿà ŸÖÿ™ÿ¨ÿ±..." oninput="filterMall()">
</div>

<div class="v-tag">‚ú® <span>VIRA</span> SELECTIONS</div>
<div id="viraGrid" class="main-grid"></div>

<div class="v-tag">üõçÔ∏è <span>STORE</span> PARTNERS</div>
<div id="partnerGrid" class="main-grid"></div>

<div id="zoom-overlay" onclick="this.style.display='none'">
    <span class="close-zoom">√ó</span>
    <img id="zoom-img">
</div>

<div id="cartModal" class="modal" onclick="this.style.display='none'">
    <div class="modal-content" onclick="event.stopPropagation()">
        <h2 style="text-align:center; font-weight:900;">ÿ≠ŸÇŸäÿ®ÿ© ÿßŸÑÿ™ÿ≥ŸàŸÇ üõçÔ∏è</h2>
        <div id="cartBody"></div>
        <div style="text-align:center; margin-top:25px;">
            <h1 id="cartTotal" style="font-size:40px; color:var(--gold); margin:0;">0</h1>
            <button class="buy-button" style="margin-top:20px; padding:20px;" onclick="sendToWhatsApp()">ÿ™ÿ£ŸÉŸäÿØ ÿßŸÑÿ∑ŸÑÿ® (Ÿàÿßÿ™ÿ≥ÿßÿ®)</button>
        </div>
    </div>
</div>

<nav>
    <div class="nav-item" onclick="location.reload()">üè†</div>
    <div class="nav-item" onclick="openCart()">üíº<span class="badge" id="bCount">0</span></div>
    <div class="nav-center">V</div>
    <div class="nav-item" onclick="alert('ÿ≠ÿ≥ÿßÿ® ÿßŸÑÿ•ÿØÿßÿ±ÿ© - ÿ•Ÿäÿ´ÿßÿ±: 2280384')">üëë</div>
</nav>

<script>
    const SHEET_ID = '1UZnlp45dVMRJxNibcg3fm52H6S4DB4YbGLr4KK3jPqs';
    let fullData = [];
    let cart = [];

    async function initVira() {
        try {
            // ÿ¨ŸÑÿ® ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÖŸÜ ÿ¥Ÿäÿ™ ÿßŸÑÿ±ÿØŸàÿØ (gid=1152504859) Ÿàÿ¥Ÿäÿ™ ÿßŸÑÿ•ÿØÿßÿ±ÿ© (gid=0)
            const [respV, respP] = await Promise.all([
                fetch(`https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv&gid=0`),
                fetch(`https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv&gid=1152504859`)
            ]);

            const textV = await respV.text();
            const textP = await respP.text();

            // ŸÖÿπÿßŸÑÿ¨ÿ© ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ•ÿØÿßÿ±ÿ© (ÿ¥Ÿäÿ™ 1)
            const dataV = textV.split('\n').slice(1).map(row => {
                const cols = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                return { store: 'VIRA', name: cols[0], price: cols[1], img: cols[3]?.replace(/"/g,'').trim(), desc: cols[4] };
            }).filter(i => i.name && i.img);

            // ŸÖÿπÿßŸÑÿ¨ÿ© ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÅŸàÿ±ŸÖ (ÿ¥Ÿäÿ™ ÿßŸÑÿ±ÿØŸàÿØ) - ÿßŸÑÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑÿØŸÇŸäŸÇ ŸÑŸÑÿ£ÿπŸÖÿØÿ©
            const dataP = textP.split('\n').slice(1).map(row => {
                const cols = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(c => c?.replace(/"/g,'').trim());
                // B(1): ÿßŸÑŸÖÿ™ÿ¨ÿ± | D(3): ÿßŸÑŸÖŸÜÿ™ÿ¨ | E(4): ÿßŸÑÿ≥ÿπÿ± | F(5): ÿßŸÑÿµŸàÿ± | G(6): ÿßŸÑŸàÿµŸÅ
                return {
                    store: cols[1] || 'ŸÖÿ™ÿ¨ÿ± ÿ¥ÿ±ŸäŸÉ',
                    name: cols[3] || '',
                    price: cols[4] || '0',
                    img: cols[5] || '',
                    desc: cols[6] || ''
                };
            }).filter(i => i.name && i.img).reverse();

            fullData = [...dataV, ...dataP];
            renderMall(fullData);
            
            // ÿ•ÿÆŸÅÿßÿ° ÿßŸÑŸÑŸàÿØÿ±
            setTimeout(() => {
                document.getElementById('v-loader').style.opacity = '0';
                setTimeout(() => document.getElementById('v-loader').remove(), 1000);
            }, 1500);

        } catch (e) { console.error("Data Error", e); }
    }

    function renderMall(list) {
        let hV = '', hP = '';
        list.forEach((p, pIdx) => {
            // ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿ±Ÿàÿßÿ®ÿ∑ ÿßŸÑŸÖÿ™ÿπÿØÿØÿ© (ÿßŸÑÿµŸàÿ±)
            const images = p.img.split(/[,\s\n]+/).filter(link => link.startsWith('http'));
            const dots = images.length > 1 ? `<div class="slider-dots" id="dots-${pIdx}">${images.map((_,i)=>`<div class="dot ${i===0?'active':''}"></div>`).join('')}</div>` : '';

            const card = `
                <div class="product-card">
                    <div class="price-tag">${p.price}</div>
                    <div class="slider-wrapper">
                        <div class="slides-inner" onscroll="syncDots(this, ${pIdx})">
                            ${images.map(img => `<img src="${img}" onclick="zoom('${img}')" onerror="this.src='https://placehold.jp/30/0a0a0a/d4af37/400x600.png?text=VIRA+MALL'">`).join('')}
                        </div>
                        ${dots}
                    </div>
                    <div class="card-info">
                        <span class="store-badge">${p.store}</span>
                        <div class="prod-name">${p.name}</div>
                        <span class="shipping-note">üöö ÿßŸÑÿ™ŸàÿµŸäŸÑ Ÿäÿ™ŸÖ ÿπÿ®ÿ± ÿßŸÑŸÖÿ™ÿ¨ÿ±</span>
                        <button class="buy-button" onclick="addToCart('${p.name.replace(/'/g,"")}')">ÿ•ÿ∂ÿßŸÅÿ© ŸÑŸÑÿ≥ŸÑÿ© üõí</button>
                    </div>
                </div>`;
            if(p.store === 'VIRA') hV += card; else hP += card;
        });
        document.getElementById('viraGrid').innerHTML = hV;
        document.getElementById('partnerGrid').innerHTML = hP;
    }

    function syncDots(el, idx) {
        const i = Math.round(el.scrollLeft / el.offsetWidth);
        const dots = document.querySelectorAll(`#dots-${idx} .dot`);
        dots.forEach((d, n) => d.classList.toggle('active', n === Math.abs(i)));
    }

    function zoom(url) {
        document.getElementById('zoom-img').src = url;
        document.getElementById('zoom-overlay').style.display = 'flex';
    }

    function filterMall() {
        const q = document.getElementById('searchInput').value.toLowerCase();
        const filtered = fullData.filter(p => p.name.toLowerCase().includes(q) || p.store.toLowerCase().includes(q));
        renderMall(filtered);
    }

    function addToCart(name) {
        const item = fullData.find(x => x.name.replace(/'/g,"") === name);
        cart.push(item);
        document.getElementById('bCount').innerText = cart.length;
        alert('ÿ£ÿ∂ŸäŸÅ ŸÑÿ¨ŸÖÿßŸÑŸÉ ‚ú®');
    }

    function openCart() {
        if(cart.length === 0) return alert('ÿßŸÑÿ≠ŸÇŸäÿ®ÿ© ŸÅÿßÿ±ÿ∫ÿ©');
        const body = document.getElementById('cartBody');
        body.innerHTML = cart.map((item, idx) => `
            <div class="cart-item">
                <div><b>${item.name}</b><br><small>${item.store}</small></div>
                <div>${item.price} <span style="color:red; margin-right:10px;" onclick="removeFromCart(${idx})">√ó</span></div>
            </div>`).join('');
        
        const total = cart.reduce((acc, curr) => acc + (parseInt(curr.price.toString().replace(/[^0-9]/g,'')) || 0), 0);
        document.getElementById('cartTotal').innerText = total.toLocaleString() + ' SDG';
        document.getElementById('cartModal').style.display = 'block';
    }

    function removeFromCart(idx) {
        cart.splice(idx, 1);
        document.getElementById('bCount').innerText = cart.length;
        if(cart.length > 0) openCart(); else document.getElementById('cartModal').style.display = 'none';
    }

    function sendToWhatsApp() {
        const text = encodeURIComponent(`ÿ∑ŸÑÿ® ÿ¨ÿØŸäÿØ ŸÖŸÜ VIRA MALL üëë\n\n${cart.map(i => `‚Ä¢ ${i.name} [ŸÖÿ™ÿ¨ÿ±: ${i.store}]`).join('\n')}\n\nÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä: ${document.getElementById('cartTotal').innerText}`);
        window.open(`https://wa.me/249967584275?text=${text}`);
    }

    initVira();
</script>
</body>
</html>
