<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VIRA MALL | ÿßŸÑŸÜÿ≥ÿÆÿ© ÿßŸÑÿßÿ≠ÿ™ÿ±ÿßŸÅŸäÿ©</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap');
        
        :root {
            --amazon-dark: #232f3e;
            --amazon-orange: #febd69;
            --amazon-yellow: #ff9900;
            --sale-red: #fa6338;
            --bg: #f7f8fa;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); font-family: 'Cairo', sans-serif; margin: 0; padding-bottom: 120px; overflow-x: hidden; }

        /* Header & Brand */
        .header { background: var(--amazon-dark); padding: 20px 15px; text-align: center; position: sticky; top: 0; z-index: 3000; box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
        .header h1 { color: var(--amazon-orange); margin: 0; font-size: 28px; font-weight: 900; letter-spacing: 1px; }
        .header p { color: #fff; margin: 5px 0 0; font-size: 13px; font-weight: 600; opacity: 0.9; }

        /* Search Bar */
        .search-box { display: flex; margin: 15px auto 0; background: #fff; border-radius: 10px; overflow: hidden; height: 48px; max-width: 95%; }
        .search-box input { border: none; padding: 0 15px; width: 100%; font-family: 'Cairo'; font-size: 14px; outline: none; }
        .search-box button { background: var(--amazon-orange); border: none; width: 60px; cursor: pointer; font-size: 20px; }

        /* Section Titles */
        .section-header { padding: 25px 15px 10px; display: flex; align-items: center; justify-content: space-between; }
        .section-header h2 { font-size: 20px; font-weight: 900; margin: 0; color: var(--amazon-dark); position: relative; }
        .section-header h2::after { content: ''; position: absolute; bottom: -5px; right: 0; width: 40px; height: 3px; background: var(--amazon-yellow); }
        .view-all { color: var(--amazon-yellow); font-size: 13px; font-weight: 700; cursor: pointer; }

        /* Grid & Cards */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 15px; }
        .card { background: #fff; border-radius: 15px; overflow: hidden; border: 1px solid #eee; position: relative; box-shadow: 0 4px 15px rgba(0,0,0,0.05); transition: 0.3s; }
        
        .img-container { position: relative; width: 100%; height: 280px; overflow: hidden; background: #f9f9f9; display: flex; cursor: zoom-in; }
        .img-container img { width: 100%; height: 100%; object-fit: cover; flex-shrink: 0; transition: 0.5s ease; }
        
        .sale-badge { position: absolute; top: 12px; right: 12px; background: var(--sale-red); color: #fff; padding: 4px 12px; border-radius: 6px; font-size: 11px; font-weight: 900; z-index: 10; box-shadow: 0 2px 8px rgba(250,99,56,0.4); }

        .dots { position: absolute; bottom: 12px; width: 100%; display: flex; justify-content: center; gap: 5px; }
        .dot { width: 7px; height: 7px; background: rgba(255,255,255,0.4); border-radius: 50%; }
        .dot.active { background: #fff; width: 18px; border-radius: 10px; }

        .p-info { padding: 15px; text-align: center; }
        .p-name { font-size: 14px; font-weight: 700; color: #333; height: 40px; overflow: hidden; margin-bottom: 8px; line-height: 1.4; }
        
        .p-price { display: flex; flex-direction: column; align-items: center; gap: 2px; margin-bottom: 12px; }
        .old { color: #aaa; text-decoration: line-through; font-size: 12px; }
        .new { color: var(--sale-red); font-size: 18px; font-weight: 900; }

        .add-btn { background: linear-gradient(180deg, #ffdb7d, #ffbb00); border: 1px solid #c89411; width: 100%; padding: 12px; border-radius: 10px; font-family: 'Cairo'; font-weight: 800; cursor: pointer; font-size: 14px; transition: 0.2s; }
        .add-btn:active { transform: scale(0.95); }

        /* Bottom Nav */
        .nav { position: fixed; bottom: 15px; left: 5%; width: 90%; background: #1a1a1a; display: flex; justify-content: space-around; padding: 12px; border-radius: 25px; z-index: 4000; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .nav-link { text-align: center; color: #888; text-decoration: none; font-size: 10px; font-weight: 700; flex: 1; position: relative; }
        .nav-link.active { color: var(--amazon-yellow); }
        .nav-link i { display: block; font-size: 22px; margin-bottom: 4px; font-style: normal; }
        .cart-count { position: absolute; top: -10px; right: 20%; background: var(--amazon-yellow); color: #000; font-size: 10px; font-weight: 900; min-width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 2px solid #1a1a1a; }

        /* Modal Description */
        #modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 5000; padding: 20px; overflow-y: auto; }
        .modal-content { background: #fff; border-radius: 20px; padding: 20px; max-width: 500px; margin: auto; position: relative; text-align: center; }
        .close-modal { position: absolute; top: 15px; left: 15px; font-size: 25px; cursor: pointer; color: #333; }

        #backBtn { display: none; position: absolute; right: 15px; top: 22px; color: white; background: rgba(255,255,255,0.2); border: none; padding: 6px 15px; border-radius: 20px; font-weight: bold; }
    </style>
</head>
<body>

<header class="header">
    <button id="backBtn" onclick="home()">‚ùÆ ÿ±ÿ¨Ÿàÿπ</button>
    <h1>VIRA MALL</h1>
    <p>ÿÆŸäÿßÿ±ŸÉŸê ÿßŸÑÿ£ŸàŸÑ ŸÑŸÑÿ£ŸÜÿßŸÇÿ© ŸàÿßŸÑÿ±ŸÅÿßŸáŸäÿ© ‚ú®</p>
    <div class="search-box">
        <input type="text" id="search" placeholder="ÿßÿ®ÿ≠ÿ´Ÿä ÿπŸÜ ŸÅÿ≥ÿ™ÿßŸÜÿå ÿ≠ŸÇŸäÿ®ÿ©ÿå ŸÖÿßÿ±ŸÉÿ©..." oninput="search()">
        <button>üîç</button>
    </div>
</header>

<div id="offers"></div>
<div id="view"></div>

<div id="modal" onclick="this.style.display='none'">
    <div class="modal-content" onclick="event.stopPropagation()">
        <span class="close-modal" onclick="document.getElementById('modal').style.display='none'">√ó</span>
        <div id="modalBody"></div>
    </div>
</div>

<nav class="nav">
    <a href="javascript:void(0)" class="nav-link active" onclick="home()"><i>üè†</i>ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©</a>
    <a href="javascript:void(0)" class="nav-link" onclick="alert('ÿ™ŸàÿµŸäŸÑŸÜÿß ÿ≥ÿ±Ÿäÿπ ŸÑŸÉŸÑ ÿßŸÑÿ≥ŸàÿØÿßŸÜ üöö')"><i>üöö</i>ÿßŸÑÿ™ŸàÿµŸäŸÑ</a>
    <a href="javascript:void(0)" class="nav-link"><i>‚ù§Ô∏è</i>ÿßŸÑŸÖŸÅÿ∂ŸÑÿ©</a>
    <a href="javascript:void(0)" class="nav-link" onclick="checkout()"><i>üõí</i>ÿßŸÑÿ≠ŸÇŸäÿ®ÿ©<span id="cCount" class="cart-count" style="display:none">0</span></a>
</nav>

<script>
    const sheet = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTWD0ZQAKe2KRwLQnNjh2t7Z2Y_BKXxaKZxZwKSXUaZLQ3eeLB1fwj6vNllpNwXCtd9aY9Q_tuuFXXV/pub?output=csv';
    let db = [], cart = [];

    async function load() {
        const r = await fetch(sheet + '&t=' + Date.now());
        const t = await r.text();
        const rows = t.split('\n').slice(1);
        
        db = rows.map(row => {
            const c = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
            const clean = (v) => (v && !v.includes('wa.me') && !v.includes('http')) ? v.trim() : "";
            return {
                name: c[0]?.replace(/"/g,''),
                price: clean(c[1]),
                shop: c[2]?.trim() || "VIRA",
                imgs: c[3]?.replace(/"/g,'').split(',').map(s => s.trim()),
                old: clean(c[4]),
                desc: c[5]?.replace(/"/g,'') || "ÿ™ÿ£ŸÑŸÇŸä ŸÖÿπ ÿ£ÿ≠ÿØÿ´ ŸÉŸàŸÑŸäŸÉÿ¥ŸÜ ŸÖŸÜ ŸÅŸäÿ±ÿß ŸÖŸàŸÑ." // ÿßŸÑÿπŸÖŸàÿØ ÿßŸÑÿ≥ÿßÿØÿ≥ ŸÑŸÑŸàÿµŸÅ
            };
        }).filter(p => p.name && p.price);
        home();
    }

    function home() {
        document.getElementById('backBtn').style.display = 'none';
        const saleItems = db.filter(p => p.old && p.old.length > 0);
        if(saleItems.length > 0) {
            document.getElementById('offers').innerHTML = `<div class="section-header"><h2>üî• ÿπÿ±Ÿàÿ∂ ÿ≠ÿµÿ±Ÿäÿ©</h2></div><div class="grid">${saleItems.map(p => card(p)).join('')}</div>`;
        }
        
        const shops = [...new Set(db.map(p => p.shop))];
        let h = '';
        shops.forEach(s => {
            const items = db.filter(p => p.shop === s).slice(0, 4);
            h += `<div class="section-header"><h2>${s}</h2><span class="view-all" onclick="shop('${s}')">ÿπÿ±ÿ∂ ÿßŸÑŸÉŸÑ ‚ùØ</span></div><div class="grid">${items.map(p => card(p)).join('')}</div>`;
        });
        document.getElementById('view').innerHTML = h;
        window.scrollTo(0,0);
    }

    function shop(name) {
        document.getElementById('backBtn').style.display = 'block';
        document.getElementById('offers').innerHTML = '';
        const items = db.filter(p => p.shop === name);
        document.getElementById('view').innerHTML = `<div class="section-header"><h2>ŸÉŸàŸÑŸäŸÉÿ¥ŸÜ ${name}</h2></div><div class="grid">${items.map(p => card(p)).join('')}</div>`;
        window.scrollTo(0,0);
    }

    function card(p) {
        const id = 'p' + Math.random().toString(36).substr(2, 5);
        const isSale = p.old && p.old.length > 0;
        return `
            <div class="card" id="${id}">
                ${isSale ? '<div class="sale-badge">SALE</div>' : ''}
                <div class="img-container" onclick="next('${id}')">
                    ${p.imgs.map(src => `<img src="${src}" onerror="this.src='https://via.placeholder.com/500x700?text=VIRA+MALL'">`).join('')}
                    <div class="dots">${p.imgs.map((_,i)=>`<div class="dot ${i===0?'active':''}"></div>`).join('')}</div>
                </div>
                <div class="p-info">
                    <div class="p-name" onclick="showDesc('${encodeURIComponent(JSON.stringify(p))}')">${p.name}</div>
                    <div class="p-price">
                        ${isSale ? `<span class="old">${p.old} SDG</span>` : ''}
                        <span class="new">${p.price} SDG</span>
                    </div>
                    <button class="add-btn" onclick="add('${p.name}', '${p.price}')">ÿ•ÿ∂ÿßŸÅÿ© ŸÑŸÑÿ≥ŸÑÿ©</button>
                </div>
            </div>`;
    }

    function showDesc(data) {
        const p = JSON.parse(decodeURIComponent(data));
        document.getElementById('modalBody').innerHTML = `
            <img src="${p.imgs[0]}" style="width:100%; border-radius:15px; margin-bottom:15px;">
            <h3>${p.name}</h3>
            <p style="color:#666; line-height:1.6;">${p.desc}</p>
            <div style="font-size:22px; font-weight:900; color:var(--sale-red); margin:15px 0;">${p.price} SDG</div>
            <button class="add-btn" onclick="add('${p.name}', '${p.price}'); document.getElementById('modal').style.display='none'">ÿ•ÿ∂ÿßŸÅÿ© ŸÑŸÑÿ≠ŸÇŸäÿ®ÿ© ÿßŸÑÿ¢ŸÜ</button>
        `;
        document.getElementById('modal').style.display = 'block';
    }

    function next(id) {
        const b = document.getElementById(id).querySelector('.img-container');
        const imgs = b.querySelectorAll('img');
        const dots = b.querySelectorAll('.dot');
        let i = parseInt(b.dataset.idx || 0);
        i = (i + 1) % imgs.length;
        imgs.forEach(img => img.style.transform = `translateX(${i * 100}%)`);
        dots.forEach((d, idx) => d.classList.toggle('active', idx === i));
        b.dataset.idx = i;
    }

    function add(n, p) {
        cart.push({n, p});
        const b = document.getElementById('cCount');
        b.innerText = cart.length; b.style.display = 'flex';
    }

    function search() {
        const q = document.getElementById('search').value.toLowerCase();
        if(q.length > 0) {
            document.getElementById('offers').innerHTML = '';
            const f = db.filter(p => p.name.toLowerCase().includes(q) || p.shop.toLowerCase().includes(q));
            document.getElementById('view').innerHTML = `<div class="grid">${f.map(p => card(p)).join('')}</div>`;
        } else { home(); }
    }

    function checkout() {
        if(!cart.length) return alert("ÿ≥ŸÑÿ™ŸÉ ŸÅÿßÿ±ÿ∫ÿ©!");
        let m = "ÿ∑ŸÑÿ® ÿ¨ÿØŸäÿØ ŸÖŸÜ VIRA MALL üõí:\n" + cart.map((it, i) => `${i+1}. ${it.n} (${it.p})`).join('\n');
        window.open(`https://wa.me/249967584275?text=${encodeURIComponent(m)}`);
    }

    load();
</script>
</body>
</html>
