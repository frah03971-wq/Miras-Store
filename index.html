<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VIRA MALL | ÙÙŠØ±Ø§ Ù…ÙˆÙ„ Ø§Ù„Ø°ÙƒÙŠ</title>
<style>
:root{ --gold:#D4AF37; --dark:#0f1111; --gray:#f5f5f7; --white:#ffffff; }
body{margin:0; font-family:'Segoe UI', Tahoma, sans-serif; background:var(--gray); direction:rtl; overflow-x:hidden;}

/* Ù‡ÙŠØ¯Ø± Ø«Ø§Ø¨Øª ÙˆÙØ®Ù… */
header{background:var(--dark); color:white; padding:20px; text-align:center; position:sticky; top:0; z-index:1000; border-bottom:3px solid var(--gold);}
header h1{margin:0; font-size:26px; color:var(--gold);}

/* Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ù‡ÙŠØ¯Ø± */
.header-tools { position: absolute; top: 20px; left: 20px; display: flex; gap: 15px; }
.cart-icon { position: relative; cursor: pointer; font-size: 22px; color: var(--gold); }
.cart-count { position: absolute; top: -8px; right: -8px; background: red; color: white; font-size: 12px; padding: 2px 6px; border-radius: 50%; }
.menu-btn { position: absolute; top: 20px; right: 20px; font-size: 26px; color: var(--gold); cursor: pointer; }

/* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© */
.sidebar { height: 100%; width: 0; position: fixed; z-index: 10001; top: 0; right: 0; background: var(--dark); overflow-x: hidden; transition: 0.4s; padding-top: 60px; }
.sidebar .section-title { padding: 15px 25px; color: var(--gold); font-weight: bold; border-bottom: 1px solid #333; cursor: pointer; display: flex; justify-content: space-between; }
.sidebar .content { padding: 15px 25px; color: white; font-size: 14px; display: none; background: #1a1a1a; }
.sidebar .closebtn { position: absolute; top: 10px; left: 25px; font-size: 36px; color: var(--gold); text-decoration: none; }

/* Ø§Ù„Ø­Ø§ÙˆÙŠØ© ÙˆØ§Ù„ÙƒØ±ÙˆØª */
.container{padding:20px; display:grid; grid-template-columns:repeat(auto-fill,minmax(160px,1fr)); gap:15px; max-width:1200px; margin:0 auto;}
.card{background:var(--white); border-radius:15px; overflow:hidden; box-shadow:0 4px 10px rgba(0,0,0,.05); display:flex; flex-direction:column; transition: 0.3s;}
.card:hover { transform: translateY(-5px); }

/* Ø³Ù„Ø§ÙŠØ¯Ø± Ø§Ù„ØµÙˆØ± */
.img-container { position: relative; width: 100%; height: 180px; background: #eee; overflow: hidden; }
.img-container img { width: 100%; height: 100%; object-fit: cover; cursor: zoom-in; }

.info{padding:12px; text-align:center; flex-grow:1;}
.price{font-size:17px; font-weight:bold; color:#222; margin:8px 0;}
.btn-add { background:var(--gold); color:var(--dark); border:none; width:100%; padding:10px; border-radius:8px; cursor:pointer; font-weight:bold; margin-bottom: 5px; }
.btn-wa { background:transparent; color:var(--gold); border:1px solid var(--gold); width:100%; padding:8px; border-radius:8px; cursor:pointer; font-size: 12px; }

/* ØµÙØ­Ø© Ø§Ù„Ø³Ù„Ø© ÙˆØ§Ù„ØªÙˆØµÙŠÙ„ */
.overlay { display:none; position:fixed; inset:0; background:white; z-index:20000; padding:20px; overflow-y:auto; }
.overlay h2 { color: var(--dark); border-bottom: 2px solid var(--gold); padding-bottom: 10px; }
.form-group { margin-bottom: 15px; }
.form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
.form-group input { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; }
.checkout-btn { background: #25D366; color: white; border: none; width: 100%; padding: 15px; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer; margin-top: 20px; }

#viewer{display:none; position:fixed; inset:0; background:rgba(0,0,0,0.9); z-index:99999; align-items:center; justify-content:center;}
#viewer img{max-width:95%; max-height:85%; border-radius:10px;}
</style>
</head>
<body>

<header>
  <div class="menu-btn" onclick="openNav()">â˜°</div>
  <h1>VIRA MALL</h1>
  <div class="header-tools">
      <div class="cart-icon" onclick="openCart()">ğŸ›’<span class="cart-count" id="cartCount">0</span></div>
  </div>
</header>

<div id="mySidebar" class="sidebar">
  <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">Ã—</a>
  
  <div class="section-title" onclick="toggleSide('payContent')">ğŸ’³ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¯ÙØ¹ Ù„Ù„ØªØ¬Ø§Ø± <span>+</span></div>
  <div id="payContent" class="content">
      Ø±Ù‚Ù… Ø­Ø³Ø§Ø¨ Ø§Ù„ØªØ§Ø¬Ø±Ø§Øª: <br> <strong style="color:var(--gold)">2280384</strong> <br><br>
      <button style="background:var(--gold); border:none; padding:8px; border-radius:5px; cursor:pointer" onclick="window.open('https://wa.me/249967584275?text=Ø§Ø±ÙŠØ¯ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙƒØªØ§Ø¬Ø±')">Ø¥Ø´ØªØ±Ùƒ Ø§Ù„Ø¢Ù† ÙƒØªØ§Ø¬Ø± âœ¨</button>
  </div>

  <div class="section-title" onclick="toggleSide('delivContent')">ğŸšš Ø§Ù„ØªÙˆØµÙŠÙ„ <span>+</span></div>
  <div id="delivContent" class="content">
      Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø³Ù„Ø© ÙˆØªØ¹Ø¨Ø¦Ø© Ø¨ÙŠØ§Ù†Ø§ØªÙƒ (Ø§Ù„ÙˆÙ„Ø§ÙŠØ©ØŒ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©ØŒ Ø§Ù„Ø´Ø§Ø±Ø¹) Ø¹Ù†Ø¯ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨.
  </div>
</div>

<div class="container" id="grid"></div>

<div id="cartOverlay" class="overlay">
    <div style="text-align: left; font-size: 24px; cursor: pointer;" onclick="closeCart()">âœ•</div>
    <h2>Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª ğŸ›’</h2>
    <div id="cartItems"></div>
    <hr>
    <h3>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„ ğŸ“</h3>
    <div class="form-group"><label>Ø§Ù„ÙˆÙ„Ø§ÙŠØ©:</label><input type="text" id="state" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ø§Ù„Ø®Ø±Ø·ÙˆÙ…"></div>
    <div class="form-group"><label>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© / Ø§Ù„Ù…Ù†Ø·Ù‚Ø©:</label><input type="text" id="city" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ø£Ù…Ø¯Ø±Ù…Ø§Ù† - Ø§Ù„Ø«ÙˆØ±Ø©"></div>
    <div class="form-group"><label>Ø§Ù„Ø´Ø§Ø±Ø¹ / Ø§Ù„Ù…Ø¹Ù„Ù… Ø§Ù„Ø¨Ø§Ø±Ø²:</label><input type="text" id="street" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ø´Ø§Ø±Ø¹ Ø§Ù„Ù†Øµ - Ù‚Ø±Ø¨ Ø·Ù„Ù…Ø¨Ø© Ø§Ù„Ù†ÙŠÙ„"></div>
    
    <div style="font-size: 20px; font-weight: bold; margin: 20px 0;">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="totalPrice">0</span> SDG</div>
    <button class="checkout-btn" onclick="sendOrder()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ âœ…</button>
</div>

<div id="viewer" onclick="this.style.display='none'"><img id="viewerImg"></div>

<script>
const SHEET_URL='https://docs.google.com/spreadsheets/d/e/2PACX-1vTWD0ZQAKe2KRwLQnNjh2t7Z2Y_BKXxaKZxZwKSXUaZLQ3eeLB1fwj6vNllpNwXCtd9aY9Q_tuuFXXV/pub?gid=0&single=true&output=csv';

let products = [];
let cart = [];

function openNav() { document.getElementById("mySidebar").style.width = "280px"; }
function closeNav() { document.getElementById("mySidebar").style.width = "0"; }
function toggleSide(id) { 
    const el = document.getElementById(id);
    el.style.display = el.style.display === 'block' ? 'none' : 'block';
}

async function loadProducts(){
  const res = await fetch(SHEET_URL);
  const text = await res.text();
  const rows = text.split(/\r?\n/).slice(1);
  products = rows.map((r, index)=>{
    const c = r.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/).map(x=>x.replace(/"/g,'').trim());
    return {id: index, name:c[0], price:c[1], store:c[2], img:c[3], whatsapp:c[4]};
  }).filter(p=>p.name && p.img);
  render();
}

function render(){
  document.getElementById('grid').innerHTML = products.map(p=>`
    <div class="card">
      <div class="img-container">
          <img src="${p.img}" onclick="openImg('${p.img}')" onerror="this.src='https://via.placeholder.com/200'">
      </div>
      <div class="info">
        <div class="store">âœ¨ ${p.store}</div>
        <div class="title" style="font-size:13px; font-weight:bold; height:32px; overflow:hidden;">${p.name}</div>
        <div class="price">${p.price} SDG</div>
        <button class="btn-add" onclick="addToCart(${p.id})">Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø© ğŸ›’</button>
        <button class="btn-wa" onclick="order('${p.whatsapp}','${p.name}')">Ø§Ø³ØªÙØ³Ø§Ø± Ù…Ø¨Ø§Ø´Ø±</button>
      </div>
    </div>
  `).join('');
}

function addToCart(id) {
    const p = products.find(item => item.id === id);
    cart.push(p);
    updateCart();
    alert("ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù„Ù…Ù„ÙƒØ© ÙÙŠØ±Ø§! âœ¨");
}

function updateCart() {
    document.getElementById('cartCount').innerText = cart.length;
    let total = 0;
    document.getElementById('cartItems').innerHTML = cart.map((item, index) => {
        total += parseInt(item.price.replace(/[^0-9]/g, '')) || 0;
        return `<div style="display:flex; justify-content:space-between; margin-bottom:10px;">
            <span>${item.name}</span>
            <b>${item.price} SDG</b>
        </div>`;
    }).join('');
    document.getElementById('totalPrice').innerText = total;
}

function openCart() { document.getElementById('cartOverlay').style.display = 'block'; }
function closeCart() { document.getElementById('cartOverlay').style.display = 'none'; }

function openImg(src){ document.getElementById('viewerImg').src=src; document.getElementById('viewer').style.display='flex'; }

function sendOrder() {
    if(cart.length === 0) return alert("Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ© ÙŠØ§ Ø±ÙˆØ­ÙŠ!");
    const state = document.getElementById('state').value;
    const city = document.getElementById('city').value;
    const street = document.getElementById('street').value;
    
    if(!state || !city) return alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„ ÙƒØ§Ù…Ù„Ø©");

    let msg = `Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ù† VIRA MALL âœ¨%0A%0A`;
    cart.forEach((item, i) => msg += `${i+1}. ${item.name} (${item.price} SDG)%0A`);
    msg += `%0AğŸ’° Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${document.getElementById('totalPrice').innerText} SDG`;
    msg += `%0A%0AğŸ“ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„:%0AØ§Ù„ÙˆÙ„Ø§ÙŠØ©: ${state}%0AØ§Ù„Ù…Ø¯ÙŠÙ†Ø©: ${city}%0AØ§Ù„Ø´Ø§Ø±Ø¹: ${street}`;
    
    // Ø¥Ø±Ø³Ø§Ù„ Ù„Ø£ÙˆÙ„ Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨ ÙÙŠ Ø§Ù„Ø³Ù„Ø© (Ø£Ùˆ Ø±Ù‚Ù…Ùƒ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ)
    const waNum = cart[0].whatsapp || "249967584275";
    window.open(`https://wa.me/${waNum}?text=${msg}`, '_blank');
}

function order(num,name){ window.open(`https://wa.me/${num}?text=${encodeURIComponent('Ø³Ù„Ø§Ù…Ø§ØªØŒ Ø­Ø§Ø¨Ø© Ø§Ø³ØªÙØ³Ø± Ø¹Ù†: '+name)}`,'_blank'); }
loadProducts();
</script>
</body>
</html>
