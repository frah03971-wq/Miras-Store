<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VIRA MALL | Ø®ÙŠØ§Ø±Ùƒ Ø§Ù„Ø£ÙˆÙ„</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap');
        
        :root {
            --amazon-orange: #febd69;
            --amazon-dark: #232f3e;
            --amazon-yellow: #ff9900;
            --light-bg: #f3f3f3;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background: var(--light-bg); color: #111; font-family: 'Cairo', sans-serif; margin: 0; padding-bottom: 80px; }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ø¹Ù„ÙˆÙŠ - Ø£Ù…Ø§Ø²ÙˆÙ† Ø³ØªØ§ÙŠÙ„ */
        .top-info { background: #131921; color: white; padding: 8px; text-align: center; font-size: 12px; font-weight: 700; }
        
        .main-header { background: var(--amazon-dark); padding: 15px; position: sticky; top: 0; z-index: 2000; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .intro-text { text-align: center; color: var(--amazon-orange); margin-bottom: 10px; }
        .intro-text h1 { margin: 0; font-size: 22px; font-weight: 900; }
        .intro-text p { margin: 0; font-size: 13px; color: #fff; opacity: 0.8; }

        /* Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ */
        .search-box { position: relative; width: 100%; display: flex; gap: 0; }
        .search-box input { 
            width: 100%; padding: 12px 15px; border-radius: 8px 0 0 8px; border: none; 
            outline: none; font-family: 'Cairo'; 
        }
        .search-btn { 
            background: var(--amazon-orange); border: none; padding: 0 15px; 
            border-radius: 0 8px 8px 0; cursor: pointer; font-size: 18px;
        }

        /* Ø§Ù„ÙƒÙˆÙ„ÙŠÙƒØ´Ù†Ø§Øª */
        .section-header { padding: 15px 15px 5px; font-weight: 900; font-size: 18px; color: var(--amazon-dark); }
        
        .product-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 10px; }
        
        /* ÙƒØ±Øª Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù€ 3 ÙˆØ¬Ù‡Ø§Øª (Slider) */
        .p-card { background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .img-slider { position: relative; width: 100%; height: 220px; overflow: hidden; }
        .slider-track { display: flex; transition: transform 0.4s ease-in-out; height: 100%; }
        .slider-track img { width: 100%; flex-shrink: 0; object-fit: cover; }
        
        /* Ù†Ù‚Ø· Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„ØµÙˆØ± */
        .dots { position: absolute; bottom: 8px; width: 100%; display: flex; justify-content: center; gap: 4px; }
        .dot { width: 6px; height: 6px; background: rgba(255,255,255,0.5); border-radius: 50%; }
        .dot.active { background: var(--amazon-orange); width: 12px; border-radius: 4px; }

        .p-info { padding: 10px; }
        .p-title { font-size: 13px; font-weight: 700; height: 38px; overflow: hidden; line-height: 1.4; }
        .p-price { color: #B12704; font-size: 17px; font-weight: 700; margin: 5px 0; }
        
        .add-to-cart { 
            background: linear-gradient(to bottom, #f7dfa1, #f0c14b);
            border: 1px solid #a88734; width: 100%; padding: 8px; 
            border-radius: 5px; font-family: 'Cairo'; font-weight: 700; font-size: 12px;
            cursor: pointer; box-shadow: 0 1px 0 rgba(255,255,255,0.4) inset;
        }

        /* Ø§Ù„Ø³Ù„Ø© ÙˆØ§Ù„Ù†Ø§Ù Ø¨Ø§Ø± */
        .bottom-nav { 
            position: fixed; bottom: 0; width: 100%; background: #fff; 
            display: flex; justify-content: space-around; padding: 10px; 
            border-top: 1px solid #ddd; z-index: 3000;
        }
        .nav-item { text-align: center; text-decoration: none; color: #555; position: relative; }
        .nav-item.active { color: var(--amazon-yellow); }
        .nav-item i { display: block; font-size: 22px; font-style: normal; margin-bottom: 2px; }
        .cart-badge { 
            position: absolute; top: -5px; right: -8px; background: #e47911; 
            color: white; font-size: 11px; font-weight: 900; width: 18px; 
            height: 18px; border-radius: 50%; display: none; align-items: center; justify-content: center;
        }

        /* Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ */
        .modal { display: none; position: fixed; inset: 0; background: white; z-index: 5000; overflow-y: auto; padding-top: 60px; }
        .close-modal { position: fixed; top: 15px; left: 15px; background: var(--amazon-dark); color: white; width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 6000; }
    </style>
</head>
<body>

<div class="top-info">ğŸšš Ø§Ù„ØªÙˆØµÙŠÙ„ Ù„ÙƒÙ„ ÙˆÙ„Ø§ÙŠØ§Øª Ø§Ù„Ø³ÙˆØ¯Ø§Ù† â€¢ Ø®ÙŠØ§Ø±ÙƒÙ Ø§Ù„Ø£ÙˆÙ„ Ù„Ù„Ø¬Ù…Ø§Ù„</div>

<header class="main-header">
    <div class="intro-text">
        <h1>VIRA<span> MALL</span></h1>
        <p>Ø®ÙŠØ§Ø±ÙƒÙ Ø§Ù„Ø£ÙˆÙ„ Ù„Ù„Ø£Ù†Ø§Ù‚Ø© ÙˆØ§Ù„Ø±ÙØ§Ù‡ÙŠØ© âœ¨</p>
    </div>
    <div class="search-box">
        <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø«ÙŠ Ø¹Ù† ÙØ³ØªØ§Ù†ØŒ Ø£Ø­Ø°ÙŠØ©ØŒ ÙƒÙˆÙ„ÙŠÙƒØ´Ù†..." oninput="doSearch()">
        <button class="search-btn">ğŸ”</button>
    </div>
</header>

<div id="mainContent">
    </div>

<div id="shop-modal" class="modal">
    <div class="close-modal" onclick="closeModal()">âœ•</div>
    <div id="modalBody"></div>
</div>

<nav class="bottom-nav">
    <a href="#" class="nav-item active" onclick="closeModal()"><i>ğŸ </i>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
    <div class="nav-item" onclick="sendOrder()">
        <i>ğŸ›’</i>Ø§Ù„Ø³Ù„Ø©
        <span id="cartCount" class="cart-badge">0</span>
    </div>
    <a href="https://wa.me/249967584275" class="nav-item"><i>ğŸ’¬</i>ØªÙˆØ§ØµÙ„</a>
</nav>

<script>
    const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTWD0ZQAKe2KRwLQnNjh2t7Z2Y_BKXxaKZxZwKSXUaZLQ3eeLB1fwj6vNllpNwXCtd9aY9Q_tuuFXXV/pub?output=csv';
    let products = [], cart = [];

    async function init() {
        const r = await fetch(sheetUrl + '&t=' + Date.now());
        const text = await r.text();
        const rows = text.split('\n').slice(1);
        products = rows.map(row => {
            const c = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
            return { name: c[0]?.replace(/"/g,''), price: c[1], shop: c[2], img: c[3] };
        }).filter(p => p.shop);
        renderMall();
    }

    function renderMall() {
        const shops = [...new Set(products.map(p => p.shop))];
        let html = '';
        shops.forEach(shop => {
            const items = products.filter(p => p.shop === shop);
            html += `
                <div class="section-header">${shop}</div>
                <div class="product-grid">
                    ${items.map((p, idx) => createCard(p, idx, shop)).join('')}
                </div>
            `;
        });
        document.getElementById('mainContent').innerHTML = html;
    }

    function createCard(p, idx, shopId) {
        const imgs = p.img.split(',');
        const sliderId = `slider-${shopId.replace(/\s/g,'')}-${idx}`;
        return `
            <div class="p-card">
                <div class="img-slider" id="${sliderId}" onclick="nextImg('${sliderId}', ${imgs.length})">
                    <div class="slider-track">
                        ${imgs.map(img => `<img src="${img.trim()}" onerror="this.src='https://via.placeholder.com/300x400?text=VIRA+MALL'">`).join('')}
                    </div>
                    <div class="dots">
                        ${imgs.map((_, i) => `<div class="dot ${i===0?'active':''}"></div>`).join('')}
                    </div>
                </div>
                <div class="p-info">
                    <div class="p-title">${p.name}</div>
                    <div class="p-price">${p.price} SDG</div>
                    <button class="add-to-cart" onclick="addToCart('${p.name}', '${p.price}')">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©</button>
                </div>
            </div>
        `;
    }

    // ÙˆØ¸ÙŠÙØ© ØªÙ‚Ù„ÙŠØ¨ Ø§Ù„ØµÙˆØ± Ø¯Ø§Ø®Ù„ Ø§Ù„ÙƒØ±Øª
    function nextImg(id, total) {
        const slider = document.getElementById(id);
        const track = slider.querySelector('.slider-track');
        const dots = slider.querySelectorAll('.dot');
        let current = parseInt(slider.dataset.index || 0);
        
        current = (current + 1) % total;
        track.style.transform = `translateX(${current * 100}%)`;
        slider.dataset.index = current;
        
        dots.forEach((d, i) => d.classList.toggle('active', i === current));
    }

    function addToCart(name, price) {
        cart.push({name, price});
        const badge = document.getElementById('cartCount');
        badge.innerText = cart.length;
        badge.style.display = 'flex';
        // Ø­Ø±ÙƒØ© Ø®ÙÙŠÙØ© Ù„Ù„Ø²Ø±
        event.target.innerText = "âœ… ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©";
        setTimeout(() => event.target.innerText = "Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©", 1000);
    }

    function doSearch() {
        const t = document.getElementById('searchInput').value.toLowerCase();
        const filtered = products.filter(p => p.name.toLowerCase().includes(t) || p.shop.toLowerCase().includes(t));
        if(t.length > 2) {
            document.getElementById('modalBody').innerHTML = `<div class="product-grid">${filtered.map((p, i) => createCard(p, i, 'search')).join('')}</div>`;
            document.getElementById('shop-modal').style.display = 'block';
        }
    }

    function sendOrder() {
        if(!cart.length) return alert("Ø³Ù„ØªÙƒ ÙØ§Ø±ØºØ©!");
        let msg = "Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ù† VIRA MALL ğŸ›’:\n\n";
        cart.forEach((item, i) => msg += `${i+1}. ${item.name} (${item.price} SDG)\n`);
        window.open(`https://wa.me/249967584275?text=${encodeURIComponent(msg)}`);
        cart = []; document.getElementById('cartCount').style.display = 'none';
    }

    function closeModal() { document.getElementById('shop-modal').style.display = 'none'; }

    init();
</script>
</body>
</html>
