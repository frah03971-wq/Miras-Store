<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VIRA MALL | ÙÙŠØ±Ø§ Ù…ÙˆÙ„</title>
<style>
:root{--gold:#D4AF37;--dark:#0f1111;--gray:#f5f5f7;--white:#fff;--red:#e41e31;}
body{margin:0;font-family:'Segoe UI',Tahoma,sans-serif;background:var(--gray);direction:rtl;overflow-x:hidden;}

/* Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ */
header{background:var(--dark);color:white;padding:15px;text-align:center;position:sticky;top:0;z-index:1000;border-bottom:3px solid var(--gold);display:flex;justify-content:space-between;align-items:center;}
header h1{margin:0;font-size:24px;color:var(--gold);flex-grow:1;letter-spacing:1px;}
.menu-btn{cursor:pointer;font-size:30px;color:var(--gold);padding:0 10px;}

/* Ø´Ø¨ÙƒØ© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª */
.container{padding:15px;display:grid;grid-template-columns:repeat(auto-fill,minmax(165px,1fr));gap:15px;max-width:1200px;margin:0 auto;}

/* ÙƒØ±Øª Ø§Ù„Ù…Ù†ØªØ¬ */
.card{background:var(--white);border-radius:15px;overflow:hidden;box-shadow:0 4px 15px rgba(0,0,0,.1);position:relative;display:flex;flex-direction:column;transition:0.3s;}
.card:hover{transform: translateY(-5px);}

/* Ø§Ù„Ø³Ù„Ø§ÙŠØ¯Ø± Ø§Ù„Ø²ÙŠØª */
.slider-container{position:relative;width:100%;height:220px;background:#eee;overflow:hidden;direction:ltr!important;}
.slider-track{display:flex;width:100%;height:100%;transition:transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);will-change: transform;}
.slider-track img{min-width:100%;width:100%;height:100%;object-fit:cover;flex-shrink:0;}

.nav-btn{position:absolute;top:50%;transform:translateY(-50%);background:rgba(212,175,55,0.8);color:black;border:none;width:30px;height:30px;cursor:pointer;border-radius:50%;z-index:10;font-weight:bold;display:flex;align-items:center;justify-content:center;}
.next{right:8px;} .prev{left:8px;}

.dots{position:absolute;bottom:10px;left:0;right:0;display:flex;justify-content:center;gap:4px;}
.dot{width:6px;height:6px;background:rgba(255,255,255,0.5);border-radius:50%;transition:0.3s;}
.dot.active{background:var(--gold);width:15px;border-radius:10px;}

.fav-icon{position:absolute;top:10px;left:10px;z-index:15;color:rgba(255,255,255,0.8);font-size:24px;cursor:pointer;text-shadow:0 0 5px rgba(0,0,0,0.5);}
.fav-icon.active{color:var(--red);}

.info{padding:12px;text-align:center;direction:rtl;}
.store-tag{font-size:10px;color:var(--gold);font-weight:bold;text-transform:uppercase;margin-bottom:5px;display:block;}
.title{font-size:14px;font-weight:bold;color:var(--dark);height:38px;overflow:hidden;margin:5px 0;}
.price{font-size:18px;font-weight:900;color:var(--dark);margin-bottom:10px;}
.btn-order{background:var(--gold);color:var(--dark);border:none;width:100%;padding:12px;border-radius:10px;font-weight:bold;cursor:pointer;text-decoration:none;display:block;transition:0.2s;}
.btn-order:active{transform:scale(0.95);}

/* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© (Ø§Ù„Ù…Ù†ÙŠÙˆ) */
.sidebar{height:100%;width:0;position:fixed;z-index:10001;top:0;right:0;background:var(--dark);transition:0.4s;color:white;overflow-x:hidden;box-shadow:-5px 0 20px rgba(0,0,0,0.5);}
.side-content{padding:25px;}
.side-content h3{color:var(--gold);border-bottom:1px solid #333;padding-bottom:10px;margin-top:25px;font-size:18px;}
.side-text{font-size:14px;color:#ccc;line-height:1.6;margin:10px 0;}
.fav-item{display:flex;align-items:center;gap:10px;margin-top:10px;background:#1a1a1a;padding:8px;border-radius:8px;}
.btn-side{background:var(--gold);color:black;width:100%;padding:12px;border-radius:8px;font-weight:bold;margin-top:15px;border:none;cursor:pointer;display:block;text-align:center;text-decoration:none;}
.btn-tg{background:#0088cc;color:white;}
</style>
</head>
<body>

<header>
  <div style="width:50px"></div>
  <h1>VIRA MALL</h1>
  <div class="menu-btn" onclick="openNav()">â˜°</div>
</header>

<div class="container" id="grid">
    <p style="text-align:center; grid-column:1/-1; padding-top:100px; color:#666;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø£Ø­Ø¯Ø« Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª... âœ¨</p>
</div>

<div id="mySidebar" class="sidebar">
  <div style="padding:20px;font-size:35px;cursor:pointer;color:var(--gold)" onclick="closeNav()">Ã—</div>
  <div class="side-content">
      
      <h3>â¤ï¸ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…ÙØ¶Ù„Ø©</h3>
      <div id="fav-list" class="side-text">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù…Ø¶Ø§ÙØ© Ù„Ù„Ù…ÙØ¶Ù„Ø©.</div>

      <h3>ğŸšš Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„</h3>
      <p class="side-text">ÙŠØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„ Ù„Ø¬Ù…ÙŠØ¹ ÙˆÙ„Ø§ÙŠØ§Øª Ø§Ù„Ø³ÙˆØ¯Ø§Ù†. Ø³Ø¹Ø± Ø§Ù„ØªÙˆØµÙŠÙ„ ÙŠØ­Ø¯Ø¯ Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ù„Ù…ØªØ¬Ø± Ø¹Ù†Ø¯ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨.</p>

      <h3>ğŸ’³ Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹</h3>
      <p class="side-text">Ù…ØªÙˆÙØ± Ø§Ù„Ø¯ÙØ¹ ÙƒØ§Ø´ Ø£Ùˆ Ø¹Ø¨Ø± Ø§Ù„ÙÙŠØ²Ø§ (Ø­Ø³Ø¨ Ø§Ù„Ù…ØªØ¬Ø±).<br>Ø±Ù‚Ù… Ø­Ø³Ø§Ø¨ Ø¨Ù†ÙƒÙƒ Ø§Ù„Ù…Ø¹ØªÙ…Ø¯: <br><strong style="color:var(--gold); font-size:18px;">2280384</strong></p>

      <h3>ğŸ”” Ø§Ø´ØªØ±Ùƒ ÙÙŠ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</h3>
      <p class="side-text">ØªØ§Ø¨Ø¹ÙŠ Ø¬Ø¯ÙŠØ¯Ù†Ø§ ÙˆØ¹Ø±ÙˆØ¶Ù†Ø§ Ø§Ù„Ø­ØµØ±ÙŠØ© Ø¹Ù„Ù‰ Ù‚Ù†Ø§ØªÙ†Ø§ ÙÙŠ ØªÙ„Ø¬Ø±Ø§Ù…:</p>
      <a href="https://t.me/+VksKXlPLnnFjYzlk" target="_blank" class="btn-side btn-tg">Ø§Ù†Ø¶Ù…ÙŠ Ù„Ù‚Ù†Ø§Ø© Ø§Ù„ØªÙ„Ø¬Ø±Ø§Ù… âœˆï¸</a>

      <hr style="border:0; border-top:1px solid #333; margin:30px 0;">
      
      <h3>ğŸ‘©â€ğŸ’¼ Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„ØªØ§Ø¬Ø±Ø§Øª</h3>
      <p class="side-text">Ù„Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙˆØ¹Ø±Ø¶ Ù…Ù†ØªØ¬Ø§ØªÙƒ ÙÙŠ ÙÙŠØ±Ø§ Ù…ÙˆÙ„:</p>
      <a href="admin.html" class="btn-side">Ø¯Ø®ÙˆÙ„ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ğŸš€</a>
  </div>
</div>

<script>
const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTWD0ZQAKe2KRwLQnNjh2t7Z2Y_BKXxaKZxZwKSXUaZLQ3eeLB1fwj6vNllpNwXCtd9aY9Q_tuuFXXV/pub?output=csv';
let favs = JSON.parse(localStorage.getItem('vira_favs') || '[]');

async function loadProducts() {
    try {
        const response = await fetch(CSV_URL + '&t=' + Date.now());
        const data = await response.text();
        const rows = data.split(/\r?\n/).slice(1);
        
        const products = rows.map(row => {
            const cols = row.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/).map(v => v.replace(/"/g, '').trim());
            if (!cols[0] || cols[0].includes('Ø±Ø¯ÙˆØ¯')) return null;
            const imgs = cols[3] ? cols[3].split(/\s+/).filter(i => i.includes('http')) : [];
            return { name: cols[0], price: cols[1], store: cols[2], imgs: imgs, wa: cols[4] };
        }).filter(p => p);
        
        renderGrid(products);
    } catch (e) {
        document.getElementById('grid').innerHTML = "ÙØ´Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹.";
    }
}

function renderGrid(list) {
    const grid = document.getElementById('grid');
    if (list.length === 0) { grid.innerHTML = "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹."; return; }
    
    grid.innerHTML = list.map((p, idx) => {
        const isFav = favs.some(f => f.name === p.name) ? 'active' : '';
        const dots = p.imgs.map((_, i) => `<div class="dot ${i === 0 ? 'active' : ''}"></div>`).join('');
        
        return `
        <div class="card" id="card-${idx}" data-i="0">
            <div class="slider-container">
                <div class="fav-icon ${isFav}" onclick="toggleFav('${p.name}', '${p.imgs[0]}', this)">â¤</div>
                <div class="slider-track">${p.imgs.map(img => `<img src="${img}">`).join('')}</div>
                ${p.imgs.length > 1 ? `
                    <button class="nav-btn prev" onclick="moveSlide(${idx}, -1)">â®</button>
                    <button class="nav-btn next" onclick="moveSlide(${idx}, 1)">â¯</button>
                    <div class="dots">${dots}</div>
                ` : ''}
            </div>
            <div class="info">
                <span class="store-tag">âœ¨ ${p.store}</span>
                <div class="title">${p.name}</div>
                <div class="price">${p.price} SDG</div>
                <a class="btn-order" href="https://wa.me/${p.wa.replace(/\s/g,'')}?text=Ø·Ù„Ø¨ Ù…Ù†ØªØ¬: ${p.name}" target="_blank">Ø·Ù„Ø¨ ÙˆØ§ØªØ³Ø§Ø¨ âœ…</a>
            </div>
        </div>`;
    }).join('');
    
    // ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ‚Ù„ÙŠØ¨ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„ 5 Ø«ÙˆØ§Ù†ÙŠ
    setInterval(() => {
        list.forEach((p, i) => { if (p.imgs.length > 1) moveSlide(i, 1); });
    }, 5000);
}

function moveSlide(cardIdx, dir) {
    const card = document.getElementById(`card-${cardIdx}`);
    if(!card) return;
    const track = card.querySelector('.slider-track');
    const dots = card.querySelectorAll('.dot');
    const total = track.children.length;
    let i = (parseInt(card.dataset.i) + dir + total) % total;
    card.dataset.i = i;
    track.style.transform = `translateX(-${i * 100}%)`;
    if (dots.length) dots.forEach((d, idx) => d.classList.toggle('active', idx === i));
}

function toggleFav(name, img, el) {
    const idx = favs.findIndex(f => f.name === name);
    if (idx > -1) {
        favs.splice(idx, 1);
        el.classList.remove('active');
    } else {
        favs.push({ name, img });
        el.classList.add('active');
    }
    localStorage.setItem('vira_favs', JSON.stringify(favs));
}

function updateFavUI() {
    const list = document.getElementById('fav-list');
    if (favs.length === 0) {
        list.innerHTML = "Ø§Ù„Ù…ÙØ¶Ù„Ø© ÙØ§Ø¶ÙŠØ© ÙŠØ§ Ù‚Ù…Ø±..";
        return;
    }
    list.innerHTML = favs.map(f => `
        <div class="fav-item">
            <img src="${f.img}" width="40" height="40" style="border-radius:5px; object-fit:cover;">
            <span>${f.name}</span>
        </div>
    `).join('');
}

function openNav() { document.getElementById("mySidebar").style.width = "300px"; updateFavUI(); }
function closeNav() { document.getElementById("mySidebar").style.width = "0"; }

loadProducts();
</script>
</body>
</html>
