<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VIRA MALL | Shein Style</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap');
        
        :root {
            --amazon-orange: #febd69;
            --amazon-dark: #232f3e;
            --amazon-yellow: #ff9900;
            --sale-red: #fa6338;
            --light-bg: #f7f7f7;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { background: var(--light-bg); color: #222; font-family: 'Cairo', sans-serif; margin: 0; padding-bottom: 100px; overflow-x: hidden; }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
        .main-header { background: var(--amazon-dark); padding: 15px; position: sticky; top: 0; z-index: 2000; text-align: center; }
        .logo-area h1 { color: var(--amazon-orange); margin: 0; font-size: 24px; font-weight: 900; }
        .logo-area p { color: #fff; margin: 0; font-size: 12px; opacity: 0.9; }

        /* Ø§Ù„Ø¨Ø­Ø« */
        .search-container { display: flex; margin-top: 12px; background: #fff; border-radius: 8px; overflow: hidden; }
        .search-container input { border: none; padding: 12px; width: 100%; font-family: 'Cairo'; outline: none; }
        .search-container button { background: var(--amazon-orange); border: none; padding: 0 15px; cursor: pointer; font-size: 18px; }

        /* Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª */
        .section-title { padding: 20px 15px 10px; font-weight: 900; font-size: 18px; display: flex; align-items: center; gap: 8px; }
        .product-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding: 12px; }

        /* ÙƒØ±Øª Ø§Ù„Ù…Ù†ØªØ¬ - Ø³ØªØ§ÙŠÙ„ Ø´ÙŠ Ø¥Ù† */
        .p-card { background: #fff; border-radius: 12px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.05); position: relative; }
        
        /* Ø³Ù„Ø§ÙŠØ¯Ø± Ø§Ù„ØµÙˆØ± */
        .image-slider { position: relative; width: 100%; height: 230px; overflow: hidden; display: flex; }
        .image-slider img { width: 100%; height: 100%; object-fit: cover; flex-shrink: 0; transition: transform 0.4s ease; }
        
        .slider-dots { position: absolute; bottom: 10px; width: 100%; display: flex; justify-content: center; gap: 5px; z-index: 10; }
        .dot { width: 6px; height: 6px; background: rgba(255,255,255,0.5); border-radius: 50%; transition: 0.3s; }
        .dot.active { background: #fff; width: 15px; border-radius: 10px; }

        .sale-tag { position: absolute; top: 10px; right: 10px; background: var(--sale-red); color: #fff; padding: 3px 8px; border-radius: 4px; font-size: 10px; font-weight: 900; z-index: 20; }
        .fav-btn { position: absolute; top: 10px; left: 10px; background: rgba(255,255,255,0.8); border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; z-index: 20; color: #ccc; cursor: pointer; transition: 0.3s; }
        .fav-btn.active { color: #ff4757; }

        .p-info { padding: 12px; text-align: center; }
        .p-name { font-size: 13px; font-weight: 600; height: 36px; overflow: hidden; margin-bottom: 5px; color: #444; }
        .price-box { display: flex; flex-direction: column; align-items: center; gap: 2px; }
        .old-p { color: #999; text-decoration: line-through; font-size: 11px; }
        .new-p { color: var(--sale-red); font-size: 16px; font-weight: 900; }

        .btn-add { background: linear-gradient(180deg, #ffdb7d 0%, #ffbb00 100%); border: 1px solid #d4a017; width: 100%; padding: 10px; border-radius: 8px; font-family: 'Cairo'; font-weight: 700; margin-top: 10px; cursor: pointer; font-size: 13px; }

        /* Ø§Ù„Ø¨Ø§Ø± Ø§Ù„Ø³ÙÙ„ÙŠ */
        .nav-bar { position: fixed; bottom: 0; width: 100%; background: #fff; display: flex; justify-content: space-around; padding: 10px 0; border-top: 1px solid #eee; z-index: 3000; box-shadow: 0 -5px 15px rgba(0,0,0,0.03); }
        .nav-link { text-align: center; color: #666; font-size: 10px; font-weight: 700; text-decoration: none; position: relative; flex: 1; }
        .nav-link i { display: block; font-size: 22px; font-style: normal; margin-bottom: 4px; }
        .nav-link.active { color: var(--amazon-yellow); }
        .count-badge { position: absolute; top: -5px; right: 25%; background: var(--amazon-yellow); color: #000; font-size: 10px; font-weight: 900; min-width: 18px; height: 18px; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 2px solid #fff; }
    </style>
</head>
<body>

<header class="main-header">
    <div class="logo-area">
        <h1>VIRA<span> MALL</span></h1>
        <p>Ø®ÙŠØ§Ø±ÙƒÙ Ø§Ù„Ø£ÙˆÙ„ Ù„Ù„Ø£Ù†Ø§Ù‚Ø© ÙˆØ§Ù„Ø±ÙØ§Ù‡ÙŠØ© âœ¨</p>
    </div>
    <div class="search-container">
        <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø«ÙŠ Ø¹Ù† ÙØ³ØªØ§Ù†ØŒ ØªØ®ÙÙŠØ¶Ø§Øª..." oninput="doSearch()">
        <button>ğŸ”</button>
    </div>
</header>

<div id="flashSales"></div>
<div class="section-title">ğŸ“¦ ÙˆØµÙ„ Ø­Ø¯ÙŠØ«Ø§Ù‹</div>
<div id="productList" class="product-grid"></div>

<nav class="nav-bar">
    <a href="#" class="nav-link active"><i>ğŸ </i>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
    <a href="javascript:void(0)" class="nav-link" onclick="alert('ØªÙˆØµÙŠÙ„Ù†Ø§ Ø³Ø±ÙŠØ¹ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª ğŸšš')"><i>ğŸšš</i>Ø§Ù„ØªÙˆØµÙŠÙ„</a>
    <a href="javascript:void(0)" class="nav-link"><i>â¤ï¸</i>Ø§Ù„Ù…ÙØ¶Ù„Ø©<span id="favCount" class="count-badge" style="display:none">0</span></a>
    <a href="javascript:void(0)" class="nav-link" onclick="sendToWhatsApp()"><i>ğŸ›’</i>Ø§Ù„Ø­Ù‚ÙŠØ¨Ø©<span id="cartCount" class="count-badge" style="display:none">0</span></a>
    <a href="https://wa.me/249967584275" class="nav-link"><i>ğŸ’¬</i>ØªÙˆØ§ØµÙ„</a>
</nav>

<script>
    const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTWD0ZQAKe2KRwLQnNjh2t7Z2Y_BKXxaKZxZwKSXUaZLQ3eeLB1fwj6vNllpNwXCtd9aY9Q_tuuFXXV/pub?output=csv';
    let allProducts = [], cart = [], favorites = [];

    async function loadData() {
        try {
            const r = await fetch(sheetUrl + '&t=' + Date.now());
            const data = await r.text();
            const rows = data.split('\n').slice(1);
            allProducts = rows.map(row => {
                const c = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                return {
                    name: c[0]?.replace(/"/g,''),
                    price: c[1]?.trim(),
                    shop: c[2],
                    images: c[3]?.replace(/"/g,'').split(',').map(img => img.trim()),
                    oldPrice: c[4]?.trim()
                };
            }).filter(p => p.name && p.price && !p.price.includes('wa.me')); // ØªÙ†Ø¸ÙŠÙ Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³
            render();
        } catch (e) { console.error("Data Load Error"); }
    }

    function render() {
        const sales = allProducts.filter(p => p.oldPrice && p.oldPrice.length > 1);
        if(sales.length > 0) {
            document.getElementById('flashSales').innerHTML = `<div class="section-title">ğŸ”¥ Ø¹Ø±ÙˆØ¶ Ù†Ø§Ø±ÙŠØ©</div><div class="product-grid">${sales.map(p => createCard(p)).join('')}</div>`;
        }
        document.getElementById('productList').innerHTML = allProducts.map(p => createCard(p)).join('');
    }

    function createCard(p) {
        const hasSale = p.oldPrice && p.oldPrice.length > 1;
        const cardId = `card-${Math.random().toString(36).substr(2, 9)}`;
        return `
            <div class="p-card" id="${cardId}">
                ${hasSale ? '<div class="sale-tag">Ø®ØµÙ… %</div>' : ''}
                <div class="fav-btn" onclick="toggleFav(this)">â¤</div>
                <div class="image-slider" onclick="slideNext('${cardId}')">
                    ${p.images.map(img => `<img src="${img}" onerror="this.src='https://via.placeholder.com/400x500?text=VIRA+MALL'">`).join('')}
                    <div class="slider-dots">
                        ${p.images.map((_, i) => `<div class="dot ${i===0?'active':''}"></div>`).join('')}
                    </div>
                </div>
                <div class="p-info">
                    <div class="p-name">${p.name}</div>
                    <div class="price-box">
                        ${hasSale ? `<span class="old-p">${p.oldPrice} SDG</span>` : ''}
                        <span class="new-p">${p.price} SDG</span>
                    </div>
                    <button class="btn-add" onclick="addToCart('${p.name}', '${p.price}')">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©</button>
                </div>
            </div>`;
    }

    function slideNext(cardId) {
        const card = document.getElementById(cardId);
        const slider = card.querySelector('.image-slider');
        const imgs = slider.querySelectorAll('img');
        const dots = slider.querySelectorAll('.dot');
        let current = parseInt(slider.dataset.index || 0);
        
        current = (current + 1) % imgs.length;
        imgs.forEach(img => img.style.transform = `translateX(${current * 100}%)`);
        dots.forEach((dot, i) => dot.classList.toggle('active', i === current));
        slider.dataset.index = current;
    }

    function addToCart(n, p) {
        cart.push({n, p});
        const badge = document.getElementById('cartCount');
        badge.innerText = cart.length; badge.style.display = 'flex';
    }

    function toggleFav(btn) {
        btn.classList.toggle('active');
        const count = document.querySelectorAll('.fav-btn.active').length;
        const badge = document.getElementById('favCount');
        badge.innerText = count; badge.style.display = count > 0 ? 'flex' : 'none';
    }

    function sendToWhatsApp() {
        if(cart.length === 0) return alert("Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©!");
        let msg = "Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ù† VIRA MALL ğŸ›ï¸:\n" + cart.map((it, i) => `${i+1}. ${it.n} (${it.p} SDG)`).join('\n');
        window.open(`https://wa.me/249967584275?text=${encodeURIComponent(msg)}`);
    }

    function doSearch() {
        const query = document.getElementById('searchInput').value.toLowerCase();
        const filtered = allProducts.filter(p => p.name.toLowerCase().includes(query));
        document.getElementById('productList').innerHTML = filtered.map(p => createCard(p)).join('');
    }

    loadData();
</script>
</body>
</html>
