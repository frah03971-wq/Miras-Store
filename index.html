<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VIRA MALL | Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap');
        
        :root {
            --amazon-orange: #febd69;
            --amazon-dark: #232f3e;
            --amazon-yellow: #ff9900;
            --sale-red: #fa6338;
            --bg: #f1f2f6;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { background: var(--bg); color: #222; font-family: 'Cairo', sans-serif; margin: 0; padding-bottom: 110px; overflow-x: hidden; }

        /* Header */
        .main-header { background: var(--amazon-dark); padding: 15px; position: sticky; top: 0; z-index: 2000; text-align: center; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .logo-area h1 { color: var(--amazon-orange); margin: 0; font-size: 26px; font-weight: 900; letter-spacing: 1px; }
        .logo-area p { color: #fff; margin: 0; font-size: 13px; opacity: 0.9; }

        .search-wrapper { display: flex; margin-top: 15px; background: #fff; border-radius: 8px; overflow: hidden; height: 45px; }
        .search-wrapper input { border: none; padding: 0 15px; width: 100%; font-family: 'Cairo'; font-size: 14px; }
        .search-wrapper button { background: var(--amazon-orange); border: none; padding: 0 20px; cursor: pointer; font-size: 18px; }

        /* Shop Sections */
        .shop-container { margin-bottom: 25px; background: #fff; padding-bottom: 15px; }
        .shop-header { padding: 15px; background: #fff; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid #f0f0f0; }
        .shop-header h2 { font-size: 18px; font-weight: 900; margin: 0; color: var(--amazon-dark); }
        .shop-header span { color: var(--amazon-yellow); font-size: 12px; font-weight: 700; }

        .product-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 10px; }

        /* Product Card - Shein Style */
        .p-card { background: #fff; border-radius: 12px; overflow: hidden; position: relative; border: 1px solid #eee; transition: 0.3s; }
        .slider-box { position: relative; width: 100%; height: 220px; overflow: hidden; display: flex; touch-action: pan-y; }
        .slider-box img { width: 100%; height: 100%; object-fit: cover; flex-shrink: 0; transition: 0.4s ease-in-out; }
        
        .dots-container { position: absolute; bottom: 8px; width: 100%; display: flex; justify-content: center; gap: 4px; z-index: 10; }
        .dot { width: 6px; height: 6px; background: rgba(255,255,255,0.4); border-radius: 50%; }
        .dot.active { background: #fff; width: 14px; border-radius: 10px; }

        .sale-label { position: absolute; top: 10px; right: 10px; background: var(--sale-red); color: #fff; padding: 4px 8px; border-radius: 4px; font-size: 10px; font-weight: 900; z-index: 15; }
        .fav-heart { position: absolute; top: 10px; left: 10px; background: rgba(255,255,255,0.9); border-radius: 50%; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; z-index: 15; color: #ddd; font-size: 18px; }
        .fav-heart.active { color: #ff4757; }

        .p-details { padding: 10px; text-align: center; }
        .p-title { font-size: 13px; font-weight: 700; height: 36px; overflow: hidden; margin-bottom: 8px; color: #333; }
        .p-pricing { display: flex; flex-direction: column; align-items: center; margin-bottom: 10px; }
        .old-val { color: #999; text-decoration: line-through; font-size: 11px; }
        .new-val { color: var(--sale-red); font-size: 16px; font-weight: 900; }

        .buy-btn { background: linear-gradient(180deg, #ffdb7d 0%, #ffbb00 100%); border: 1px solid #c89411; width: 100%; padding: 10px; border-radius: 8px; font-family: 'Cairo'; font-weight: 700; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }

        /* Navbar */
        .bottom-bar { position: fixed; bottom: 0; width: 100%; background: #fff; display: flex; justify-content: space-around; padding: 12px 0; border-top: 1px solid #ddd; z-index: 3000; }
        .bar-item { text-align: center; text-decoration: none; color: #555; font-size: 11px; font-weight: 700; flex: 1; position: relative; }
        .bar-item i { display: block; font-size: 24px; font-style: normal; margin-bottom: 4px; }
        .bar-item.active { color: var(--amazon-yellow); }
        .notif-badge { position: absolute; top: -8px; left: 55%; background: var(--amazon-yellow); color: #222; font-size: 10px; font-weight: 900; min-width: 18px; height: 18px; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 2px solid #fff; }
    </style>
</head>
<body>

<header class="main-header">
    <div class="logo-area">
        <h1>VIRA<span> MALL</span></h1>
        <p>Ø®ÙŠØ§Ø±ÙƒÙ Ø§Ù„Ø£ÙˆÙ„ Ù„Ù„Ø£Ù†Ø§Ù‚Ø© ÙˆØ§Ù„Ø±ÙØ§Ù‡ÙŠØ© âœ¨</p>
    </div>
    <div class="search-wrapper">
        <input type="text" id="aiSearch" placeholder="Ø§Ø¨Ø­Ø«ÙŠ Ø¹Ù† ÙØ³Ø§ØªÙŠÙ†ØŒ Ø¹Ø±ÙˆØ¶ØŒ ÙƒÙˆÙ„ÙŠÙƒØ´Ù†..." oninput="searchMaster()">
        <button>ğŸ”</button>
    </div>
</header>

<div id="dynamicContent">
    </div>

<nav class="bottom-bar">
    <a href="#" class="bar-item active"><i>ğŸ </i>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
    <a href="javascript:void(0)" class="bar-item" onclick="alert('ØªÙˆØµÙŠÙ„Ù†Ø§ Ø³Ø±ÙŠØ¹ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª ğŸšš')"><i>ğŸšš</i>Ø§Ù„ØªÙˆØµÙŠÙ„</a>
    <a href="javascript:void(0)" class="bar-item"><i>â¤ï¸</i>Ø§Ù„Ù…ÙØ¶Ù„Ø©<span id="favCount" class="notif-badge" style="display:none">0</span></a>
    <a href="javascript:void(0)" class="bar-item" onclick="checkout()"><i>ğŸ›’</i>Ø§Ù„Ø­Ù‚ÙŠØ¨Ø©<span id="cartCount" class="notif-badge" style="display:none">0</span></a>
    <a href="https://wa.me/249967584275" class="bar-item"><i>ğŸ’¬</i>ØªÙˆØ§ØµÙ„</a>
</nav>

<script>
    const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTWD0ZQAKe2KRwLQnNjh2t7Z2Y_BKXxaKZxZwKSXUaZLQ3eeLB1fwj6vNllpNwXCtd9aY9Q_tuuFXXV/pub?output=csv';
    let database = [], cart = [];

    async function startApp() {
        const resp = await fetch(sheetUrl + '&t=' + Date.now());
        const csvText = await resp.text();
        const lines = csvText.split('\n').slice(1);
        
        database = lines.map(line => {
            const parts = line.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
            // ÙÙ„ØªØ± Ø°ÙƒÙŠ Ù„ØªÙ†Ø¸ÙŠÙ Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ù…Ù† Ø®Ø§Ù†Ø© Ø§Ù„Ø³Ø¹Ø±
            const cleanPrice = (val) => (val && !val.includes('wa.me') && !val.includes('http')) ? val.trim() : "";
            
            return {
                name: parts[0]?.replace(/"/g,''),
                price: cleanPrice(parts[1]),
                shop: parts[2]?.trim() || "VIRA Brand",
                images: parts[3]?.replace(/"/g,'').split(',').map(s => s.trim()),
                oldPrice: cleanPrice(parts[4])
            };
        }).filter(p => p.name && p.price);
        
        renderHome();
    }

    function renderHome() {
        const shops = [...new Set(database.map(p => p.shop))];
        let html = '';
        
        shops.forEach(shopName => {
            const items = database.filter(p => p.shop === shopName);
            html += `
                <div class="shop-container">
                    <div class="shop-header"><h2>${shopName}</h2><span>Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„ â¯</span></div>
                    <div class="product-grid">
                        ${items.map(p => createCard(p)).join('')}
                    </div>
                </div>`;
        });
        document.getElementById('dynamicContent').innerHTML = html;
    }

    function createCard(p) {
        const hasSale = p.oldPrice && p.oldPrice.length > 0;
        const cid = `c${Math.random().toString(36).substr(2, 5)}`;
        return `
            <div class="p-card" id="${cid}">
                ${hasSale ? '<div class="sale-label">Ø®ØµÙ… %</div>' : ''}
                <div class="fav-heart" onclick="this.classList.toggle('active')">â¤</div>
                <div class="slider-box" onclick="nextSlide('${cid}')">
                    ${p.images.map(src => `<img src="${src}" onerror="this.src='https://via.placeholder.com/400x500?text=VIRA+MALL'">`).join('')}
                    <div class="dots-container">
                        ${p.images.map((_, i) => `<div class="dot ${i===0?'active':''}"></div>`).join('')}
                    </div>
                </div>
                <div class="p-details">
                    <div class="p-title">${p.name}</div>
                    <div class="p-pricing">
                        ${hasSale ? `<span class="old-val">${p.oldPrice} SDG</span>` : ''}
                        <span class="new-val">${p.price} SDG</span>
                    </div>
                    <button class="buy-btn" onclick="addToCart('${p.name}', '${p.price}')">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©</button>
                </div>
            </div>`;
    }

    function nextSlide(cid) {
        const el = document.getElementById(cid);
        const slider = el.querySelector('.slider-box');
        const imgs = slider.querySelectorAll('img');
        const dots = el.querySelectorAll('.dot');
        let idx = parseInt(slider.dataset.idx || 0);
        
        idx = (idx + 1) % imgs.length;
        imgs.forEach(img => img.style.transform = `translateX(${idx * 100}%)`);
        dots.forEach((d, i) => d.classList.toggle('active', i === idx));
        slider.dataset.idx = idx;
    }

    function addToCart(n, p) {
        cart.push({n, p});
        const b = document.getElementById('cartCount');
        b.innerText = cart.length; b.style.display = 'flex';
    }

    function checkout() {
        if(!cart.length) return alert("Ø³Ù„ØªÙƒ ÙØ§Ø±ØºØ©!");
        let m = "Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ù† VIRA MALL ğŸ›’:\n" + cart.map((it, i) => `${i+1}. ${it.n} (${it.p} SDG)`).join('\n');
        window.open(`https://wa.me/249967584275?text=${encodeURIComponent(m)}`);
    }

    function searchMaster() {
        const q = document.getElementById('aiSearch').value.toLowerCase();
        const f = database.filter(p => p.name.toLowerCase().includes(q) || p.shop.toLowerCase().includes(q));
        document.getElementById('dynamicContent').innerHTML = `<div class="product-grid">${f.map(p => createCard(p)).join('')}</div>`;
    }

    startApp();
</script>
</body>
</html>
